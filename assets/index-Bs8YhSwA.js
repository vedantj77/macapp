(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function Ox(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var d1={exports:{}},ty={};var Gw;function iG(){if(Gw)return ty;Gw=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,i,s){var a=null;if(s!==void 0&&(a=""+s),i.key!==void 0&&(a=""+i.key),"key"in i){s={};for(var o in i)o!=="key"&&(s[o]=i[o])}else s=i;return i=s.ref,{$$typeof:r,type:n,key:a,ref:i!==void 0?i:null,props:s}}return ty.Fragment=e,ty.jsx=t,ty.jsxs=t,ty}var Hw;function sG(){return Hw||(Hw=1,d1.exports=iG()),d1.exports}var ye=sG(),p1={exports:{}},wn={};var zw;function rG(){if(zw)return wn;zw=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),v=Symbol.iterator;function y(X){return X===null||typeof X!="object"?null:(X=v&&X[v]||X["@@iterator"],typeof X=="function"?X:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,E={};function b(X,ne,xe){this.props=X,this.context=ne,this.refs=E,this.updater=xe||x}b.prototype.isReactComponent={},b.prototype.setState=function(X,ne){if(typeof X!="object"&&typeof X!="function"&&X!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,X,ne,"setState")},b.prototype.forceUpdate=function(X){this.updater.enqueueForceUpdate(this,X,"forceUpdate")};function T(){}T.prototype=b.prototype;function R(X,ne,xe){this.props=X,this.context=ne,this.refs=E,this.updater=xe||x}var D=R.prototype=new T;D.constructor=R,S(D,b.prototype),D.isPureReactComponent=!0;var P=Array.isArray;function O(){}var N={H:null,A:null,T:null,S:null},U=Object.prototype.hasOwnProperty;function B(X,ne,xe){var _e=xe.ref;return{$$typeof:r,type:X,key:ne,ref:_e!==void 0?_e:null,props:xe}}function I(X,ne){return B(X.type,ne,X.props)}function z(X){return typeof X=="object"&&X!==null&&X.$$typeof===r}function W(X){var ne={"=":"=0",":":"=2"};return"$"+X.replace(/[=:]/g,function(xe){return ne[xe]})}var Z=/\/+/g;function te(X,ne){return typeof X=="object"&&X!==null&&X.key!=null?W(""+X.key):ne.toString(36)}function re(X){switch(X.status){case"fulfilled":return X.value;case"rejected":throw X.reason;default:switch(typeof X.status=="string"?X.then(O,O):(X.status="pending",X.then(function(ne){X.status==="pending"&&(X.status="fulfilled",X.value=ne)},function(ne){X.status==="pending"&&(X.status="rejected",X.reason=ne)})),X.status){case"fulfilled":return X.value;case"rejected":throw X.reason}}throw X}function k(X,ne,xe,_e,Be){var pe=typeof X;(pe==="undefined"||pe==="boolean")&&(X=null);var be=!1;if(X===null)be=!0;else switch(pe){case"bigint":case"string":case"number":be=!0;break;case"object":switch(X.$$typeof){case r:case e:be=!0;break;case h:return be=X._init,k(be(X._payload),ne,xe,_e,Be)}}if(be)return Be=Be(X),be=_e===""?"."+te(X,0):_e,P(Be)?(xe="",be!=null&&(xe=be.replace(Z,"$&/")+"/"),k(Be,ne,xe,"",function(St){return St})):Be!=null&&(z(Be)&&(Be=I(Be,xe+(Be.key==null||X&&X.key===Be.key?"":(""+Be.key).replace(Z,"$&/")+"/")+be)),ne.push(Be)),1;be=0;var je=_e===""?".":_e+":";if(P(X))for(var gt=0;gt<X.length;gt++)_e=X[gt],pe=je+te(_e,gt),be+=k(_e,ne,xe,pe,Be);else if(gt=y(X),typeof gt=="function")for(X=gt.call(X),gt=0;!(_e=X.next()).done;)_e=_e.value,pe=je+te(_e,gt++),be+=k(_e,ne,xe,pe,Be);else if(pe==="object"){if(typeof X.then=="function")return k(re(X),ne,xe,_e,Be);throw ne=String(X),Error("Objects are not valid as a React child (found: "+(ne==="[object Object]"?"object with keys {"+Object.keys(X).join(", ")+"}":ne)+"). If you meant to render a collection of children, use an array instead.")}return be}function j(X,ne,xe){if(X==null)return X;var _e=[],Be=0;return k(X,_e,"","",function(pe){return ne.call(xe,pe,Be++)}),_e}function J(X){if(X._status===-1){var ne=X._result;ne=ne(),ne.then(function(xe){(X._status===0||X._status===-1)&&(X._status=1,X._result=xe)},function(xe){(X._status===0||X._status===-1)&&(X._status=2,X._result=xe)}),X._status===-1&&(X._status=0,X._result=ne)}if(X._status===1)return X._result.default;throw X._result}var oe=typeof reportError=="function"?reportError:function(X){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ne=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof X=="object"&&X!==null&&typeof X.message=="string"?String(X.message):String(X),error:X});if(!window.dispatchEvent(ne))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",X);return}console.error(X)},K={map:j,forEach:function(X,ne,xe){j(X,function(){ne.apply(this,arguments)},xe)},count:function(X){var ne=0;return j(X,function(){ne++}),ne},toArray:function(X){return j(X,function(ne){return ne})||[]},only:function(X){if(!z(X))throw Error("React.Children.only expected to receive a single React element child.");return X}};return wn.Activity=p,wn.Children=K,wn.Component=b,wn.Fragment=t,wn.Profiler=i,wn.PureComponent=R,wn.StrictMode=n,wn.Suspense=c,wn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=N,wn.__COMPILER_RUNTIME={__proto__:null,c:function(X){return N.H.useMemoCache(X)}},wn.cache=function(X){return function(){return X.apply(null,arguments)}},wn.cacheSignal=function(){return null},wn.cloneElement=function(X,ne,xe){if(X==null)throw Error("The argument must be a React element, but you passed "+X+".");var _e=S({},X.props),Be=X.key;if(ne!=null)for(pe in ne.key!==void 0&&(Be=""+ne.key),ne)!U.call(ne,pe)||pe==="key"||pe==="__self"||pe==="__source"||pe==="ref"&&ne.ref===void 0||(_e[pe]=ne[pe]);var pe=arguments.length-2;if(pe===1)_e.children=xe;else if(1<pe){for(var be=Array(pe),je=0;je<pe;je++)be[je]=arguments[je+2];_e.children=be}return B(X.type,Be,_e)},wn.createContext=function(X){return X={$$typeof:a,_currentValue:X,_currentValue2:X,_threadCount:0,Provider:null,Consumer:null},X.Provider=X,X.Consumer={$$typeof:s,_context:X},X},wn.createElement=function(X,ne,xe){var _e,Be={},pe=null;if(ne!=null)for(_e in ne.key!==void 0&&(pe=""+ne.key),ne)U.call(ne,_e)&&_e!=="key"&&_e!=="__self"&&_e!=="__source"&&(Be[_e]=ne[_e]);var be=arguments.length-2;if(be===1)Be.children=xe;else if(1<be){for(var je=Array(be),gt=0;gt<be;gt++)je[gt]=arguments[gt+2];Be.children=je}if(X&&X.defaultProps)for(_e in be=X.defaultProps,be)Be[_e]===void 0&&(Be[_e]=be[_e]);return B(X,pe,Be)},wn.createRef=function(){return{current:null}},wn.forwardRef=function(X){return{$$typeof:o,render:X}},wn.isValidElement=z,wn.lazy=function(X){return{$$typeof:h,_payload:{_status:-1,_result:X},_init:J}},wn.memo=function(X,ne){return{$$typeof:u,type:X,compare:ne===void 0?null:ne}},wn.startTransition=function(X){var ne=N.T,xe={};N.T=xe;try{var _e=X(),Be=N.S;Be!==null&&Be(xe,_e),typeof _e=="object"&&_e!==null&&typeof _e.then=="function"&&_e.then(O,oe)}catch(pe){oe(pe)}finally{ne!==null&&xe.types!==null&&(ne.types=xe.types),N.T=ne}},wn.unstable_useCacheRefresh=function(){return N.H.useCacheRefresh()},wn.use=function(X){return N.H.use(X)},wn.useActionState=function(X,ne,xe){return N.H.useActionState(X,ne,xe)},wn.useCallback=function(X,ne){return N.H.useCallback(X,ne)},wn.useContext=function(X){return N.H.useContext(X)},wn.useDebugValue=function(){},wn.useDeferredValue=function(X,ne){return N.H.useDeferredValue(X,ne)},wn.useEffect=function(X,ne){return N.H.useEffect(X,ne)},wn.useEffectEvent=function(X){return N.H.useEffectEvent(X)},wn.useId=function(){return N.H.useId()},wn.useImperativeHandle=function(X,ne,xe){return N.H.useImperativeHandle(X,ne,xe)},wn.useInsertionEffect=function(X,ne){return N.H.useInsertionEffect(X,ne)},wn.useLayoutEffect=function(X,ne){return N.H.useLayoutEffect(X,ne)},wn.useMemo=function(X,ne){return N.H.useMemo(X,ne)},wn.useOptimistic=function(X,ne){return N.H.useOptimistic(X,ne)},wn.useReducer=function(X,ne,xe){return N.H.useReducer(X,ne,xe)},wn.useRef=function(X){return N.H.useRef(X)},wn.useState=function(X){return N.H.useState(X)},wn.useSyncExternalStore=function(X,ne,xe){return N.H.useSyncExternalStore(X,ne,xe)},wn.useTransition=function(){return N.H.useTransition()},wn.version="19.2.0",wn}var Vw;function bg(){return Vw||(Vw=1,p1.exports=rG()),p1.exports}var Fe=bg();const Ey=Ox(Fe);var m1={exports:{}},ny={},g1={exports:{}},v1={};var Yw;function aG(){return Yw||(Yw=1,(function(r){function e(k,j){var J=k.length;k.push(j);e:for(;0<J;){var oe=J-1>>>1,K=k[oe];if(0<i(K,j))k[oe]=j,k[J]=K,J=oe;else break e}}function t(k){return k.length===0?null:k[0]}function n(k){if(k.length===0)return null;var j=k[0],J=k.pop();if(J!==j){k[0]=J;e:for(var oe=0,K=k.length,X=K>>>1;oe<X;){var ne=2*(oe+1)-1,xe=k[ne],_e=ne+1,Be=k[_e];if(0>i(xe,J))_e<K&&0>i(Be,xe)?(k[oe]=Be,k[_e]=J,oe=_e):(k[oe]=xe,k[ne]=J,oe=ne);else if(_e<K&&0>i(Be,J))k[oe]=Be,k[_e]=J,oe=_e;else break e}}return j}function i(k,j){var J=k.sortIndex-j.sortIndex;return J!==0?J:k.id-j.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();r.unstable_now=function(){return a.now()-o}}var c=[],u=[],h=1,p=null,v=3,y=!1,x=!1,S=!1,E=!1,b=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function D(k){for(var j=t(u);j!==null;){if(j.callback===null)n(u);else if(j.startTime<=k)n(u),j.sortIndex=j.expirationTime,e(c,j);else break;j=t(u)}}function P(k){if(S=!1,D(k),!x)if(t(c)!==null)x=!0,O||(O=!0,W());else{var j=t(u);j!==null&&re(P,j.startTime-k)}}var O=!1,N=-1,U=5,B=-1;function I(){return E?!0:!(r.unstable_now()-B<U)}function z(){if(E=!1,O){var k=r.unstable_now();B=k;var j=!0;try{e:{x=!1,S&&(S=!1,T(N),N=-1),y=!0;var J=v;try{t:{for(D(k),p=t(c);p!==null&&!(p.expirationTime>k&&I());){var oe=p.callback;if(typeof oe=="function"){p.callback=null,v=p.priorityLevel;var K=oe(p.expirationTime<=k);if(k=r.unstable_now(),typeof K=="function"){p.callback=K,D(k),j=!0;break t}p===t(c)&&n(c),D(k)}else n(c);p=t(c)}if(p!==null)j=!0;else{var X=t(u);X!==null&&re(P,X.startTime-k),j=!1}}break e}finally{p=null,v=J,y=!1}j=void 0}}finally{j?W():O=!1}}}var W;if(typeof R=="function")W=function(){R(z)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,te=Z.port2;Z.port1.onmessage=z,W=function(){te.postMessage(null)}}else W=function(){b(z,0)};function re(k,j){N=b(function(){k(r.unstable_now())},j)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(k){k.callback=null},r.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):U=0<k?Math.floor(1e3/k):5},r.unstable_getCurrentPriorityLevel=function(){return v},r.unstable_next=function(k){switch(v){case 1:case 2:case 3:var j=3;break;default:j=v}var J=v;v=j;try{return k()}finally{v=J}},r.unstable_requestPaint=function(){E=!0},r.unstable_runWithPriority=function(k,j){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var J=v;v=k;try{return j()}finally{v=J}},r.unstable_scheduleCallback=function(k,j,J){var oe=r.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?oe+J:oe):J=oe,k){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=J+K,k={id:h++,callback:j,priorityLevel:k,startTime:J,expirationTime:K,sortIndex:-1},J>oe?(k.sortIndex=J,e(u,k),t(c)===null&&k===t(u)&&(S?(T(N),N=-1):S=!0,re(P,J-oe))):(k.sortIndex=K,e(c,k),x||y||(x=!0,O||(O=!0,W()))),k},r.unstable_shouldYield=I,r.unstable_wrapCallback=function(k){var j=v;return function(){var J=v;v=j;try{return k.apply(this,arguments)}finally{v=J}}}})(v1)),v1}var Xw;function oG(){return Xw||(Xw=1,g1.exports=aG()),g1.exports}var y1={exports:{}},Zr={};var Kw;function lG(){if(Kw)return Zr;Kw=1;var r=bg();function e(c){var u="https://react.dev/errors/"+c;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)u+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+c+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(c,u,h){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:p==null?null:""+p,children:c,containerInfo:u,implementation:h}}var a=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(c,u){if(c==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return Zr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Zr.createPortal=function(c,u){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return s(c,u,null,h)},Zr.flushSync=function(c){var u=a.T,h=n.p;try{if(a.T=null,n.p=2,c)return c()}finally{a.T=u,n.p=h,n.d.f()}},Zr.preconnect=function(c,u){typeof c=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,n.d.C(c,u))},Zr.prefetchDNS=function(c){typeof c=="string"&&n.d.D(c)},Zr.preinit=function(c,u){if(typeof c=="string"&&u&&typeof u.as=="string"){var h=u.as,p=o(h,u.crossOrigin),v=typeof u.integrity=="string"?u.integrity:void 0,y=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;h==="style"?n.d.S(c,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:p,integrity:v,fetchPriority:y}):h==="script"&&n.d.X(c,{crossOrigin:p,integrity:v,fetchPriority:y,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},Zr.preinitModule=function(c,u){if(typeof c=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var h=o(u.as,u.crossOrigin);n.d.M(c,{crossOrigin:h,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&n.d.M(c)},Zr.preload=function(c,u){if(typeof c=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var h=u.as,p=o(h,u.crossOrigin);n.d.L(c,h,{crossOrigin:p,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},Zr.preloadModule=function(c,u){if(typeof c=="string")if(u){var h=o(u.as,u.crossOrigin);n.d.m(c,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:h,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else n.d.m(c)},Zr.requestFormReset=function(c){n.d.r(c)},Zr.unstable_batchedUpdates=function(c,u){return c(u)},Zr.useFormState=function(c,u,h){return a.H.useFormState(c,u,h)},Zr.useFormStatus=function(){return a.H.useHostTransitionStatus()},Zr.version="19.2.0",Zr}var qw;function cG(){if(qw)return y1.exports;qw=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),y1.exports=lG(),y1.exports}var jw;function uG(){if(jw)return ny;jw=1;var r=oG(),e=bg(),t=cG();function n(l){var f="https://react.dev/errors/"+l;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)f+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+l+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function s(l){var f=l,g=l;if(l.alternate)for(;f.return;)f=f.return;else{l=f;do f=l,(f.flags&4098)!==0&&(g=f.return),l=f.return;while(l)}return f.tag===3?g:null}function a(l){if(l.tag===13){var f=l.memoizedState;if(f===null&&(l=l.alternate,l!==null&&(f=l.memoizedState)),f!==null)return f.dehydrated}return null}function o(l){if(l.tag===31){var f=l.memoizedState;if(f===null&&(l=l.alternate,l!==null&&(f=l.memoizedState)),f!==null)return f.dehydrated}return null}function c(l){if(s(l)!==l)throw Error(n(188))}function u(l){var f=l.alternate;if(!f){if(f=s(l),f===null)throw Error(n(188));return f!==l?null:l}for(var g=l,_=f;;){var M=g.return;if(M===null)break;var L=M.alternate;if(L===null){if(_=M.return,_!==null){g=_;continue}break}if(M.child===L.child){for(L=M.child;L;){if(L===g)return c(M),l;if(L===_)return c(M),f;L=L.sibling}throw Error(n(188))}if(g.return!==_.return)g=M,_=L;else{for(var G=!1,Q=M.child;Q;){if(Q===g){G=!0,g=M,_=L;break}if(Q===_){G=!0,_=M,g=L;break}Q=Q.sibling}if(!G){for(Q=L.child;Q;){if(Q===g){G=!0,g=L,_=M;break}if(Q===_){G=!0,_=L,g=M;break}Q=Q.sibling}if(!G)throw Error(n(189))}}if(g.alternate!==_)throw Error(n(190))}if(g.tag!==3)throw Error(n(188));return g.stateNode.current===g?l:f}function h(l){var f=l.tag;if(f===5||f===26||f===27||f===6)return l;for(l=l.child;l!==null;){if(f=h(l),f!==null)return f;l=l.sibling}return null}var p=Object.assign,v=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),R=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),U=Symbol.for("react.lazy"),B=Symbol.for("react.activity"),I=Symbol.for("react.memo_cache_sentinel"),z=Symbol.iterator;function W(l){return l===null||typeof l!="object"?null:(l=z&&l[z]||l["@@iterator"],typeof l=="function"?l:null)}var Z=Symbol.for("react.client.reference");function te(l){if(l==null)return null;if(typeof l=="function")return l.$$typeof===Z?null:l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case S:return"Fragment";case b:return"Profiler";case E:return"StrictMode";case P:return"Suspense";case O:return"SuspenseList";case B:return"Activity"}if(typeof l=="object")switch(l.$$typeof){case x:return"Portal";case R:return l.displayName||"Context";case T:return(l._context.displayName||"Context")+".Consumer";case D:var f=l.render;return l=l.displayName,l||(l=f.displayName||f.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case N:return f=l.displayName||null,f!==null?f:te(l.type)||"Memo";case U:f=l._payload,l=l._init;try{return te(l(f))}catch{}}return null}var re=Array.isArray,k=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,j=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J={pending:!1,data:null,method:null,action:null},oe=[],K=-1;function X(l){return{current:l}}function ne(l){0>K||(l.current=oe[K],oe[K]=null,K--)}function xe(l,f){K++,oe[K]=l.current,l.current=f}var _e=X(null),Be=X(null),pe=X(null),be=X(null);function je(l,f){switch(xe(pe,f),xe(Be,l),xe(_e,null),f.nodeType){case 9:case 11:l=(l=f.documentElement)&&(l=l.namespaceURI)?cw(l):0;break;default:if(l=f.tagName,f=f.namespaceURI)f=cw(f),l=uw(f,l);else switch(l){case"svg":l=1;break;case"math":l=2;break;default:l=0}}ne(_e),xe(_e,l)}function gt(){ne(_e),ne(Be),ne(pe)}function St(l){l.memoizedState!==null&&xe(be,l);var f=_e.current,g=uw(f,l.type);f!==g&&(xe(Be,l),xe(_e,g))}function At(l){Be.current===l&&(ne(_e),ne(Be)),be.current===l&&(ne(be),$v._currentValue=J)}var jt,vt;function ze(l){if(jt===void 0)try{throw Error()}catch(g){var f=g.stack.trim().match(/\n( *(at )?)/);jt=f&&f[1]||"",vt=-1<g.stack.indexOf(`
    at`)?" (<anonymous>)":-1<g.stack.indexOf("@")?"@unknown:0:0":""}return`
`+jt+l+vt}var ie=!1;function Oe(l,f){if(!l||ie)return"";ie=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var _={DetermineComponentFrameRoot:function(){try{if(f){var mt=function(){throw Error()};if(Object.defineProperty(mt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(mt,[])}catch(We){var He=We}Reflect.construct(l,[],mt)}else{try{mt.call()}catch(We){He=We}l.call(mt.prototype)}}else{try{throw Error()}catch(We){He=We}(mt=l())&&typeof mt.catch=="function"&&mt.catch(function(){})}}catch(We){if(We&&He&&typeof We.stack=="string")return[We.stack,He.stack]}return[null,null]}};_.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var M=Object.getOwnPropertyDescriptor(_.DetermineComponentFrameRoot,"name");M&&M.configurable&&Object.defineProperty(_.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var L=_.DetermineComponentFrameRoot(),G=L[0],Q=L[1];if(G&&Q){var ve=G.split(`
`),Ue=Q.split(`
`);for(M=_=0;_<ve.length&&!ve[_].includes("DetermineComponentFrameRoot");)_++;for(;M<Ue.length&&!Ue[M].includes("DetermineComponentFrameRoot");)M++;if(_===ve.length||M===Ue.length)for(_=ve.length-1,M=Ue.length-1;1<=_&&0<=M&&ve[_]!==Ue[M];)M--;for(;1<=_&&0<=M;_--,M--)if(ve[_]!==Ue[M]){if(_!==1||M!==1)do if(_--,M--,0>M||ve[_]!==Ue[M]){var nt=`
`+ve[_].replace(" at new "," at ");return l.displayName&&nt.includes("<anonymous>")&&(nt=nt.replace("<anonymous>",l.displayName)),nt}while(1<=_&&0<=M);break}}}finally{ie=!1,Error.prepareStackTrace=g}return(g=l?l.displayName||l.name:"")?ze(g):""}function ue(l,f){switch(l.tag){case 26:case 27:case 5:return ze(l.type);case 16:return ze("Lazy");case 13:return l.child!==f&&f!==null?ze("Suspense Fallback"):ze("Suspense");case 19:return ze("SuspenseList");case 0:case 15:return Oe(l.type,!1);case 11:return Oe(l.type.render,!1);case 1:return Oe(l.type,!0);case 31:return ze("Activity");default:return""}}function st(l){try{var f="",g=null;do f+=ue(l,g),g=l,l=l.return;while(l);return f}catch(_){return`
Error generating stack: `+_.message+`
`+_.stack}}var $e=Object.prototype.hasOwnProperty,_t=r.unstable_scheduleCallback,it=r.unstable_cancelCallback,Tt=r.unstable_shouldYield,se=r.unstable_requestPaint,q=r.unstable_now,Ee=r.unstable_getCurrentPriorityLevel,Ge=r.unstable_ImmediatePriority,Ve=r.unstable_UserBlockingPriority,Pe=r.unstable_NormalPriority,wt=r.unstable_LowPriority,bt=r.unstable_IdlePriority,Ft=r.log,Mt=r.unstable_setDisableYieldValue,Ze=null,Je=null;function Nt(l){if(typeof Ft=="function"&&Mt(l),Je&&typeof Je.setStrictMode=="function")try{Je.setStrictMode(Ze,l)}catch{}}var he=Math.clz32?Math.clz32:le,Ce=Math.log,tt=Math.LN2;function le(l){return l>>>=0,l===0?32:31-(Ce(l)/tt|0)|0}var Re=256,ht=262144,yt=4194304;function ut(l){var f=l&42;if(f!==0)return f;switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return l&261888;case 262144:case 524288:case 1048576:case 2097152:return l&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return l&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return l}}function Qe(l,f,g){var _=l.pendingLanes;if(_===0)return 0;var M=0,L=l.suspendedLanes,G=l.pingedLanes;l=l.warmLanes;var Q=_&134217727;return Q!==0?(_=Q&~L,_!==0?M=ut(_):(G&=Q,G!==0?M=ut(G):g||(g=Q&~l,g!==0&&(M=ut(g))))):(Q=_&~L,Q!==0?M=ut(Q):G!==0?M=ut(G):g||(g=_&~l,g!==0&&(M=ut(g)))),M===0?0:f!==0&&f!==M&&(f&L)===0&&(L=M&-M,g=f&-f,L>=g||L===32&&(g&4194048)!==0)?f:M}function Rt(l,f){return(l.pendingLanes&~(l.suspendedLanes&~l.pingedLanes)&f)===0}function Vt(l,f){switch(l){case 1:case 2:case 4:case 8:case 64:return f+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function En(){var l=yt;return yt<<=1,(yt&62914560)===0&&(yt=4194304),l}function Dt(l){for(var f=[],g=0;31>g;g++)f.push(l);return f}function Ut(l,f){l.pendingLanes|=f,f!==268435456&&(l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0)}function dn(l,f,g,_,M,L){var G=l.pendingLanes;l.pendingLanes=g,l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0,l.expiredLanes&=g,l.entangledLanes&=g,l.errorRecoveryDisabledLanes&=g,l.shellSuspendCounter=0;var Q=l.entanglements,ve=l.expirationTimes,Ue=l.hiddenUpdates;for(g=G&~g;0<g;){var nt=31-he(g),mt=1<<nt;Q[nt]=0,ve[nt]=-1;var He=Ue[nt];if(He!==null)for(Ue[nt]=null,nt=0;nt<He.length;nt++){var We=He[nt];We!==null&&(We.lane&=-536870913)}g&=~mt}_!==0&&It(l,_,0),L!==0&&M===0&&l.tag!==0&&(l.suspendedLanes|=L&~(G&~f))}function It(l,f,g){l.pendingLanes|=f,l.suspendedLanes&=~f;var _=31-he(f);l.entangledLanes|=f,l.entanglements[_]=l.entanglements[_]|1073741824|g&261930}function pn(l,f){var g=l.entangledLanes|=f;for(l=l.entanglements;g;){var _=31-he(g),M=1<<_;M&f|l[_]&f&&(l[_]|=f),g&=~M}}function Wt(l,f){var g=f&-f;return g=(g&42)!==0?1:$t(g),(g&(l.suspendedLanes|f))!==0?0:g}function $t(l){switch(l){case 2:l=1;break;case 8:l=4;break;case 32:l=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:l=128;break;case 268435456:l=134217728;break;default:l=0}return l}function ai(l){return l&=-l,2<l?8<l?(l&134217727)!==0?32:268435456:8:2}function hn(){var l=j.p;return l!==0?l:(l=window.event,l===void 0?32:Bw(l.type))}function Yt(l,f){var g=j.p;try{return j.p=l,f()}finally{j.p=g}}var Xn=Math.random().toString(36).slice(2),Jt="__reactFiber$"+Xn,V="__reactProps$"+Xn,$="__reactContainer$"+Xn,me="__reactEvents$"+Xn,De="__reactListeners$"+Xn,Ye="__reactHandles$"+Xn,Xe="__reactResources$"+Xn,dt="__reactMarker$"+Xn;function rt(l){delete l[Jt],delete l[V],delete l[me],delete l[De],delete l[Ye]}function ct(l){var f=l[Jt];if(f)return f;for(var g=l.parentNode;g;){if(f=g[$]||g[Jt]){if(g=f.alternate,f.child!==null||g!==null&&g.child!==null)for(l=vw(l);l!==null;){if(g=l[Jt])return g;l=vw(l)}return f}l=g,g=l.parentNode}return null}function Y(l){if(l=l[Jt]||l[$]){var f=l.tag;if(f===5||f===6||f===13||f===31||f===26||f===27||f===3)return l}return null}function ce(l){var f=l.tag;if(f===5||f===26||f===27||f===6)return l.stateNode;throw Error(n(33))}function fe(l){var f=l[Xe];return f||(f=l[Xe]={hoistableStyles:new Map,hoistableScripts:new Map}),f}function Se(l){l[dt]=!0}var de=new Set,Ke={};function et(l,f){pt(l,f),pt(l+"Capture",f)}function pt(l,f){for(Ke[l]=f,l=0;l<f.length;l++)de.add(f[l])}var xt=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Lt={},Pt={};function Bt(l){return $e.call(Pt,l)?!0:$e.call(Lt,l)?!1:xt.test(l)?Pt[l]=!0:(Lt[l]=!0,!1)}function Kt(l,f,g){if(Bt(f))if(g===null)l.removeAttribute(f);else{switch(typeof g){case"undefined":case"function":case"symbol":l.removeAttribute(f);return;case"boolean":var _=f.toLowerCase().slice(0,5);if(_!=="data-"&&_!=="aria-"){l.removeAttribute(f);return}}l.setAttribute(f,""+g)}}function bn(l,f,g){if(g===null)l.removeAttribute(f);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(f);return}l.setAttribute(f,""+g)}}function nn(l,f,g,_){if(_===null)l.removeAttribute(g);else{switch(typeof _){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(g);return}l.setAttributeNS(f,g,""+_)}}function fn(l){switch(typeof l){case"bigint":case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function Nn(l){var f=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function sn(l,f,g){var _=Object.getOwnPropertyDescriptor(l.constructor.prototype,f);if(!l.hasOwnProperty(f)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var M=_.get,L=_.set;return Object.defineProperty(l,f,{configurable:!0,get:function(){return M.call(this)},set:function(G){g=""+G,L.call(this,G)}}),Object.defineProperty(l,f,{enumerable:_.enumerable}),{getValue:function(){return g},setValue:function(G){g=""+G},stopTracking:function(){l._valueTracker=null,delete l[f]}}}}function In(l){if(!l._valueTracker){var f=Nn(l)?"checked":"value";l._valueTracker=sn(l,f,""+l[f])}}function Qt(l){if(!l)return!1;var f=l._valueTracker;if(!f)return!0;var g=f.getValue(),_="";return l&&(_=Nn(l)?l.checked?"true":"false":l.value),l=_,l!==g?(f.setValue(l),!0):!1}function zn(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var ni=/[\n"\\]/g;function ln(l){return l.replace(ni,function(f){return"\\"+f.charCodeAt(0).toString(16)+" "})}function Ji(l,f,g,_,M,L,G,Q){l.name="",G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"?l.type=G:l.removeAttribute("type"),f!=null?G==="number"?(f===0&&l.value===""||l.value!=f)&&(l.value=""+fn(f)):l.value!==""+fn(f)&&(l.value=""+fn(f)):G!=="submit"&&G!=="reset"||l.removeAttribute("value"),f!=null?oi(l,G,fn(f)):g!=null?oi(l,G,fn(g)):_!=null&&l.removeAttribute("value"),M==null&&L!=null&&(l.defaultChecked=!!L),M!=null&&(l.checked=M&&typeof M!="function"&&typeof M!="symbol"),Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?l.name=""+fn(Q):l.removeAttribute("name")}function $n(l,f,g,_,M,L,G,Q){if(L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(l.type=L),f!=null||g!=null){if(!(L!=="submit"&&L!=="reset"||f!=null)){In(l);return}g=g!=null?""+fn(g):"",f=f!=null?""+fn(f):g,Q||f===l.value||(l.value=f),l.defaultValue=f}_=_??M,_=typeof _!="function"&&typeof _!="symbol"&&!!_,l.checked=Q?l.checked:!!_,l.defaultChecked=!!_,G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"&&(l.name=G),In(l)}function oi(l,f,g){f==="number"&&zn(l.ownerDocument)===l||l.defaultValue===""+g||(l.defaultValue=""+g)}function Ri(l,f,g,_){if(l=l.options,f){f={};for(var M=0;M<g.length;M++)f["$"+g[M]]=!0;for(g=0;g<l.length;g++)M=f.hasOwnProperty("$"+l[g].value),l[g].selected!==M&&(l[g].selected=M),M&&_&&(l[g].defaultSelected=!0)}else{for(g=""+fn(g),f=null,M=0;M<l.length;M++){if(l[M].value===g){l[M].selected=!0,_&&(l[M].defaultSelected=!0);return}f!==null||l[M].disabled||(f=l[M])}f!==null&&(f.selected=!0)}}function Ds(l,f,g){if(f!=null&&(f=""+fn(f),f!==l.value&&(l.value=f),g==null)){l.defaultValue!==f&&(l.defaultValue=f);return}l.defaultValue=g!=null?""+fn(g):""}function es(l,f,g,_){if(f==null){if(_!=null){if(g!=null)throw Error(n(92));if(re(_)){if(1<_.length)throw Error(n(93));_=_[0]}g=_}g==null&&(g=""),f=g}g=fn(f),l.defaultValue=g,_=l.textContent,_===g&&_!==""&&_!==null&&(l.value=_),In(l)}function po(l,f){if(f){var g=l.firstChild;if(g&&g===l.lastChild&&g.nodeType===3){g.nodeValue=f;return}}l.textContent=f}var Va=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Yh(l,f,g){var _=f.indexOf("--")===0;g==null||typeof g=="boolean"||g===""?_?l.setProperty(f,""):f==="float"?l.cssFloat="":l[f]="":_?l.setProperty(f,g):typeof g!="number"||g===0||Va.has(f)?f==="float"?l.cssFloat=g:l[f]=(""+g).trim():l[f]=g+"px"}function wg(l,f,g){if(f!=null&&typeof f!="object")throw Error(n(62));if(l=l.style,g!=null){for(var _ in g)!g.hasOwnProperty(_)||f!=null&&f.hasOwnProperty(_)||(_.indexOf("--")===0?l.setProperty(_,""):_==="float"?l.cssFloat="":l[_]="");for(var M in f)_=f[M],f.hasOwnProperty(M)&&g[M]!==_&&Yh(l,M,_)}else for(var L in f)f.hasOwnProperty(L)&&Yh(l,L,f[L])}function Xh(l){if(l.indexOf("-")===-1)return!1;switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var n_=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),i_=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Kh(l){return i_.test(""+l)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":l}function Yo(){}var qh=null;function jp(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var du=null,dc=null;function Ig(l){var f=Y(l);if(f&&(l=f.stateNode)){var g=l[V]||null;e:switch(l=f.stateNode,f.type){case"input":if(Ji(l,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name),f=g.name,g.type==="radio"&&f!=null){for(g=l;g.parentNode;)g=g.parentNode;for(g=g.querySelectorAll('input[name="'+ln(""+f)+'"][type="radio"]'),f=0;f<g.length;f++){var _=g[f];if(_!==l&&_.form===l.form){var M=_[V]||null;if(!M)throw Error(n(90));Ji(_,M.value,M.defaultValue,M.defaultValue,M.checked,M.defaultChecked,M.type,M.name)}}for(f=0;f<g.length;f++)_=g[f],_.form===l.form&&Qt(_)}break e;case"textarea":Ds(l,g.value,g.defaultValue);break e;case"select":f=g.value,f!=null&&Ri(l,!!g.multiple,f,!1)}}}var Wp=!1;function Bg(l,f,g){if(Wp)return l(f,g);Wp=!0;try{var _=l(f);return _}finally{if(Wp=!1,(du!==null||dc!==null)&&(ee(),du&&(f=du,l=dc,dc=du=null,Ig(f),l)))for(f=0;f<l.length;f++)Ig(l[f])}}function pu(l,f){var g=l.stateNode;if(g===null)return null;var _=g[V]||null;if(_===null)return null;g=_[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(l=l.type,_=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!_;break e;default:l=!1}if(l)return null;if(g&&typeof g!="function")throw Error(n(231,f,typeof g));return g}var Xo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Jp=!1;if(Xo)try{var jh={};Object.defineProperty(jh,"passive",{get:function(){Jp=!0}}),window.addEventListener("test",jh,jh),window.removeEventListener("test",jh,jh)}catch{Jp=!1}var pc=null,$p=null,mc=null;function Qp(){if(mc)return mc;var l,f=$p,g=f.length,_,M="value"in pc?pc.value:pc.textContent,L=M.length;for(l=0;l<g&&f[l]===M[l];l++);var G=g-l;for(_=1;_<=G&&f[g-_]===M[L-_];_++);return mc=M.slice(l,1<_?1-_:void 0)}function mu(l){var f=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&f===13&&(l=13)):l=f,l===10&&(l=13),32<=l||l===13?l:0}function Wh(){return!0}function Og(){return!1}function ur(l){function f(g,_,M,L,G){this._reactName=g,this._targetInst=M,this.type=_,this.nativeEvent=L,this.target=G,this.currentTarget=null;for(var Q in l)l.hasOwnProperty(Q)&&(g=l[Q],this[Q]=g?g(L):L[Q]);return this.isDefaultPrevented=(L.defaultPrevented!=null?L.defaultPrevented:L.returnValue===!1)?Wh:Og,this.isPropagationStopped=Og,this}return p(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():typeof g.returnValue!="unknown"&&(g.returnValue=!1),this.isDefaultPrevented=Wh)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():typeof g.cancelBubble!="unknown"&&(g.cancelBubble=!0),this.isPropagationStopped=Wh)},persist:function(){},isPersistent:Wh}),f}var gc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jh=ur(gc),mo=p({},gc,{view:0,detail:0}),Zp=ur(mo),em,$h,xf,Qh=p({},mo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ed,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==xf&&(xf&&l.type==="mousemove"?(em=l.screenX-xf.screenX,$h=l.screenY-xf.screenY):$h=em=0,xf=l),em)},movementY:function(l){return"movementY"in l?l.movementY:$h}}),s_=ur(Qh),qs=p({},Qh,{dataTransfer:0}),r_=ur(qs),a_=p({},mo,{relatedTarget:0}),tm=ur(a_),o_=p({},gc,{animationName:0,elapsedTime:0,pseudoElement:0}),l_=ur(o_),Zh=p({},gc,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),Pg=ur(Zh),c_=p({},gc,{data:0}),Ng=ur(c_),u_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ug={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Fg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function f_(l){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(l):(l=Fg[l])?!!f[l]:!1}function ed(){return f_}var kg=p({},mo,{key:function(l){if(l.key){var f=u_[l.key]||l.key;if(f!=="Unidentified")return f}return l.type==="keypress"?(l=mu(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?Ug[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ed,charCode:function(l){return l.type==="keypress"?mu(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?mu(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),Gg=ur(kg),h_=p({},Qh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nm=ur(h_),d_=p({},mo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ed}),Rl=ur(d_),Hg=p({},gc,{propertyName:0,elapsedTime:0,pseudoElement:0}),IT=ur(Hg),p_=p({},Qh,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),vc=ur(p_),Dl=p({},gc,{newState:0,oldState:0}),zg=ur(Dl),Vg=[9,13,27,32],gu=Xo&&"CompositionEvent"in window,yc=null;Xo&&"documentMode"in document&&(yc=document.documentMode);var vu=Xo&&"TextEvent"in window&&!yc,js=Xo&&(!gu||yc&&8<yc&&11>=yc),td=" ",Yg=!1;function im(l,f){switch(l){case"keyup":return Vg.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _f(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var xc=!1;function sm(l,f){switch(l){case"compositionend":return _f(f);case"keypress":return f.which!==32?null:(Yg=!0,td);case"textInput":return l=f.data,l===td&&Yg?null:l;default:return null}}function m_(l,f){if(xc)return l==="compositionend"||!gu&&im(l,f)?(l=Qp(),mc=$p=pc=null,xc=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return js&&f.locale!=="ko"?null:f.data;default:return null}}var ua={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xg(l){var f=l&&l.nodeName&&l.nodeName.toLowerCase();return f==="input"?!!ua[l.type]:f==="textarea"}function rm(l,f,g,_){du?dc?dc.push(_):dc=[_]:du=_,f=aS(f,"onChange"),0<f.length&&(g=new Jh("onChange","change",null,g,_),l.push({event:g,listeners:f}))}var Sf=null,Af=null;function Kg(l){iw(l,0)}function Ef(l){var f=ce(l);if(Qt(f))return l}function qg(l,f){if(l==="change")return f}var nd=!1;if(Xo){var yu;if(Xo){var Hi="oninput"in document;if(!Hi){var g_=document.createElement("div");g_.setAttribute("oninput","return;"),Hi=typeof g_.oninput=="function"}yu=Hi}else yu=!1;nd=yu&&(!document.documentMode||9<document.documentMode)}function v_(){Sf&&(Sf.detachEvent("onpropertychange",jg),Af=Sf=null)}function jg(l){if(l.propertyName==="value"&&Ef(Af)){var f=[];rm(f,Af,l,jp(l)),Bg(Kg,f)}}function id(l,f,g){l==="focusin"?(v_(),Sf=f,Af=g,Sf.attachEvent("onpropertychange",jg)):l==="focusout"&&v_()}function _c(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return Ef(Af)}function y_(l,f){if(l==="click")return Ef(f)}function x_(l,f){if(l==="input"||l==="change")return Ef(f)}function xu(l,f){return l===f&&(l!==0||1/l===1/f)||l!==l&&f!==f}var zi=typeof Object.is=="function"?Object.is:xu;function bf(l,f){if(zi(l,f))return!0;if(typeof l!="object"||l===null||typeof f!="object"||f===null)return!1;var g=Object.keys(l),_=Object.keys(f);if(g.length!==_.length)return!1;for(_=0;_<g.length;_++){var M=g[_];if(!$e.call(f,M)||!zi(l[M],f[M]))return!1}return!0}function Wg(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function Jg(l,f){var g=Wg(l);l=0;for(var _;g;){if(g.nodeType===3){if(_=l+g.textContent.length,l<=f&&_>=f)return{node:g,offset:f-l};l=_}e:{for(;g;){if(g.nextSibling){g=g.nextSibling;break e}g=g.parentNode}g=void 0}g=Wg(g)}}function am(l,f){return l&&f?l===f?!0:l&&l.nodeType===3?!1:f&&f.nodeType===3?am(l,f.parentNode):"contains"in l?l.contains(f):l.compareDocumentPosition?!!(l.compareDocumentPosition(f)&16):!1:!1}function om(l){l=l!=null&&l.ownerDocument!=null&&l.ownerDocument.defaultView!=null?l.ownerDocument.defaultView:window;for(var f=zn(l.document);f instanceof l.HTMLIFrameElement;){try{var g=typeof f.contentWindow.location.href=="string"}catch{g=!1}if(g)l=f.contentWindow;else break;f=zn(l.document)}return f}function Tf(l){var f=l&&l.nodeName&&l.nodeName.toLowerCase();return f&&(f==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||f==="textarea"||l.contentEditable==="true")}var __=Xo&&"documentMode"in document&&11>=document.documentMode,Mf=null,lm=null,Cf=null,fa=!1;function cm(l,f,g){var _=g.window===g?g.document:g.nodeType===9?g:g.ownerDocument;fa||Mf==null||Mf!==zn(_)||(_=Mf,"selectionStart"in _&&Tf(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),Cf&&bf(Cf,_)||(Cf=_,_=aS(lm,"onSelect"),0<_.length&&(f=new Jh("onSelect","select",null,f,g),l.push({event:f,listeners:_}),f.target=Mf)))}function Sc(l,f){var g={};return g[l.toLowerCase()]=f.toLowerCase(),g["Webkit"+l]="webkit"+f,g["Moz"+l]="moz"+f,g}var Rf={animationend:Sc("Animation","AnimationEnd"),animationiteration:Sc("Animation","AnimationIteration"),animationstart:Sc("Animation","AnimationStart"),transitionrun:Sc("Transition","TransitionRun"),transitionstart:Sc("Transition","TransitionStart"),transitioncancel:Sc("Transition","TransitionCancel"),transitionend:Sc("Transition","TransitionEnd")},sd={},Rr={};Xo&&(Rr=document.createElement("div").style,"AnimationEvent"in window||(delete Rf.animationend.animation,delete Rf.animationiteration.animation,delete Rf.animationstart.animation),"TransitionEvent"in window||delete Rf.transitionend.transition);function Ac(l){if(sd[l])return sd[l];if(!Rf[l])return l;var f=Rf[l],g;for(g in f)if(f.hasOwnProperty(g)&&g in Rr)return sd[l]=f[g];return l}var zr=Ac("animationend"),$g=Ac("animationiteration"),Ko=Ac("animationstart"),Df=Ac("transitionrun"),Ec=Ac("transitionstart"),Qg=Ac("transitioncancel"),um=Ac("transitionend"),Ll=new Map,fm="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");fm.push("scrollEnd");function fr(l,f){Ll.set(l,f),et(f,[l])}var bc=typeof reportError=="function"?reportError:function(l){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof l=="object"&&l!==null&&typeof l.message=="string"?String(l.message):String(l),error:l});if(!window.dispatchEvent(f))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",l);return}console.error(l)},Fs=[],_u=0,hm=0;function Tc(){for(var l=_u,f=hm=_u=0;f<l;){var g=Fs[f];Fs[f++]=null;var _=Fs[f];Fs[f++]=null;var M=Fs[f];Fs[f++]=null;var L=Fs[f];if(Fs[f++]=null,_!==null&&M!==null){var G=_.pending;G===null?M.next=M:(M.next=G.next,G.next=M),_.pending=M}L!==0&&dm(g,M,L)}}function rd(l,f,g,_){Fs[_u++]=l,Fs[_u++]=f,Fs[_u++]=g,Fs[_u++]=_,hm|=_,l.lanes|=_,l=l.alternate,l!==null&&(l.lanes|=_)}function Lf(l,f,g,_){return rd(l,f,g,_),wf(l)}function Mc(l,f){return rd(l,null,null,f),wf(l)}function dm(l,f,g){l.lanes|=g;var _=l.alternate;_!==null&&(_.lanes|=g);for(var M=!1,L=l.return;L!==null;)L.childLanes|=g,_=L.alternate,_!==null&&(_.childLanes|=g),L.tag===22&&(l=L.stateNode,l===null||l._visibility&1||(M=!0)),l=L,L=L.return;return l.tag===3?(L=l.stateNode,M&&f!==null&&(M=31-he(g),l=L.hiddenUpdates,_=l[M],_===null?l[M]=[f]:_.push(f),f.lane=g|536870912),L):null}function wf(l){if(50<Uu)throw Uu=0,Fu=null,Error(n(185));for(var f=l.return;f!==null;)l=f,f=l.return;return l.tag===3?l.stateNode:null}var Cc={};function S_(l,f,g,_){this.tag=l,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dr(l,f,g,_){return new S_(l,f,g,_)}function Lr(l){return l=l.prototype,!(!l||!l.isReactComponent)}function qo(l,f){var g=l.alternate;return g===null?(g=Dr(l.tag,f,l.key,l.mode),g.elementType=l.elementType,g.type=l.type,g.stateNode=l.stateNode,g.alternate=l,l.alternate=g):(g.pendingProps=f,g.type=l.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=l.flags&65011712,g.childLanes=l.childLanes,g.lanes=l.lanes,g.child=l.child,g.memoizedProps=l.memoizedProps,g.memoizedState=l.memoizedState,g.updateQueue=l.updateQueue,f=l.dependencies,g.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},g.sibling=l.sibling,g.index=l.index,g.ref=l.ref,g.refCleanup=l.refCleanup,g}function hr(l,f){l.flags&=65011714;var g=l.alternate;return g===null?(l.childLanes=0,l.lanes=f,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=g.childLanes,l.lanes=g.lanes,l.child=g.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=g.memoizedProps,l.memoizedState=g.memoizedState,l.updateQueue=g.updateQueue,l.type=g.type,f=g.dependencies,l.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),l}function ad(l,f,g,_,M,L){var G=0;if(_=l,typeof l=="function")Lr(l)&&(G=1);else if(typeof l=="string")G=X4(l,g,_e.current)?26:l==="html"||l==="head"||l==="body"?27:5;else e:switch(l){case B:return l=Dr(31,g,f,M),l.elementType=B,l.lanes=L,l;case S:return wl(g.children,M,L,f);case E:G=8,M|=24;break;case b:return l=Dr(12,g,f,M|2),l.elementType=b,l.lanes=L,l;case P:return l=Dr(13,g,f,M),l.elementType=P,l.lanes=L,l;case O:return l=Dr(19,g,f,M),l.elementType=O,l.lanes=L,l;default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case R:G=10;break e;case T:G=9;break e;case D:G=11;break e;case N:G=14;break e;case U:G=16,_=null;break e}G=29,g=Error(n(130,l===null?"null":typeof l,"")),_=null}return f=Dr(G,g,f,M),f.elementType=l,f.type=_,f.lanes=L,f}function wl(l,f,g,_){return l=Dr(7,l,_,f),l.lanes=g,l}function pm(l,f,g){return l=Dr(6,l,null,f),l.lanes=g,l}function A_(l){var f=Dr(18,null,null,0);return f.stateNode=l,f}function go(l,f,g){return f=Dr(4,l.children!==null?l.children:[],l.key,f),f.lanes=g,f.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},f}var Zg=new WeakMap;function Vr(l,f){if(typeof l=="object"&&l!==null){var g=Zg.get(l);return g!==void 0?g:(f={value:l,source:f,stack:st(f)},Zg.set(l,f),f)}return{value:l,source:f,stack:st(f)}}var vo=[],Su=0,od=null,If=0,ha=[],Yr=0,jo=null,Wo=1,Jo="";function Il(l,f){vo[Su++]=If,vo[Su++]=od,od=l,If=f}function ev(l,f,g){ha[Yr++]=Wo,ha[Yr++]=Jo,ha[Yr++]=jo,jo=l;var _=Wo;l=Jo;var M=32-he(_)-1;_&=~(1<<M),g+=1;var L=32-he(f)+M;if(30<L){var G=M-M%5;L=(_&(1<<G)-1).toString(32),_>>=G,M-=G,Wo=1<<32-he(f)+M|g<<M|_,Jo=L+l}else Wo=1<<L|g<<M|_,Jo=l}function mm(l){l.return!==null&&(Il(l,1),ev(l,1,0))}function Rc(l){for(;l===od;)od=vo[--Su],vo[Su]=null,If=vo[--Su],vo[Su]=null;for(;l===jo;)jo=ha[--Yr],ha[Yr]=null,Jo=ha[--Yr],ha[Yr]=null,Wo=ha[--Yr],ha[Yr]=null}function ld(l,f){ha[Yr++]=Wo,ha[Yr++]=Jo,ha[Yr++]=jo,Wo=f.id,Jo=f.overflow,jo=l}var ks=null,Ni=null,Qn=!1,Bl=null,Gs=!1,gm=Error(n(519));function Kn(l){var f=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw cd(Vr(f,l)),gm}function vm(l){var f=l.stateNode,g=l.type,_=l.memoizedProps;switch(f[Jt]=l,f[V]=_,g){case"dialog":Zn("cancel",f),Zn("close",f);break;case"iframe":case"object":case"embed":Zn("load",f);break;case"video":case"audio":for(g=0;g<Kv.length;g++)Zn(Kv[g],f);break;case"source":Zn("error",f);break;case"img":case"image":case"link":Zn("error",f),Zn("load",f);break;case"details":Zn("toggle",f);break;case"input":Zn("invalid",f),$n(f,_.value,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name,!0);break;case"select":Zn("invalid",f);break;case"textarea":Zn("invalid",f),es(f,_.value,_.defaultValue,_.children)}g=_.children,typeof g!="string"&&typeof g!="number"&&typeof g!="bigint"||f.textContent===""+g||_.suppressHydrationWarning===!0||ow(f.textContent,g)?(_.popover!=null&&(Zn("beforetoggle",f),Zn("toggle",f)),_.onScroll!=null&&Zn("scroll",f),_.onScrollEnd!=null&&Zn("scrollend",f),_.onClick!=null&&(f.onclick=Yo),f=!0):f=!1,f||Kn(l,!0)}function E_(l){for(ks=l.return;ks;)switch(ks.tag){case 5:case 31:case 13:Gs=!1;return;case 27:case 3:Gs=!0;return;default:ks=ks.return}}function Au(l){if(l!==ks)return!1;if(!Qn)return E_(l),Qn=!0,!1;var f=l.tag,g;if((g=f!==3&&f!==27)&&((g=f===5)&&(g=l.type,g=!(g!=="form"&&g!=="button")||QT(l.type,l.memoizedProps)),g=!g),g&&Ni&&Kn(l),E_(l),f===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(n(317));Ni=gw(l)}else if(f===31){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(n(317));Ni=gw(l)}else f===27?(f=Ni,$f(l.type)?(l=i1,i1=null,Ni=l):Ni=f):Ni=ks?ol(l.stateNode.nextSibling):null;return!0}function Eu(){Ni=ks=null,Qn=!1}function tv(){var l=Bl;return l!==null&&(yr===null?yr=l:yr.push.apply(yr,l),Bl=null),l}function cd(l){Bl===null?Bl=[l]:Bl.push(l)}var nv=X(null),Ol=null,dr=null;function Pl(l,f,g){xe(nv,f._currentValue),f._currentValue=g}function Ya(l){l._currentValue=nv.current,ne(nv)}function Nl(l,f,g){for(;l!==null;){var _=l.alternate;if((l.childLanes&f)!==f?(l.childLanes|=f,_!==null&&(_.childLanes|=f)):_!==null&&(_.childLanes&f)!==f&&(_.childLanes|=f),l===g)break;l=l.return}}function ym(l,f,g,_){var M=l.child;for(M!==null&&(M.return=l);M!==null;){var L=M.dependencies;if(L!==null){var G=M.child;L=L.firstContext;e:for(;L!==null;){var Q=L;L=M;for(var ve=0;ve<f.length;ve++)if(Q.context===f[ve]){L.lanes|=g,Q=L.alternate,Q!==null&&(Q.lanes|=g),Nl(L.return,g,l),_||(G=null);break e}L=Q.next}}else if(M.tag===18){if(G=M.return,G===null)throw Error(n(341));G.lanes|=g,L=G.alternate,L!==null&&(L.lanes|=g),Nl(G,g,l),G=null}else G=M.child;if(G!==null)G.return=M;else for(G=M;G!==null;){if(G===l){G=null;break}if(M=G.sibling,M!==null){M.return=G.return,G=M;break}G=G.return}M=G}}function Dc(l,f,g,_){l=null;for(var M=f,L=!1;M!==null;){if(!L){if((M.flags&524288)!==0)L=!0;else if((M.flags&262144)!==0)break}if(M.tag===10){var G=M.alternate;if(G===null)throw Error(n(387));if(G=G.memoizedProps,G!==null){var Q=M.type;zi(M.pendingProps.value,G.value)||(l!==null?l.push(Q):l=[Q])}}else if(M===be.current){if(G=M.alternate,G===null)throw Error(n(387));G.memoizedState.memoizedState!==M.memoizedState.memoizedState&&(l!==null?l.push($v):l=[$v])}M=M.return}l!==null&&ym(f,l,g,_),f.flags|=262144}function Bf(l){for(l=l.firstContext;l!==null;){if(!zi(l.context._currentValue,l.memoizedValue))return!0;l=l.next}return!1}function bu(l){Ol=l,dr=null,l=l.dependencies,l!==null&&(l.firstContext=null)}function Hs(l){return iv(Ol,l)}function ud(l,f){return Ol===null&&bu(l),iv(l,f)}function iv(l,f){var g=f._currentValue;if(f={context:f,memoizedValue:g,next:null},dr===null){if(l===null)throw Error(n(308));dr=f,l.dependencies={lanes:0,firstContext:f},l.flags|=524288}else dr=dr.next=f;return g}var b_=typeof AbortController<"u"?AbortController:function(){var l=[],f=this.signal={aborted:!1,addEventListener:function(g,_){l.push(_)}};this.abort=function(){f.aborted=!0,l.forEach(function(g){return g()})}},T_=r.unstable_scheduleCallback,sv=r.unstable_NormalPriority,cn={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function rv(){return{controller:new b_,data:new Map,refCount:0}}function Ws(l){l.refCount--,l.refCount===0&&T_(sv,function(){l.controller.abort()})}var Tu=null,av=0,Ul=0,yo=null;function Of(l,f){if(Tu===null){var g=Tu=[];av=0,Ul=VT(),yo={status:"pending",value:void 0,then:function(_){g.push(_)}}}return av++,f.then(ov,ov),f}function ov(){if(--av===0&&Tu!==null){yo!==null&&(yo.status="fulfilled");var l=Tu;Tu=null,Ul=0,yo=null;for(var f=0;f<l.length;f++)(0,l[f])()}}function lv(l,f){var g=[],_={status:"pending",value:null,reason:null,then:function(M){g.push(M)}};return l.then(function(){_.status="fulfilled",_.value=f;for(var M=0;M<g.length;M++)(0,g[M])(f)},function(M){for(_.status="rejected",_.reason=M,M=0;M<g.length;M++)(0,g[M])(void 0)}),_}var M_=k.S;k.S=function(l,f){jf=q(),typeof f=="object"&&f!==null&&typeof f.then=="function"&&Of(l,f),M_!==null&&M_(l,f)};var Lc=X(null);function $o(){var l=Lc.current;return l!==null?l:Si.pooledCache}function Pf(l,f){f===null?xe(Lc,Lc.current):xe(Lc,f.pool)}function xm(){var l=$o();return l===null?null:{parent:cn._currentValue,pool:l}}var wc=Error(n(460)),fd=Error(n(474)),xo=Error(n(542)),hd={then:function(){}};function C_(l){return l=l.status,l==="fulfilled"||l==="rejected"}function cv(l,f,g){switch(g=l[g],g===void 0?l.push(f):g!==f&&(f.then(Yo,Yo),f=g),f.status){case"fulfilled":return f.value;case"rejected":throw l=f.reason,uv(l),l;default:if(typeof f.status=="string")f.then(Yo,Yo);else{if(l=Si,l!==null&&100<l.shellSuspendCounter)throw Error(n(482));l=f,l.status="pending",l.then(function(_){if(f.status==="pending"){var M=f;M.status="fulfilled",M.value=_}},function(_){if(f.status==="pending"){var M=f;M.status="rejected",M.reason=_}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw l=f.reason,uv(l),l}throw gn=f,wc}}function Mu(l){try{var f=l._init;return f(l._payload)}catch(g){throw g!==null&&typeof g=="object"&&typeof g.then=="function"?(gn=g,wc):g}}var gn=null;function _m(){if(gn===null)throw Error(n(459));var l=gn;return gn=null,l}function uv(l){if(l===wc||l===xo)throw Error(n(483))}var Ic=null,Bc=0;function Sm(l){var f=Bc;return Bc+=1,Ic===null&&(Ic=[]),cv(Ic,l,f)}function dd(l,f){f=f.props.ref,l.ref=f!==void 0?f:null}function pd(l,f){throw f.$$typeof===v?Error(n(525)):(l=Object.prototype.toString.call(f),Error(n(31,l==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":l)))}function Nf(l){function f(Me,Ae){if(l){var Ne=Me.deletions;Ne===null?(Me.deletions=[Ae],Me.flags|=16):Ne.push(Ae)}}function g(Me,Ae){if(!l)return null;for(;Ae!==null;)f(Me,Ae),Ae=Ae.sibling;return null}function _(Me){for(var Ae=new Map;Me!==null;)Me.key!==null?Ae.set(Me.key,Me):Ae.set(Me.index,Me),Me=Me.sibling;return Ae}function M(Me,Ae){return Me=qo(Me,Ae),Me.index=0,Me.sibling=null,Me}function L(Me,Ae,Ne){return Me.index=Ne,l?(Ne=Me.alternate,Ne!==null?(Ne=Ne.index,Ne<Ae?(Me.flags|=67108866,Ae):Ne):(Me.flags|=67108866,Ae)):(Me.flags|=1048576,Ae)}function G(Me){return l&&Me.alternate===null&&(Me.flags|=67108866),Me}function Q(Me,Ae,Ne,ft){return Ae===null||Ae.tag!==6?(Ae=pm(Ne,Me.mode,ft),Ae.return=Me,Ae):(Ae=M(Ae,Ne),Ae.return=Me,Ae)}function ve(Me,Ae,Ne,ft){var mn=Ne.type;return mn===S?nt(Me,Ae,Ne.props.children,ft,Ne.key):Ae!==null&&(Ae.elementType===mn||typeof mn=="object"&&mn!==null&&mn.$$typeof===U&&Mu(mn)===Ae.type)?(Ae=M(Ae,Ne.props),dd(Ae,Ne),Ae.return=Me,Ae):(Ae=ad(Ne.type,Ne.key,Ne.props,null,Me.mode,ft),dd(Ae,Ne),Ae.return=Me,Ae)}function Ue(Me,Ae,Ne,ft){return Ae===null||Ae.tag!==4||Ae.stateNode.containerInfo!==Ne.containerInfo||Ae.stateNode.implementation!==Ne.implementation?(Ae=go(Ne,Me.mode,ft),Ae.return=Me,Ae):(Ae=M(Ae,Ne.children||[]),Ae.return=Me,Ae)}function nt(Me,Ae,Ne,ft,mn){return Ae===null||Ae.tag!==7?(Ae=wl(Ne,Me.mode,ft,mn),Ae.return=Me,Ae):(Ae=M(Ae,Ne),Ae.return=Me,Ae)}function mt(Me,Ae,Ne){if(typeof Ae=="string"&&Ae!==""||typeof Ae=="number"||typeof Ae=="bigint")return Ae=pm(""+Ae,Me.mode,Ne),Ae.return=Me,Ae;if(typeof Ae=="object"&&Ae!==null){switch(Ae.$$typeof){case y:return Ne=ad(Ae.type,Ae.key,Ae.props,null,Me.mode,Ne),dd(Ne,Ae),Ne.return=Me,Ne;case x:return Ae=go(Ae,Me.mode,Ne),Ae.return=Me,Ae;case U:return Ae=Mu(Ae),mt(Me,Ae,Ne)}if(re(Ae)||W(Ae))return Ae=wl(Ae,Me.mode,Ne,null),Ae.return=Me,Ae;if(typeof Ae.then=="function")return mt(Me,Sm(Ae),Ne);if(Ae.$$typeof===R)return mt(Me,ud(Me,Ae),Ne);pd(Me,Ae)}return null}function He(Me,Ae,Ne,ft){var mn=Ae!==null?Ae.key:null;if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number"||typeof Ne=="bigint")return mn!==null?null:Q(Me,Ae,""+Ne,ft);if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case y:return Ne.key===mn?ve(Me,Ae,Ne,ft):null;case x:return Ne.key===mn?Ue(Me,Ae,Ne,ft):null;case U:return Ne=Mu(Ne),He(Me,Ae,Ne,ft)}if(re(Ne)||W(Ne))return mn!==null?null:nt(Me,Ae,Ne,ft,null);if(typeof Ne.then=="function")return He(Me,Ae,Sm(Ne),ft);if(Ne.$$typeof===R)return He(Me,Ae,ud(Me,Ne),ft);pd(Me,Ne)}return null}function We(Me,Ae,Ne,ft,mn){if(typeof ft=="string"&&ft!==""||typeof ft=="number"||typeof ft=="bigint")return Me=Me.get(Ne)||null,Q(Ae,Me,""+ft,mn);if(typeof ft=="object"&&ft!==null){switch(ft.$$typeof){case y:return Me=Me.get(ft.key===null?Ne:ft.key)||null,ve(Ae,Me,ft,mn);case x:return Me=Me.get(ft.key===null?Ne:ft.key)||null,Ue(Ae,Me,ft,mn);case U:return ft=Mu(ft),We(Me,Ae,Ne,ft,mn)}if(re(ft)||W(ft))return Me=Me.get(Ne)||null,nt(Ae,Me,ft,mn,null);if(typeof ft.then=="function")return We(Me,Ae,Ne,Sm(ft),mn);if(ft.$$typeof===R)return We(Me,Ae,Ne,ud(Ae,ft),mn);pd(Ae,ft)}return null}function Zt(Me,Ae,Ne,ft){for(var mn=null,Ei=null,an=Ae,kn=Ae=0,ri=null;an!==null&&kn<Ne.length;kn++){an.index>kn?(ri=an,an=null):ri=an.sibling;var bi=He(Me,an,Ne[kn],ft);if(bi===null){an===null&&(an=ri);break}l&&an&&bi.alternate===null&&f(Me,an),Ae=L(bi,Ae,kn),Ei===null?mn=bi:Ei.sibling=bi,Ei=bi,an=ri}if(kn===Ne.length)return g(Me,an),Qn&&Il(Me,kn),mn;if(an===null){for(;kn<Ne.length;kn++)an=mt(Me,Ne[kn],ft),an!==null&&(Ae=L(an,Ae,kn),Ei===null?mn=an:Ei.sibling=an,Ei=an);return Qn&&Il(Me,kn),mn}for(an=_(an);kn<Ne.length;kn++)ri=We(an,Me,kn,Ne[kn],ft),ri!==null&&(l&&ri.alternate!==null&&an.delete(ri.key===null?kn:ri.key),Ae=L(ri,Ae,kn),Ei===null?mn=ri:Ei.sibling=ri,Ei=ri);return l&&an.forEach(function(nh){return f(Me,nh)}),Qn&&Il(Me,kn),mn}function xn(Me,Ae,Ne,ft){if(Ne==null)throw Error(n(151));for(var mn=null,Ei=null,an=Ae,kn=Ae=0,ri=null,bi=Ne.next();an!==null&&!bi.done;kn++,bi=Ne.next()){an.index>kn?(ri=an,an=null):ri=an.sibling;var nh=He(Me,an,bi.value,ft);if(nh===null){an===null&&(an=ri);break}l&&an&&nh.alternate===null&&f(Me,an),Ae=L(nh,Ae,kn),Ei===null?mn=nh:Ei.sibling=nh,Ei=nh,an=ri}if(bi.done)return g(Me,an),Qn&&Il(Me,kn),mn;if(an===null){for(;!bi.done;kn++,bi=Ne.next())bi=mt(Me,bi.value,ft),bi!==null&&(Ae=L(bi,Ae,kn),Ei===null?mn=bi:Ei.sibling=bi,Ei=bi);return Qn&&Il(Me,kn),mn}for(an=_(an);!bi.done;kn++,bi=Ne.next())bi=We(an,Me,kn,bi.value,ft),bi!==null&&(l&&bi.alternate!==null&&an.delete(bi.key===null?kn:bi.key),Ae=L(bi,Ae,kn),Ei===null?mn=bi:Ei.sibling=bi,Ei=bi);return l&&an.forEach(function(nG){return f(Me,nG)}),Qn&&Il(Me,kn),mn}function ki(Me,Ae,Ne,ft){if(typeof Ne=="object"&&Ne!==null&&Ne.type===S&&Ne.key===null&&(Ne=Ne.props.children),typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case y:e:{for(var mn=Ne.key;Ae!==null;){if(Ae.key===mn){if(mn=Ne.type,mn===S){if(Ae.tag===7){g(Me,Ae.sibling),ft=M(Ae,Ne.props.children),ft.return=Me,Me=ft;break e}}else if(Ae.elementType===mn||typeof mn=="object"&&mn!==null&&mn.$$typeof===U&&Mu(mn)===Ae.type){g(Me,Ae.sibling),ft=M(Ae,Ne.props),dd(ft,Ne),ft.return=Me,Me=ft;break e}g(Me,Ae);break}else f(Me,Ae);Ae=Ae.sibling}Ne.type===S?(ft=wl(Ne.props.children,Me.mode,ft,Ne.key),ft.return=Me,Me=ft):(ft=ad(Ne.type,Ne.key,Ne.props,null,Me.mode,ft),dd(ft,Ne),ft.return=Me,Me=ft)}return G(Me);case x:e:{for(mn=Ne.key;Ae!==null;){if(Ae.key===mn)if(Ae.tag===4&&Ae.stateNode.containerInfo===Ne.containerInfo&&Ae.stateNode.implementation===Ne.implementation){g(Me,Ae.sibling),ft=M(Ae,Ne.children||[]),ft.return=Me,Me=ft;break e}else{g(Me,Ae);break}else f(Me,Ae);Ae=Ae.sibling}ft=go(Ne,Me.mode,ft),ft.return=Me,Me=ft}return G(Me);case U:return Ne=Mu(Ne),ki(Me,Ae,Ne,ft)}if(re(Ne))return Zt(Me,Ae,Ne,ft);if(W(Ne)){if(mn=W(Ne),typeof mn!="function")throw Error(n(150));return Ne=mn.call(Ne),xn(Me,Ae,Ne,ft)}if(typeof Ne.then=="function")return ki(Me,Ae,Sm(Ne),ft);if(Ne.$$typeof===R)return ki(Me,Ae,ud(Me,Ne),ft);pd(Me,Ne)}return typeof Ne=="string"&&Ne!==""||typeof Ne=="number"||typeof Ne=="bigint"?(Ne=""+Ne,Ae!==null&&Ae.tag===6?(g(Me,Ae.sibling),ft=M(Ae,Ne),ft.return=Me,Me=ft):(g(Me,Ae),ft=pm(Ne,Me.mode,ft),ft.return=Me,Me=ft),G(Me)):g(Me,Ae)}return function(Me,Ae,Ne,ft){try{Bc=0;var mn=ki(Me,Ae,Ne,ft);return Ic=null,mn}catch(an){if(an===wc||an===xo)throw an;var Ei=Dr(29,an,null,Me.mode);return Ei.lanes=ft,Ei.return=Me,Ei}finally{}}}var Cu=Nf(!0),R_=Nf(!1),Oc=!1;function fv(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function hv(l,f){l=l.updateQueue,f.updateQueue===l&&(f.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,callbacks:null})}function Qo(l){return{lane:l,tag:0,payload:null,callback:null,next:null}}function Fl(l,f,g){var _=l.updateQueue;if(_===null)return null;if(_=_.shared,(ii&2)!==0){var M=_.pending;return M===null?f.next=f:(f.next=M.next,M.next=f),_.pending=f,f=wf(l),dm(l,null,g),f}return rd(l,_,f,g),wf(l)}function Pc(l,f,g){if(f=f.updateQueue,f!==null&&(f=f.shared,(g&4194048)!==0)){var _=f.lanes;_&=l.pendingLanes,g|=_,f.lanes=g,pn(l,g)}}function Am(l,f){var g=l.updateQueue,_=l.alternate;if(_!==null&&(_=_.updateQueue,g===_)){var M=null,L=null;if(g=g.firstBaseUpdate,g!==null){do{var G={lane:g.lane,tag:g.tag,payload:g.payload,callback:null,next:null};L===null?M=L=G:L=L.next=G,g=g.next}while(g!==null);L===null?M=L=f:L=L.next=f}else M=L=f;g={baseState:_.baseState,firstBaseUpdate:M,lastBaseUpdate:L,shared:_.shared,callbacks:_.callbacks},l.updateQueue=g;return}l=g.lastBaseUpdate,l===null?g.firstBaseUpdate=f:l.next=f,g.lastBaseUpdate=f}var dv=!1;function md(){if(dv){var l=yo;if(l!==null)throw l}}function Ru(l,f,g,_){dv=!1;var M=l.updateQueue;Oc=!1;var L=M.firstBaseUpdate,G=M.lastBaseUpdate,Q=M.shared.pending;if(Q!==null){M.shared.pending=null;var ve=Q,Ue=ve.next;ve.next=null,G===null?L=Ue:G.next=Ue,G=ve;var nt=l.alternate;nt!==null&&(nt=nt.updateQueue,Q=nt.lastBaseUpdate,Q!==G&&(Q===null?nt.firstBaseUpdate=Ue:Q.next=Ue,nt.lastBaseUpdate=ve))}if(L!==null){var mt=M.baseState;G=0,nt=Ue=ve=null,Q=L;do{var He=Q.lane&-536870913,We=He!==Q.lane;if(We?(qn&He)===He:(_&He)===He){He!==0&&He===Ul&&(dv=!0),nt!==null&&(nt=nt.next={lane:0,tag:Q.tag,payload:Q.payload,callback:null,next:null});e:{var Zt=l,xn=Q;He=f;var ki=g;switch(xn.tag){case 1:if(Zt=xn.payload,typeof Zt=="function"){mt=Zt.call(ki,mt,He);break e}mt=Zt;break e;case 3:Zt.flags=Zt.flags&-65537|128;case 0:if(Zt=xn.payload,He=typeof Zt=="function"?Zt.call(ki,mt,He):Zt,He==null)break e;mt=p({},mt,He);break e;case 2:Oc=!0}}He=Q.callback,He!==null&&(l.flags|=64,We&&(l.flags|=8192),We=M.callbacks,We===null?M.callbacks=[He]:We.push(He))}else We={lane:He,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},nt===null?(Ue=nt=We,ve=mt):nt=nt.next=We,G|=He;if(Q=Q.next,Q===null){if(Q=M.shared.pending,Q===null)break;We=Q,Q=We.next,We.next=null,M.lastBaseUpdate=We,M.shared.pending=null}}while(!0);nt===null&&(ve=mt),M.baseState=ve,M.firstBaseUpdate=Ue,M.lastBaseUpdate=nt,L===null&&(M.shared.lanes=0),Ea|=G,l.lanes=G,l.memoizedState=mt}}function Zo(l,f){if(typeof l!="function")throw Error(n(191,l));l.call(f)}function Js(l,f){var g=l.callbacks;if(g!==null)for(l.callbacks=null,l=0;l<g.length;l++)Zo(g[l],f)}var da=X(null),wr=X(0);function pv(l,f){l=gs,xe(wr,l),xe(da,f),gs=l|f.baseLanes}function mv(){xe(wr,gs),xe(da,da.current)}function pr(){gs=wr.current,ne(da),ne(wr)}var Ls=X(null),Xa=null;function Nc(l){var f=l.alternate;xe(ts,ts.current&1),xe(Ls,l),Xa===null&&(f===null||da.current!==null||f.memoizedState!==null)&&(Xa=l)}function gv(l){xe(ts,ts.current),xe(Ls,l),Xa===null&&(Xa=l)}function D_(l){l.tag===22?(xe(ts,ts.current),xe(Ls,l),Xa===null&&(Xa=l)):kl()}function kl(){xe(ts,ts.current),xe(Ls,Ls.current)}function pa(l){ne(Ls),Xa===l&&(Xa=null),ne(ts)}var ts=X(0);function Em(l){for(var f=l;f!==null;){if(f.tag===13){var g=f.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||t1(g)||n1(g)))return f}else if(f.tag===19&&(f.memoizedProps.revealOrder==="forwards"||f.memoizedProps.revealOrder==="backwards"||f.memoizedProps.revealOrder==="unstable_legacy-backwards"||f.memoizedProps.revealOrder==="together")){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}var Xr=0,_n=null,Di=null,Es=null,bm=!1,el=!1,Du=!1,Tm=0,gd=0,tl=null,BT=0;function ns(){throw Error(n(321))}function vv(l,f){if(f===null)return!1;for(var g=0;g<f.length&&g<l.length;g++)if(!zi(l[g],f[g]))return!1;return!0}function yv(l,f,g,_,M,L){return Xr=L,_n=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,k.H=l===null||l.memoizedState===null?W_:kf,Du=!1,L=g(_,M),Du=!1,el&&(L=w_(f,g,_,M)),L_(l),L}function L_(l){k.H=Sd;var f=Di!==null&&Di.next!==null;if(Xr=0,Es=Di=_n=null,bm=!1,gd=0,tl=null,f)throw Error(n(300));l===null||Vi||(l=l.dependencies,l!==null&&Bf(l)&&(Vi=!0))}function w_(l,f,g,_){_n=l;var M=0;do{if(el&&(tl=null),gd=0,el=!1,25<=M)throw Error(n(301));if(M+=1,Es=Di=null,l.updateQueue!=null){var L=l.updateQueue;L.lastEffect=null,L.events=null,L.stores=null,L.memoCache!=null&&(L.memoCache.index=0)}k.H=Ad,L=f(g,_)}while(el);return L}function OT(){var l=k.H,f=l.useState()[0];return f=typeof f.then=="function"?yd(f):f,l=l.useState()[0],(Di!==null?Di.memoizedState:null)!==l&&(_n.flags|=1024),f}function xv(){var l=Tm!==0;return Tm=0,l}function _v(l,f,g){f.updateQueue=l.updateQueue,f.flags&=-2053,l.lanes&=~g}function Sv(l){if(bm){for(l=l.memoizedState;l!==null;){var f=l.queue;f!==null&&(f.pending=null),l=l.next}bm=!1}Xr=0,Es=Di=_n=null,el=!1,gd=Tm=0,tl=null}function Ir(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Es===null?_n.memoizedState=Es=l:Es=Es.next=l,Es}function hs(){if(Di===null){var l=_n.alternate;l=l!==null?l.memoizedState:null}else l=Di.next;var f=Es===null?_n.memoizedState:Es.next;if(f!==null)Es=f,Di=l;else{if(l===null)throw _n.alternate===null?Error(n(467)):Error(n(310));Di=l,l={memoizedState:Di.memoizedState,baseState:Di.baseState,baseQueue:Di.baseQueue,queue:Di.queue,next:null},Es===null?_n.memoizedState=Es=l:Es=Es.next=l}return Es}function vd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function yd(l){var f=gd;return gd+=1,tl===null&&(tl=[]),l=cv(tl,l,f),f=_n,(Es===null?f.memoizedState:Es.next)===null&&(f=f.alternate,k.H=f===null||f.memoizedState===null?W_:kf),l}function Mm(l){if(l!==null&&typeof l=="object"){if(typeof l.then=="function")return yd(l);if(l.$$typeof===R)return Hs(l)}throw Error(n(438,String(l)))}function Av(l){var f=null,g=_n.updateQueue;if(g!==null&&(f=g.memoCache),f==null){var _=_n.alternate;_!==null&&(_=_.updateQueue,_!==null&&(_=_.memoCache,_!=null&&(f={data:_.data.map(function(M){return M.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),g===null&&(g=vd(),_n.updateQueue=g),g.memoCache=f,g=f.data[f.index],g===void 0)for(g=f.data[f.index]=Array(l),_=0;_<l;_++)g[_]=I;return f.index++,g}function Gl(l,f){return typeof f=="function"?f(l):f}function Cm(l){var f=hs();return Ev(f,Di,l)}function Ev(l,f,g){var _=l.queue;if(_===null)throw Error(n(311));_.lastRenderedReducer=g;var M=l.baseQueue,L=_.pending;if(L!==null){if(M!==null){var G=M.next;M.next=L.next,L.next=G}f.baseQueue=M=L,_.pending=null}if(L=l.baseState,M===null)l.memoizedState=L;else{f=M.next;var Q=G=null,ve=null,Ue=f,nt=!1;do{var mt=Ue.lane&-536870913;if(mt!==Ue.lane?(qn&mt)===mt:(Xr&mt)===mt){var He=Ue.revertLane;if(He===0)ve!==null&&(ve=ve.next={lane:0,revertLane:0,gesture:null,action:Ue.action,hasEagerState:Ue.hasEagerState,eagerState:Ue.eagerState,next:null}),mt===Ul&&(nt=!0);else if((Xr&He)===He){Ue=Ue.next,He===Ul&&(nt=!0);continue}else mt={lane:0,revertLane:Ue.revertLane,gesture:null,action:Ue.action,hasEagerState:Ue.hasEagerState,eagerState:Ue.eagerState,next:null},ve===null?(Q=ve=mt,G=L):ve=ve.next=mt,_n.lanes|=He,Ea|=He;mt=Ue.action,Du&&g(L,mt),L=Ue.hasEagerState?Ue.eagerState:g(L,mt)}else He={lane:mt,revertLane:Ue.revertLane,gesture:Ue.gesture,action:Ue.action,hasEagerState:Ue.hasEagerState,eagerState:Ue.eagerState,next:null},ve===null?(Q=ve=He,G=L):ve=ve.next=He,_n.lanes|=mt,Ea|=mt;Ue=Ue.next}while(Ue!==null&&Ue!==f);if(ve===null?G=L:ve.next=Q,!zi(L,l.memoizedState)&&(Vi=!0,nt&&(g=yo,g!==null)))throw g;l.memoizedState=L,l.baseState=G,l.baseQueue=ve,_.lastRenderedState=L}return M===null&&(_.lanes=0),[l.memoizedState,_.dispatch]}function Rm(l){var f=hs(),g=f.queue;if(g===null)throw Error(n(311));g.lastRenderedReducer=l;var _=g.dispatch,M=g.pending,L=f.memoizedState;if(M!==null){g.pending=null;var G=M=M.next;do L=l(L,G.action),G=G.next;while(G!==M);zi(L,f.memoizedState)||(Vi=!0),f.memoizedState=L,f.baseQueue===null&&(f.baseState=L),g.lastRenderedState=L}return[L,_]}function bv(l,f,g){var _=_n,M=hs(),L=Qn;if(L){if(g===void 0)throw Error(n(407));g=g()}else g=f();var G=!zi((Di||M).memoizedState,g);if(G&&(M.memoizedState=g,Vi=!0),M=M.queue,Dv(Mv.bind(null,_,M,l),[l]),M.getSnapshot!==f||G||Es!==null&&Es.memoizedState.tag&1){if(_.flags|=2048,Uf(9,{destroy:void 0},Tv.bind(null,_,M,g,f),null),Si===null)throw Error(n(349));L||(Xr&127)!==0||I_(_,f,g)}return g}function I_(l,f,g){l.flags|=16384,l={getSnapshot:f,value:g},f=_n.updateQueue,f===null?(f=vd(),_n.updateQueue=f,f.stores=[l]):(g=f.stores,g===null?f.stores=[l]:g.push(l))}function Tv(l,f,g,_){f.value=g,f.getSnapshot=_,Cv(f)&&Dm(l)}function Mv(l,f,g){return g(function(){Cv(f)&&Dm(l)})}function Cv(l){var f=l.getSnapshot;l=l.value;try{var g=f();return!zi(l,g)}catch{return!0}}function Dm(l){var f=Mc(l,2);f!==null&&m(f,l,2)}function xd(l){var f=Ir();if(typeof l=="function"){var g=l;if(l=g(),Du){Nt(!0);try{g()}finally{Nt(!1)}}}return f.memoizedState=f.baseState=l,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gl,lastRenderedState:l},f}function B_(l,f,g,_){return l.baseState=g,Ev(l,Di,typeof _=="function"?_:Gl)}function PT(l,f,g,_,M){if(Hl(l))throw Error(n(485));if(l=f.action,l!==null){var L={payload:M,action:l,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(G){L.listeners.push(G)}};k.T!==null?g(!0):L.isTransition=!1,_(L),g=f.pending,g===null?(L.next=f.pending=L,O_(f,L)):(L.next=g.next,f.pending=g.next=L)}}function O_(l,f){var g=f.action,_=f.payload,M=l.state;if(f.isTransition){var L=k.T,G={};k.T=G;try{var Q=g(M,_),ve=k.S;ve!==null&&ve(G,Q),P_(l,f,Q)}catch(Ue){Lm(l,f,Ue)}finally{L!==null&&G.types!==null&&(L.types=G.types),k.T=L}}else try{L=g(M,_),P_(l,f,L)}catch(Ue){Lm(l,f,Ue)}}function P_(l,f,g){g!==null&&typeof g=="object"&&typeof g.then=="function"?g.then(function(_){Rv(l,f,_)},function(_){return Lm(l,f,_)}):Rv(l,f,g)}function Rv(l,f,g){f.status="fulfilled",f.value=g,N_(f),l.state=g,f=l.pending,f!==null&&(g=f.next,g===f?l.pending=null:(g=g.next,f.next=g,O_(l,g)))}function Lm(l,f,g){var _=l.pending;if(l.pending=null,_!==null){_=_.next;do f.status="rejected",f.reason=g,N_(f),f=f.next;while(f!==_)}l.action=null}function N_(l){l=l.listeners;for(var f=0;f<l.length;f++)(0,l[f])()}function U_(l,f){return f}function F_(l,f){if(Qn){var g=Si.formState;if(g!==null){e:{var _=_n;if(Qn){if(Ni){t:{for(var M=Ni,L=Gs;M.nodeType!==8;){if(!L){M=null;break t}if(M=ol(M.nextSibling),M===null){M=null;break t}}L=M.data,M=L==="F!"||L==="F"?M:null}if(M){Ni=ol(M.nextSibling),_=M.data==="F!";break e}}Kn(_)}_=!1}_&&(f=g[0])}}return g=Ir(),g.memoizedState=g.baseState=f,_={pending:null,lanes:0,dispatch:null,lastRenderedReducer:U_,lastRenderedState:f},g.queue=_,g=j_.bind(null,_n,_),_.dispatch=g,_=xd(!1),L=_d.bind(null,_n,!1,_.queue),_=Ir(),M={state:f,dispatch:null,action:l,pending:null},_.queue=M,g=PT.bind(null,_n,M,L,g),M.dispatch=g,_.memoizedState=l,[f,g,!1]}function k_(l){var f=hs();return G_(f,Di,l)}function G_(l,f,g){if(f=Ev(l,f,U_)[0],l=Cm(Gl)[0],typeof f=="object"&&f!==null&&typeof f.then=="function")try{var _=yd(f)}catch(G){throw G===wc?xo:G}else _=f;f=hs();var M=f.queue,L=M.dispatch;return g!==f.memoizedState&&(_n.flags|=2048,Uf(9,{destroy:void 0},NT.bind(null,M,g),null)),[_,L,l]}function NT(l,f){l.action=f}function H_(l){var f=hs(),g=Di;if(g!==null)return G_(f,g,l);hs(),f=f.memoizedState,g=hs();var _=g.queue.dispatch;return g.memoizedState=l,[f,_,!1]}function Uf(l,f,g,_){return l={tag:l,create:g,deps:_,inst:f,next:null},f=_n.updateQueue,f===null&&(f=vd(),_n.updateQueue=f),g=f.lastEffect,g===null?f.lastEffect=l.next=l:(_=g.next,g.next=l,l.next=_,f.lastEffect=l),l}function z_(){return hs().memoizedState}function wm(l,f,g,_){var M=Ir();_n.flags|=l,M.memoizedState=Uf(1|f,{destroy:void 0},g,_===void 0?null:_)}function Im(l,f,g,_){var M=hs();_=_===void 0?null:_;var L=M.memoizedState.inst;Di!==null&&_!==null&&vv(_,Di.memoizedState.deps)?M.memoizedState=Uf(f,L,g,_):(_n.flags|=l,M.memoizedState=Uf(1|f,L,g,_))}function V_(l,f){wm(8390656,8,l,f)}function Dv(l,f){Im(2048,8,l,f)}function Y_(l){_n.flags|=4;var f=_n.updateQueue;if(f===null)f=vd(),_n.updateQueue=f,f.events=[l];else{var g=f.events;g===null?f.events=[l]:g.push(l)}}function X_(l){var f=hs().memoizedState;return Y_({ref:f,nextImpl:l}),function(){if((ii&2)!==0)throw Error(n(440));return f.impl.apply(void 0,arguments)}}function K_(l,f){return Im(4,2,l,f)}function ma(l,f){return Im(4,4,l,f)}function Lv(l,f){if(typeof f=="function"){l=l();var g=f(l);return function(){typeof g=="function"?g():f(null)}}if(f!=null)return l=l(),f.current=l,function(){f.current=null}}function Bm(l,f,g){g=g!=null?g.concat([l]):null,Im(4,4,Lv.bind(null,f,l),g)}function Om(){}function wv(l,f){var g=hs();f=f===void 0?null:f;var _=g.memoizedState;return f!==null&&vv(f,_[1])?_[0]:(g.memoizedState=[l,f],l)}function Iv(l,f){var g=hs();f=f===void 0?null:f;var _=g.memoizedState;if(f!==null&&vv(f,_[1]))return _[0];if(_=l(),Du){Nt(!0);try{l()}finally{Nt(!1)}}return g.memoizedState=[_,f],_}function Bv(l,f,g){return g===void 0||(Xr&1073741824)!==0&&(qn&261930)===0?l.memoizedState=f:(l.memoizedState=g,l=d(),_n.lanes|=l,Ea|=l,g)}function Ov(l,f,g,_){return zi(g,f)?g:da.current!==null?(l=Bv(l,g,_),zi(l,f)||(Vi=!0),l):(Xr&42)===0||(Xr&1073741824)!==0&&(qn&261930)===0?(Vi=!0,l.memoizedState=g):(l=d(),_n.lanes|=l,Ea|=l,f)}function Pv(l,f,g,_,M){var L=j.p;j.p=L!==0&&8>L?L:8;var G=k.T,Q={};k.T=Q,_d(l,!1,f,g);try{var ve=M(),Ue=k.S;if(Ue!==null&&Ue(Q,ve),ve!==null&&typeof ve=="object"&&typeof ve.then=="function"){var nt=lv(ve,_);Ff(l,f,nt,Or(l))}else Ff(l,f,_,Or(l))}catch(mt){Ff(l,f,{then:function(){},status:"rejected",reason:mt},Or())}finally{j.p=L,G!==null&&Q.types!==null&&(G.types=Q.types),k.T=G}}function UT(){}function Nv(l,f,g,_){if(l.tag!==5)throw Error(n(476));var M=q_(l).queue;Pv(l,M,f,J,g===null?UT:function(){return Uv(l),g(_)})}function q_(l){var f=l.memoizedState;if(f!==null)return f;f={memoizedState:J,baseState:J,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gl,lastRenderedState:J},next:null};var g={};return f.next={memoizedState:g,baseState:g,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gl,lastRenderedState:g},next:null},l.memoizedState=f,l=l.alternate,l!==null&&(l.memoizedState=f),f}function Uv(l){var f=q_(l);f.next===null&&(f=l.alternate.memoizedState),Ff(l,f.next.queue,{},Or())}function Fv(){return Hs($v)}function $s(){return hs().memoizedState}function kv(){return hs().memoizedState}function FT(l){for(var f=l.return;f!==null;){switch(f.tag){case 24:case 3:var g=Or();l=Qo(g);var _=Fl(f,l,g);_!==null&&(m(_,f,g),Pc(_,f,g)),f={cache:rv()},l.payload=f;return}f=f.return}}function kT(l,f,g){var _=Or();g={lane:_,revertLane:0,gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},Hl(l)?Lu(f,g):(g=Lf(l,f,g,_),g!==null&&(m(g,l,_),Kr(g,f,_)))}function j_(l,f,g){var _=Or();Ff(l,f,g,_)}function Ff(l,f,g,_){var M={lane:_,revertLane:0,gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null};if(Hl(l))Lu(f,M);else{var L=l.alternate;if(l.lanes===0&&(L===null||L.lanes===0)&&(L=f.lastRenderedReducer,L!==null))try{var G=f.lastRenderedState,Q=L(G,g);if(M.hasEagerState=!0,M.eagerState=Q,zi(Q,G))return rd(l,f,M,0),Si===null&&Tc(),!1}catch{}finally{}if(g=Lf(l,f,M,_),g!==null)return m(g,l,_),Kr(g,f,_),!0}return!1}function _d(l,f,g,_){if(_={lane:2,revertLane:VT(),gesture:null,action:_,hasEagerState:!1,eagerState:null,next:null},Hl(l)){if(f)throw Error(n(479))}else f=Lf(l,g,_,2),f!==null&&m(f,l,2)}function Hl(l){var f=l.alternate;return l===_n||f!==null&&f===_n}function Lu(l,f){el=bm=!0;var g=l.pending;g===null?f.next=f:(f.next=g.next,g.next=f),l.pending=f}function Kr(l,f,g){if((g&4194048)!==0){var _=f.lanes;_&=l.pendingLanes,g|=_,f.lanes=g,pn(l,g)}}var Sd={readContext:Hs,use:Mm,useCallback:ns,useContext:ns,useEffect:ns,useImperativeHandle:ns,useLayoutEffect:ns,useInsertionEffect:ns,useMemo:ns,useReducer:ns,useRef:ns,useState:ns,useDebugValue:ns,useDeferredValue:ns,useTransition:ns,useSyncExternalStore:ns,useId:ns,useHostTransitionStatus:ns,useFormState:ns,useActionState:ns,useOptimistic:ns,useMemoCache:ns,useCacheRefresh:ns};Sd.useEffectEvent=ns;var W_={readContext:Hs,use:Mm,useCallback:function(l,f){return Ir().memoizedState=[l,f===void 0?null:f],l},useContext:Hs,useEffect:V_,useImperativeHandle:function(l,f,g){g=g!=null?g.concat([l]):null,wm(4194308,4,Lv.bind(null,f,l),g)},useLayoutEffect:function(l,f){return wm(4194308,4,l,f)},useInsertionEffect:function(l,f){wm(4,2,l,f)},useMemo:function(l,f){var g=Ir();f=f===void 0?null:f;var _=l();if(Du){Nt(!0);try{l()}finally{Nt(!1)}}return g.memoizedState=[_,f],_},useReducer:function(l,f,g){var _=Ir();if(g!==void 0){var M=g(f);if(Du){Nt(!0);try{g(f)}finally{Nt(!1)}}}else M=f;return _.memoizedState=_.baseState=M,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:M},_.queue=l,l=l.dispatch=kT.bind(null,_n,l),[_.memoizedState,l]},useRef:function(l){var f=Ir();return l={current:l},f.memoizedState=l},useState:function(l){l=xd(l);var f=l.queue,g=j_.bind(null,_n,f);return f.dispatch=g,[l.memoizedState,g]},useDebugValue:Om,useDeferredValue:function(l,f){var g=Ir();return Bv(g,l,f)},useTransition:function(){var l=xd(!1);return l=Pv.bind(null,_n,l.queue,!0,!1),Ir().memoizedState=l,[!1,l]},useSyncExternalStore:function(l,f,g){var _=_n,M=Ir();if(Qn){if(g===void 0)throw Error(n(407));g=g()}else{if(g=f(),Si===null)throw Error(n(349));(qn&127)!==0||I_(_,f,g)}M.memoizedState=g;var L={value:g,getSnapshot:f};return M.queue=L,V_(Mv.bind(null,_,L,l),[l]),_.flags|=2048,Uf(9,{destroy:void 0},Tv.bind(null,_,L,g,f),null),g},useId:function(){var l=Ir(),f=Si.identifierPrefix;if(Qn){var g=Jo,_=Wo;g=(_&~(1<<32-he(_)-1)).toString(32)+g,f="_"+f+"R_"+g,g=Tm++,0<g&&(f+="H"+g.toString(32)),f+="_"}else g=BT++,f="_"+f+"r_"+g.toString(32)+"_";return l.memoizedState=f},useHostTransitionStatus:Fv,useFormState:F_,useActionState:F_,useOptimistic:function(l){var f=Ir();f.memoizedState=f.baseState=l;var g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=g,f=_d.bind(null,_n,!0,g),g.dispatch=f,[l,f]},useMemoCache:Av,useCacheRefresh:function(){return Ir().memoizedState=FT.bind(null,_n)},useEffectEvent:function(l){var f=Ir(),g={impl:l};return f.memoizedState=g,function(){if((ii&2)!==0)throw Error(n(440));return g.impl.apply(void 0,arguments)}}},kf={readContext:Hs,use:Mm,useCallback:wv,useContext:Hs,useEffect:Dv,useImperativeHandle:Bm,useInsertionEffect:K_,useLayoutEffect:ma,useMemo:Iv,useReducer:Cm,useRef:z_,useState:function(){return Cm(Gl)},useDebugValue:Om,useDeferredValue:function(l,f){var g=hs();return Ov(g,Di.memoizedState,l,f)},useTransition:function(){var l=Cm(Gl)[0],f=hs().memoizedState;return[typeof l=="boolean"?l:yd(l),f]},useSyncExternalStore:bv,useId:$s,useHostTransitionStatus:Fv,useFormState:k_,useActionState:k_,useOptimistic:function(l,f){var g=hs();return B_(g,Di,l,f)},useMemoCache:Av,useCacheRefresh:kv};kf.useEffectEvent=X_;var Ad={readContext:Hs,use:Mm,useCallback:wv,useContext:Hs,useEffect:Dv,useImperativeHandle:Bm,useInsertionEffect:K_,useLayoutEffect:ma,useMemo:Iv,useReducer:Rm,useRef:z_,useState:function(){return Rm(Gl)},useDebugValue:Om,useDeferredValue:function(l,f){var g=hs();return Di===null?Bv(g,l,f):Ov(g,Di.memoizedState,l,f)},useTransition:function(){var l=Rm(Gl)[0],f=hs().memoizedState;return[typeof l=="boolean"?l:yd(l),f]},useSyncExternalStore:bv,useId:$s,useHostTransitionStatus:Fv,useFormState:H_,useActionState:H_,useOptimistic:function(l,f){var g=hs();return Di!==null?B_(g,Di,l,f):(g.baseState=l,[l,g.queue.dispatch])},useMemoCache:Av,useCacheRefresh:kv};Ad.useEffectEvent=X_;function Gf(l,f,g,_){f=l.memoizedState,g=g(_,f),g=g==null?f:p({},f,g),l.memoizedState=g,l.lanes===0&&(l.updateQueue.baseState=g)}var Ed={enqueueSetState:function(l,f,g){l=l._reactInternals;var _=Or(),M=Qo(_);M.payload=f,g!=null&&(M.callback=g),f=Fl(l,M,_),f!==null&&(m(f,l,_),Pc(f,l,_))},enqueueReplaceState:function(l,f,g){l=l._reactInternals;var _=Or(),M=Qo(_);M.tag=1,M.payload=f,g!=null&&(M.callback=g),f=Fl(l,M,_),f!==null&&(m(f,l,_),Pc(f,l,_))},enqueueForceUpdate:function(l,f){l=l._reactInternals;var g=Or(),_=Qo(g);_.tag=2,f!=null&&(_.callback=f),f=Fl(l,_,g),f!==null&&(m(f,l,g),Pc(f,l,g))}};function J_(l,f,g,_,M,L,G){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(_,L,G):f.prototype&&f.prototype.isPureReactComponent?!bf(g,_)||!bf(M,L):!0}function $_(l,f,g,_){l=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(g,_),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(g,_),f.state!==l&&Ed.enqueueReplaceState(f,f.state,null)}function Qs(l,f){var g=f;if("ref"in f){g={};for(var _ in f)_!=="ref"&&(g[_]=f[_])}if(l=l.defaultProps){g===f&&(g=p({},g));for(var M in l)g[M]===void 0&&(g[M]=l[M])}return g}function Gv(l){bc(l)}function Q_(l){console.error(l)}function Pm(l){bc(l)}function Nm(l,f){try{var g=l.onUncaughtError;g(f.value,{componentStack:f.stack})}catch(_){setTimeout(function(){throw _})}}function Z_(l,f,g){try{var _=l.onCaughtError;_(g.value,{componentStack:g.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(M){setTimeout(function(){throw M})}}function Hv(l,f,g){return g=Qo(g),g.tag=3,g.payload={element:null},g.callback=function(){Nm(l,f)},g}function Hf(l){return l=Qo(l),l.tag=3,l}function qr(l,f,g,_){var M=g.type.getDerivedStateFromError;if(typeof M=="function"){var L=_.value;l.payload=function(){return M(L)},l.callback=function(){Z_(f,g,_)}}var G=g.stateNode;G!==null&&typeof G.componentDidCatch=="function"&&(l.callback=function(){Z_(f,g,_),typeof M!="function"&&(al===null?al=new Set([this]):al.add(this));var Q=_.stack;this.componentDidCatch(_.value,{componentStack:Q!==null?Q:""})})}function ga(l,f,g,_,M){if(g.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){if(f=g.alternate,f!==null&&Dc(f,g,M,!0),g=Ls.current,g!==null){switch(g.tag){case 31:case 13:return Xa===null?Tn():g.alternate===null&&Ai===0&&(Ai=3),g.flags&=-257,g.flags|=65536,g.lanes=M,_===hd?g.flags|=16384:(f=g.updateQueue,f===null?g.updateQueue=new Set([_]):f.add(_),GT(l,_,M)),!1;case 22:return g.flags|=65536,_===hd?g.flags|=16384:(f=g.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([_])},g.updateQueue=f):(g=f.retryQueue,g===null?f.retryQueue=new Set([_]):g.add(_)),GT(l,_,M)),!1}throw Error(n(435,g.tag))}return GT(l,_,M),Tn(),!1}if(Qn)return f=Ls.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=M,_!==gm&&(l=Error(n(422),{cause:_}),cd(Vr(l,g)))):(_!==gm&&(f=Error(n(423),{cause:_}),cd(Vr(f,g))),l=l.current.alternate,l.flags|=65536,M&=-M,l.lanes|=M,_=Vr(_,g),M=Hv(l.stateNode,_,M),Am(l,M),Ai!==4&&(Ai=2)),!1;var L=Error(n(520),{cause:_});if(L=Vr(L,g),bo===null?bo=[L]:bo.push(L),Ai!==4&&(Ai=2),f===null)return!0;_=Vr(_,g),g=f;do{switch(g.tag){case 3:return g.flags|=65536,l=M&-M,g.lanes|=l,l=Hv(g.stateNode,_,l),Am(g,l),!1;case 1:if(f=g.type,L=g.stateNode,(g.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||L!==null&&typeof L.componentDidCatch=="function"&&(al===null||!al.has(L))))return g.flags|=65536,M&=-M,g.lanes|=M,M=Hf(M),qr(M,l,g,_),Am(g,M),!1}g=g.return}while(g!==null);return!1}var Um=Error(n(461)),Vi=!1;function is(l,f,g,_){f.child=l===null?R_(f,null,g,_):Cu(f,l.child,g,_)}function bd(l,f,g,_,M){g=g.render;var L=f.ref;if("ref"in _){var G={};for(var Q in _)Q!=="ref"&&(G[Q]=_[Q])}else G=_;return bu(f),_=yv(l,f,g,G,L,M),Q=xv(),l!==null&&!Vi?(_v(l,f,M),Ao(l,f,M)):(Qn&&Q&&mm(f),f.flags|=1,is(l,f,_,M),f.child)}function Td(l,f,g,_,M){if(l===null){var L=g.type;return typeof L=="function"&&!Lr(L)&&L.defaultProps===void 0&&g.compare===null?(f.tag=15,f.type=L,va(l,f,L,_,M)):(l=ad(g.type,null,_,f,f.mode,M),l.ref=f.ref,l.return=f,f.child=l)}if(L=l.child,!Fc(l,M)){var G=L.memoizedProps;if(g=g.compare,g=g!==null?g:bf,g(G,_)&&l.ref===f.ref)return Ao(l,f,M)}return f.flags|=1,l=qo(L,_),l.ref=f.ref,l.return=f,f.child=l}function va(l,f,g,_,M){if(l!==null){var L=l.memoizedProps;if(bf(L,_)&&l.ref===f.ref)if(Vi=!1,f.pendingProps=_=L,Fc(l,M))(l.flags&131072)!==0&&(Vi=!0);else return f.lanes=l.lanes,Ao(l,f,M)}return zf(l,f,g,_,M)}function ya(l,f,g,_){var M=_.children,L=l!==null?l.memoizedState:null;if(l===null&&f.stateNode===null&&(f.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),_.mode==="hidden"){if((f.flags&128)!==0){if(L=L!==null?L.baseLanes|g:g,l!==null){for(_=f.child=l.child,M=0;_!==null;)M=M|_.lanes|_.childLanes,_=_.sibling;_=M&~L}else _=0,f.child=null;return nl(l,f,L,g,_)}if((g&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},l!==null&&Pf(f,L!==null?L.cachePool:null),L!==null?pv(f,L):mv(),D_(f);else return _=f.lanes=536870912,nl(l,f,L!==null?L.baseLanes|g:g,g,_)}else L!==null?(Pf(f,L.cachePool),pv(f,L),kl(),f.memoizedState=null):(l!==null&&Pf(f,null),mv(),kl());return is(l,f,M,g),f.child}function _o(l,f){return l!==null&&l.tag===22||f.stateNode!==null||(f.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.sibling}function nl(l,f,g,_,M){var L=$o();return L=L===null?null:{parent:cn._currentValue,pool:L},f.memoizedState={baseLanes:g,cachePool:L},l!==null&&Pf(f,null),mv(),D_(f),l!==null&&Dc(l,f,_,!0),f.childLanes=M,null}function Ka(l,f){return f=Vf({mode:f.mode,children:f.children},l.mode),f.ref=l.ref,l.child=f,f.return=l,f}function zs(l,f,g){return Cu(f,l.child,null,g),l=Ka(f,f.pendingProps),l.flags|=2,pa(f),f.memoizedState=null,l}function Md(l,f,g){var _=f.pendingProps,M=(f.flags&128)!==0;if(f.flags&=-129,l===null){if(Qn){if(_.mode==="hidden")return l=Ka(f,_),f.lanes=536870912,_o(null,l);if(gv(f),(l=Ni)?(l=mw(l,Gs),l=l!==null&&l.data==="&"?l:null,l!==null&&(f.memoizedState={dehydrated:l,treeContext:jo!==null?{id:Wo,overflow:Jo}:null,retryLane:536870912,hydrationErrors:null},g=A_(l),g.return=f,f.child=g,ks=f,Ni=null)):l=null,l===null)throw Kn(f);return f.lanes=536870912,null}return Ka(f,_)}var L=l.memoizedState;if(L!==null){var G=L.dehydrated;if(gv(f),M)if(f.flags&256)f.flags&=-257,f=zs(l,f,g);else if(f.memoizedState!==null)f.child=l.child,f.flags|=128,f=null;else throw Error(n(558));else if(Vi||Dc(l,f,g,!1),M=(g&l.childLanes)!==0,Vi||M){if(_=Si,_!==null&&(G=Wt(_,g),G!==0&&G!==L.retryLane))throw L.retryLane=G,Mc(l,G),m(_,l,G),Um;Tn(),f=zs(l,f,g)}else l=L.treeContext,Ni=ol(G.nextSibling),ks=f,Qn=!0,Bl=null,Gs=!1,l!==null&&ld(f,l),f=Ka(f,_),f.flags|=4096;return f}return l=qo(l.child,{mode:_.mode,children:_.children}),l.ref=f.ref,f.child=l,l.return=f,l}function So(l,f){var g=f.ref;if(g===null)l!==null&&l.ref!==null&&(f.flags|=4194816);else{if(typeof g!="function"&&typeof g!="object")throw Error(n(284));(l===null||l.ref!==g)&&(f.flags|=4194816)}}function zf(l,f,g,_,M){return bu(f),g=yv(l,f,g,_,void 0,M),_=xv(),l!==null&&!Vi?(_v(l,f,M),Ao(l,f,M)):(Qn&&_&&mm(f),f.flags|=1,is(l,f,g,M),f.child)}function mr(l,f,g,_,M,L){return bu(f),f.updateQueue=null,g=w_(f,_,g,M),L_(l),_=xv(),l!==null&&!Vi?(_v(l,f,L),Ao(l,f,L)):(Qn&&_&&mm(f),f.flags|=1,is(l,f,g,L),f.child)}function Zs(l,f,g,_,M){if(bu(f),f.stateNode===null){var L=Cc,G=g.contextType;typeof G=="object"&&G!==null&&(L=Hs(G)),L=new g(_,L),f.memoizedState=L.state!==null&&L.state!==void 0?L.state:null,L.updater=Ed,f.stateNode=L,L._reactInternals=f,L=f.stateNode,L.props=_,L.state=f.memoizedState,L.refs={},fv(f),G=g.contextType,L.context=typeof G=="object"&&G!==null?Hs(G):Cc,L.state=f.memoizedState,G=g.getDerivedStateFromProps,typeof G=="function"&&(Gf(f,g,G,_),L.state=f.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof L.getSnapshotBeforeUpdate=="function"||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(G=L.state,typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount(),G!==L.state&&Ed.enqueueReplaceState(L,L.state,null),Ru(f,_,L,M),md(),L.state=f.memoizedState),typeof L.componentDidMount=="function"&&(f.flags|=4194308),_=!0}else if(l===null){L=f.stateNode;var Q=f.memoizedProps,ve=Qs(g,Q);L.props=ve;var Ue=L.context,nt=g.contextType;G=Cc,typeof nt=="object"&&nt!==null&&(G=Hs(nt));var mt=g.getDerivedStateFromProps;nt=typeof mt=="function"||typeof L.getSnapshotBeforeUpdate=="function",Q=f.pendingProps!==Q,nt||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(Q||Ue!==G)&&$_(f,L,_,G),Oc=!1;var He=f.memoizedState;L.state=He,Ru(f,_,L,M),md(),Ue=f.memoizedState,Q||He!==Ue||Oc?(typeof mt=="function"&&(Gf(f,g,mt,_),Ue=f.memoizedState),(ve=Oc||J_(f,g,ve,_,He,Ue,G))?(nt||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount()),typeof L.componentDidMount=="function"&&(f.flags|=4194308)):(typeof L.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=_,f.memoizedState=Ue),L.props=_,L.state=Ue,L.context=G,_=ve):(typeof L.componentDidMount=="function"&&(f.flags|=4194308),_=!1)}else{L=f.stateNode,hv(l,f),G=f.memoizedProps,nt=Qs(g,G),L.props=nt,mt=f.pendingProps,He=L.context,Ue=g.contextType,ve=Cc,typeof Ue=="object"&&Ue!==null&&(ve=Hs(Ue)),Q=g.getDerivedStateFromProps,(Ue=typeof Q=="function"||typeof L.getSnapshotBeforeUpdate=="function")||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(G!==mt||He!==ve)&&$_(f,L,_,ve),Oc=!1,He=f.memoizedState,L.state=He,Ru(f,_,L,M),md();var We=f.memoizedState;G!==mt||He!==We||Oc||l!==null&&l.dependencies!==null&&Bf(l.dependencies)?(typeof Q=="function"&&(Gf(f,g,Q,_),We=f.memoizedState),(nt=Oc||J_(f,g,nt,_,He,We,ve)||l!==null&&l.dependencies!==null&&Bf(l.dependencies))?(Ue||typeof L.UNSAFE_componentWillUpdate!="function"&&typeof L.componentWillUpdate!="function"||(typeof L.componentWillUpdate=="function"&&L.componentWillUpdate(_,We,ve),typeof L.UNSAFE_componentWillUpdate=="function"&&L.UNSAFE_componentWillUpdate(_,We,ve)),typeof L.componentDidUpdate=="function"&&(f.flags|=4),typeof L.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof L.componentDidUpdate!="function"||G===l.memoizedProps&&He===l.memoizedState||(f.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||G===l.memoizedProps&&He===l.memoizedState||(f.flags|=1024),f.memoizedProps=_,f.memoizedState=We),L.props=_,L.state=We,L.context=ve,_=nt):(typeof L.componentDidUpdate!="function"||G===l.memoizedProps&&He===l.memoizedState||(f.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||G===l.memoizedProps&&He===l.memoizedState||(f.flags|=1024),_=!1)}return L=_,So(l,f),_=(f.flags&128)!==0,L||_?(L=f.stateNode,g=_&&typeof g.getDerivedStateFromError!="function"?null:L.render(),f.flags|=1,l!==null&&_?(f.child=Cu(f,l.child,null,M),f.child=Cu(f,null,g,M)):is(l,f,g,M),f.memoizedState=L.state,l=f.child):l=Ao(l,f,M),l}function li(l,f,g,_){return Eu(),f.flags|=256,is(l,f,g,_),f.child}var xa={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function qa(l){return{baseLanes:l,cachePool:xm()}}function Cd(l,f,g){return l=l!==null?l.childLanes&~g:0,f&&(l|=si),l}function _a(l,f,g){var _=f.pendingProps,M=!1,L=(f.flags&128)!==0,G;if((G=L)||(G=l!==null&&l.memoizedState===null?!1:(ts.current&2)!==0),G&&(M=!0,f.flags&=-129),G=(f.flags&32)!==0,f.flags&=-33,l===null){if(Qn){if(M?Nc(f):kl(),(l=Ni)?(l=mw(l,Gs),l=l!==null&&l.data!=="&"?l:null,l!==null&&(f.memoizedState={dehydrated:l,treeContext:jo!==null?{id:Wo,overflow:Jo}:null,retryLane:536870912,hydrationErrors:null},g=A_(l),g.return=f,f.child=g,ks=f,Ni=null)):l=null,l===null)throw Kn(f);return n1(l)?f.lanes=32:f.lanes=536870912,null}var Q=_.children;return _=_.fallback,M?(kl(),M=f.mode,Q=Vf({mode:"hidden",children:Q},M),_=wl(_,M,g,null),Q.return=f,_.return=f,Q.sibling=_,f.child=Q,_=f.child,_.memoizedState=qa(g),_.childLanes=Cd(l,G,g),f.memoizedState=xa,_o(null,_)):(Nc(f),Uc(f,Q))}var ve=l.memoizedState;if(ve!==null&&(Q=ve.dehydrated,Q!==null)){if(L)f.flags&256?(Nc(f),f.flags&=-257,f=Yf(l,f,g)):f.memoizedState!==null?(kl(),f.child=l.child,f.flags|=128,f=null):(kl(),Q=_.fallback,M=f.mode,_=Vf({mode:"visible",children:_.children},M),Q=wl(Q,M,g,null),Q.flags|=2,_.return=f,Q.return=f,_.sibling=Q,f.child=_,Cu(f,l.child,null,g),_=f.child,_.memoizedState=qa(g),_.childLanes=Cd(l,G,g),f.memoizedState=xa,f=_o(null,_));else if(Nc(f),n1(Q)){if(G=Q.nextSibling&&Q.nextSibling.dataset,G)var Ue=G.dgst;G=Ue,_=Error(n(419)),_.stack="",_.digest=G,cd({value:_,source:null,stack:null}),f=Yf(l,f,g)}else if(Vi||Dc(l,f,g,!1),G=(g&l.childLanes)!==0,Vi||G){if(G=Si,G!==null&&(_=Wt(G,g),_!==0&&_!==ve.retryLane))throw ve.retryLane=_,Mc(l,_),m(G,l,_),Um;t1(Q)||Tn(),f=Yf(l,f,g)}else t1(Q)?(f.flags|=192,f.child=l.child,f=null):(l=ve.treeContext,Ni=ol(Q.nextSibling),ks=f,Qn=!0,Bl=null,Gs=!1,l!==null&&ld(f,l),f=Uc(f,_.children),f.flags|=4096);return f}return M?(kl(),Q=_.fallback,M=f.mode,ve=l.child,Ue=ve.sibling,_=qo(ve,{mode:"hidden",children:_.children}),_.subtreeFlags=ve.subtreeFlags&65011712,Ue!==null?Q=qo(Ue,Q):(Q=wl(Q,M,g,null),Q.flags|=2),Q.return=f,_.return=f,_.sibling=Q,f.child=_,_o(null,_),_=f.child,Q=l.child.memoizedState,Q===null?Q=qa(g):(M=Q.cachePool,M!==null?(ve=cn._currentValue,M=M.parent!==ve?{parent:ve,pool:ve}:M):M=xm(),Q={baseLanes:Q.baseLanes|g,cachePool:M}),_.memoizedState=Q,_.childLanes=Cd(l,G,g),f.memoizedState=xa,_o(l.child,_)):(Nc(f),g=l.child,l=g.sibling,g=qo(g,{mode:"visible",children:_.children}),g.return=f,g.sibling=null,l!==null&&(G=f.deletions,G===null?(f.deletions=[l],f.flags|=16):G.push(l)),f.child=g,f.memoizedState=null,g)}function Uc(l,f){return f=Vf({mode:"visible",children:f},l.mode),f.return=l,l.child=f}function Vf(l,f){return l=Dr(22,l,null,f),l.lanes=0,l}function Yf(l,f,g){return Cu(f,l.child,null,g),l=Uc(f,f.pendingProps.children),l.flags|=2,f.memoizedState=null,l}function wu(l,f,g){l.lanes|=f;var _=l.alternate;_!==null&&(_.lanes|=f),Nl(l.return,f,g)}function Rd(l,f,g,_,M,L){var G=l.memoizedState;G===null?l.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:_,tail:g,tailMode:M,treeForkCount:L}:(G.isBackwards=f,G.rendering=null,G.renderingStartTime=0,G.last=_,G.tail=g,G.tailMode=M,G.treeForkCount=L)}function Dd(l,f,g){var _=f.pendingProps,M=_.revealOrder,L=_.tail;_=_.children;var G=ts.current,Q=(G&2)!==0;if(Q?(G=G&1|2,f.flags|=128):G&=1,xe(ts,G),is(l,f,_,g),_=Qn?If:0,!Q&&l!==null&&(l.flags&128)!==0)e:for(l=f.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&wu(l,g,f);else if(l.tag===19)wu(l,g,f);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===f)break e;for(;l.sibling===null;){if(l.return===null||l.return===f)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}switch(M){case"forwards":for(g=f.child,M=null;g!==null;)l=g.alternate,l!==null&&Em(l)===null&&(M=g),g=g.sibling;g=M,g===null?(M=f.child,f.child=null):(M=g.sibling,g.sibling=null),Rd(f,!1,M,g,L,_);break;case"backwards":case"unstable_legacy-backwards":for(g=null,M=f.child,f.child=null;M!==null;){if(l=M.alternate,l!==null&&Em(l)===null){f.child=M;break}l=M.sibling,M.sibling=g,g=M,M=l}Rd(f,!0,g,null,L,_);break;case"together":Rd(f,!1,null,null,void 0,_);break;default:f.memoizedState=null}return f.child}function Ao(l,f,g){if(l!==null&&(f.dependencies=l.dependencies),Ea|=f.lanes,(g&f.childLanes)===0)if(l!==null){if(Dc(l,f,g,!1),(g&f.childLanes)===0)return null}else return null;if(l!==null&&f.child!==l.child)throw Error(n(153));if(f.child!==null){for(l=f.child,g=qo(l,l.pendingProps),f.child=g,g.return=f;l.sibling!==null;)l=l.sibling,g=g.sibling=qo(l,l.pendingProps),g.return=f;g.sibling=null}return f.child}function Fc(l,f){return(l.lanes&f)!==0?!0:(l=l.dependencies,!!(l!==null&&Bf(l)))}function Ld(l,f,g){switch(f.tag){case 3:je(f,f.stateNode.containerInfo),Pl(f,cn,l.memoizedState.cache),Eu();break;case 27:case 5:St(f);break;case 4:je(f,f.stateNode.containerInfo);break;case 10:Pl(f,f.type,f.memoizedProps.value);break;case 31:if(f.memoizedState!==null)return f.flags|=128,gv(f),null;break;case 13:var _=f.memoizedState;if(_!==null)return _.dehydrated!==null?(Nc(f),f.flags|=128,null):(g&f.child.childLanes)!==0?_a(l,f,g):(Nc(f),l=Ao(l,f,g),l!==null?l.sibling:null);Nc(f);break;case 19:var M=(l.flags&128)!==0;if(_=(g&f.childLanes)!==0,_||(Dc(l,f,g,!1),_=(g&f.childLanes)!==0),M){if(_)return Dd(l,f,g);f.flags|=128}if(M=f.memoizedState,M!==null&&(M.rendering=null,M.tail=null,M.lastEffect=null),xe(ts,ts.current),_)break;return null;case 22:return f.lanes=0,ya(l,f,g,f.pendingProps);case 24:Pl(f,cn,l.memoizedState.cache)}return Ao(l,f,g)}function Fm(l,f,g){if(l!==null)if(l.memoizedProps!==f.pendingProps)Vi=!0;else{if(!Fc(l,g)&&(f.flags&128)===0)return Vi=!1,Ld(l,f,g);Vi=(l.flags&131072)!==0}else Vi=!1,Qn&&(f.flags&1048576)!==0&&ev(f,If,f.index);switch(f.lanes=0,f.tag){case 16:e:{var _=f.pendingProps;if(l=Mu(f.elementType),f.type=l,typeof l=="function")Lr(l)?(_=Qs(l,_),f.tag=1,f=Zs(null,f,l,_,g)):(f.tag=0,f=zf(null,f,l,_,g));else{if(l!=null){var M=l.$$typeof;if(M===D){f.tag=11,f=bd(null,f,l,_,g);break e}else if(M===N){f.tag=14,f=Td(null,f,l,_,g);break e}}throw f=te(l)||l,Error(n(306,f,""))}}return f;case 0:return zf(l,f,f.type,f.pendingProps,g);case 1:return _=f.type,M=Qs(_,f.pendingProps),Zs(l,f,_,M,g);case 3:e:{if(je(f,f.stateNode.containerInfo),l===null)throw Error(n(387));_=f.pendingProps;var L=f.memoizedState;M=L.element,hv(l,f),Ru(f,_,null,g);var G=f.memoizedState;if(_=G.cache,Pl(f,cn,_),_!==L.cache&&ym(f,[cn],g,!0),md(),_=G.element,L.isDehydrated)if(L={element:_,isDehydrated:!1,cache:G.cache},f.updateQueue.baseState=L,f.memoizedState=L,f.flags&256){f=li(l,f,_,g);break e}else if(_!==M){M=Vr(Error(n(424)),f),cd(M),f=li(l,f,_,g);break e}else{switch(l=f.stateNode.containerInfo,l.nodeType){case 9:l=l.body;break;default:l=l.nodeName==="HTML"?l.ownerDocument.body:l}for(Ni=ol(l.firstChild),ks=f,Qn=!0,Bl=null,Gs=!0,g=R_(f,null,_,g),f.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling}else{if(Eu(),_===M){f=Ao(l,f,g);break e}is(l,f,_,g)}f=f.child}return f;case 26:return So(l,f),l===null?(g=Sw(f.type,null,f.pendingProps,null))?f.memoizedState=g:Qn||(g=f.type,l=f.pendingProps,_=oS(pe.current).createElement(g),_[Jt]=f,_[V]=l,Pr(_,g,l),Se(_),f.stateNode=_):f.memoizedState=Sw(f.type,l.memoizedProps,f.pendingProps,l.memoizedState),null;case 27:return St(f),l===null&&Qn&&(_=f.stateNode=yw(f.type,f.pendingProps,pe.current),ks=f,Gs=!0,M=Ni,$f(f.type)?(i1=M,Ni=ol(_.firstChild)):Ni=M),is(l,f,f.pendingProps.children,g),So(l,f),l===null&&(f.flags|=4194304),f.child;case 5:return l===null&&Qn&&((M=_=Ni)&&(_=I4(_,f.type,f.pendingProps,Gs),_!==null?(f.stateNode=_,ks=f,Ni=ol(_.firstChild),Gs=!1,M=!0):M=!1),M||Kn(f)),St(f),M=f.type,L=f.pendingProps,G=l!==null?l.memoizedProps:null,_=L.children,QT(M,L)?_=null:G!==null&&QT(M,G)&&(f.flags|=32),f.memoizedState!==null&&(M=yv(l,f,OT,null,null,g),$v._currentValue=M),So(l,f),is(l,f,_,g),f.child;case 6:return l===null&&Qn&&((l=g=Ni)&&(g=B4(g,f.pendingProps,Gs),g!==null?(f.stateNode=g,ks=f,Ni=null,l=!0):l=!1),l||Kn(f)),null;case 13:return _a(l,f,g);case 4:return je(f,f.stateNode.containerInfo),_=f.pendingProps,l===null?f.child=Cu(f,null,_,g):is(l,f,_,g),f.child;case 11:return bd(l,f,f.type,f.pendingProps,g);case 7:return is(l,f,f.pendingProps,g),f.child;case 8:return is(l,f,f.pendingProps.children,g),f.child;case 12:return is(l,f,f.pendingProps.children,g),f.child;case 10:return _=f.pendingProps,Pl(f,f.type,_.value),is(l,f,_.children,g),f.child;case 9:return M=f.type._context,_=f.pendingProps.children,bu(f),M=Hs(M),_=_(M),f.flags|=1,is(l,f,_,g),f.child;case 14:return Td(l,f,f.type,f.pendingProps,g);case 15:return va(l,f,f.type,f.pendingProps,g);case 19:return Dd(l,f,g);case 31:return Md(l,f,g);case 22:return ya(l,f,g,f.pendingProps);case 24:return bu(f),_=Hs(cn),l===null?(M=$o(),M===null&&(M=Si,L=rv(),M.pooledCache=L,L.refCount++,L!==null&&(M.pooledCacheLanes|=g),M=L),f.memoizedState={parent:_,cache:M},fv(f),Pl(f,cn,M)):((l.lanes&g)!==0&&(hv(l,f),Ru(f,null,null,g),md()),M=l.memoizedState,L=f.memoizedState,M.parent!==_?(M={parent:_,cache:_},f.memoizedState=M,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=M),Pl(f,cn,_)):(_=L.cache,Pl(f,cn,_),_!==M.cache&&ym(f,[cn],g,!0))),is(l,f,f.pendingProps.children,g),f.child;case 29:throw f.pendingProps}throw Error(n(156,f.tag))}function jr(l){l.flags|=4}function kc(l,f,g,_,M){if((f=(l.mode&32)!==0)&&(f=!1),f){if(l.flags|=16777216,(M&335544128)===M)if(l.stateNode.complete)l.flags|=8192;else if(Ct())l.flags|=8192;else throw gn=hd,fd}else l.flags&=-16777217}function zl(l,f){if(f.type!=="stylesheet"||(f.state.loading&4)!==0)l.flags&=-16777217;else if(l.flags|=16777216,!Mw(f))if(Ct())l.flags|=8192;else throw gn=hd,fd}function Xf(l,f){f!==null&&(l.flags|=4),l.flags&16384&&(f=l.tag!==22?En():536870912,l.lanes|=f,ba|=f)}function wd(l,f){if(!Qn)switch(l.tailMode){case"hidden":f=l.tail;for(var g=null;f!==null;)f.alternate!==null&&(g=f),f=f.sibling;g===null?l.tail=null:g.sibling=null;break;case"collapsed":g=l.tail;for(var _=null;g!==null;)g.alternate!==null&&(_=g),g=g.sibling;_===null?f||l.tail===null?l.tail=null:l.tail.sibling=null:_.sibling=null}}function Mi(l){var f=l.alternate!==null&&l.alternate.child===l.child,g=0,_=0;if(f)for(var M=l.child;M!==null;)g|=M.lanes|M.childLanes,_|=M.subtreeFlags&65011712,_|=M.flags&65011712,M.return=l,M=M.sibling;else for(M=l.child;M!==null;)g|=M.lanes|M.childLanes,_|=M.subtreeFlags,_|=M.flags,M.return=l,M=M.sibling;return l.subtreeFlags|=_,l.childLanes=g,f}function zv(l,f,g){var _=f.pendingProps;switch(Rc(f),f.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Mi(f),null;case 1:return Mi(f),null;case 3:return g=f.stateNode,_=null,l!==null&&(_=l.memoizedState.cache),f.memoizedState.cache!==_&&(f.flags|=2048),Ya(cn),gt(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(l===null||l.child===null)&&(Au(f)?jr(f):l===null||l.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,tv())),Mi(f),null;case 26:var M=f.type,L=f.memoizedState;return l===null?(jr(f),L!==null?(Mi(f),zl(f,L)):(Mi(f),kc(f,M,null,_,g))):L?L!==l.memoizedState?(jr(f),Mi(f),zl(f,L)):(Mi(f),f.flags&=-16777217):(l=l.memoizedProps,l!==_&&jr(f),Mi(f),kc(f,M,l,_,g)),null;case 27:if(At(f),g=pe.current,M=f.type,l!==null&&f.stateNode!=null)l.memoizedProps!==_&&jr(f);else{if(!_){if(f.stateNode===null)throw Error(n(166));return Mi(f),null}l=_e.current,Au(f)?vm(f):(l=yw(M,_,g),f.stateNode=l,jr(f))}return Mi(f),null;case 5:if(At(f),M=f.type,l!==null&&f.stateNode!=null)l.memoizedProps!==_&&jr(f);else{if(!_){if(f.stateNode===null)throw Error(n(166));return Mi(f),null}if(L=_e.current,Au(f))vm(f);else{var G=oS(pe.current);switch(L){case 1:L=G.createElementNS("http://www.w3.org/2000/svg",M);break;case 2:L=G.createElementNS("http://www.w3.org/1998/Math/MathML",M);break;default:switch(M){case"svg":L=G.createElementNS("http://www.w3.org/2000/svg",M);break;case"math":L=G.createElementNS("http://www.w3.org/1998/Math/MathML",M);break;case"script":L=G.createElement("div"),L.innerHTML="<script><\/script>",L=L.removeChild(L.firstChild);break;case"select":L=typeof _.is=="string"?G.createElement("select",{is:_.is}):G.createElement("select"),_.multiple?L.multiple=!0:_.size&&(L.size=_.size);break;default:L=typeof _.is=="string"?G.createElement(M,{is:_.is}):G.createElement(M)}}L[Jt]=f,L[V]=_;e:for(G=f.child;G!==null;){if(G.tag===5||G.tag===6)L.appendChild(G.stateNode);else if(G.tag!==4&&G.tag!==27&&G.child!==null){G.child.return=G,G=G.child;continue}if(G===f)break e;for(;G.sibling===null;){if(G.return===null||G.return===f)break e;G=G.return}G.sibling.return=G.return,G=G.sibling}f.stateNode=L;e:switch(Pr(L,M,_),M){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break e;case"img":_=!0;break e;default:_=!1}_&&jr(f)}}return Mi(f),kc(f,f.type,l===null?null:l.memoizedProps,f.pendingProps,g),null;case 6:if(l&&f.stateNode!=null)l.memoizedProps!==_&&jr(f);else{if(typeof _!="string"&&f.stateNode===null)throw Error(n(166));if(l=pe.current,Au(f)){if(l=f.stateNode,g=f.memoizedProps,_=null,M=ks,M!==null)switch(M.tag){case 27:case 5:_=M.memoizedProps}l[Jt]=f,l=!!(l.nodeValue===g||_!==null&&_.suppressHydrationWarning===!0||ow(l.nodeValue,g)),l||Kn(f,!0)}else l=oS(l).createTextNode(_),l[Jt]=f,f.stateNode=l}return Mi(f),null;case 31:if(g=f.memoizedState,l===null||l.memoizedState!==null){if(_=Au(f),g!==null){if(l===null){if(!_)throw Error(n(318));if(l=f.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(n(557));l[Jt]=f}else Eu(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;Mi(f),l=!1}else g=tv(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=g),l=!0;if(!l)return f.flags&256?(pa(f),f):(pa(f),null);if((f.flags&128)!==0)throw Error(n(558))}return Mi(f),null;case 13:if(_=f.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(M=Au(f),_!==null&&_.dehydrated!==null){if(l===null){if(!M)throw Error(n(318));if(M=f.memoizedState,M=M!==null?M.dehydrated:null,!M)throw Error(n(317));M[Jt]=f}else Eu(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;Mi(f),M=!1}else M=tv(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=M),M=!0;if(!M)return f.flags&256?(pa(f),f):(pa(f),null)}return pa(f),(f.flags&128)!==0?(f.lanes=g,f):(g=_!==null,l=l!==null&&l.memoizedState!==null,g&&(_=f.child,M=null,_.alternate!==null&&_.alternate.memoizedState!==null&&_.alternate.memoizedState.cachePool!==null&&(M=_.alternate.memoizedState.cachePool.pool),L=null,_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(L=_.memoizedState.cachePool.pool),L!==M&&(_.flags|=2048)),g!==l&&g&&(f.child.flags|=8192),Xf(f,f.updateQueue),Mi(f),null);case 4:return gt(),l===null&&qT(f.stateNode.containerInfo),Mi(f),null;case 10:return Ya(f.type),Mi(f),null;case 19:if(ne(ts),_=f.memoizedState,_===null)return Mi(f),null;if(M=(f.flags&128)!==0,L=_.rendering,L===null)if(M)wd(_,!1);else{if(Ai!==0||l!==null&&(l.flags&128)!==0)for(l=f.child;l!==null;){if(L=Em(l),L!==null){for(f.flags|=128,wd(_,!1),l=L.updateQueue,f.updateQueue=l,Xf(f,l),f.subtreeFlags=0,l=g,g=f.child;g!==null;)hr(g,l),g=g.sibling;return xe(ts,ts.current&1|2),Qn&&Il(f,_.treeForkCount),f.child}l=l.sibling}_.tail!==null&&q()>Ta&&(f.flags|=128,M=!0,wd(_,!1),f.lanes=4194304)}else{if(!M)if(l=Em(L),l!==null){if(f.flags|=128,M=!0,l=l.updateQueue,f.updateQueue=l,Xf(f,l),wd(_,!0),_.tail===null&&_.tailMode==="hidden"&&!L.alternate&&!Qn)return Mi(f),null}else 2*q()-_.renderingStartTime>Ta&&g!==536870912&&(f.flags|=128,M=!0,wd(_,!1),f.lanes=4194304);_.isBackwards?(L.sibling=f.child,f.child=L):(l=_.last,l!==null?l.sibling=L:f.child=L,_.last=L)}return _.tail!==null?(l=_.tail,_.rendering=l,_.tail=l.sibling,_.renderingStartTime=q(),l.sibling=null,g=ts.current,xe(ts,M?g&1|2:g&1),Qn&&Il(f,_.treeForkCount),l):(Mi(f),null);case 22:case 23:return pa(f),pr(),_=f.memoizedState!==null,l!==null?l.memoizedState!==null!==_&&(f.flags|=8192):_&&(f.flags|=8192),_?(g&536870912)!==0&&(f.flags&128)===0&&(Mi(f),f.subtreeFlags&6&&(f.flags|=8192)):Mi(f),g=f.updateQueue,g!==null&&Xf(f,g.retryQueue),g=null,l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(g=l.memoizedState.cachePool.pool),_=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(_=f.memoizedState.cachePool.pool),_!==g&&(f.flags|=2048),l!==null&&ne(Lc),null;case 24:return g=null,l!==null&&(g=l.memoizedState.cache),f.memoizedState.cache!==g&&(f.flags|=2048),Ya(cn),Mi(f),null;case 25:return null;case 30:return null}throw Error(n(156,f.tag))}function km(l,f){switch(Rc(f),f.tag){case 1:return l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 3:return Ya(cn),gt(),l=f.flags,(l&65536)!==0&&(l&128)===0?(f.flags=l&-65537|128,f):null;case 26:case 27:case 5:return At(f),null;case 31:if(f.memoizedState!==null){if(pa(f),f.alternate===null)throw Error(n(340));Eu()}return l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 13:if(pa(f),l=f.memoizedState,l!==null&&l.dehydrated!==null){if(f.alternate===null)throw Error(n(340));Eu()}return l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 19:return ne(ts),null;case 4:return gt(),null;case 10:return Ya(f.type),null;case 22:case 23:return pa(f),pr(),l!==null&&ne(Lc),l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 24:return Ya(cn),null;case 25:return null;default:return null}}function Iu(l,f){switch(Rc(f),f.tag){case 3:Ya(cn),gt();break;case 26:case 27:case 5:At(f);break;case 4:gt();break;case 31:f.memoizedState!==null&&pa(f);break;case 13:pa(f);break;case 19:ne(ts);break;case 10:Ya(f.type);break;case 22:case 23:pa(f),pr(),l!==null&&ne(Lc);break;case 24:Ya(cn)}}function il(l,f){try{var g=f.updateQueue,_=g!==null?g.lastEffect:null;if(_!==null){var M=_.next;g=M;do{if((g.tag&l)===l){_=void 0;var L=g.create,G=g.inst;_=L(),G.destroy=_}g=g.next}while(g!==M)}}catch(Q){Ii(f,f.return,Q)}}function ja(l,f,g){try{var _=f.updateQueue,M=_!==null?_.lastEffect:null;if(M!==null){var L=M.next;_=L;do{if((_.tag&l)===l){var G=_.inst,Q=G.destroy;if(Q!==void 0){G.destroy=void 0,M=f;var ve=g,Ue=Q;try{Ue()}catch(nt){Ii(M,ve,nt)}}}_=_.next}while(_!==L)}}catch(nt){Ii(f,f.return,nt)}}function Gc(l){var f=l.updateQueue;if(f!==null){var g=l.stateNode;try{Js(f,g)}catch(_){Ii(l,l.return,_)}}}function Vv(l,f,g){g.props=Qs(l.type,l.memoizedProps),g.state=l.memoizedState;try{g.componentWillUnmount()}catch(_){Ii(l,f,_)}}function sl(l,f){try{var g=l.ref;if(g!==null){switch(l.tag){case 26:case 27:case 5:var _=l.stateNode;break;case 30:_=l.stateNode;break;default:_=l.stateNode}typeof g=="function"?l.refCleanup=g(_):g.current=_}}catch(M){Ii(l,f,M)}}function Sa(l,f){var g=l.ref,_=l.refCleanup;if(g!==null)if(typeof _=="function")try{_()}catch(M){Ii(l,f,M)}finally{l.refCleanup=null,l=l.alternate,l!=null&&(l.refCleanup=null)}else if(typeof g=="function")try{g(null)}catch(M){Ii(l,f,M)}else g.current=null}function Aa(l){var f=l.type,g=l.memoizedProps,_=l.stateNode;try{e:switch(f){case"button":case"input":case"select":case"textarea":g.autoFocus&&_.focus();break e;case"img":g.src?_.src=g.src:g.srcSet&&(_.srcset=g.srcSet)}}catch(M){Ii(l,l.return,M)}}function Wa(l,f,g){try{var _=l.stateNode;M4(_,l.type,g,f),_[V]=f}catch(M){Ii(l,l.return,M)}}function bs(l){return l.tag===5||l.tag===3||l.tag===26||l.tag===27&&$f(l.type)||l.tag===4}function rl(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||bs(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.tag===27&&$f(l.type)||l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function Bn(l,f,g){var _=l.tag;if(_===5||_===6)l=l.stateNode,f?(g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g).insertBefore(l,f):(f=g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g,f.appendChild(l),g=g._reactRootContainer,g!=null||f.onclick!==null||(f.onclick=Yo));else if(_!==4&&(_===27&&$f(l.type)&&(g=l.stateNode,f=null),l=l.child,l!==null))for(Bn(l,f,g),l=l.sibling;l!==null;)Bn(l,f,g),l=l.sibling}function gi(l,f,g){var _=l.tag;if(_===5||_===6)l=l.stateNode,f?g.insertBefore(l,f):g.appendChild(l);else if(_!==4&&(_===27&&$f(l.type)&&(g=l.stateNode),l=l.child,l!==null))for(gi(l,f,g),l=l.sibling;l!==null;)gi(l,f,g),l=l.sibling}function ds(l){var f=l.stateNode,g=l.memoizedProps;try{for(var _=l.type,M=f.attributes;M.length;)f.removeAttributeNode(M[0]);Pr(f,_,g),f[Jt]=l,f[V]=g}catch(L){Ii(l,l.return,L)}}var Ja=!1,Yi=!1,Vl=!1,Id=typeof WeakSet=="function"?WeakSet:Set,ss=null;function Kf(l,f){if(l=l.containerInfo,JT=pS,l=om(l),Tf(l)){if("selectionStart"in l)var g={start:l.selectionStart,end:l.selectionEnd};else e:{g=(g=l.ownerDocument)&&g.defaultView||window;var _=g.getSelection&&g.getSelection();if(_&&_.rangeCount!==0){g=_.anchorNode;var M=_.anchorOffset,L=_.focusNode;_=_.focusOffset;try{g.nodeType,L.nodeType}catch{g=null;break e}var G=0,Q=-1,ve=-1,Ue=0,nt=0,mt=l,He=null;t:for(;;){for(var We;mt!==g||M!==0&&mt.nodeType!==3||(Q=G+M),mt!==L||_!==0&&mt.nodeType!==3||(ve=G+_),mt.nodeType===3&&(G+=mt.nodeValue.length),(We=mt.firstChild)!==null;)He=mt,mt=We;for(;;){if(mt===l)break t;if(He===g&&++Ue===M&&(Q=G),He===L&&++nt===_&&(ve=G),(We=mt.nextSibling)!==null)break;mt=He,He=mt.parentNode}mt=We}g=Q===-1||ve===-1?null:{start:Q,end:ve}}else g=null}g=g||{start:0,end:0}}else g=null;for($T={focusedElem:l,selectionRange:g},pS=!1,ss=f;ss!==null;)if(f=ss,l=f.child,(f.subtreeFlags&1028)!==0&&l!==null)l.return=f,ss=l;else for(;ss!==null;){switch(f=ss,L=f.alternate,l=f.flags,f.tag){case 0:if((l&4)!==0&&(l=f.updateQueue,l=l!==null?l.events:null,l!==null))for(g=0;g<l.length;g++)M=l[g],M.ref.impl=M.nextImpl;break;case 11:case 15:break;case 1:if((l&1024)!==0&&L!==null){l=void 0,g=f,M=L.memoizedProps,L=L.memoizedState,_=g.stateNode;try{var Zt=Qs(g.type,M);l=_.getSnapshotBeforeUpdate(Zt,L),_.__reactInternalSnapshotBeforeUpdate=l}catch(xn){Ii(g,g.return,xn)}}break;case 3:if((l&1024)!==0){if(l=f.stateNode.containerInfo,g=l.nodeType,g===9)e1(l);else if(g===1)switch(l.nodeName){case"HEAD":case"HTML":case"BODY":e1(l);break;default:l.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((l&1024)!==0)throw Error(n(163))}if(l=f.sibling,l!==null){l.return=f.return,ss=l;break}ss=f.return}}function eS(l,f,g){var _=g.flags;switch(g.tag){case 0:case 11:case 15:Yl(l,g),_&4&&il(5,g);break;case 1:if(Yl(l,g),_&4)if(l=g.stateNode,f===null)try{l.componentDidMount()}catch(G){Ii(g,g.return,G)}else{var M=Qs(g.type,f.memoizedProps);f=f.memoizedState;try{l.componentDidUpdate(M,f,l.__reactInternalSnapshotBeforeUpdate)}catch(G){Ii(g,g.return,G)}}_&64&&Gc(g),_&512&&sl(g,g.return);break;case 3:if(Yl(l,g),_&64&&(l=g.updateQueue,l!==null)){if(f=null,g.child!==null)switch(g.child.tag){case 27:case 5:f=g.child.stateNode;break;case 1:f=g.child.stateNode}try{Js(l,f)}catch(G){Ii(g,g.return,G)}}break;case 27:f===null&&_&4&&ds(g);case 26:case 5:Yl(l,g),f===null&&_&4&&Aa(g),_&512&&sl(g,g.return);break;case 12:Yl(l,g);break;case 31:Yl(l,g),_&4&&Hm(l,g);break;case 13:Yl(l,g),_&4&&Yv(l,g),_&64&&(l=g.memoizedState,l!==null&&(l=l.dehydrated,l!==null&&(g=p4.bind(null,g),O4(l,g))));break;case 22:if(_=g.memoizedState!==null||Ja,!_){f=f!==null&&f.memoizedState!==null||Yi,M=Ja;var L=Yi;Ja=_,(Yi=f)&&!L?_i(l,g,(g.subtreeFlags&8772)!==0):Yl(l,g),Ja=M,Yi=L}break;case 30:break;default:Yl(l,g)}}function Gm(l){var f=l.alternate;f!==null&&(l.alternate=null,Gm(f)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(f=l.stateNode,f!==null&&rt(f)),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}var ci=null,Ts=!1;function gr(l,f,g){for(g=g.child;g!==null;)Hc(l,f,g),g=g.sibling}function Hc(l,f,g){if(Je&&typeof Je.onCommitFiberUnmount=="function")try{Je.onCommitFiberUnmount(Ze,g)}catch{}switch(g.tag){case 26:Yi||Sa(g,f),gr(l,f,g),g.memoizedState?g.memoizedState.count--:g.stateNode&&(g=g.stateNode,g.parentNode.removeChild(g));break;case 27:Yi||Sa(g,f);var _=ci,M=Ts;$f(g.type)&&(ci=g.stateNode,Ts=!1),gr(l,f,g),jv(g.stateNode),ci=_,Ts=M;break;case 5:Yi||Sa(g,f);case 6:if(_=ci,M=Ts,ci=null,gr(l,f,g),ci=_,Ts=M,ci!==null)if(Ts)try{(ci.nodeType===9?ci.body:ci.nodeName==="HTML"?ci.ownerDocument.body:ci).removeChild(g.stateNode)}catch(L){Ii(g,f,L)}else try{ci.removeChild(g.stateNode)}catch(L){Ii(g,f,L)}break;case 18:ci!==null&&(Ts?(l=ci,dw(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,g.stateNode),Qm(l)):dw(ci,g.stateNode));break;case 4:_=ci,M=Ts,ci=g.stateNode.containerInfo,Ts=!0,gr(l,f,g),ci=_,Ts=M;break;case 0:case 11:case 14:case 15:ja(2,g,f),Yi||ja(4,g,f),gr(l,f,g);break;case 1:Yi||(Sa(g,f),_=g.stateNode,typeof _.componentWillUnmount=="function"&&Vv(g,f,_)),gr(l,f,g);break;case 21:gr(l,f,g);break;case 22:Yi=(_=Yi)||g.memoizedState!==null,gr(l,f,g),Yi=_;break;default:gr(l,f,g)}}function Hm(l,f){if(f.memoizedState===null&&(l=f.alternate,l!==null&&(l=l.memoizedState,l!==null))){l=l.dehydrated;try{Qm(l)}catch(g){Ii(f,f.return,g)}}}function Yv(l,f){if(f.memoizedState===null&&(l=f.alternate,l!==null&&(l=l.memoizedState,l!==null&&(l=l.dehydrated,l!==null))))try{Qm(l)}catch(g){Ii(f,f.return,g)}}function tS(l){switch(l.tag){case 31:case 13:case 19:var f=l.stateNode;return f===null&&(f=l.stateNode=new Id),f;case 22:return l=l.stateNode,f=l._retryCache,f===null&&(f=l._retryCache=new Id),f;default:throw Error(n(435,l.tag))}}function ps(l,f){var g=tS(l);f.forEach(function(_){if(!g.has(_)){g.add(_);var M=m4.bind(null,l,_);_.then(M,M)}})}function vr(l,f){var g=f.deletions;if(g!==null)for(var _=0;_<g.length;_++){var M=g[_],L=l,G=f,Q=G;e:for(;Q!==null;){switch(Q.tag){case 27:if($f(Q.type)){ci=Q.stateNode,Ts=!1;break e}break;case 5:ci=Q.stateNode,Ts=!1;break e;case 3:case 4:ci=Q.stateNode.containerInfo,Ts=!0;break e}Q=Q.return}if(ci===null)throw Error(n(160));Hc(L,G,M),ci=null,Ts=!1,L=M.alternate,L!==null&&(L.return=null),M.return=null}if(f.subtreeFlags&13886)for(f=f.child;f!==null;)zc(f,l),f=f.sibling}var Wr=null;function zc(l,f){var g=l.alternate,_=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:vr(f,l),rs(l),_&4&&(ja(3,l,l.return),il(3,l),ja(5,l,l.return));break;case 1:vr(f,l),rs(l),_&512&&(Yi||g===null||Sa(g,g.return)),_&64&&Ja&&(l=l.updateQueue,l!==null&&(_=l.callbacks,_!==null&&(g=l.shared.hiddenCallbacks,l.shared.hiddenCallbacks=g===null?_:g.concat(_))));break;case 26:var M=Wr;if(vr(f,l),rs(l),_&512&&(Yi||g===null||Sa(g,g.return)),_&4){var L=g!==null?g.memoizedState:null;if(_=l.memoizedState,g===null)if(_===null)if(l.stateNode===null){e:{_=l.type,g=l.memoizedProps,M=M.ownerDocument||M;t:switch(_){case"title":L=M.getElementsByTagName("title")[0],(!L||L[dt]||L[Jt]||L.namespaceURI==="http://www.w3.org/2000/svg"||L.hasAttribute("itemprop"))&&(L=M.createElement(_),M.head.insertBefore(L,M.querySelector("head > title"))),Pr(L,_,g),L[Jt]=l,Se(L),_=L;break e;case"link":var G=bw("link","href",M).get(_+(g.href||""));if(G){for(var Q=0;Q<G.length;Q++)if(L=G[Q],L.getAttribute("href")===(g.href==null||g.href===""?null:g.href)&&L.getAttribute("rel")===(g.rel==null?null:g.rel)&&L.getAttribute("title")===(g.title==null?null:g.title)&&L.getAttribute("crossorigin")===(g.crossOrigin==null?null:g.crossOrigin)){G.splice(Q,1);break t}}L=M.createElement(_),Pr(L,_,g),M.head.appendChild(L);break;case"meta":if(G=bw("meta","content",M).get(_+(g.content||""))){for(Q=0;Q<G.length;Q++)if(L=G[Q],L.getAttribute("content")===(g.content==null?null:""+g.content)&&L.getAttribute("name")===(g.name==null?null:g.name)&&L.getAttribute("property")===(g.property==null?null:g.property)&&L.getAttribute("http-equiv")===(g.httpEquiv==null?null:g.httpEquiv)&&L.getAttribute("charset")===(g.charSet==null?null:g.charSet)){G.splice(Q,1);break t}}L=M.createElement(_),Pr(L,_,g),M.head.appendChild(L);break;default:throw Error(n(468,_))}L[Jt]=l,Se(L),_=L}l.stateNode=_}else Tw(M,l.type,l.stateNode);else l.stateNode=Ew(M,_,l.memoizedProps);else L!==_?(L===null?g.stateNode!==null&&(g=g.stateNode,g.parentNode.removeChild(g)):L.count--,_===null?Tw(M,l.type,l.stateNode):Ew(M,_,l.memoizedProps)):_===null&&l.stateNode!==null&&Wa(l,l.memoizedProps,g.memoizedProps)}break;case 27:vr(f,l),rs(l),_&512&&(Yi||g===null||Sa(g,g.return)),g!==null&&_&4&&Wa(l,l.memoizedProps,g.memoizedProps);break;case 5:if(vr(f,l),rs(l),_&512&&(Yi||g===null||Sa(g,g.return)),l.flags&32){M=l.stateNode;try{po(M,"")}catch(Zt){Ii(l,l.return,Zt)}}_&4&&l.stateNode!=null&&(M=l.memoizedProps,Wa(l,M,g!==null?g.memoizedProps:M)),_&1024&&(Vl=!0);break;case 6:if(vr(f,l),rs(l),_&4){if(l.stateNode===null)throw Error(n(162));_=l.memoizedProps,g=l.stateNode;try{g.nodeValue=_}catch(Zt){Ii(l,l.return,Zt)}}break;case 3:if(uS=null,M=Wr,Wr=lS(f.containerInfo),vr(f,l),Wr=M,rs(l),_&4&&g!==null&&g.memoizedState.isDehydrated)try{Qm(f.containerInfo)}catch(Zt){Ii(l,l.return,Zt)}Vl&&(Vl=!1,nS(l));break;case 4:_=Wr,Wr=lS(l.stateNode.containerInfo),vr(f,l),rs(l),Wr=_;break;case 12:vr(f,l),rs(l);break;case 31:vr(f,l),rs(l),_&4&&(_=l.updateQueue,_!==null&&(l.updateQueue=null,ps(l,_)));break;case 13:vr(f,l),rs(l),l.child.flags&8192&&l.memoizedState!==null!=(g!==null&&g.memoizedState!==null)&&(ql=q()),_&4&&(_=l.updateQueue,_!==null&&(l.updateQueue=null,ps(l,_)));break;case 22:M=l.memoizedState!==null;var ve=g!==null&&g.memoizedState!==null,Ue=Ja,nt=Yi;if(Ja=Ue||M,Yi=nt||ve,vr(f,l),Yi=nt,Ja=Ue,rs(l),_&8192)e:for(f=l.stateNode,f._visibility=M?f._visibility&-2:f._visibility|1,M&&(g===null||ve||Ja||Yi||Bu(l)),g=null,f=l;;){if(f.tag===5||f.tag===26){if(g===null){ve=g=f;try{if(L=ve.stateNode,M)G=L.style,typeof G.setProperty=="function"?G.setProperty("display","none","important"):G.display="none";else{Q=ve.stateNode;var mt=ve.memoizedProps.style,He=mt!=null&&mt.hasOwnProperty("display")?mt.display:null;Q.style.display=He==null||typeof He=="boolean"?"":(""+He).trim()}}catch(Zt){Ii(ve,ve.return,Zt)}}}else if(f.tag===6){if(g===null){ve=f;try{ve.stateNode.nodeValue=M?"":ve.memoizedProps}catch(Zt){Ii(ve,ve.return,Zt)}}}else if(f.tag===18){if(g===null){ve=f;try{var We=ve.stateNode;M?pw(We,!0):pw(ve.stateNode,!1)}catch(Zt){Ii(ve,ve.return,Zt)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===l)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break e;for(;f.sibling===null;){if(f.return===null||f.return===l)break e;g===f&&(g=null),f=f.return}g===f&&(g=null),f.sibling.return=f.return,f=f.sibling}_&4&&(_=l.updateQueue,_!==null&&(g=_.retryQueue,g!==null&&(_.retryQueue=null,ps(l,g))));break;case 19:vr(f,l),rs(l),_&4&&(_=l.updateQueue,_!==null&&(l.updateQueue=null,ps(l,_)));break;case 30:break;case 21:break;default:vr(f,l),rs(l)}}function rs(l){var f=l.flags;if(f&2){try{for(var g,_=l.return;_!==null;){if(bs(_)){g=_;break}_=_.return}if(g==null)throw Error(n(160));switch(g.tag){case 27:var M=g.stateNode,L=rl(l);gi(l,L,M);break;case 5:var G=g.stateNode;g.flags&32&&(po(G,""),g.flags&=-33);var Q=rl(l);gi(l,Q,G);break;case 3:case 4:var ve=g.stateNode.containerInfo,Ue=rl(l);Bn(l,Ue,ve);break;default:throw Error(n(161))}}catch(nt){Ii(l,l.return,nt)}l.flags&=-3}f&4096&&(l.flags&=-4097)}function nS(l){if(l.subtreeFlags&1024)for(l=l.child;l!==null;){var f=l;nS(f),f.tag===5&&f.flags&1024&&f.stateNode.reset(),l=l.sibling}}function Yl(l,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)eS(l,f.alternate,f),f=f.sibling}function Bu(l){for(l=l.child;l!==null;){var f=l;switch(f.tag){case 0:case 11:case 14:case 15:ja(4,f,f.return),Bu(f);break;case 1:Sa(f,f.return);var g=f.stateNode;typeof g.componentWillUnmount=="function"&&Vv(f,f.return,g),Bu(f);break;case 27:jv(f.stateNode);case 26:case 5:Sa(f,f.return),Bu(f);break;case 22:f.memoizedState===null&&Bu(f);break;case 30:Bu(f);break;default:Bu(f)}l=l.sibling}}function _i(l,f,g){for(g=g&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var _=f.alternate,M=l,L=f,G=L.flags;switch(L.tag){case 0:case 11:case 15:_i(M,L,g),il(4,L);break;case 1:if(_i(M,L,g),_=L,M=_.stateNode,typeof M.componentDidMount=="function")try{M.componentDidMount()}catch(Ue){Ii(_,_.return,Ue)}if(_=L,M=_.updateQueue,M!==null){var Q=_.stateNode;try{var ve=M.shared.hiddenCallbacks;if(ve!==null)for(M.shared.hiddenCallbacks=null,M=0;M<ve.length;M++)Zo(ve[M],Q)}catch(Ue){Ii(_,_.return,Ue)}}g&&G&64&&Gc(L),sl(L,L.return);break;case 27:ds(L);case 26:case 5:_i(M,L,g),g&&_===null&&G&4&&Aa(L),sl(L,L.return);break;case 12:_i(M,L,g);break;case 31:_i(M,L,g),g&&G&4&&Hm(M,L);break;case 13:_i(M,L,g),g&&G&4&&Yv(M,L);break;case 22:L.memoizedState===null&&_i(M,L,g),sl(L,L.return);break;case 30:break;default:_i(M,L,g)}f=f.sibling}}function zm(l,f){var g=null;l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(g=l.memoizedState.cachePool.pool),l=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(l=f.memoizedState.cachePool.pool),l!==g&&(l!=null&&l.refCount++,g!=null&&Ws(g))}function Xl(l,f){l=null,f.alternate!==null&&(l=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==l&&(f.refCount++,l!=null&&Ws(l))}function ws(l,f,g,_){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)$i(l,f,g,_),f=f.sibling}function $i(l,f,g,_){var M=f.flags;switch(f.tag){case 0:case 11:case 15:ws(l,f,g,_),M&2048&&il(9,f);break;case 1:ws(l,f,g,_);break;case 3:ws(l,f,g,_),M&2048&&(l=null,f.alternate!==null&&(l=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==l&&(f.refCount++,l!=null&&Ws(l)));break;case 12:if(M&2048){ws(l,f,g,_),l=f.stateNode;try{var L=f.memoizedProps,G=L.id,Q=L.onPostCommit;typeof Q=="function"&&Q(G,f.alternate===null?"mount":"update",l.passiveEffectDuration,-0)}catch(ve){Ii(f,f.return,ve)}}else ws(l,f,g,_);break;case 31:ws(l,f,g,_);break;case 13:ws(l,f,g,_);break;case 23:break;case 22:L=f.stateNode,G=f.alternate,f.memoizedState!==null?L._visibility&2?ws(l,f,g,_):qf(l,f):L._visibility&2?ws(l,f,g,_):(L._visibility|=2,Vc(l,f,g,_,(f.subtreeFlags&10256)!==0||!1)),M&2048&&zm(G,f);break;case 24:ws(l,f,g,_),M&2048&&Xl(f.alternate,f);break;default:ws(l,f,g,_)}}function Vc(l,f,g,_,M){for(M=M&&((f.subtreeFlags&10256)!==0||!1),f=f.child;f!==null;){var L=l,G=f,Q=g,ve=_,Ue=G.flags;switch(G.tag){case 0:case 11:case 15:Vc(L,G,Q,ve,M),il(8,G);break;case 23:break;case 22:var nt=G.stateNode;G.memoizedState!==null?nt._visibility&2?Vc(L,G,Q,ve,M):qf(L,G):(nt._visibility|=2,Vc(L,G,Q,ve,M)),M&&Ue&2048&&zm(G.alternate,G);break;case 24:Vc(L,G,Q,ve,M),M&&Ue&2048&&Xl(G.alternate,G);break;default:Vc(L,G,Q,ve,M)}f=f.sibling}}function qf(l,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var g=l,_=f,M=_.flags;switch(_.tag){case 22:qf(g,_),M&2048&&zm(_.alternate,_);break;case 24:qf(g,_),M&2048&&Xl(_.alternate,_);break;default:qf(g,_)}f=f.sibling}}var as=8192;function Ou(l,f,g){if(l.subtreeFlags&as)for(l=l.child;l!==null;)ms(l,f,g),l=l.sibling}function ms(l,f,g){switch(l.tag){case 26:Ou(l,f,g),l.flags&as&&l.memoizedState!==null&&K4(g,Wr,l.memoizedState,l.memoizedProps);break;case 5:Ou(l,f,g);break;case 3:case 4:var _=Wr;Wr=lS(l.stateNode.containerInfo),Ou(l,f,g),Wr=_;break;case 22:l.memoizedState===null&&(_=l.alternate,_!==null&&_.memoizedState!==null?(_=as,as=16777216,Ou(l,f,g),as=_):Ou(l,f,g));break;default:Ou(l,f,g)}}function Jr(l){var f=l.alternate;if(f!==null&&(l=f.child,l!==null)){f.child=null;do f=l.sibling,l.sibling=null,l=f;while(l!==null)}}function Br(l){var f=l.deletions;if((l.flags&16)!==0){if(f!==null)for(var g=0;g<f.length;g++){var _=f[g];ss=_,Bd(_,l)}Jr(l)}if(l.subtreeFlags&10256)for(l=l.child;l!==null;)Pu(l),l=l.sibling}function Pu(l){switch(l.tag){case 0:case 11:case 15:Br(l),l.flags&2048&&ja(9,l,l.return);break;case 3:Br(l);break;case 12:Br(l);break;case 22:var f=l.stateNode;l.memoizedState!==null&&f._visibility&2&&(l.return===null||l.return.tag!==13)?(f._visibility&=-3,Vm(l)):Br(l);break;default:Br(l)}}function Vm(l){var f=l.deletions;if((l.flags&16)!==0){if(f!==null)for(var g=0;g<f.length;g++){var _=f[g];ss=_,Bd(_,l)}Jr(l)}for(l=l.child;l!==null;){switch(f=l,f.tag){case 0:case 11:case 15:ja(8,f,f.return),Vm(f);break;case 22:g=f.stateNode,g._visibility&2&&(g._visibility&=-3,Vm(f));break;default:Vm(f)}l=l.sibling}}function Bd(l,f){for(;ss!==null;){var g=ss;switch(g.tag){case 0:case 11:case 15:ja(8,g,f);break;case 23:case 22:if(g.memoizedState!==null&&g.memoizedState.cachePool!==null){var _=g.memoizedState.cachePool.pool;_!=null&&_.refCount++}break;case 24:Ws(g.memoizedState.cache)}if(_=g.child,_!==null)_.return=g,ss=_;else e:for(g=l;ss!==null;){_=ss;var M=_.sibling,L=_.return;if(Gm(_),_===g){ss=null;break e}if(M!==null){M.return=L,ss=M;break e}ss=L}}}var Ym={getCacheForType:function(l){var f=Hs(cn),g=f.data.get(l);return g===void 0&&(g=l(),f.data.set(l,g)),g},cacheSignal:function(){return Hs(cn).controller.signal}},Xm=typeof WeakMap=="function"?WeakMap:Map,ii=0,Si=null,On=null,qn=0,un=0,Hn=null,Rn=!1,Fn=!1,Li=!1,gs=0,Ai=0,Ea=0,Kl=0,Eo=0,si=0,ba=0,bo=null,yr=null,$r=!1,ql=0,jf=0,Ta=1/0,Wf=null,al=null,Qi=0,To=null,Ma=null,$a=0,jl=0,Nu=null,Km=null,Uu=0,Fu=null;function Or(){return(ii&2)!==0&&qn!==0?qn&-qn:k.T!==null?VT():hn()}function d(){if(si===0)if((qn&536870912)===0||Qn){var l=ht;ht<<=1,(ht&3932160)===0&&(ht=262144),si=l}else si=536870912;return l=Ls.current,l!==null&&(l.flags|=32),si}function m(l,f,g){(l===Si&&(un===2||un===9)||l.cancelPendingCommit!==null)&&(Le(l,0),F(l,qn,si,!1)),Ut(l,g),((ii&2)===0||l!==Si)&&(l===Si&&((ii&2)===0&&(Kl|=g),Ai===4&&F(l,qn,si,!1)),Yc(l))}function A(l,f,g){if((ii&6)!==0)throw Error(n(327));var _=!g&&(f&127)===0&&(f&l.expiredLanes)===0||Rt(l,f),M=_?ku(l,f):Qr(l,f,!0),L=_;do{if(M===0){Fn&&!_&&F(l,f,0,!1);break}else{if(g=l.current.alternate,L&&!w(g)){M=Qr(l,f,!1),L=!1;continue}if(M===2){if(L=f,l.errorRecoveryDisabledLanes&L)var G=0;else G=l.pendingLanes&-536870913,G=G!==0?G:G&536870912?536870912:0;if(G!==0){f=G;e:{var Q=l;M=bo;var ve=Q.current.memoizedState.isDehydrated;if(ve&&(Le(Q,G).flags|=256),G=Qr(Q,G,!1),G!==2){if(Li&&!ve){Q.errorRecoveryDisabledLanes|=L,Kl|=L,M=4;break e}L=yr,yr=M,L!==null&&(yr===null?yr=L:yr.push.apply(yr,L))}M=G}if(L=!1,M!==2)continue}}if(M===1){Le(l,0),F(l,f,0,!0);break}e:{switch(_=l,L=M,L){case 0:case 1:throw Error(n(345));case 4:if((f&4194048)!==f)break;case 6:F(_,f,si,!Rn);break e;case 2:yr=null;break;case 3:case 5:break;default:throw Error(n(329))}if((f&62914560)===f&&(M=ql+300-q(),10<M)){if(F(_,f,si,!Rn),Qe(_,0,!0)!==0)break e;$a=f,_.timeoutHandle=fw(C.bind(null,_,g,yr,Wf,$r,f,si,Kl,ba,Rn,L,"Throttled",-0,0),M);break e}C(_,g,yr,Wf,$r,f,si,Kl,ba,Rn,L,null,-0,0)}}break}while(!0);Yc(l)}function C(l,f,g,_,M,L,G,Q,ve,Ue,nt,mt,He,We){if(l.timeoutHandle=-1,mt=f.subtreeFlags,mt&8192||(mt&16785408)===16785408){mt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Yo},ms(f,L,mt);var Zt=(L&62914560)===L?ql-q():(L&4194048)===L?jf-q():0;if(Zt=q4(mt,Zt),Zt!==null){$a=L,l.cancelPendingCommit=Zt(Sn.bind(null,l,f,L,g,_,M,G,Q,ve,nt,mt,null,He,We)),F(l,L,G,!Ue);return}}Sn(l,f,L,g,_,M,G,Q,ve)}function w(l){for(var f=l;;){var g=f.tag;if((g===0||g===11||g===15)&&f.flags&16384&&(g=f.updateQueue,g!==null&&(g=g.stores,g!==null)))for(var _=0;_<g.length;_++){var M=g[_],L=M.getSnapshot;M=M.value;try{if(!zi(L(),M))return!1}catch{return!1}}if(g=f.child,f.subtreeFlags&16384&&g!==null)g.return=f,f=g;else{if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function F(l,f,g,_){f&=~Eo,f&=~Kl,l.suspendedLanes|=f,l.pingedLanes&=~f,_&&(l.warmLanes|=f),_=l.expirationTimes;for(var M=f;0<M;){var L=31-he(M),G=1<<L;_[L]=-1,M&=~G}g!==0&&It(l,g,f)}function ee(){return(ii&6)===0?(Xv(0),!1):!0}function ge(){if(On!==null){if(un===0)var l=On.return;else l=On,dr=Ol=null,Sv(l),Ic=null,Bc=0,l=On;for(;l!==null;)Iu(l.alternate,l),l=l.return;On=null}}function Le(l,f){var g=l.timeoutHandle;g!==-1&&(l.timeoutHandle=-1,D4(g)),g=l.cancelPendingCommit,g!==null&&(l.cancelPendingCommit=null,g()),$a=0,ge(),Si=l,On=g=qo(l.current,null),qn=f,un=0,Hn=null,Rn=!1,Fn=Rt(l,f),Li=!1,ba=si=Eo=Kl=Ea=Ai=0,yr=bo=null,$r=!1,(f&8)!==0&&(f|=f&32);var _=l.entangledLanes;if(_!==0)for(l=l.entanglements,_&=f;0<_;){var M=31-he(_),L=1<<M;f|=l[M],_&=~L}return gs=f,Tc(),g}function ot(l,f){_n=null,k.H=Sd,f===wc||f===xo?(f=_m(),un=3):f===fd?(f=_m(),un=4):un=f===Um?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,Hn=f,On===null&&(Ai=1,Nm(l,Vr(f,l.current)))}function Ct(){var l=Ls.current;return l===null?!0:(qn&4194048)===qn?Xa===null:(qn&62914560)===qn||(qn&536870912)!==0?l===Xa:!1}function kt(){var l=k.H;return k.H=Sd,l===null?Sd:l}function Xt(){var l=k.A;return k.A=Ym,l}function Tn(){Ai=4,Rn||(qn&4194048)!==qn&&Ls.current!==null||(Fn=!0),(Ea&134217727)===0&&(Kl&134217727)===0||Si===null||F(Si,qn,si,!1)}function Qr(l,f,g){var _=ii;ii|=2;var M=kt(),L=Xt();(Si!==l||qn!==f)&&(Wf=null,Le(l,f)),f=!1;var G=Ai;e:do try{if(un!==0&&On!==null){var Q=On,ve=Hn;switch(un){case 8:ge(),G=6;break e;case 3:case 2:case 9:case 6:Ls.current===null&&(f=!0);var Ue=un;if(un=0,Hn=null,Et(l,Q,ve,Ue),g&&Fn){G=0;break e}break;default:Ue=un,un=0,Hn=null,Et(l,Q,ve,Ue)}}Od(),G=Ai;break}catch(nt){ot(l,nt)}while(!0);return f&&l.shellSuspendCounter++,dr=Ol=null,ii=_,k.H=M,k.A=L,On===null&&(Si=null,qn=0,Tc()),G}function Od(){for(;On!==null;)Te(On)}function ku(l,f){var g=ii;ii|=2;var _=kt(),M=Xt();Si!==l||qn!==f?(Wf=null,Ta=q()+500,Le(l,f)):Fn=Rt(l,f);e:do try{if(un!==0&&On!==null){f=On;var L=Hn;t:switch(un){case 1:un=0,Hn=null,Et(l,f,L,1);break;case 2:case 9:if(C_(L)){un=0,Hn=null,qe(f);break}f=function(){un!==2&&un!==9||Si!==l||(un=7),Yc(l)},L.then(f,f);break e;case 3:un=7;break e;case 4:un=5;break e;case 7:C_(L)?(un=0,Hn=null,qe(f)):(un=0,Hn=null,Et(l,f,L,7));break;case 5:var G=null;switch(On.tag){case 26:G=On.memoizedState;case 5:case 27:var Q=On;if(G?Mw(G):Q.stateNode.complete){un=0,Hn=null;var ve=Q.sibling;if(ve!==null)On=ve;else{var Ue=Q.return;Ue!==null?(On=Ue,on(Ue)):On=null}break t}}un=0,Hn=null,Et(l,f,L,5);break;case 6:un=0,Hn=null,Et(l,f,L,6);break;case 8:ge(),Ai=6;break e;default:throw Error(n(462))}}ke();break}catch(nt){ot(l,nt)}while(!0);return dr=Ol=null,k.H=_,k.A=M,ii=g,On!==null?0:(Si=null,qn=0,Tc(),Ai)}function ke(){for(;On!==null&&!Tt();)Te(On)}function Te(l){var f=Fm(l.alternate,l,gs);l.memoizedProps=l.pendingProps,f===null?on(l):On=f}function qe(l){var f=l,g=f.alternate;switch(f.tag){case 15:case 0:f=mr(g,f,f.pendingProps,f.type,void 0,qn);break;case 11:f=mr(g,f,f.pendingProps,f.type.render,f.ref,qn);break;case 5:Sv(f);default:Iu(g,f),f=On=hr(f,gs),f=Fm(g,f,gs)}l.memoizedProps=l.pendingProps,f===null?on(l):On=f}function Et(l,f,g,_){dr=Ol=null,Sv(f),Ic=null,Bc=0;var M=f.return;try{if(ga(l,M,f,g,qn)){Ai=1,Nm(l,Vr(g,l.current)),On=null;return}}catch(L){if(M!==null)throw On=M,L;Ai=1,Nm(l,Vr(g,l.current)),On=null;return}f.flags&32768?(Qn||_===1?l=!0:Fn||(qn&536870912)!==0?l=!1:(Rn=l=!0,(_===2||_===9||_===3||_===6)&&(_=Ls.current,_!==null&&_.tag===13&&(_.flags|=16384))),Ui(f,l)):on(f)}function on(l){var f=l;do{if((f.flags&32768)!==0){Ui(f,Rn);return}l=f.return;var g=zv(f.alternate,f,gs);if(g!==null){On=g;return}if(f=f.sibling,f!==null){On=f;return}On=f=l}while(f!==null);Ai===0&&(Ai=5)}function Ui(l,f){do{var g=km(l.alternate,l);if(g!==null){g.flags&=32767,On=g;return}if(g=l.return,g!==null&&(g.flags|=32768,g.subtreeFlags=0,g.deletions=null),!f&&(l=l.sibling,l!==null)){On=l;return}On=l=g}while(l!==null);Ai=6,On=null}function Sn(l,f,g,_,M,L,G,Q,ve){l.cancelPendingCommit=null;do qm();while(Qi!==0);if((ii&6)!==0)throw Error(n(327));if(f!==null){if(f===l.current)throw Error(n(177));if(L=f.lanes|f.childLanes,L|=hm,dn(l,g,L,G,Q,ve),l===Si&&(On=Si=null,qn=0),Ma=f,To=l,$a=g,jl=L,Nu=M,Km=_,(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?(l.callbackNode=null,l.callbackPriority=0,g4(Pe,function(){return jL(),null})):(l.callbackNode=null,l.callbackPriority=0),_=(f.flags&13878)!==0,(f.subtreeFlags&13878)!==0||_){_=k.T,k.T=null,M=j.p,j.p=2,G=ii,ii|=4;try{Kf(l,f,g)}finally{ii=G,j.p=M,k.T=_}}Qi=1,ui(),Is(),fi()}}function ui(){if(Qi===1){Qi=0;var l=To,f=Ma,g=(f.flags&13878)!==0;if((f.subtreeFlags&13878)!==0||g){g=k.T,k.T=null;var _=j.p;j.p=2;var M=ii;ii|=4;try{zc(f,l);var L=$T,G=om(l.containerInfo),Q=L.focusedElem,ve=L.selectionRange;if(G!==Q&&Q&&Q.ownerDocument&&am(Q.ownerDocument.documentElement,Q)){if(ve!==null&&Tf(Q)){var Ue=ve.start,nt=ve.end;if(nt===void 0&&(nt=Ue),"selectionStart"in Q)Q.selectionStart=Ue,Q.selectionEnd=Math.min(nt,Q.value.length);else{var mt=Q.ownerDocument||document,He=mt&&mt.defaultView||window;if(He.getSelection){var We=He.getSelection(),Zt=Q.textContent.length,xn=Math.min(ve.start,Zt),ki=ve.end===void 0?xn:Math.min(ve.end,Zt);!We.extend&&xn>ki&&(G=ki,ki=xn,xn=G);var Me=Jg(Q,xn),Ae=Jg(Q,ki);if(Me&&Ae&&(We.rangeCount!==1||We.anchorNode!==Me.node||We.anchorOffset!==Me.offset||We.focusNode!==Ae.node||We.focusOffset!==Ae.offset)){var Ne=mt.createRange();Ne.setStart(Me.node,Me.offset),We.removeAllRanges(),xn>ki?(We.addRange(Ne),We.extend(Ae.node,Ae.offset)):(Ne.setEnd(Ae.node,Ae.offset),We.addRange(Ne))}}}}for(mt=[],We=Q;We=We.parentNode;)We.nodeType===1&&mt.push({element:We,left:We.scrollLeft,top:We.scrollTop});for(typeof Q.focus=="function"&&Q.focus(),Q=0;Q<mt.length;Q++){var ft=mt[Q];ft.element.scrollLeft=ft.left,ft.element.scrollTop=ft.top}}pS=!!JT,$T=JT=null}finally{ii=M,j.p=_,k.T=g}}l.current=f,Qi=2}}function Is(){if(Qi===2){Qi=0;var l=To,f=Ma,g=(f.flags&8772)!==0;if((f.subtreeFlags&8772)!==0||g){g=k.T,k.T=null;var _=j.p;j.p=2;var M=ii;ii|=4;try{eS(l,f.alternate,f)}finally{ii=M,j.p=_,k.T=g}}Qi=3}}function fi(){if(Qi===4||Qi===3){Qi=0,se();var l=To,f=Ma,g=$a,_=Km;(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?Qi=5:(Qi=0,Ma=To=null,Wl(l,l.pendingLanes));var M=l.pendingLanes;if(M===0&&(al=null),ai(g),f=f.stateNode,Je&&typeof Je.onCommitFiberRoot=="function")try{Je.onCommitFiberRoot(Ze,f,void 0,(f.current.flags&128)===128)}catch{}if(_!==null){f=k.T,M=j.p,j.p=2,k.T=null;try{for(var L=l.onRecoverableError,G=0;G<_.length;G++){var Q=_[G];L(Q.value,{componentStack:Q.stack})}}finally{k.T=f,j.p=M}}($a&3)!==0&&qm(),Yc(l),M=l.pendingLanes,(g&261930)!==0&&(M&42)!==0?l===Fu?Uu++:(Uu=0,Fu=l):Uu=0,Xv(0)}}function Wl(l,f){(l.pooledCacheLanes&=f)===0&&(f=l.pooledCache,f!=null&&(l.pooledCache=null,Ws(f)))}function qm(){return ui(),Is(),fi(),jL()}function jL(){if(Qi!==5)return!1;var l=To,f=jl;jl=0;var g=ai($a),_=k.T,M=j.p;try{j.p=32>g?32:g,k.T=null,g=Nu,Nu=null;var L=To,G=$a;if(Qi=0,Ma=To=null,$a=0,(ii&6)!==0)throw Error(n(331));var Q=ii;if(ii|=4,Pu(L.current),$i(L,L.current,G,g),ii=Q,Xv(0,!1),Je&&typeof Je.onPostCommitFiberRoot=="function")try{Je.onPostCommitFiberRoot(Ze,L)}catch{}return!0}finally{j.p=M,k.T=_,Wl(l,f)}}function WL(l,f,g){f=Vr(g,f),f=Hv(l.stateNode,f,2),l=Fl(l,f,2),l!==null&&(Ut(l,2),Yc(l))}function Ii(l,f,g){if(l.tag===3)WL(l,l,g);else for(;f!==null;){if(f.tag===3){WL(f,l,g);break}else if(f.tag===1){var _=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(al===null||!al.has(_))){l=Vr(g,l),g=Hf(2),_=Fl(f,g,2),_!==null&&(qr(g,_,f,l),Ut(_,2),Yc(_));break}}f=f.return}}function GT(l,f,g){var _=l.pingCache;if(_===null){_=l.pingCache=new Xm;var M=new Set;_.set(f,M)}else M=_.get(f),M===void 0&&(M=new Set,_.set(f,M));M.has(g)||(Li=!0,M.add(g),l=d4.bind(null,l,f,g),f.then(l,l))}function d4(l,f,g){var _=l.pingCache;_!==null&&_.delete(f),l.pingedLanes|=l.suspendedLanes&g,l.warmLanes&=~g,Si===l&&(qn&g)===g&&(Ai===4||Ai===3&&(qn&62914560)===qn&&300>q()-ql?(ii&2)===0&&Le(l,0):Eo|=g,ba===qn&&(ba=0)),Yc(l)}function JL(l,f){f===0&&(f=En()),l=Mc(l,f),l!==null&&(Ut(l,f),Yc(l))}function p4(l){var f=l.memoizedState,g=0;f!==null&&(g=f.retryLane),JL(l,g)}function m4(l,f){var g=0;switch(l.tag){case 31:case 13:var _=l.stateNode,M=l.memoizedState;M!==null&&(g=M.retryLane);break;case 19:_=l.stateNode;break;case 22:_=l.stateNode._retryCache;break;default:throw Error(n(314))}_!==null&&_.delete(f),JL(l,g)}function g4(l,f){return _t(l,f)}var iS=null,jm=null,HT=!1,sS=!1,zT=!1,Jf=0;function Yc(l){l!==jm&&l.next===null&&(jm===null?iS=jm=l:jm=jm.next=l),sS=!0,HT||(HT=!0,y4())}function Xv(l,f){if(!zT&&sS){zT=!0;do for(var g=!1,_=iS;_!==null;){if(l!==0){var M=_.pendingLanes;if(M===0)var L=0;else{var G=_.suspendedLanes,Q=_.pingedLanes;L=(1<<31-he(42|l)+1)-1,L&=M&~(G&~Q),L=L&201326741?L&201326741|1:L?L|2:0}L!==0&&(g=!0,ew(_,L))}else L=qn,L=Qe(_,_===Si?L:0,_.cancelPendingCommit!==null||_.timeoutHandle!==-1),(L&3)===0||Rt(_,L)||(g=!0,ew(_,L));_=_.next}while(g);zT=!1}}function v4(){$L()}function $L(){sS=HT=!1;var l=0;Jf!==0&&R4()&&(l=Jf);for(var f=q(),g=null,_=iS;_!==null;){var M=_.next,L=QL(_,f);L===0?(_.next=null,g===null?iS=M:g.next=M,M===null&&(jm=g)):(g=_,(l!==0||(L&3)!==0)&&(sS=!0)),_=M}Qi!==0&&Qi!==5||Xv(l),Jf!==0&&(Jf=0)}function QL(l,f){for(var g=l.suspendedLanes,_=l.pingedLanes,M=l.expirationTimes,L=l.pendingLanes&-62914561;0<L;){var G=31-he(L),Q=1<<G,ve=M[G];ve===-1?((Q&g)===0||(Q&_)!==0)&&(M[G]=Vt(Q,f)):ve<=f&&(l.expiredLanes|=Q),L&=~Q}if(f=Si,g=qn,g=Qe(l,l===f?g:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),_=l.callbackNode,g===0||l===f&&(un===2||un===9)||l.cancelPendingCommit!==null)return _!==null&&_!==null&&it(_),l.callbackNode=null,l.callbackPriority=0;if((g&3)===0||Rt(l,g)){if(f=g&-g,f===l.callbackPriority)return f;switch(_!==null&&it(_),ai(g)){case 2:case 8:g=Ve;break;case 32:g=Pe;break;case 268435456:g=bt;break;default:g=Pe}return _=ZL.bind(null,l),g=_t(g,_),l.callbackPriority=f,l.callbackNode=g,f}return _!==null&&_!==null&&it(_),l.callbackPriority=2,l.callbackNode=null,2}function ZL(l,f){if(Qi!==0&&Qi!==5)return l.callbackNode=null,l.callbackPriority=0,null;var g=l.callbackNode;if(qm()&&l.callbackNode!==g)return null;var _=qn;return _=Qe(l,l===Si?_:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),_===0?null:(A(l,_,f),QL(l,q()),l.callbackNode!=null&&l.callbackNode===g?ZL.bind(null,l):null)}function ew(l,f){if(qm())return null;A(l,f,!0)}function y4(){L4(function(){(ii&6)!==0?_t(Ge,v4):$L()})}function VT(){if(Jf===0){var l=Ul;l===0&&(l=Re,Re<<=1,(Re&261888)===0&&(Re=256)),Jf=l}return Jf}function tw(l){return l==null||typeof l=="symbol"||typeof l=="boolean"?null:typeof l=="function"?l:Kh(""+l)}function nw(l,f){var g=f.ownerDocument.createElement("input");return g.name=f.name,g.value=f.value,l.id&&g.setAttribute("form",l.id),f.parentNode.insertBefore(g,f),l=new FormData(l),g.parentNode.removeChild(g),l}function x4(l,f,g,_,M){if(f==="submit"&&g&&g.stateNode===M){var L=tw((M[V]||null).action),G=_.submitter;G&&(f=(f=G[V]||null)?tw(f.formAction):G.getAttribute("formAction"),f!==null&&(L=f,G=null));var Q=new Jh("action","action",null,_,M);l.push({event:Q,listeners:[{instance:null,listener:function(){if(_.defaultPrevented){if(Jf!==0){var ve=G?nw(M,G):new FormData(M);Nv(g,{pending:!0,data:ve,method:M.method,action:L},null,ve)}}else typeof L=="function"&&(Q.preventDefault(),ve=G?nw(M,G):new FormData(M),Nv(g,{pending:!0,data:ve,method:M.method,action:L},L,ve))},currentTarget:M}]})}}for(var YT=0;YT<fm.length;YT++){var XT=fm[YT],_4=XT.toLowerCase(),S4=XT[0].toUpperCase()+XT.slice(1);fr(_4,"on"+S4)}fr(zr,"onAnimationEnd"),fr($g,"onAnimationIteration"),fr(Ko,"onAnimationStart"),fr("dblclick","onDoubleClick"),fr("focusin","onFocus"),fr("focusout","onBlur"),fr(Df,"onTransitionRun"),fr(Ec,"onTransitionStart"),fr(Qg,"onTransitionCancel"),fr(um,"onTransitionEnd"),pt("onMouseEnter",["mouseout","mouseover"]),pt("onMouseLeave",["mouseout","mouseover"]),pt("onPointerEnter",["pointerout","pointerover"]),pt("onPointerLeave",["pointerout","pointerover"]),et("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),et("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),et("onBeforeInput",["compositionend","keypress","textInput","paste"]),et("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),et("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),et("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Kv="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),A4=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Kv));function iw(l,f){f=(f&4)!==0;for(var g=0;g<l.length;g++){var _=l[g],M=_.event;_=_.listeners;e:{var L=void 0;if(f)for(var G=_.length-1;0<=G;G--){var Q=_[G],ve=Q.instance,Ue=Q.currentTarget;if(Q=Q.listener,ve!==L&&M.isPropagationStopped())break e;L=Q,M.currentTarget=Ue;try{L(M)}catch(nt){bc(nt)}M.currentTarget=null,L=ve}else for(G=0;G<_.length;G++){if(Q=_[G],ve=Q.instance,Ue=Q.currentTarget,Q=Q.listener,ve!==L&&M.isPropagationStopped())break e;L=Q,M.currentTarget=Ue;try{L(M)}catch(nt){bc(nt)}M.currentTarget=null,L=ve}}}}function Zn(l,f){var g=f[me];g===void 0&&(g=f[me]=new Set);var _=l+"__bubble";g.has(_)||(sw(f,l,2,!1),g.add(_))}function KT(l,f,g){var _=0;f&&(_|=4),sw(g,l,_,f)}var rS="_reactListening"+Math.random().toString(36).slice(2);function qT(l){if(!l[rS]){l[rS]=!0,de.forEach(function(g){g!=="selectionchange"&&(A4.has(g)||KT(g,!1,l),KT(g,!0,l))});var f=l.nodeType===9?l:l.ownerDocument;f===null||f[rS]||(f[rS]=!0,KT("selectionchange",!1,f))}}function sw(l,f,g,_){switch(Bw(f)){case 2:var M=J4;break;case 8:M=$4;break;default:M=l1}g=M.bind(null,f,g,l),M=void 0,!Jp||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(M=!0),_?M!==void 0?l.addEventListener(f,g,{capture:!0,passive:M}):l.addEventListener(f,g,!0):M!==void 0?l.addEventListener(f,g,{passive:M}):l.addEventListener(f,g,!1)}function jT(l,f,g,_,M){var L=_;if((f&1)===0&&(f&2)===0&&_!==null)e:for(;;){if(_===null)return;var G=_.tag;if(G===3||G===4){var Q=_.stateNode.containerInfo;if(Q===M)break;if(G===4)for(G=_.return;G!==null;){var ve=G.tag;if((ve===3||ve===4)&&G.stateNode.containerInfo===M)return;G=G.return}for(;Q!==null;){if(G=ct(Q),G===null)return;if(ve=G.tag,ve===5||ve===6||ve===26||ve===27){_=L=G;continue e}Q=Q.parentNode}}_=_.return}Bg(function(){var Ue=L,nt=jp(g),mt=[];e:{var He=Ll.get(l);if(He!==void 0){var We=Jh,Zt=l;switch(l){case"keypress":if(mu(g)===0)break e;case"keydown":case"keyup":We=Gg;break;case"focusin":Zt="focus",We=tm;break;case"focusout":Zt="blur",We=tm;break;case"beforeblur":case"afterblur":We=tm;break;case"click":if(g.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":We=s_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":We=r_;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":We=Rl;break;case zr:case $g:case Ko:We=l_;break;case um:We=IT;break;case"scroll":case"scrollend":We=Zp;break;case"wheel":We=vc;break;case"copy":case"cut":case"paste":We=Pg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":We=nm;break;case"toggle":case"beforetoggle":We=zg}var xn=(f&4)!==0,ki=!xn&&(l==="scroll"||l==="scrollend"),Me=xn?He!==null?He+"Capture":null:He;xn=[];for(var Ae=Ue,Ne;Ae!==null;){var ft=Ae;if(Ne=ft.stateNode,ft=ft.tag,ft!==5&&ft!==26&&ft!==27||Ne===null||Me===null||(ft=pu(Ae,Me),ft!=null&&xn.push(qv(Ae,ft,Ne))),ki)break;Ae=Ae.return}0<xn.length&&(He=new We(He,Zt,null,g,nt),mt.push({event:He,listeners:xn}))}}if((f&7)===0){e:{if(He=l==="mouseover"||l==="pointerover",We=l==="mouseout"||l==="pointerout",He&&g!==qh&&(Zt=g.relatedTarget||g.fromElement)&&(ct(Zt)||Zt[$]))break e;if((We||He)&&(He=nt.window===nt?nt:(He=nt.ownerDocument)?He.defaultView||He.parentWindow:window,We?(Zt=g.relatedTarget||g.toElement,We=Ue,Zt=Zt?ct(Zt):null,Zt!==null&&(ki=s(Zt),xn=Zt.tag,Zt!==ki||xn!==5&&xn!==27&&xn!==6)&&(Zt=null)):(We=null,Zt=Ue),We!==Zt)){if(xn=s_,ft="onMouseLeave",Me="onMouseEnter",Ae="mouse",(l==="pointerout"||l==="pointerover")&&(xn=nm,ft="onPointerLeave",Me="onPointerEnter",Ae="pointer"),ki=We==null?He:ce(We),Ne=Zt==null?He:ce(Zt),He=new xn(ft,Ae+"leave",We,g,nt),He.target=ki,He.relatedTarget=Ne,ft=null,ct(nt)===Ue&&(xn=new xn(Me,Ae+"enter",Zt,g,nt),xn.target=Ne,xn.relatedTarget=ki,ft=xn),ki=ft,We&&Zt)t:{for(xn=E4,Me=We,Ae=Zt,Ne=0,ft=Me;ft;ft=xn(ft))Ne++;ft=0;for(var mn=Ae;mn;mn=xn(mn))ft++;for(;0<Ne-ft;)Me=xn(Me),Ne--;for(;0<ft-Ne;)Ae=xn(Ae),ft--;for(;Ne--;){if(Me===Ae||Ae!==null&&Me===Ae.alternate){xn=Me;break t}Me=xn(Me),Ae=xn(Ae)}xn=null}else xn=null;We!==null&&rw(mt,He,We,xn,!1),Zt!==null&&ki!==null&&rw(mt,ki,Zt,xn,!0)}}e:{if(He=Ue?ce(Ue):window,We=He.nodeName&&He.nodeName.toLowerCase(),We==="select"||We==="input"&&He.type==="file")var Ei=qg;else if(Xg(He))if(nd)Ei=x_;else{Ei=_c;var an=id}else We=He.nodeName,!We||We.toLowerCase()!=="input"||He.type!=="checkbox"&&He.type!=="radio"?Ue&&Xh(Ue.elementType)&&(Ei=qg):Ei=y_;if(Ei&&(Ei=Ei(l,Ue))){rm(mt,Ei,g,nt);break e}an&&an(l,He,Ue),l==="focusout"&&Ue&&He.type==="number"&&Ue.memoizedProps.value!=null&&oi(He,"number",He.value)}switch(an=Ue?ce(Ue):window,l){case"focusin":(Xg(an)||an.contentEditable==="true")&&(Mf=an,lm=Ue,Cf=null);break;case"focusout":Cf=lm=Mf=null;break;case"mousedown":fa=!0;break;case"contextmenu":case"mouseup":case"dragend":fa=!1,cm(mt,g,nt);break;case"selectionchange":if(__)break;case"keydown":case"keyup":cm(mt,g,nt)}var kn;if(gu)e:{switch(l){case"compositionstart":var ri="onCompositionStart";break e;case"compositionend":ri="onCompositionEnd";break e;case"compositionupdate":ri="onCompositionUpdate";break e}ri=void 0}else xc?im(l,g)&&(ri="onCompositionEnd"):l==="keydown"&&g.keyCode===229&&(ri="onCompositionStart");ri&&(js&&g.locale!=="ko"&&(xc||ri!=="onCompositionStart"?ri==="onCompositionEnd"&&xc&&(kn=Qp()):(pc=nt,$p="value"in pc?pc.value:pc.textContent,xc=!0)),an=aS(Ue,ri),0<an.length&&(ri=new Ng(ri,l,null,g,nt),mt.push({event:ri,listeners:an}),kn?ri.data=kn:(kn=_f(g),kn!==null&&(ri.data=kn)))),(kn=vu?sm(l,g):m_(l,g))&&(ri=aS(Ue,"onBeforeInput"),0<ri.length&&(an=new Ng("onBeforeInput","beforeinput",null,g,nt),mt.push({event:an,listeners:ri}),an.data=kn)),x4(mt,l,Ue,g,nt)}iw(mt,f)})}function qv(l,f,g){return{instance:l,listener:f,currentTarget:g}}function aS(l,f){for(var g=f+"Capture",_=[];l!==null;){var M=l,L=M.stateNode;if(M=M.tag,M!==5&&M!==26&&M!==27||L===null||(M=pu(l,g),M!=null&&_.unshift(qv(l,M,L)),M=pu(l,f),M!=null&&_.push(qv(l,M,L))),l.tag===3)return _;l=l.return}return[]}function E4(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5&&l.tag!==27);return l||null}function rw(l,f,g,_,M){for(var L=f._reactName,G=[];g!==null&&g!==_;){var Q=g,ve=Q.alternate,Ue=Q.stateNode;if(Q=Q.tag,ve!==null&&ve===_)break;Q!==5&&Q!==26&&Q!==27||Ue===null||(ve=Ue,M?(Ue=pu(g,L),Ue!=null&&G.unshift(qv(g,Ue,ve))):M||(Ue=pu(g,L),Ue!=null&&G.push(qv(g,Ue,ve)))),g=g.return}G.length!==0&&l.push({event:f,listeners:G})}var b4=/\r\n?/g,T4=/\u0000|\uFFFD/g;function aw(l){return(typeof l=="string"?l:""+l).replace(b4,`
`).replace(T4,"")}function ow(l,f){return f=aw(f),aw(l)===f}function Fi(l,f,g,_,M,L){switch(g){case"children":typeof _=="string"?f==="body"||f==="textarea"&&_===""||po(l,_):(typeof _=="number"||typeof _=="bigint")&&f!=="body"&&po(l,""+_);break;case"className":bn(l,"class",_);break;case"tabIndex":bn(l,"tabindex",_);break;case"dir":case"role":case"viewBox":case"width":case"height":bn(l,g,_);break;case"style":wg(l,_,L);break;case"data":if(f!=="object"){bn(l,"data",_);break}case"src":case"href":if(_===""&&(f!=="a"||g!=="href")){l.removeAttribute(g);break}if(_==null||typeof _=="function"||typeof _=="symbol"||typeof _=="boolean"){l.removeAttribute(g);break}_=Kh(""+_),l.setAttribute(g,_);break;case"action":case"formAction":if(typeof _=="function"){l.setAttribute(g,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof L=="function"&&(g==="formAction"?(f!=="input"&&Fi(l,f,"name",M.name,M,null),Fi(l,f,"formEncType",M.formEncType,M,null),Fi(l,f,"formMethod",M.formMethod,M,null),Fi(l,f,"formTarget",M.formTarget,M,null)):(Fi(l,f,"encType",M.encType,M,null),Fi(l,f,"method",M.method,M,null),Fi(l,f,"target",M.target,M,null)));if(_==null||typeof _=="symbol"||typeof _=="boolean"){l.removeAttribute(g);break}_=Kh(""+_),l.setAttribute(g,_);break;case"onClick":_!=null&&(l.onclick=Yo);break;case"onScroll":_!=null&&Zn("scroll",l);break;case"onScrollEnd":_!=null&&Zn("scrollend",l);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(n(61));if(g=_.__html,g!=null){if(M.children!=null)throw Error(n(60));l.innerHTML=g}}break;case"multiple":l.multiple=_&&typeof _!="function"&&typeof _!="symbol";break;case"muted":l.muted=_&&typeof _!="function"&&typeof _!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(_==null||typeof _=="function"||typeof _=="boolean"||typeof _=="symbol"){l.removeAttribute("xlink:href");break}g=Kh(""+_),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",g);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":_!=null&&typeof _!="function"&&typeof _!="symbol"?l.setAttribute(g,""+_):l.removeAttribute(g);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":_&&typeof _!="function"&&typeof _!="symbol"?l.setAttribute(g,""):l.removeAttribute(g);break;case"capture":case"download":_===!0?l.setAttribute(g,""):_!==!1&&_!=null&&typeof _!="function"&&typeof _!="symbol"?l.setAttribute(g,_):l.removeAttribute(g);break;case"cols":case"rows":case"size":case"span":_!=null&&typeof _!="function"&&typeof _!="symbol"&&!isNaN(_)&&1<=_?l.setAttribute(g,_):l.removeAttribute(g);break;case"rowSpan":case"start":_==null||typeof _=="function"||typeof _=="symbol"||isNaN(_)?l.removeAttribute(g):l.setAttribute(g,_);break;case"popover":Zn("beforetoggle",l),Zn("toggle",l),Kt(l,"popover",_);break;case"xlinkActuate":nn(l,"http://www.w3.org/1999/xlink","xlink:actuate",_);break;case"xlinkArcrole":nn(l,"http://www.w3.org/1999/xlink","xlink:arcrole",_);break;case"xlinkRole":nn(l,"http://www.w3.org/1999/xlink","xlink:role",_);break;case"xlinkShow":nn(l,"http://www.w3.org/1999/xlink","xlink:show",_);break;case"xlinkTitle":nn(l,"http://www.w3.org/1999/xlink","xlink:title",_);break;case"xlinkType":nn(l,"http://www.w3.org/1999/xlink","xlink:type",_);break;case"xmlBase":nn(l,"http://www.w3.org/XML/1998/namespace","xml:base",_);break;case"xmlLang":nn(l,"http://www.w3.org/XML/1998/namespace","xml:lang",_);break;case"xmlSpace":nn(l,"http://www.w3.org/XML/1998/namespace","xml:space",_);break;case"is":Kt(l,"is",_);break;case"innerText":case"textContent":break;default:(!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(g=n_.get(g)||g,Kt(l,g,_))}}function WT(l,f,g,_,M,L){switch(g){case"style":wg(l,_,L);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(n(61));if(g=_.__html,g!=null){if(M.children!=null)throw Error(n(60));l.innerHTML=g}}break;case"children":typeof _=="string"?po(l,_):(typeof _=="number"||typeof _=="bigint")&&po(l,""+_);break;case"onScroll":_!=null&&Zn("scroll",l);break;case"onScrollEnd":_!=null&&Zn("scrollend",l);break;case"onClick":_!=null&&(l.onclick=Yo);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ke.hasOwnProperty(g))e:{if(g[0]==="o"&&g[1]==="n"&&(M=g.endsWith("Capture"),f=g.slice(2,M?g.length-7:void 0),L=l[V]||null,L=L!=null?L[g]:null,typeof L=="function"&&l.removeEventListener(f,L,M),typeof _=="function")){typeof L!="function"&&L!==null&&(g in l?l[g]=null:l.hasAttribute(g)&&l.removeAttribute(g)),l.addEventListener(f,_,M);break e}g in l?l[g]=_:_===!0?l.setAttribute(g,""):Kt(l,g,_)}}}function Pr(l,f,g){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Zn("error",l),Zn("load",l);var _=!1,M=!1,L;for(L in g)if(g.hasOwnProperty(L)){var G=g[L];if(G!=null)switch(L){case"src":_=!0;break;case"srcSet":M=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,f));default:Fi(l,f,L,G,g,null)}}M&&Fi(l,f,"srcSet",g.srcSet,g,null),_&&Fi(l,f,"src",g.src,g,null);return;case"input":Zn("invalid",l);var Q=L=G=M=null,ve=null,Ue=null;for(_ in g)if(g.hasOwnProperty(_)){var nt=g[_];if(nt!=null)switch(_){case"name":M=nt;break;case"type":G=nt;break;case"checked":ve=nt;break;case"defaultChecked":Ue=nt;break;case"value":L=nt;break;case"defaultValue":Q=nt;break;case"children":case"dangerouslySetInnerHTML":if(nt!=null)throw Error(n(137,f));break;default:Fi(l,f,_,nt,g,null)}}$n(l,L,Q,ve,Ue,G,M,!1);return;case"select":Zn("invalid",l),_=G=L=null;for(M in g)if(g.hasOwnProperty(M)&&(Q=g[M],Q!=null))switch(M){case"value":L=Q;break;case"defaultValue":G=Q;break;case"multiple":_=Q;default:Fi(l,f,M,Q,g,null)}f=L,g=G,l.multiple=!!_,f!=null?Ri(l,!!_,f,!1):g!=null&&Ri(l,!!_,g,!0);return;case"textarea":Zn("invalid",l),L=M=_=null;for(G in g)if(g.hasOwnProperty(G)&&(Q=g[G],Q!=null))switch(G){case"value":_=Q;break;case"defaultValue":M=Q;break;case"children":L=Q;break;case"dangerouslySetInnerHTML":if(Q!=null)throw Error(n(91));break;default:Fi(l,f,G,Q,g,null)}es(l,_,M,L);return;case"option":for(ve in g)if(g.hasOwnProperty(ve)&&(_=g[ve],_!=null))switch(ve){case"selected":l.selected=_&&typeof _!="function"&&typeof _!="symbol";break;default:Fi(l,f,ve,_,g,null)}return;case"dialog":Zn("beforetoggle",l),Zn("toggle",l),Zn("cancel",l),Zn("close",l);break;case"iframe":case"object":Zn("load",l);break;case"video":case"audio":for(_=0;_<Kv.length;_++)Zn(Kv[_],l);break;case"image":Zn("error",l),Zn("load",l);break;case"details":Zn("toggle",l);break;case"embed":case"source":case"link":Zn("error",l),Zn("load",l);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ue in g)if(g.hasOwnProperty(Ue)&&(_=g[Ue],_!=null))switch(Ue){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,f));default:Fi(l,f,Ue,_,g,null)}return;default:if(Xh(f)){for(nt in g)g.hasOwnProperty(nt)&&(_=g[nt],_!==void 0&&WT(l,f,nt,_,g,void 0));return}}for(Q in g)g.hasOwnProperty(Q)&&(_=g[Q],_!=null&&Fi(l,f,Q,_,g,null))}function M4(l,f,g,_){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var M=null,L=null,G=null,Q=null,ve=null,Ue=null,nt=null;for(We in g){var mt=g[We];if(g.hasOwnProperty(We)&&mt!=null)switch(We){case"checked":break;case"value":break;case"defaultValue":ve=mt;default:_.hasOwnProperty(We)||Fi(l,f,We,null,_,mt)}}for(var He in _){var We=_[He];if(mt=g[He],_.hasOwnProperty(He)&&(We!=null||mt!=null))switch(He){case"type":L=We;break;case"name":M=We;break;case"checked":Ue=We;break;case"defaultChecked":nt=We;break;case"value":G=We;break;case"defaultValue":Q=We;break;case"children":case"dangerouslySetInnerHTML":if(We!=null)throw Error(n(137,f));break;default:We!==mt&&Fi(l,f,He,We,_,mt)}}Ji(l,G,Q,ve,Ue,nt,L,M);return;case"select":We=G=Q=He=null;for(L in g)if(ve=g[L],g.hasOwnProperty(L)&&ve!=null)switch(L){case"value":break;case"multiple":We=ve;default:_.hasOwnProperty(L)||Fi(l,f,L,null,_,ve)}for(M in _)if(L=_[M],ve=g[M],_.hasOwnProperty(M)&&(L!=null||ve!=null))switch(M){case"value":He=L;break;case"defaultValue":Q=L;break;case"multiple":G=L;default:L!==ve&&Fi(l,f,M,L,_,ve)}f=Q,g=G,_=We,He!=null?Ri(l,!!g,He,!1):!!_!=!!g&&(f!=null?Ri(l,!!g,f,!0):Ri(l,!!g,g?[]:"",!1));return;case"textarea":We=He=null;for(Q in g)if(M=g[Q],g.hasOwnProperty(Q)&&M!=null&&!_.hasOwnProperty(Q))switch(Q){case"value":break;case"children":break;default:Fi(l,f,Q,null,_,M)}for(G in _)if(M=_[G],L=g[G],_.hasOwnProperty(G)&&(M!=null||L!=null))switch(G){case"value":He=M;break;case"defaultValue":We=M;break;case"children":break;case"dangerouslySetInnerHTML":if(M!=null)throw Error(n(91));break;default:M!==L&&Fi(l,f,G,M,_,L)}Ds(l,He,We);return;case"option":for(var Zt in g)if(He=g[Zt],g.hasOwnProperty(Zt)&&He!=null&&!_.hasOwnProperty(Zt))switch(Zt){case"selected":l.selected=!1;break;default:Fi(l,f,Zt,null,_,He)}for(ve in _)if(He=_[ve],We=g[ve],_.hasOwnProperty(ve)&&He!==We&&(He!=null||We!=null))switch(ve){case"selected":l.selected=He&&typeof He!="function"&&typeof He!="symbol";break;default:Fi(l,f,ve,He,_,We)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var xn in g)He=g[xn],g.hasOwnProperty(xn)&&He!=null&&!_.hasOwnProperty(xn)&&Fi(l,f,xn,null,_,He);for(Ue in _)if(He=_[Ue],We=g[Ue],_.hasOwnProperty(Ue)&&He!==We&&(He!=null||We!=null))switch(Ue){case"children":case"dangerouslySetInnerHTML":if(He!=null)throw Error(n(137,f));break;default:Fi(l,f,Ue,He,_,We)}return;default:if(Xh(f)){for(var ki in g)He=g[ki],g.hasOwnProperty(ki)&&He!==void 0&&!_.hasOwnProperty(ki)&&WT(l,f,ki,void 0,_,He);for(nt in _)He=_[nt],We=g[nt],!_.hasOwnProperty(nt)||He===We||He===void 0&&We===void 0||WT(l,f,nt,He,_,We);return}}for(var Me in g)He=g[Me],g.hasOwnProperty(Me)&&He!=null&&!_.hasOwnProperty(Me)&&Fi(l,f,Me,null,_,He);for(mt in _)He=_[mt],We=g[mt],!_.hasOwnProperty(mt)||He===We||He==null&&We==null||Fi(l,f,mt,He,_,We)}function lw(l){switch(l){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function C4(){if(typeof performance.getEntriesByType=="function"){for(var l=0,f=0,g=performance.getEntriesByType("resource"),_=0;_<g.length;_++){var M=g[_],L=M.transferSize,G=M.initiatorType,Q=M.duration;if(L&&Q&&lw(G)){for(G=0,Q=M.responseEnd,_+=1;_<g.length;_++){var ve=g[_],Ue=ve.startTime;if(Ue>Q)break;var nt=ve.transferSize,mt=ve.initiatorType;nt&&lw(mt)&&(ve=ve.responseEnd,G+=nt*(ve<Q?1:(Q-Ue)/(ve-Ue)))}if(--_,f+=8*(L+G)/(M.duration/1e3),l++,10<l)break}}if(0<l)return f/l/1e6}return navigator.connection&&(l=navigator.connection.downlink,typeof l=="number")?l:5}var JT=null,$T=null;function oS(l){return l.nodeType===9?l:l.ownerDocument}function cw(l){switch(l){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function uw(l,f){if(l===0)switch(f){case"svg":return 1;case"math":return 2;default:return 0}return l===1&&f==="foreignObject"?0:l}function QT(l,f){return l==="textarea"||l==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.children=="bigint"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var ZT=null;function R4(){var l=window.event;return l&&l.type==="popstate"?l===ZT?!1:(ZT=l,!0):(ZT=null,!1)}var fw=typeof setTimeout=="function"?setTimeout:void 0,D4=typeof clearTimeout=="function"?clearTimeout:void 0,hw=typeof Promise=="function"?Promise:void 0,L4=typeof queueMicrotask=="function"?queueMicrotask:typeof hw<"u"?function(l){return hw.resolve(null).then(l).catch(w4)}:fw;function w4(l){setTimeout(function(){throw l})}function $f(l){return l==="head"}function dw(l,f){var g=f,_=0;do{var M=g.nextSibling;if(l.removeChild(g),M&&M.nodeType===8)if(g=M.data,g==="/$"||g==="/&"){if(_===0){l.removeChild(M),Qm(f);return}_--}else if(g==="$"||g==="$?"||g==="$~"||g==="$!"||g==="&")_++;else if(g==="html")jv(l.ownerDocument.documentElement);else if(g==="head"){g=l.ownerDocument.head,jv(g);for(var L=g.firstChild;L;){var G=L.nextSibling,Q=L.nodeName;L[dt]||Q==="SCRIPT"||Q==="STYLE"||Q==="LINK"&&L.rel.toLowerCase()==="stylesheet"||g.removeChild(L),L=G}}else g==="body"&&jv(l.ownerDocument.body);g=M}while(g);Qm(f)}function pw(l,f){var g=l;l=0;do{var _=g.nextSibling;if(g.nodeType===1?f?(g._stashedDisplay=g.style.display,g.style.display="none"):(g.style.display=g._stashedDisplay||"",g.getAttribute("style")===""&&g.removeAttribute("style")):g.nodeType===3&&(f?(g._stashedText=g.nodeValue,g.nodeValue=""):g.nodeValue=g._stashedText||""),_&&_.nodeType===8)if(g=_.data,g==="/$"){if(l===0)break;l--}else g!=="$"&&g!=="$?"&&g!=="$~"&&g!=="$!"||l++;g=_}while(g)}function e1(l){var f=l.firstChild;for(f&&f.nodeType===10&&(f=f.nextSibling);f;){var g=f;switch(f=f.nextSibling,g.nodeName){case"HTML":case"HEAD":case"BODY":e1(g),rt(g);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(g.rel.toLowerCase()==="stylesheet")continue}l.removeChild(g)}}function I4(l,f,g,_){for(;l.nodeType===1;){var M=g;if(l.nodeName.toLowerCase()!==f.toLowerCase()){if(!_&&(l.nodeName!=="INPUT"||l.type!=="hidden"))break}else if(_){if(!l[dt])switch(f){case"meta":if(!l.hasAttribute("itemprop"))break;return l;case"link":if(L=l.getAttribute("rel"),L==="stylesheet"&&l.hasAttribute("data-precedence"))break;if(L!==M.rel||l.getAttribute("href")!==(M.href==null||M.href===""?null:M.href)||l.getAttribute("crossorigin")!==(M.crossOrigin==null?null:M.crossOrigin)||l.getAttribute("title")!==(M.title==null?null:M.title))break;return l;case"style":if(l.hasAttribute("data-precedence"))break;return l;case"script":if(L=l.getAttribute("src"),(L!==(M.src==null?null:M.src)||l.getAttribute("type")!==(M.type==null?null:M.type)||l.getAttribute("crossorigin")!==(M.crossOrigin==null?null:M.crossOrigin))&&L&&l.hasAttribute("async")&&!l.hasAttribute("itemprop"))break;return l;default:return l}}else if(f==="input"&&l.type==="hidden"){var L=M.name==null?null:""+M.name;if(M.type==="hidden"&&l.getAttribute("name")===L)return l}else return l;if(l=ol(l.nextSibling),l===null)break}return null}function B4(l,f,g){if(f==="")return null;for(;l.nodeType!==3;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!g||(l=ol(l.nextSibling),l===null))return null;return l}function mw(l,f){for(;l.nodeType!==8;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!f||(l=ol(l.nextSibling),l===null))return null;return l}function t1(l){return l.data==="$?"||l.data==="$~"}function n1(l){return l.data==="$!"||l.data==="$?"&&l.ownerDocument.readyState!=="loading"}function O4(l,f){var g=l.ownerDocument;if(l.data==="$~")l._reactRetry=f;else if(l.data!=="$?"||g.readyState!=="loading")f();else{var _=function(){f(),g.removeEventListener("DOMContentLoaded",_)};g.addEventListener("DOMContentLoaded",_),l._reactRetry=_}}function ol(l){for(;l!=null;l=l.nextSibling){var f=l.nodeType;if(f===1||f===3)break;if(f===8){if(f=l.data,f==="$"||f==="$!"||f==="$?"||f==="$~"||f==="&"||f==="F!"||f==="F")break;if(f==="/$"||f==="/&")return null}}return l}var i1=null;function gw(l){l=l.nextSibling;for(var f=0;l;){if(l.nodeType===8){var g=l.data;if(g==="/$"||g==="/&"){if(f===0)return ol(l.nextSibling);f--}else g!=="$"&&g!=="$!"&&g!=="$?"&&g!=="$~"&&g!=="&"||f++}l=l.nextSibling}return null}function vw(l){l=l.previousSibling;for(var f=0;l;){if(l.nodeType===8){var g=l.data;if(g==="$"||g==="$!"||g==="$?"||g==="$~"||g==="&"){if(f===0)return l;f--}else g!=="/$"&&g!=="/&"||f++}l=l.previousSibling}return null}function yw(l,f,g){switch(f=oS(g),l){case"html":if(l=f.documentElement,!l)throw Error(n(452));return l;case"head":if(l=f.head,!l)throw Error(n(453));return l;case"body":if(l=f.body,!l)throw Error(n(454));return l;default:throw Error(n(451))}}function jv(l){for(var f=l.attributes;f.length;)l.removeAttributeNode(f[0]);rt(l)}var ll=new Map,xw=new Set;function lS(l){return typeof l.getRootNode=="function"?l.getRootNode():l.nodeType===9?l:l.ownerDocument}var Gu=j.d;j.d={f:P4,r:N4,D:U4,C:F4,L:k4,m:G4,X:z4,S:H4,M:V4};function P4(){var l=Gu.f(),f=ee();return l||f}function N4(l){var f=Y(l);f!==null&&f.tag===5&&f.type==="form"?Uv(f):Gu.r(l)}var Wm=typeof document>"u"?null:document;function _w(l,f,g){var _=Wm;if(_&&typeof f=="string"&&f){var M=ln(f);M='link[rel="'+l+'"][href="'+M+'"]',typeof g=="string"&&(M+='[crossorigin="'+g+'"]'),xw.has(M)||(xw.add(M),l={rel:l,crossOrigin:g,href:f},_.querySelector(M)===null&&(f=_.createElement("link"),Pr(f,"link",l),Se(f),_.head.appendChild(f)))}}function U4(l){Gu.D(l),_w("dns-prefetch",l,null)}function F4(l,f){Gu.C(l,f),_w("preconnect",l,f)}function k4(l,f,g){Gu.L(l,f,g);var _=Wm;if(_&&l&&f){var M='link[rel="preload"][as="'+ln(f)+'"]';f==="image"&&g&&g.imageSrcSet?(M+='[imagesrcset="'+ln(g.imageSrcSet)+'"]',typeof g.imageSizes=="string"&&(M+='[imagesizes="'+ln(g.imageSizes)+'"]')):M+='[href="'+ln(l)+'"]';var L=M;switch(f){case"style":L=Jm(l);break;case"script":L=$m(l)}ll.has(L)||(l=p({rel:"preload",href:f==="image"&&g&&g.imageSrcSet?void 0:l,as:f},g),ll.set(L,l),_.querySelector(M)!==null||f==="style"&&_.querySelector(Wv(L))||f==="script"&&_.querySelector(Jv(L))||(f=_.createElement("link"),Pr(f,"link",l),Se(f),_.head.appendChild(f)))}}function G4(l,f){Gu.m(l,f);var g=Wm;if(g&&l){var _=f&&typeof f.as=="string"?f.as:"script",M='link[rel="modulepreload"][as="'+ln(_)+'"][href="'+ln(l)+'"]',L=M;switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":L=$m(l)}if(!ll.has(L)&&(l=p({rel:"modulepreload",href:l},f),ll.set(L,l),g.querySelector(M)===null)){switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(g.querySelector(Jv(L)))return}_=g.createElement("link"),Pr(_,"link",l),Se(_),g.head.appendChild(_)}}}function H4(l,f,g){Gu.S(l,f,g);var _=Wm;if(_&&l){var M=fe(_).hoistableStyles,L=Jm(l);f=f||"default";var G=M.get(L);if(!G){var Q={loading:0,preload:null};if(G=_.querySelector(Wv(L)))Q.loading=5;else{l=p({rel:"stylesheet",href:l,"data-precedence":f},g),(g=ll.get(L))&&s1(l,g);var ve=G=_.createElement("link");Se(ve),Pr(ve,"link",l),ve._p=new Promise(function(Ue,nt){ve.onload=Ue,ve.onerror=nt}),ve.addEventListener("load",function(){Q.loading|=1}),ve.addEventListener("error",function(){Q.loading|=2}),Q.loading|=4,cS(G,f,_)}G={type:"stylesheet",instance:G,count:1,state:Q},M.set(L,G)}}}function z4(l,f){Gu.X(l,f);var g=Wm;if(g&&l){var _=fe(g).hoistableScripts,M=$m(l),L=_.get(M);L||(L=g.querySelector(Jv(M)),L||(l=p({src:l,async:!0},f),(f=ll.get(M))&&r1(l,f),L=g.createElement("script"),Se(L),Pr(L,"link",l),g.head.appendChild(L)),L={type:"script",instance:L,count:1,state:null},_.set(M,L))}}function V4(l,f){Gu.M(l,f);var g=Wm;if(g&&l){var _=fe(g).hoistableScripts,M=$m(l),L=_.get(M);L||(L=g.querySelector(Jv(M)),L||(l=p({src:l,async:!0,type:"module"},f),(f=ll.get(M))&&r1(l,f),L=g.createElement("script"),Se(L),Pr(L,"link",l),g.head.appendChild(L)),L={type:"script",instance:L,count:1,state:null},_.set(M,L))}}function Sw(l,f,g,_){var M=(M=pe.current)?lS(M):null;if(!M)throw Error(n(446));switch(l){case"meta":case"title":return null;case"style":return typeof g.precedence=="string"&&typeof g.href=="string"?(f=Jm(g.href),g=fe(M).hoistableStyles,_=g.get(f),_||(_={type:"style",instance:null,count:0,state:null},g.set(f,_)),_):{type:"void",instance:null,count:0,state:null};case"link":if(g.rel==="stylesheet"&&typeof g.href=="string"&&typeof g.precedence=="string"){l=Jm(g.href);var L=fe(M).hoistableStyles,G=L.get(l);if(G||(M=M.ownerDocument||M,G={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},L.set(l,G),(L=M.querySelector(Wv(l)))&&!L._p&&(G.instance=L,G.state.loading=5),ll.has(l)||(g={rel:"preload",as:"style",href:g.href,crossOrigin:g.crossOrigin,integrity:g.integrity,media:g.media,hrefLang:g.hrefLang,referrerPolicy:g.referrerPolicy},ll.set(l,g),L||Y4(M,l,g,G.state))),f&&_===null)throw Error(n(528,""));return G}if(f&&_!==null)throw Error(n(529,""));return null;case"script":return f=g.async,g=g.src,typeof g=="string"&&f&&typeof f!="function"&&typeof f!="symbol"?(f=$m(g),g=fe(M).hoistableScripts,_=g.get(f),_||(_={type:"script",instance:null,count:0,state:null},g.set(f,_)),_):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,l))}}function Jm(l){return'href="'+ln(l)+'"'}function Wv(l){return'link[rel="stylesheet"]['+l+"]"}function Aw(l){return p({},l,{"data-precedence":l.precedence,precedence:null})}function Y4(l,f,g,_){l.querySelector('link[rel="preload"][as="style"]['+f+"]")?_.loading=1:(f=l.createElement("link"),_.preload=f,f.addEventListener("load",function(){return _.loading|=1}),f.addEventListener("error",function(){return _.loading|=2}),Pr(f,"link",g),Se(f),l.head.appendChild(f))}function $m(l){return'[src="'+ln(l)+'"]'}function Jv(l){return"script[async]"+l}function Ew(l,f,g){if(f.count++,f.instance===null)switch(f.type){case"style":var _=l.querySelector('style[data-href~="'+ln(g.href)+'"]');if(_)return f.instance=_,Se(_),_;var M=p({},g,{"data-href":g.href,"data-precedence":g.precedence,href:null,precedence:null});return _=(l.ownerDocument||l).createElement("style"),Se(_),Pr(_,"style",M),cS(_,g.precedence,l),f.instance=_;case"stylesheet":M=Jm(g.href);var L=l.querySelector(Wv(M));if(L)return f.state.loading|=4,f.instance=L,Se(L),L;_=Aw(g),(M=ll.get(M))&&s1(_,M),L=(l.ownerDocument||l).createElement("link"),Se(L);var G=L;return G._p=new Promise(function(Q,ve){G.onload=Q,G.onerror=ve}),Pr(L,"link",_),f.state.loading|=4,cS(L,g.precedence,l),f.instance=L;case"script":return L=$m(g.src),(M=l.querySelector(Jv(L)))?(f.instance=M,Se(M),M):(_=g,(M=ll.get(L))&&(_=p({},g),r1(_,M)),l=l.ownerDocument||l,M=l.createElement("script"),Se(M),Pr(M,"link",_),l.head.appendChild(M),f.instance=M);case"void":return null;default:throw Error(n(443,f.type))}else f.type==="stylesheet"&&(f.state.loading&4)===0&&(_=f.instance,f.state.loading|=4,cS(_,g.precedence,l));return f.instance}function cS(l,f,g){for(var _=g.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),M=_.length?_[_.length-1]:null,L=M,G=0;G<_.length;G++){var Q=_[G];if(Q.dataset.precedence===f)L=Q;else if(L!==M)break}L?L.parentNode.insertBefore(l,L.nextSibling):(f=g.nodeType===9?g.head:g,f.insertBefore(l,f.firstChild))}function s1(l,f){l.crossOrigin==null&&(l.crossOrigin=f.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=f.referrerPolicy),l.title==null&&(l.title=f.title)}function r1(l,f){l.crossOrigin==null&&(l.crossOrigin=f.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=f.referrerPolicy),l.integrity==null&&(l.integrity=f.integrity)}var uS=null;function bw(l,f,g){if(uS===null){var _=new Map,M=uS=new Map;M.set(g,_)}else M=uS,_=M.get(g),_||(_=new Map,M.set(g,_));if(_.has(l))return _;for(_.set(l,null),g=g.getElementsByTagName(l),M=0;M<g.length;M++){var L=g[M];if(!(L[dt]||L[Jt]||l==="link"&&L.getAttribute("rel")==="stylesheet")&&L.namespaceURI!=="http://www.w3.org/2000/svg"){var G=L.getAttribute(f)||"";G=l+G;var Q=_.get(G);Q?Q.push(L):_.set(G,[L])}}return _}function Tw(l,f,g){l=l.ownerDocument||l,l.head.insertBefore(g,f==="title"?l.querySelector("head > title"):null)}function X4(l,f,g){if(g===1||f.itemProp!=null)return!1;switch(l){case"meta":case"title":return!0;case"style":if(typeof f.precedence!="string"||typeof f.href!="string"||f.href==="")break;return!0;case"link":if(typeof f.rel!="string"||typeof f.href!="string"||f.href===""||f.onLoad||f.onError)break;switch(f.rel){case"stylesheet":return l=f.disabled,typeof f.precedence=="string"&&l==null;default:return!0}case"script":if(f.async&&typeof f.async!="function"&&typeof f.async!="symbol"&&!f.onLoad&&!f.onError&&f.src&&typeof f.src=="string")return!0}return!1}function Mw(l){return!(l.type==="stylesheet"&&(l.state.loading&3)===0)}function K4(l,f,g,_){if(g.type==="stylesheet"&&(typeof _.media!="string"||matchMedia(_.media).matches!==!1)&&(g.state.loading&4)===0){if(g.instance===null){var M=Jm(_.href),L=f.querySelector(Wv(M));if(L){f=L._p,f!==null&&typeof f=="object"&&typeof f.then=="function"&&(l.count++,l=fS.bind(l),f.then(l,l)),g.state.loading|=4,g.instance=L,Se(L);return}L=f.ownerDocument||f,_=Aw(_),(M=ll.get(M))&&s1(_,M),L=L.createElement("link"),Se(L);var G=L;G._p=new Promise(function(Q,ve){G.onload=Q,G.onerror=ve}),Pr(L,"link",_),g.instance=L}l.stylesheets===null&&(l.stylesheets=new Map),l.stylesheets.set(g,f),(f=g.state.preload)&&(g.state.loading&3)===0&&(l.count++,g=fS.bind(l),f.addEventListener("load",g),f.addEventListener("error",g))}}var a1=0;function q4(l,f){return l.stylesheets&&l.count===0&&dS(l,l.stylesheets),0<l.count||0<l.imgCount?function(g){var _=setTimeout(function(){if(l.stylesheets&&dS(l,l.stylesheets),l.unsuspend){var L=l.unsuspend;l.unsuspend=null,L()}},6e4+f);0<l.imgBytes&&a1===0&&(a1=62500*C4());var M=setTimeout(function(){if(l.waitingForImages=!1,l.count===0&&(l.stylesheets&&dS(l,l.stylesheets),l.unsuspend)){var L=l.unsuspend;l.unsuspend=null,L()}},(l.imgBytes>a1?50:800)+f);return l.unsuspend=g,function(){l.unsuspend=null,clearTimeout(_),clearTimeout(M)}}:null}function fS(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)dS(this,this.stylesheets);else if(this.unsuspend){var l=this.unsuspend;this.unsuspend=null,l()}}}var hS=null;function dS(l,f){l.stylesheets=null,l.unsuspend!==null&&(l.count++,hS=new Map,f.forEach(j4,l),hS=null,fS.call(l))}function j4(l,f){if(!(f.state.loading&4)){var g=hS.get(l);if(g)var _=g.get(null);else{g=new Map,hS.set(l,g);for(var M=l.querySelectorAll("link[data-precedence],style[data-precedence]"),L=0;L<M.length;L++){var G=M[L];(G.nodeName==="LINK"||G.getAttribute("media")!=="not all")&&(g.set(G.dataset.precedence,G),_=G)}_&&g.set(null,_)}M=f.instance,G=M.getAttribute("data-precedence"),L=g.get(G)||_,L===_&&g.set(null,M),g.set(G,M),this.count++,_=fS.bind(this),M.addEventListener("load",_),M.addEventListener("error",_),L?L.parentNode.insertBefore(M,L.nextSibling):(l=l.nodeType===9?l.head:l,l.insertBefore(M,l.firstChild)),f.state.loading|=4}}var $v={$$typeof:R,Provider:null,Consumer:null,_currentValue:J,_currentValue2:J,_threadCount:0};function W4(l,f,g,_,M,L,G,Q,ve){this.tag=1,this.containerInfo=l,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Dt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Dt(0),this.hiddenUpdates=Dt(null),this.identifierPrefix=_,this.onUncaughtError=M,this.onCaughtError=L,this.onRecoverableError=G,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ve,this.incompleteTransitions=new Map}function Cw(l,f,g,_,M,L,G,Q,ve,Ue,nt,mt){return l=new W4(l,f,g,G,ve,Ue,nt,mt,Q),f=1,L===!0&&(f|=24),L=Dr(3,null,null,f),l.current=L,L.stateNode=l,f=rv(),f.refCount++,l.pooledCache=f,f.refCount++,L.memoizedState={element:_,isDehydrated:g,cache:f},fv(L),l}function Rw(l){return l?(l=Cc,l):Cc}function Dw(l,f,g,_,M,L){M=Rw(M),_.context===null?_.context=M:_.pendingContext=M,_=Qo(f),_.payload={element:g},L=L===void 0?null:L,L!==null&&(_.callback=L),g=Fl(l,_,f),g!==null&&(m(g,l,f),Pc(g,l,f))}function Lw(l,f){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var g=l.retryLane;l.retryLane=g!==0&&g<f?g:f}}function o1(l,f){Lw(l,f),(l=l.alternate)&&Lw(l,f)}function ww(l){if(l.tag===13||l.tag===31){var f=Mc(l,67108864);f!==null&&m(f,l,67108864),o1(l,67108864)}}function Iw(l){if(l.tag===13||l.tag===31){var f=Or();f=$t(f);var g=Mc(l,f);g!==null&&m(g,l,f),o1(l,f)}}var pS=!0;function J4(l,f,g,_){var M=k.T;k.T=null;var L=j.p;try{j.p=2,l1(l,f,g,_)}finally{j.p=L,k.T=M}}function $4(l,f,g,_){var M=k.T;k.T=null;var L=j.p;try{j.p=8,l1(l,f,g,_)}finally{j.p=L,k.T=M}}function l1(l,f,g,_){if(pS){var M=c1(_);if(M===null)jT(l,f,_,mS,g),Ow(l,_);else if(Z4(M,l,f,g,_))_.stopPropagation();else if(Ow(l,_),f&4&&-1<Q4.indexOf(l)){for(;M!==null;){var L=Y(M);if(L!==null)switch(L.tag){case 3:if(L=L.stateNode,L.current.memoizedState.isDehydrated){var G=ut(L.pendingLanes);if(G!==0){var Q=L;for(Q.pendingLanes|=2,Q.entangledLanes|=2;G;){var ve=1<<31-he(G);Q.entanglements[1]|=ve,G&=~ve}Yc(L),(ii&6)===0&&(Ta=q()+500,Xv(0))}}break;case 31:case 13:Q=Mc(L,2),Q!==null&&m(Q,L,2),ee(),o1(L,2)}if(L=c1(_),L===null&&jT(l,f,_,mS,g),L===M)break;M=L}M!==null&&_.stopPropagation()}else jT(l,f,_,null,g)}}function c1(l){return l=jp(l),u1(l)}var mS=null;function u1(l){if(mS=null,l=ct(l),l!==null){var f=s(l);if(f===null)l=null;else{var g=f.tag;if(g===13){if(l=a(f),l!==null)return l;l=null}else if(g===31){if(l=o(f),l!==null)return l;l=null}else if(g===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;l=null}else f!==l&&(l=null)}}return mS=l,null}function Bw(l){switch(l){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ee()){case Ge:return 2;case Ve:return 8;case Pe:case wt:return 32;case bt:return 268435456;default:return 32}default:return 32}}var f1=!1,Qf=null,Zf=null,eh=null,Qv=new Map,Zv=new Map,th=[],Q4="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ow(l,f){switch(l){case"focusin":case"focusout":Qf=null;break;case"dragenter":case"dragleave":Zf=null;break;case"mouseover":case"mouseout":eh=null;break;case"pointerover":case"pointerout":Qv.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zv.delete(f.pointerId)}}function ey(l,f,g,_,M,L){return l===null||l.nativeEvent!==L?(l={blockedOn:f,domEventName:g,eventSystemFlags:_,nativeEvent:L,targetContainers:[M]},f!==null&&(f=Y(f),f!==null&&ww(f)),l):(l.eventSystemFlags|=_,f=l.targetContainers,M!==null&&f.indexOf(M)===-1&&f.push(M),l)}function Z4(l,f,g,_,M){switch(f){case"focusin":return Qf=ey(Qf,l,f,g,_,M),!0;case"dragenter":return Zf=ey(Zf,l,f,g,_,M),!0;case"mouseover":return eh=ey(eh,l,f,g,_,M),!0;case"pointerover":var L=M.pointerId;return Qv.set(L,ey(Qv.get(L)||null,l,f,g,_,M)),!0;case"gotpointercapture":return L=M.pointerId,Zv.set(L,ey(Zv.get(L)||null,l,f,g,_,M)),!0}return!1}function Pw(l){var f=ct(l.target);if(f!==null){var g=s(f);if(g!==null){if(f=g.tag,f===13){if(f=a(g),f!==null){l.blockedOn=f,Yt(l.priority,function(){Iw(g)});return}}else if(f===31){if(f=o(g),f!==null){l.blockedOn=f,Yt(l.priority,function(){Iw(g)});return}}else if(f===3&&g.stateNode.current.memoizedState.isDehydrated){l.blockedOn=g.tag===3?g.stateNode.containerInfo:null;return}}}l.blockedOn=null}function gS(l){if(l.blockedOn!==null)return!1;for(var f=l.targetContainers;0<f.length;){var g=c1(l.nativeEvent);if(g===null){g=l.nativeEvent;var _=new g.constructor(g.type,g);qh=_,g.target.dispatchEvent(_),qh=null}else return f=Y(g),f!==null&&ww(f),l.blockedOn=g,!1;f.shift()}return!0}function Nw(l,f,g){gS(l)&&g.delete(f)}function eG(){f1=!1,Qf!==null&&gS(Qf)&&(Qf=null),Zf!==null&&gS(Zf)&&(Zf=null),eh!==null&&gS(eh)&&(eh=null),Qv.forEach(Nw),Zv.forEach(Nw)}function vS(l,f){l.blockedOn===f&&(l.blockedOn=null,f1||(f1=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,eG)))}var yS=null;function Uw(l){yS!==l&&(yS=l,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){yS===l&&(yS=null);for(var f=0;f<l.length;f+=3){var g=l[f],_=l[f+1],M=l[f+2];if(typeof _!="function"){if(u1(_||g)===null)continue;break}var L=Y(g);L!==null&&(l.splice(f,3),f-=3,Nv(L,{pending:!0,data:M,method:g.method,action:_},_,M))}}))}function Qm(l){function f(ve){return vS(ve,l)}Qf!==null&&vS(Qf,l),Zf!==null&&vS(Zf,l),eh!==null&&vS(eh,l),Qv.forEach(f),Zv.forEach(f);for(var g=0;g<th.length;g++){var _=th[g];_.blockedOn===l&&(_.blockedOn=null)}for(;0<th.length&&(g=th[0],g.blockedOn===null);)Pw(g),g.blockedOn===null&&th.shift();if(g=(l.ownerDocument||l).$$reactFormReplay,g!=null)for(_=0;_<g.length;_+=3){var M=g[_],L=g[_+1],G=M[V]||null;if(typeof L=="function")G||Uw(g);else if(G){var Q=null;if(L&&L.hasAttribute("formAction")){if(M=L,G=L[V]||null)Q=G.formAction;else if(u1(M)!==null)continue}else Q=G.action;typeof Q=="function"?g[_+1]=Q:(g.splice(_,3),_-=3),Uw(g)}}}function Fw(){function l(L){L.canIntercept&&L.info==="react-transition"&&L.intercept({handler:function(){return new Promise(function(G){return M=G})},focusReset:"manual",scroll:"manual"})}function f(){M!==null&&(M(),M=null),_||setTimeout(g,20)}function g(){if(!_&&!navigation.transition){var L=navigation.currentEntry;L&&L.url!=null&&navigation.navigate(L.url,{state:L.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var _=!1,M=null;return navigation.addEventListener("navigate",l),navigation.addEventListener("navigatesuccess",f),navigation.addEventListener("navigateerror",f),setTimeout(g,100),function(){_=!0,navigation.removeEventListener("navigate",l),navigation.removeEventListener("navigatesuccess",f),navigation.removeEventListener("navigateerror",f),M!==null&&(M(),M=null)}}}function h1(l){this._internalRoot=l}xS.prototype.render=h1.prototype.render=function(l){var f=this._internalRoot;if(f===null)throw Error(n(409));var g=f.current,_=Or();Dw(g,_,l,f,null,null)},xS.prototype.unmount=h1.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var f=l.containerInfo;Dw(l.current,2,null,l,null,null),ee(),f[$]=null}};function xS(l){this._internalRoot=l}xS.prototype.unstable_scheduleHydration=function(l){if(l){var f=hn();l={blockedOn:null,target:l,priority:f};for(var g=0;g<th.length&&f!==0&&f<th[g].priority;g++);th.splice(g,0,l),g===0&&Pw(l)}};var kw=e.version;if(kw!=="19.2.0")throw Error(n(527,kw,"19.2.0"));j.findDOMNode=function(l){var f=l._reactInternals;if(f===void 0)throw typeof l.render=="function"?Error(n(188)):(l=Object.keys(l).join(","),Error(n(268,l)));return l=u(f),l=l!==null?h(l):null,l=l===null?null:l.stateNode,l};var tG={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:k,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _S=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_S.isDisabled&&_S.supportsFiber)try{Ze=_S.inject(tG),Je=_S}catch{}}return ny.createRoot=function(l,f){if(!i(l))throw Error(n(299));var g=!1,_="",M=Gv,L=Q_,G=Pm;return f!=null&&(f.unstable_strictMode===!0&&(g=!0),f.identifierPrefix!==void 0&&(_=f.identifierPrefix),f.onUncaughtError!==void 0&&(M=f.onUncaughtError),f.onCaughtError!==void 0&&(L=f.onCaughtError),f.onRecoverableError!==void 0&&(G=f.onRecoverableError)),f=Cw(l,1,!1,null,null,g,_,null,M,L,G,Fw),l[$]=f.current,qT(l),new h1(f)},ny.hydrateRoot=function(l,f,g){if(!i(l))throw Error(n(299));var _=!1,M="",L=Gv,G=Q_,Q=Pm,ve=null;return g!=null&&(g.unstable_strictMode===!0&&(_=!0),g.identifierPrefix!==void 0&&(M=g.identifierPrefix),g.onUncaughtError!==void 0&&(L=g.onUncaughtError),g.onCaughtError!==void 0&&(G=g.onCaughtError),g.onRecoverableError!==void 0&&(Q=g.onRecoverableError),g.formState!==void 0&&(ve=g.formState)),f=Cw(l,1,!0,f,g??null,_,M,ve,L,G,Q,Fw),f.context=Rw(null),g=f.current,_=Or(),_=$t(_),M=Qo(_),M.callback=null,Fl(g,M,_),g=_,f.current.lanes=g,Ut(f,g),Yc(f),l[$]=f.current,qT(l),new xS(f)},ny.version="19.2.0",ny}var Ww;function fG(){if(Ww)return m1.exports;Ww=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),m1.exports=uG(),m1.exports}var pO=fG();const hG=[{label:"Store"},{label:"Mac"},{label:"iPhone"},{label:"Watch"},{label:"Vision"},{label:"AirPods"}],VR=["Object_84","Object_37","Object_34","Object_12","Object_80","Object_35","Object_36","Object_13","Object_125","Object_76","Object_33","Object_42","Object_58","Object_52","Object_21","Object_10"],dG=[{id:"p1",src:"/performance1.png"},{id:"p2",src:"/performance2.png"},{id:"p3",src:"/performance3.png"},{id:"p4",src:"/performance4.png"},{id:"p5",src:"/performance5.jpg"},{id:"p6",src:"/performance6.png"},{id:"p7",src:"/performance7.png"}],pG=[{id:"p1",left:5,bottom:65},{id:"p2",right:10,bottom:60},{id:"p3",right:-5,bottom:45},{id:"p4",right:-10,bottom:0},{id:"p5",left:20,bottom:50},{id:"p6",left:2,bottom:30},{id:"p7",left:-5,bottom:0}],mG=[{id:1,icon:"/feature-icon1.svg",highlight:"Email AI.",text:"Summarize and draft replies to emails instantly, so you stay on top of your inbox.",styles:"left-5 md:left-20 top-[20%] opacity-0 translate-y-5"},{id:2,icon:"/feature-icon2.svg",highlight:"Image AI.",text:"Generate or edit images with ease. Just type what you imagine, and let AI bring it to life.",styles:"right-5 md:right-20 top-[30%] opacity-0 translate-y-5"},{id:3,icon:"/feature-icon3.svg",highlight:"Summarize AI.",text:"Turn long articles, reports, or notes into clear, bite-sized summaries in seconds.",styles:"left-5 md:left-20 top-[50%] opacity-0 translate-y-5"},{id:4,icon:"/feature-icon4.svg",highlight:"AirDrop.",text:"Wirelessly share photos, large files, and more between your iPhone, your Mac, & other devices.",styles:"right-5 md:right-20 top-[70%] opacity-0 translate-y-5"},{id:5,icon:"/feature-icon5.svg",highlight:"Writing Tool.",text:"Write smarter and faster, whether its blogs, essays, or captions, AI helps polish your words.",styles:"left-5 md:left-20 top-[90%] opacity-0 translate-y-5"}],Jw=[{videoPath:"/videos/feature-1.mp4",boxClass:".box1",delay:1},{videoPath:"/videos/feature-2.mp4",boxClass:".box2",delay:0},{videoPath:"/videos/feature-3.mp4",boxClass:".box3",delay:0},{videoPath:"/videos/feature-4.mp4",boxClass:".box4",delay:0},{videoPath:"/videos/feature-5.mp4",boxClass:".box5",delay:0}],gG=[{label:"Privacy Policy",link:"#"},{label:"Terms of Use",link:"#"},{label:"Sales Policy",link:"#"},{label:"Legal",link:"#"},{label:"Site Map",link:"#"}],vG=()=>ye.jsx("header",{children:ye.jsxs("nav",{children:[ye.jsx("img",{src:"/logo.svg",alt:"Apple logo"}),ye.jsx("ul",{children:hG.map(({label:r})=>ye.jsx("li",{children:ye.jsx("a",{href:r,children:r})},r))}),ye.jsxs("div",{className:"flex-centre gap-3",children:[ye.jsx("button",{children:ye.jsx("img",{src:"/search.svg",alt:"Search"})}),ye.jsx("button",{children:ye.jsx("img",{src:"/cart.svg",alt:"Cart"})})]})]})}),yG=()=>{const r=Fe.useRef();return Fe.useEffect(()=>{r.current&&(r.current.playbackRate=2)},[]),ye.jsxs("section",{id:"hero",children:[ye.jsxs("div",{children:[ye.jsx("h1",{children:"MacBook Pro"}),ye.jsx("img",{src:"/title.png",alt:"MacBook Title"})]}),ye.jsx("video",{ref:r,src:"/videos/hero.mp4",autoPlay:!0,muted:!0,playsInline:!0}),ye.jsx("button",{children:"Buy"}),ye.jsx("p",{children:"From  122599.00 or  11999/mo for 12 months"})]})},$w=r=>{let e;const t=new Set,n=(u,h)=>{const p=typeof u=="function"?u(e):u;if(!Object.is(p,e)){const v=e;e=h??(typeof p!="object"||p===null)?p:Object.assign({},e,p),t.forEach(y=>y(e,v))}},i=()=>e,o={setState:n,getState:i,getInitialState:()=>c,subscribe:u=>(t.add(u),()=>t.delete(u))},c=e=r(n,i,o);return o},mO=(r=>r?$w(r):$w),xG=r=>r;function _G(r,e=xG){const t=Ey.useSyncExternalStore(r.subscribe,Ey.useCallback(()=>e(r.getState()),[r,e]),Ey.useCallback(()=>e(r.getInitialState()),[r,e]));return Ey.useDebugValue(t),t}const Qw=r=>{const e=mO(r),t=n=>_G(e,n);return Object.assign(t,e),t},SG=(r=>r?Qw(r):Qw),Tg=SG(r=>({color:"#f2f2f2",setColor:e=>r({color:e}),scale:.08,setScale:e=>r({scale:e}),texture:"/videos/feature-1.mp4",setTexture:e=>r({texture:e}),reset:()=>r({color:"#f2f2f2",scale:.08,texture:"/videos/feature-1.mp4"})}));function gO(r){var e,t,n="";if(typeof r=="string"||typeof r=="number")n+=r;else if(typeof r=="object")if(Array.isArray(r)){var i=r.length;for(e=0;e<i;e++)r[e]&&(t=gO(r[e]))&&(n&&(n+=" "),n+=t)}else for(t in r)r[t]&&(n&&(n+=" "),n+=t);return n}function JA(){for(var r,e,t=0,n="",i=arguments.length;t<i;t++)(r=arguments[t])&&(e=gO(r))&&(n&&(n+=" "),n+=e);return n}var x1={exports:{}},Hu={};var Zw;function AG(){return Zw||(Zw=1,Hu.ConcurrentRoot=1,Hu.ContinuousEventPriority=8,Hu.DefaultEventPriority=32,Hu.DiscreteEventPriority=2,Hu.IdleEventPriority=268435456,Hu.LegacyRoot=0,Hu.NoEventPriority=0),Hu}var eI;function EG(){return eI||(eI=1,x1.exports=AG()),x1.exports}var $A=EG();const Px="181",ep={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},tp={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},vO=0,bC=1,yO=2,bG=3,xO=0,Nb=1,Py=2,ic=3,au=0,Ga=1,so=2,lc=0,vp=1,TC=2,MC=3,CC=4,_O=5,vh=100,SO=101,AO=102,EO=103,bO=104,TO=200,MO=201,CO=202,RO=203,xE=204,_E=205,DO=206,LO=207,wO=208,IO=209,BO=210,OO=211,PO=212,NO=213,UO=214,SE=0,AE=1,EE=2,Dp=3,bE=4,TE=5,ME=6,CE=7,Nx=0,FO=1,kO=2,su=0,GO=1,HO=2,zO=3,YR=4,VO=5,YO=6,XO=7,RC="attached",KO="detached",Lh=300,ou=301,wh=302,Q0=303,ox=304,Mg=306,Ih=1e3,_s=1001,Z0=1002,br=1003,Ub=1004,TG=1004,lp=1005,MG=1005,yi=1006,k0=1007,CG=1007,ml=1008,DC=1008,Ha=1009,Fb=1010,kb=1011,eg=1012,Ux=1013,lu=1014,Ss=1015,ar=1016,Gb=1017,Hb=1018,tg=1020,XR=35902,KR=35899,qR=1021,jR=1022,Ns=1023,ng=1026,ig=1027,Fx=1028,kx=1029,zb=1030,Vb=1031,RG=1032,Yb=1033,Ny=33776,Uy=33777,Fy=33778,ky=33779,RE=35840,DE=35841,LE=35842,wE=35843,IE=36196,BE=37492,OE=37496,PE=37808,NE=37809,UE=37810,FE=37811,kE=37812,GE=37813,HE=37814,zE=37815,VE=37816,YE=37817,XE=37818,KE=37819,qE=37820,jE=37821,WE=36492,JE=36494,$E=36495,QE=36283,ZE=36284,eb=36285,tb=36286,qO=2200,jO=2201,WO=2202,sg=2300,rg=2301,QA=2302,cp=2400,up=2401,lx=2402,Xb=2500,WR=2501,JO=0,JR=1,nb=2,$O=3200,QO=3201,DG=3202,LG=3203,kh=0,ZO=1,sf="",sr="srgb",cc="srgb-linear",cx="linear",Bi="srgb",wG=0,np=7680,IG=7681,BG=7682,OG=7683,PG=34055,NG=34056,UG=5386,FG=512,kG=513,GG=514,HG=515,zG=516,VG=517,YG=518,LC=519,eP=512,tP=513,nP=514,$R=515,iP=516,sP=517,rP=518,aP=519,ux=35044,XG=35048,KG=35040,qG=35045,jG=35049,WG=35041,JG=35046,$G=35050,QG=35042,ZG="100",wC="300 es",No=2e3,ag=2001,e8={COMPUTE:"compute",RENDER:"render"},t8={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},n8={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};function oP(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}const i8={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function O0(r,e){return new i8[r](e)}function fx(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function lP(){const r=fx("canvas");return r.style.display="block",r}const tI={};let Bh=null;function s8(r){Bh=r}function r8(){return Bh}function hx(...r){const e="THREE."+r.shift();Bh?Bh("log",e,...r):console.log(e,...r)}function Ht(...r){const e="THREE."+r.shift();Bh?Bh("warn",e,...r):console.warn(e,...r)}function Cn(...r){const e="THREE."+r.shift();Bh?Bh("error",e,...r):console.error(e,...r)}function og(...r){const e=r.join(" ");e in tI||(tI[e]=!0,Ht(...r))}function a8(r,e,t){return new Promise(function(n,i){function s(){switch(r.clientWaitSync(e,r.SYNC_FLUSH_COMMANDS_BIT,0)){case r.WAIT_FAILED:i();break;case r.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:n()}}setTimeout(s,t)})}let hu=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const i=n[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let s=0,a=i.length;s<a;s++)i[s].call(this,e);e.target=null}}};const ea=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let nI=1234567;const yp=Math.PI/180,lg=180/Math.PI;function Fo(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ea[r&255]+ea[r>>8&255]+ea[r>>16&255]+ea[r>>24&255]+"-"+ea[e&255]+ea[e>>8&255]+"-"+ea[e>>16&15|64]+ea[e>>24&255]+"-"+ea[t&63|128]+ea[t>>8&255]+"-"+ea[t>>16&255]+ea[t>>24&255]+ea[n&255]+ea[n>>8&255]+ea[n>>16&255]+ea[n>>24&255]).toLowerCase()}function An(r,e,t){return Math.max(e,Math.min(t,r))}function QR(r,e){return(r%e+e)%e}function o8(r,e,t,n,i){return n+(r-e)*(i-n)/(t-e)}function l8(r,e,t){return r!==e?(t-r)/(e-r):0}function Gy(r,e,t){return(1-t)*r+t*e}function c8(r,e,t,n){return Gy(r,e,1-Math.exp(-t*n))}function u8(r,e=1){return e-Math.abs(QR(r,e*2)-e)}function f8(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*(3-2*r))}function h8(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*r*(r*(r*6-15)+10))}function d8(r,e){return r+Math.floor(Math.random()*(e-r+1))}function p8(r,e){return r+Math.random()*(e-r)}function m8(r){return r*(.5-Math.random())}function g8(r){r!==void 0&&(nI=r);let e=nI+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function v8(r){return r*yp}function y8(r){return r*lg}function x8(r){return(r&r-1)===0&&r!==0}function _8(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function S8(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function A8(r,e,t,n,i){const s=Math.cos,a=Math.sin,o=s(t/2),c=a(t/2),u=s((e+n)/2),h=a((e+n)/2),p=s((e-n)/2),v=a((e-n)/2),y=s((n-e)/2),x=a((n-e)/2);switch(i){case"XYX":r.set(o*h,c*p,c*v,o*u);break;case"YZY":r.set(c*v,o*h,c*p,o*u);break;case"ZXZ":r.set(c*p,c*v,o*h,o*u);break;case"XZX":r.set(o*h,c*x,c*y,o*u);break;case"YXY":r.set(c*y,o*h,c*x,o*u);break;case"ZYZ":r.set(c*x,c*y,o*h,o*u);break;default:Ht("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Na(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function Un(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const cP={DEG2RAD:yp,RAD2DEG:lg,generateUUID:Fo,clamp:An,euclideanModulo:QR,mapLinear:o8,inverseLerp:l8,lerp:Gy,damp:c8,pingpong:u8,smoothstep:f8,smootherstep:h8,randInt:d8,randFloat:p8,randFloatSpread:m8,seededRandom:g8,degToRad:v8,radToDeg:y8,isPowerOfTwo:x8,ceilPowerOfTwo:_8,floorPowerOfTwo:S8,setQuaternionFromProperEuler:A8,normalize:Un,denormalize:Na};class at{constructor(e=0,t=0){at.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=An(this.x,e.x,t.x),this.y=An(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=An(this.x,e,t),this.y=An(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(An(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(An(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),s=this.x-e.x,a=this.y-e.y;return this.x=s*n-a*i+e.x,this.y=s*i+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Tr{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,s,a,o){let c=n[i+0],u=n[i+1],h=n[i+2],p=n[i+3],v=s[a+0],y=s[a+1],x=s[a+2],S=s[a+3];if(o<=0){e[t+0]=c,e[t+1]=u,e[t+2]=h,e[t+3]=p;return}if(o>=1){e[t+0]=v,e[t+1]=y,e[t+2]=x,e[t+3]=S;return}if(p!==S||c!==v||u!==y||h!==x){let E=c*v+u*y+h*x+p*S;E<0&&(v=-v,y=-y,x=-x,S=-S,E=-E);let b=1-o;if(E<.9995){const T=Math.acos(E),R=Math.sin(T);b=Math.sin(b*T)/R,o=Math.sin(o*T)/R,c=c*b+v*o,u=u*b+y*o,h=h*b+x*o,p=p*b+S*o}else{c=c*b+v*o,u=u*b+y*o,h=h*b+x*o,p=p*b+S*o;const T=1/Math.sqrt(c*c+u*u+h*h+p*p);c*=T,u*=T,h*=T,p*=T}}e[t]=c,e[t+1]=u,e[t+2]=h,e[t+3]=p}static multiplyQuaternionsFlat(e,t,n,i,s,a){const o=n[i],c=n[i+1],u=n[i+2],h=n[i+3],p=s[a],v=s[a+1],y=s[a+2],x=s[a+3];return e[t]=o*x+h*p+c*y-u*v,e[t+1]=c*x+h*v+u*p-o*y,e[t+2]=u*x+h*y+o*v-c*p,e[t+3]=h*x-o*p-c*v-u*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,i=e._y,s=e._z,a=e._order,o=Math.cos,c=Math.sin,u=o(n/2),h=o(i/2),p=o(s/2),v=c(n/2),y=c(i/2),x=c(s/2);switch(a){case"XYZ":this._x=v*h*p+u*y*x,this._y=u*y*p-v*h*x,this._z=u*h*x+v*y*p,this._w=u*h*p-v*y*x;break;case"YXZ":this._x=v*h*p+u*y*x,this._y=u*y*p-v*h*x,this._z=u*h*x-v*y*p,this._w=u*h*p+v*y*x;break;case"ZXY":this._x=v*h*p-u*y*x,this._y=u*y*p+v*h*x,this._z=u*h*x+v*y*p,this._w=u*h*p-v*y*x;break;case"ZYX":this._x=v*h*p-u*y*x,this._y=u*y*p+v*h*x,this._z=u*h*x-v*y*p,this._w=u*h*p+v*y*x;break;case"YZX":this._x=v*h*p+u*y*x,this._y=u*y*p+v*h*x,this._z=u*h*x-v*y*p,this._w=u*h*p-v*y*x;break;case"XZY":this._x=v*h*p-u*y*x,this._y=u*y*p-v*h*x,this._z=u*h*x+v*y*p,this._w=u*h*p+v*y*x;break;default:Ht("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],s=t[8],a=t[1],o=t[5],c=t[9],u=t[2],h=t[6],p=t[10],v=n+o+p;if(v>0){const y=.5/Math.sqrt(v+1);this._w=.25/y,this._x=(h-c)*y,this._y=(s-u)*y,this._z=(a-i)*y}else if(n>o&&n>p){const y=2*Math.sqrt(1+n-o-p);this._w=(h-c)/y,this._x=.25*y,this._y=(i+a)/y,this._z=(s+u)/y}else if(o>p){const y=2*Math.sqrt(1+o-n-p);this._w=(s-u)/y,this._x=(i+a)/y,this._y=.25*y,this._z=(c+h)/y}else{const y=2*Math.sqrt(1+p-n-o);this._w=(a-i)/y,this._x=(s+u)/y,this._y=(c+h)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(An(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,s=e._z,a=e._w,o=t._x,c=t._y,u=t._z,h=t._w;return this._x=n*h+a*o+i*u-s*c,this._y=i*h+a*c+s*o-n*u,this._z=s*h+a*u+n*c-i*o,this._w=a*h-n*o-i*c-s*u,this._onChangeCallback(),this}slerp(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);let n=e._x,i=e._y,s=e._z,a=e._w,o=this.dot(e);o<0&&(n=-n,i=-i,s=-s,a=-a,o=-o);let c=1-t;if(o<.9995){const u=Math.acos(o),h=Math.sin(u);c=Math.sin(c*u)/h,t=Math.sin(t*u)/h,this._x=this._x*c+n*t,this._y=this._y*c+i*t,this._z=this._z*c+s*t,this._w=this._w*c+a*t,this._onChangeCallback()}else this._x=this._x*c+n*t,this._y=this._y*c+i*t,this._z=this._z*c+s*t,this._w=this._w*c+a*t,this.normalize();return this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ae{constructor(e=0,t=0,n=0){ae.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(iI.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(iI.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*i,this.y=s[1]*t+s[4]*n+s[7]*i,this.z=s[2]*t+s[5]*n+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=e.elements,a=1/(s[3]*t+s[7]*n+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*i+s[12])*a,this.y=(s[1]*t+s[5]*n+s[9]*i+s[13])*a,this.z=(s[2]*t+s[6]*n+s[10]*i+s[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,s=e.x,a=e.y,o=e.z,c=e.w,u=2*(a*i-o*n),h=2*(o*t-s*i),p=2*(s*n-a*t);return this.x=t+c*u+a*p-o*h,this.y=n+c*h+o*u-s*p,this.z=i+c*p+s*h-a*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i,this.y=s[1]*t+s[5]*n+s[9]*i,this.z=s[2]*t+s[6]*n+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=An(this.x,e.x,t.x),this.y=An(this.y,e.y,t.y),this.z=An(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=An(this.x,e,t),this.y=An(this.y,e,t),this.z=An(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(An(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,s=e.z,a=t.x,o=t.y,c=t.z;return this.x=i*c-s*o,this.y=s*a-n*c,this.z=n*o-i*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return _1.copy(this).projectOnVector(e),this.sub(_1)}reflect(e){return this.sub(_1.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(An(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _1=new ae,iI=new Tr;class Pn{constructor(e,t,n,i,s,a,o,c,u){Pn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,i,s,a,o,c,u)}set(e,t,n,i,s,a,o,c,u){const h=this.elements;return h[0]=e,h[1]=i,h[2]=o,h[3]=t,h[4]=s,h[5]=c,h[6]=n,h[7]=a,h[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,a=n[0],o=n[3],c=n[6],u=n[1],h=n[4],p=n[7],v=n[2],y=n[5],x=n[8],S=i[0],E=i[3],b=i[6],T=i[1],R=i[4],D=i[7],P=i[2],O=i[5],N=i[8];return s[0]=a*S+o*T+c*P,s[3]=a*E+o*R+c*O,s[6]=a*b+o*D+c*N,s[1]=u*S+h*T+p*P,s[4]=u*E+h*R+p*O,s[7]=u*b+h*D+p*N,s[2]=v*S+y*T+x*P,s[5]=v*E+y*R+x*O,s[8]=v*b+y*D+x*N,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],c=e[6],u=e[7],h=e[8];return t*a*h-t*o*u-n*s*h+n*o*c+i*s*u-i*a*c}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],c=e[6],u=e[7],h=e[8],p=h*a-o*u,v=o*c-h*s,y=u*s-a*c,x=t*p+n*v+i*y;if(x===0)return this.set(0,0,0,0,0,0,0,0,0);const S=1/x;return e[0]=p*S,e[1]=(i*u-h*n)*S,e[2]=(o*n-i*a)*S,e[3]=v*S,e[4]=(h*t-i*c)*S,e[5]=(i*s-o*t)*S,e[6]=y*S,e[7]=(n*c-u*t)*S,e[8]=(a*t-n*s)*S,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,s,a,o){const c=Math.cos(s),u=Math.sin(s);return this.set(n*c,n*u,-n*(c*a+u*o)+a+e,-i*u,i*c,-i*(-u*a+c*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(S1.makeScale(e,t)),this}rotate(e){return this.premultiply(S1.makeRotation(-e)),this}translate(e,t){return this.premultiply(S1.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const S1=new Pn,sI=new Pn().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),rI=new Pn().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function E8(){const r={enabled:!0,workingColorSpace:cc,spaces:{},convert:function(i,s,a){return this.enabled===!1||s===a||!s||!a||(this.spaces[s].transfer===Bi&&(i.r=uf(i.r),i.g=uf(i.g),i.b=uf(i.b)),this.spaces[s].primaries!==this.spaces[a].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===Bi&&(i.r=G0(i.r),i.g=G0(i.g),i.b=G0(i.b))),i},workingToColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},colorSpaceToWorking:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===sf?cx:this.spaces[i].transfer},getToneMappingMode:function(i){return this.spaces[i].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,a){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(i,s){return og("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),r.workingToColorSpace(i,s)},toWorkingColorSpace:function(i,s){return og("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),r.colorSpaceToWorking(i,s)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return r.define({[cc]:{primaries:e,whitePoint:n,transfer:cx,toXYZ:sI,fromXYZ:rI,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:sr},outputColorSpaceConfig:{drawingBufferColorSpace:sr}},[sr]:{primaries:e,whitePoint:n,transfer:Bi,toXYZ:sI,fromXYZ:rI,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:sr}}}),r}const hi=E8();function uf(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function G0(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let Zm;class uP{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{Zm===void 0&&(Zm=fx("canvas")),Zm.width=e.width,Zm.height=e.height;const i=Zm.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=Zm}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=fx("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),s=i.data;for(let a=0;a<s.length;a++)s[a]=uf(s[a]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(uf(t[n]/255)*255):t[n]=uf(t[n]);return{data:t,width:e.width,height:e.height}}else return Ht("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let b8=0;class yh{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:b8++}),this.uuid=Fo(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let a=0,o=i.length;a<o;a++)i[a].isDataTexture?s.push(A1(i[a].image)):s.push(A1(i[a]))}else s=A1(i);n.url=s}return t||(e.images[this.uuid]=n),n}}function A1(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?uP.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(Ht("Texture: Unable to serialize Texture."),{})}let T8=0;const E1=new ae;class Ti extends hu{constructor(e=Ti.DEFAULT_IMAGE,t=Ti.DEFAULT_MAPPING,n=_s,i=_s,s=yi,a=ml,o=Ns,c=Ha,u=Ti.DEFAULT_ANISOTROPY,h=sf){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:T8++}),this.uuid=Fo(),this.name="",this.source=new yh(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=s,this.minFilter=a,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=c,this.offset=new at(0,0),this.repeat=new at(1,1),this.center=new at(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Pn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(E1).x}get height(){return this.source.getSize(E1).y}get depth(){return this.source.getSize(E1).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(n===void 0){Ht(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){Ht(`Texture.setValues(): property '${t}' does not exist.`);continue}i&&n&&i.isVector2&&n.isVector2||i&&n&&i.isVector3&&n.isVector3||i&&n&&i.isMatrix3&&n.isMatrix3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Lh)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ih:e.x=e.x-Math.floor(e.x);break;case _s:e.x=e.x<0?0:1;break;case Z0:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ih:e.y=e.y-Math.floor(e.y);break;case _s:e.y=e.y<0?0:1;break;case Z0:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Ti.DEFAULT_IMAGE=null;Ti.DEFAULT_MAPPING=Lh;Ti.DEFAULT_ANISOTROPY=1;class vi{constructor(e=0,t=0,n=0,i=1){vi.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*s,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*s,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*s,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,s;const c=e.elements,u=c[0],h=c[4],p=c[8],v=c[1],y=c[5],x=c[9],S=c[2],E=c[6],b=c[10];if(Math.abs(h-v)<.01&&Math.abs(p-S)<.01&&Math.abs(x-E)<.01){if(Math.abs(h+v)<.1&&Math.abs(p+S)<.1&&Math.abs(x+E)<.1&&Math.abs(u+y+b-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const R=(u+1)/2,D=(y+1)/2,P=(b+1)/2,O=(h+v)/4,N=(p+S)/4,U=(x+E)/4;return R>D&&R>P?R<.01?(n=0,i=.707106781,s=.707106781):(n=Math.sqrt(R),i=O/n,s=N/n):D>P?D<.01?(n=.707106781,i=0,s=.707106781):(i=Math.sqrt(D),n=O/i,s=U/i):P<.01?(n=.707106781,i=.707106781,s=0):(s=Math.sqrt(P),n=N/s,i=U/s),this.set(n,i,s,t),this}let T=Math.sqrt((E-x)*(E-x)+(p-S)*(p-S)+(v-h)*(v-h));return Math.abs(T)<.001&&(T=1),this.x=(E-x)/T,this.y=(p-S)/T,this.z=(v-h)/T,this.w=Math.acos((u+y+b-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=An(this.x,e.x,t.x),this.y=An(this.y,e.y,t.y),this.z=An(this.z,e.z,t.z),this.w=An(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=An(this.x,e,t),this.y=An(this.y,e,t),this.z=An(this.z,e,t),this.w=An(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(An(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class ZR extends hu{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:yi,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new vi(0,0,e,t),this.scissorTest=!1,this.viewport=new vi(0,0,e,t);const i={width:e,height:t,depth:n.depth},s=new Ti(i);this.textures=[];const a=n.count;for(let o=0;o<a;o++)this.textures[o]=s.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:yi,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n,this.textures[i].isData3DTexture!==!0&&(this.textures[i].isArrayTexture=this.textures[i].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new yh(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Al extends ZR{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class Kb extends Ti{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=br,this.minFilter=br,this.wrapR=_s,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class M8 extends Al{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Kb(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class qb extends Ti{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=br,this.minFilter=br,this.wrapR=_s,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class C8 extends Al{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new qb(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Fr{constructor(e=new ae(1/0,1/0,1/0),t=new ae(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Jl.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Jl.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Jl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,Jl):Jl.fromBufferAttribute(s,a),Jl.applyMatrix4(e.matrixWorld),this.expandByPoint(Jl);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),SS.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),SS.copy(n.boundingBox)),SS.applyMatrix4(e.matrixWorld),this.union(SS)}const i=e.children;for(let s=0,a=i.length;s<a;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Jl),Jl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(iy),AS.subVectors(this.max,iy),e0.subVectors(e.a,iy),t0.subVectors(e.b,iy),n0.subVectors(e.c,iy),ih.subVectors(t0,e0),sh.subVectors(n0,t0),Pd.subVectors(e0,n0);let t=[0,-ih.z,ih.y,0,-sh.z,sh.y,0,-Pd.z,Pd.y,ih.z,0,-ih.x,sh.z,0,-sh.x,Pd.z,0,-Pd.x,-ih.y,ih.x,0,-sh.y,sh.x,0,-Pd.y,Pd.x,0];return!b1(t,e0,t0,n0,AS)||(t=[1,0,0,0,1,0,0,0,1],!b1(t,e0,t0,n0,AS))?!1:(ES.crossVectors(ih,sh),t=[ES.x,ES.y,ES.z],b1(t,e0,t0,n0,AS))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Jl).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Jl).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(zu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),zu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),zu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),zu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),zu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),zu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),zu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),zu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(zu),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const zu=[new ae,new ae,new ae,new ae,new ae,new ae,new ae,new ae],Jl=new ae,SS=new Fr,e0=new ae,t0=new ae,n0=new ae,ih=new ae,sh=new ae,Pd=new ae,iy=new ae,AS=new ae,ES=new ae,Nd=new ae;function b1(r,e,t,n,i){for(let s=0,a=r.length-3;s<=a;s+=3){Nd.fromArray(r,s);const o=i.x*Math.abs(Nd.x)+i.y*Math.abs(Nd.y)+i.z*Math.abs(Nd.z),c=e.dot(Nd),u=t.dot(Nd),h=n.dot(Nd);if(Math.max(-Math.max(c,u,h),Math.min(c,u,h))>o)return!1}return!0}const R8=new Fr,sy=new ae,T1=new ae;class Mr{constructor(e=new ae,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):R8.setFromPoints(e).getCenter(n);let i=0;for(let s=0,a=e.length;s<a;s++)i=Math.max(i,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;sy.subVectors(e,this.center);const t=sy.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.addScaledVector(sy,i/n),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(T1.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(sy.copy(e.center).add(T1)),this.expandByPoint(sy.copy(e.center).sub(T1))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const Vu=new ae,M1=new ae,bS=new ae,rh=new ae,C1=new ae,TS=new ae,R1=new ae;class zp{constructor(e=new ae,t=new ae(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Vu)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Vu.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Vu.copy(this.origin).addScaledVector(this.direction,t),Vu.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){M1.copy(e).add(t).multiplyScalar(.5),bS.copy(t).sub(e).normalize(),rh.copy(this.origin).sub(M1);const s=e.distanceTo(t)*.5,a=-this.direction.dot(bS),o=rh.dot(this.direction),c=-rh.dot(bS),u=rh.lengthSq(),h=Math.abs(1-a*a);let p,v,y,x;if(h>0)if(p=a*c-o,v=a*o-c,x=s*h,p>=0)if(v>=-x)if(v<=x){const S=1/h;p*=S,v*=S,y=p*(p+a*v+2*o)+v*(a*p+v+2*c)+u}else v=s,p=Math.max(0,-(a*v+o)),y=-p*p+v*(v+2*c)+u;else v=-s,p=Math.max(0,-(a*v+o)),y=-p*p+v*(v+2*c)+u;else v<=-x?(p=Math.max(0,-(-a*s+o)),v=p>0?-s:Math.min(Math.max(-s,-c),s),y=-p*p+v*(v+2*c)+u):v<=x?(p=0,v=Math.min(Math.max(-s,-c),s),y=v*(v+2*c)+u):(p=Math.max(0,-(a*s+o)),v=p>0?s:Math.min(Math.max(-s,-c),s),y=-p*p+v*(v+2*c)+u);else v=a>0?-s:s,p=Math.max(0,-(a*v+o)),y=-p*p+v*(v+2*c)+u;return n&&n.copy(this.origin).addScaledVector(this.direction,p),i&&i.copy(M1).addScaledVector(bS,v),y}intersectSphere(e,t){Vu.subVectors(e.center,this.origin);const n=Vu.dot(this.direction),i=Vu.dot(Vu)-n*n,s=e.radius*e.radius;if(i>s)return null;const a=Math.sqrt(s-i),o=n-a,c=n+a;return c<0?null:o<0?this.at(c,t):this.at(o,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,s,a,o,c;const u=1/this.direction.x,h=1/this.direction.y,p=1/this.direction.z,v=this.origin;return u>=0?(n=(e.min.x-v.x)*u,i=(e.max.x-v.x)*u):(n=(e.max.x-v.x)*u,i=(e.min.x-v.x)*u),h>=0?(s=(e.min.y-v.y)*h,a=(e.max.y-v.y)*h):(s=(e.max.y-v.y)*h,a=(e.min.y-v.y)*h),n>a||s>i||((s>n||isNaN(n))&&(n=s),(a<i||isNaN(i))&&(i=a),p>=0?(o=(e.min.z-v.z)*p,c=(e.max.z-v.z)*p):(o=(e.max.z-v.z)*p,c=(e.min.z-v.z)*p),n>c||o>i)||((o>n||n!==n)&&(n=o),(c<i||i!==i)&&(i=c),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,Vu)!==null}intersectTriangle(e,t,n,i,s){C1.subVectors(t,e),TS.subVectors(n,e),R1.crossVectors(C1,TS);let a=this.direction.dot(R1),o;if(a>0){if(i)return null;o=1}else if(a<0)o=-1,a=-a;else return null;rh.subVectors(this.origin,e);const c=o*this.direction.dot(TS.crossVectors(rh,TS));if(c<0)return null;const u=o*this.direction.dot(C1.cross(rh));if(u<0||c+u>a)return null;const h=-o*rh.dot(R1);return h<0?null:this.at(h/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class yn{constructor(e,t,n,i,s,a,o,c,u,h,p,v,y,x,S,E){yn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,i,s,a,o,c,u,h,p,v,y,x,S,E)}set(e,t,n,i,s,a,o,c,u,h,p,v,y,x,S,E){const b=this.elements;return b[0]=e,b[4]=t,b[8]=n,b[12]=i,b[1]=s,b[5]=a,b[9]=o,b[13]=c,b[2]=u,b[6]=h,b[10]=p,b[14]=v,b[3]=y,b[7]=x,b[11]=S,b[15]=E,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new yn().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/i0.setFromMatrixColumn(e,0).length(),s=1/i0.setFromMatrixColumn(e,1).length(),a=1/i0.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,s=e.z,a=Math.cos(n),o=Math.sin(n),c=Math.cos(i),u=Math.sin(i),h=Math.cos(s),p=Math.sin(s);if(e.order==="XYZ"){const v=a*h,y=a*p,x=o*h,S=o*p;t[0]=c*h,t[4]=-c*p,t[8]=u,t[1]=y+x*u,t[5]=v-S*u,t[9]=-o*c,t[2]=S-v*u,t[6]=x+y*u,t[10]=a*c}else if(e.order==="YXZ"){const v=c*h,y=c*p,x=u*h,S=u*p;t[0]=v+S*o,t[4]=x*o-y,t[8]=a*u,t[1]=a*p,t[5]=a*h,t[9]=-o,t[2]=y*o-x,t[6]=S+v*o,t[10]=a*c}else if(e.order==="ZXY"){const v=c*h,y=c*p,x=u*h,S=u*p;t[0]=v-S*o,t[4]=-a*p,t[8]=x+y*o,t[1]=y+x*o,t[5]=a*h,t[9]=S-v*o,t[2]=-a*u,t[6]=o,t[10]=a*c}else if(e.order==="ZYX"){const v=a*h,y=a*p,x=o*h,S=o*p;t[0]=c*h,t[4]=x*u-y,t[8]=v*u+S,t[1]=c*p,t[5]=S*u+v,t[9]=y*u-x,t[2]=-u,t[6]=o*c,t[10]=a*c}else if(e.order==="YZX"){const v=a*c,y=a*u,x=o*c,S=o*u;t[0]=c*h,t[4]=S-v*p,t[8]=x*p+y,t[1]=p,t[5]=a*h,t[9]=-o*h,t[2]=-u*h,t[6]=y*p+x,t[10]=v-S*p}else if(e.order==="XZY"){const v=a*c,y=a*u,x=o*c,S=o*u;t[0]=c*h,t[4]=-p,t[8]=u*h,t[1]=v*p+S,t[5]=a*h,t[9]=y*p-x,t[2]=x*p-y,t[6]=o*h,t[10]=S*p+v}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(D8,e,L8)}lookAt(e,t,n){const i=this.elements;return Mo.subVectors(e,t),Mo.lengthSq()===0&&(Mo.z=1),Mo.normalize(),ah.crossVectors(n,Mo),ah.lengthSq()===0&&(Math.abs(n.z)===1?Mo.x+=1e-4:Mo.z+=1e-4,Mo.normalize(),ah.crossVectors(n,Mo)),ah.normalize(),MS.crossVectors(Mo,ah),i[0]=ah.x,i[4]=MS.x,i[8]=Mo.x,i[1]=ah.y,i[5]=MS.y,i[9]=Mo.y,i[2]=ah.z,i[6]=MS.z,i[10]=Mo.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,a=n[0],o=n[4],c=n[8],u=n[12],h=n[1],p=n[5],v=n[9],y=n[13],x=n[2],S=n[6],E=n[10],b=n[14],T=n[3],R=n[7],D=n[11],P=n[15],O=i[0],N=i[4],U=i[8],B=i[12],I=i[1],z=i[5],W=i[9],Z=i[13],te=i[2],re=i[6],k=i[10],j=i[14],J=i[3],oe=i[7],K=i[11],X=i[15];return s[0]=a*O+o*I+c*te+u*J,s[4]=a*N+o*z+c*re+u*oe,s[8]=a*U+o*W+c*k+u*K,s[12]=a*B+o*Z+c*j+u*X,s[1]=h*O+p*I+v*te+y*J,s[5]=h*N+p*z+v*re+y*oe,s[9]=h*U+p*W+v*k+y*K,s[13]=h*B+p*Z+v*j+y*X,s[2]=x*O+S*I+E*te+b*J,s[6]=x*N+S*z+E*re+b*oe,s[10]=x*U+S*W+E*k+b*K,s[14]=x*B+S*Z+E*j+b*X,s[3]=T*O+R*I+D*te+P*J,s[7]=T*N+R*z+D*re+P*oe,s[11]=T*U+R*W+D*k+P*K,s[15]=T*B+R*Z+D*j+P*X,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],s=e[12],a=e[1],o=e[5],c=e[9],u=e[13],h=e[2],p=e[6],v=e[10],y=e[14],x=e[3],S=e[7],E=e[11],b=e[15];return x*(+s*c*p-i*u*p-s*o*v+n*u*v+i*o*y-n*c*y)+S*(+t*c*y-t*u*v+s*a*v-i*a*y+i*u*h-s*c*h)+E*(+t*u*p-t*o*y-s*a*p+n*a*y+s*o*h-n*u*h)+b*(-i*o*h-t*c*p+t*o*v+i*a*p-n*a*v+n*c*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],c=e[6],u=e[7],h=e[8],p=e[9],v=e[10],y=e[11],x=e[12],S=e[13],E=e[14],b=e[15],T=p*E*u-S*v*u+S*c*y-o*E*y-p*c*b+o*v*b,R=x*v*u-h*E*u-x*c*y+a*E*y+h*c*b-a*v*b,D=h*S*u-x*p*u+x*o*y-a*S*y-h*o*b+a*p*b,P=x*p*c-h*S*c-x*o*v+a*S*v+h*o*E-a*p*E,O=t*T+n*R+i*D+s*P;if(O===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const N=1/O;return e[0]=T*N,e[1]=(S*v*s-p*E*s-S*i*y+n*E*y+p*i*b-n*v*b)*N,e[2]=(o*E*s-S*c*s+S*i*u-n*E*u-o*i*b+n*c*b)*N,e[3]=(p*c*s-o*v*s-p*i*u+n*v*u+o*i*y-n*c*y)*N,e[4]=R*N,e[5]=(h*E*s-x*v*s+x*i*y-t*E*y-h*i*b+t*v*b)*N,e[6]=(x*c*s-a*E*s-x*i*u+t*E*u+a*i*b-t*c*b)*N,e[7]=(a*v*s-h*c*s+h*i*u-t*v*u-a*i*y+t*c*y)*N,e[8]=D*N,e[9]=(x*p*s-h*S*s-x*n*y+t*S*y+h*n*b-t*p*b)*N,e[10]=(a*S*s-x*o*s+x*n*u-t*S*u-a*n*b+t*o*b)*N,e[11]=(h*o*s-a*p*s-h*n*u+t*p*u+a*n*y-t*o*y)*N,e[12]=P*N,e[13]=(h*S*i-x*p*i+x*n*v-t*S*v-h*n*E+t*p*E)*N,e[14]=(x*o*i-a*S*i-x*n*c+t*S*c+a*n*E-t*o*E)*N,e[15]=(a*p*i-h*o*i+h*n*c-t*p*c-a*n*v+t*o*v)*N,this}scale(e){const t=this.elements,n=e.x,i=e.y,s=e.z;return t[0]*=n,t[4]*=i,t[8]*=s,t[1]*=n,t[5]*=i,t[9]*=s,t[2]*=n,t[6]*=i,t[10]*=s,t[3]*=n,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),s=1-n,a=e.x,o=e.y,c=e.z,u=s*a,h=s*o;return this.set(u*a+n,u*o-i*c,u*c+i*o,0,u*o+i*c,h*o+n,h*c-i*a,0,u*c-i*o,h*c+i*a,s*c*c+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,s,a){return this.set(1,n,s,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,s=t._x,a=t._y,o=t._z,c=t._w,u=s+s,h=a+a,p=o+o,v=s*u,y=s*h,x=s*p,S=a*h,E=a*p,b=o*p,T=c*u,R=c*h,D=c*p,P=n.x,O=n.y,N=n.z;return i[0]=(1-(S+b))*P,i[1]=(y+D)*P,i[2]=(x-R)*P,i[3]=0,i[4]=(y-D)*O,i[5]=(1-(v+b))*O,i[6]=(E+T)*O,i[7]=0,i[8]=(x+R)*N,i[9]=(E-T)*N,i[10]=(1-(v+S))*N,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let s=i0.set(i[0],i[1],i[2]).length();const a=i0.set(i[4],i[5],i[6]).length(),o=i0.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],$l.copy(this);const u=1/s,h=1/a,p=1/o;return $l.elements[0]*=u,$l.elements[1]*=u,$l.elements[2]*=u,$l.elements[4]*=h,$l.elements[5]*=h,$l.elements[6]*=h,$l.elements[8]*=p,$l.elements[9]*=p,$l.elements[10]*=p,t.setFromRotationMatrix($l),n.x=s,n.y=a,n.z=o,this}makePerspective(e,t,n,i,s,a,o=No,c=!1){const u=this.elements,h=2*s/(t-e),p=2*s/(n-i),v=(t+e)/(t-e),y=(n+i)/(n-i);let x,S;if(c)x=s/(a-s),S=a*s/(a-s);else if(o===No)x=-(a+s)/(a-s),S=-2*a*s/(a-s);else if(o===ag)x=-a/(a-s),S=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return u[0]=h,u[4]=0,u[8]=v,u[12]=0,u[1]=0,u[5]=p,u[9]=y,u[13]=0,u[2]=0,u[6]=0,u[10]=x,u[14]=S,u[3]=0,u[7]=0,u[11]=-1,u[15]=0,this}makeOrthographic(e,t,n,i,s,a,o=No,c=!1){const u=this.elements,h=2/(t-e),p=2/(n-i),v=-(t+e)/(t-e),y=-(n+i)/(n-i);let x,S;if(c)x=1/(a-s),S=a/(a-s);else if(o===No)x=-2/(a-s),S=-(a+s)/(a-s);else if(o===ag)x=-1/(a-s),S=-s/(a-s);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return u[0]=h,u[4]=0,u[8]=0,u[12]=v,u[1]=0,u[5]=p,u[9]=0,u[13]=y,u[2]=0,u[6]=0,u[10]=x,u[14]=S,u[3]=0,u[7]=0,u[11]=0,u[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const i0=new ae,$l=new yn,D8=new ae(0,0,0),L8=new ae(1,1,1),ah=new ae,MS=new ae,Mo=new ae,aI=new yn,oI=new Tr;class Ho{constructor(e=0,t=0,n=0,i=Ho.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,s=i[0],a=i[4],o=i[8],c=i[1],u=i[5],h=i[9],p=i[2],v=i[6],y=i[10];switch(t){case"XYZ":this._y=Math.asin(An(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,y),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(v,u),this._z=0);break;case"YXZ":this._x=Math.asin(-An(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(o,y),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-p,s),this._z=0);break;case"ZXY":this._x=Math.asin(An(v,-1,1)),Math.abs(v)<.9999999?(this._y=Math.atan2(-p,y),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-An(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(v,y),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(An(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,u),this._y=Math.atan2(-p,s)):(this._x=0,this._y=Math.atan2(o,y));break;case"XZY":this._z=Math.asin(-An(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(v,u),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-h,y),this._y=0);break;default:Ht("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return aI.makeRotationFromQuaternion(e),this.setFromRotationMatrix(aI,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return oI.setFromEuler(this),this.setFromQuaternion(oI,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ho.DEFAULT_ORDER="XYZ";class cg{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let w8=0;const lI=new ae,s0=new Tr,Yu=new yn,CS=new ae,ry=new ae,I8=new ae,B8=new Tr,cI=new ae(1,0,0),uI=new ae(0,1,0),fI=new ae(0,0,1),hI={type:"added"},O8={type:"removed"},r0={type:"childadded",child:null},D1={type:"childremoved",child:null};class pi extends hu{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:w8++}),this.uuid=Fo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=pi.DEFAULT_UP.clone();const e=new ae,t=new Ho,n=new Tr,i=new ae(1,1,1);function s(){n.setFromEuler(t,!1)}function a(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new yn},normalMatrix:{value:new Pn}}),this.matrix=new yn,this.matrixWorld=new yn,this.matrixAutoUpdate=pi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=pi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new cg,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return s0.setFromAxisAngle(e,t),this.quaternion.multiply(s0),this}rotateOnWorldAxis(e,t){return s0.setFromAxisAngle(e,t),this.quaternion.premultiply(s0),this}rotateX(e){return this.rotateOnAxis(cI,e)}rotateY(e){return this.rotateOnAxis(uI,e)}rotateZ(e){return this.rotateOnAxis(fI,e)}translateOnAxis(e,t){return lI.copy(e).applyQuaternion(this.quaternion),this.position.add(lI.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(cI,e)}translateY(e){return this.translateOnAxis(uI,e)}translateZ(e){return this.translateOnAxis(fI,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Yu.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?CS.copy(e):CS.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),ry.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Yu.lookAt(ry,CS,this.up):Yu.lookAt(CS,ry,this.up),this.quaternion.setFromRotationMatrix(Yu),i&&(Yu.extractRotation(i.matrixWorld),s0.setFromRotationMatrix(Yu),this.quaternion.premultiply(s0.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(Cn("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(hI),r0.child=e,this.dispatchEvent(r0),r0.child=null):Cn("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(O8),D1.child=e,this.dispatchEvent(D1),D1.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Yu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Yu.multiply(e.parent.matrixWorld)),e.applyMatrix4(Yu),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(hI),r0.child=e,this.dispatchEvent(r0),r0.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const a=this.children[n].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ry,e,I8),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ry,B8,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(o=>({...o})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(i.boundingBox=this.boundingBox.toJSON()));function s(o,c){return o[c.uuid]===void 0&&(o[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const c=o.shapes;if(Array.isArray(c))for(let u=0,h=c.length;u<h;u++){const p=c[u];s(e.shapes,p)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let c=0,u=this.material.length;c<u;c++)o.push(s(e.materials,this.material[c]));i.material=o}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const c=this.animations[o];i.animations.push(s(e.animations,c))}}if(t){const o=a(e.geometries),c=a(e.materials),u=a(e.textures),h=a(e.images),p=a(e.shapes),v=a(e.skeletons),y=a(e.animations),x=a(e.nodes);o.length>0&&(n.geometries=o),c.length>0&&(n.materials=c),u.length>0&&(n.textures=u),h.length>0&&(n.images=h),p.length>0&&(n.shapes=p),v.length>0&&(n.skeletons=v),y.length>0&&(n.animations=y),x.length>0&&(n.nodes=x)}return n.object=i,n;function a(o){const c=[];for(const u in o){const h=o[u];delete h.metadata,c.push(h)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}pi.DEFAULT_UP=new ae(0,1,0);pi.DEFAULT_MATRIX_AUTO_UPDATE=!0;pi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ql=new ae,Xu=new ae,L1=new ae,Ku=new ae,a0=new ae,o0=new ae,dI=new ae,w1=new ae,I1=new ae,B1=new ae,O1=new vi,P1=new vi,N1=new vi;class ro{constructor(e=new ae,t=new ae,n=new ae){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Ql.subVectors(e,t),i.cross(Ql);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,n,i,s){Ql.subVectors(i,t),Xu.subVectors(n,t),L1.subVectors(e,t);const a=Ql.dot(Ql),o=Ql.dot(Xu),c=Ql.dot(L1),u=Xu.dot(Xu),h=Xu.dot(L1),p=a*u-o*o;if(p===0)return s.set(0,0,0),null;const v=1/p,y=(u*c-o*h)*v,x=(a*h-o*c)*v;return s.set(1-y-x,x,y)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,Ku)===null?!1:Ku.x>=0&&Ku.y>=0&&Ku.x+Ku.y<=1}static getInterpolation(e,t,n,i,s,a,o,c){return this.getBarycoord(e,t,n,i,Ku)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,Ku.x),c.addScaledVector(a,Ku.y),c.addScaledVector(o,Ku.z),c)}static getInterpolatedAttribute(e,t,n,i,s,a){return O1.setScalar(0),P1.setScalar(0),N1.setScalar(0),O1.fromBufferAttribute(e,t),P1.fromBufferAttribute(e,n),N1.fromBufferAttribute(e,i),a.setScalar(0),a.addScaledVector(O1,s.x),a.addScaledVector(P1,s.y),a.addScaledVector(N1,s.z),a}static isFrontFacing(e,t,n,i){return Ql.subVectors(n,t),Xu.subVectors(e,t),Ql.cross(Xu).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ql.subVectors(this.c,this.b),Xu.subVectors(this.a,this.b),Ql.cross(Xu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ro.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ro.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,s){return ro.getInterpolation(e,this.a,this.b,this.c,t,n,i,s)}containsPoint(e){return ro.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ro.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,s=this.c;let a,o;a0.subVectors(i,n),o0.subVectors(s,n),w1.subVectors(e,n);const c=a0.dot(w1),u=o0.dot(w1);if(c<=0&&u<=0)return t.copy(n);I1.subVectors(e,i);const h=a0.dot(I1),p=o0.dot(I1);if(h>=0&&p<=h)return t.copy(i);const v=c*p-h*u;if(v<=0&&c>=0&&h<=0)return a=c/(c-h),t.copy(n).addScaledVector(a0,a);B1.subVectors(e,s);const y=a0.dot(B1),x=o0.dot(B1);if(x>=0&&y<=x)return t.copy(s);const S=y*u-c*x;if(S<=0&&u>=0&&x<=0)return o=u/(u-x),t.copy(n).addScaledVector(o0,o);const E=h*x-y*p;if(E<=0&&p-h>=0&&y-x>=0)return dI.subVectors(s,i),o=(p-h)/(p-h+(y-x)),t.copy(i).addScaledVector(dI,o);const b=1/(E+S+v);return a=S*b,o=v*b,t.copy(n).addScaledVector(a0,a).addScaledVector(o0,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const fP={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},oh={h:0,s:0,l:0},RS={h:0,s:0,l:0};function U1(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*6*(2/3-t):r}class Ot{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=sr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,hi.colorSpaceToWorking(this,t),this}setRGB(e,t,n,i=hi.workingColorSpace){return this.r=e,this.g=t,this.b=n,hi.colorSpaceToWorking(this,i),this}setHSL(e,t,n,i=hi.workingColorSpace){if(e=QR(e,1),t=An(t,0,1),n=An(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,a=2*n-s;this.r=U1(a,s,e+1/3),this.g=U1(a,s,e),this.b=U1(a,s,e-1/3)}return hi.colorSpaceToWorking(this,i),this}setStyle(e,t=sr){function n(s){s!==void 0&&parseFloat(s)<1&&Ht("Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=i[1],o=i[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:Ht("Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(s,16),t);Ht("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=sr){const n=fP[e.toLowerCase()];return n!==void 0?this.setHex(n,t):Ht("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=uf(e.r),this.g=uf(e.g),this.b=uf(e.b),this}copyLinearToSRGB(e){return this.r=G0(e.r),this.g=G0(e.g),this.b=G0(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=sr){return hi.workingToColorSpace(ta.copy(this),e),Math.round(An(ta.r*255,0,255))*65536+Math.round(An(ta.g*255,0,255))*256+Math.round(An(ta.b*255,0,255))}getHexString(e=sr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=hi.workingColorSpace){hi.workingToColorSpace(ta.copy(this),t);const n=ta.r,i=ta.g,s=ta.b,a=Math.max(n,i,s),o=Math.min(n,i,s);let c,u;const h=(o+a)/2;if(o===a)c=0,u=0;else{const p=a-o;switch(u=h<=.5?p/(a+o):p/(2-a-o),a){case n:c=(i-s)/p+(i<s?6:0);break;case i:c=(s-n)/p+2;break;case s:c=(n-i)/p+4;break}c/=6}return e.h=c,e.s=u,e.l=h,e}getRGB(e,t=hi.workingColorSpace){return hi.workingToColorSpace(ta.copy(this),t),e.r=ta.r,e.g=ta.g,e.b=ta.b,e}getStyle(e=sr){hi.workingToColorSpace(ta.copy(this),e);const t=ta.r,n=ta.g,i=ta.b;return e!==sr?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(e,t,n){return this.getHSL(oh),this.setHSL(oh.h+e,oh.s+t,oh.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(oh),e.getHSL(RS);const n=Gy(oh.h,RS.h,t),i=Gy(oh.s,RS.s,t),s=Gy(oh.l,RS.l,t);return this.setHSL(n,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*i,this.g=s[1]*t+s[4]*n+s[7]*i,this.b=s[2]*t+s[5]*n+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ta=new Ot;Ot.NAMES=fP;let P8=0;class or extends hu{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:P8++}),this.uuid=Fo(),this.name="",this.type="Material",this.blending=vp,this.side=au,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=xE,this.blendDst=_E,this.blendEquation=vh,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ot(0,0,0),this.blendAlpha=0,this.depthFunc=Dp,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=LC,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=np,this.stencilZFail=np,this.stencilZPass=np,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){Ht(`Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){Ht(`Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==vp&&(n.blending=this.blending),this.side!==au&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==xE&&(n.blendSrc=this.blendSrc),this.blendDst!==_E&&(n.blendDst=this.blendDst),this.blendEquation!==vh&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Dp&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==LC&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==np&&(n.stencilFail=this.stencilFail),this.stencilZFail!==np&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==np&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(s){const a=[];for(const o in s){const c=s[o];delete c.metadata,a.push(c)}return a}if(t){const s=i(e.textures),a=i(e.images);s.length>0&&(n.textures=s),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let s=0;s!==i;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class ao extends or{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ot(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ho,this.combine=Nx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const rf=N8();function N8(){const r=new ArrayBuffer(4),e=new Float32Array(r),t=new Uint32Array(r),n=new Uint32Array(512),i=new Uint32Array(512);for(let c=0;c<256;++c){const u=c-127;u<-27?(n[c]=0,n[c|256]=32768,i[c]=24,i[c|256]=24):u<-14?(n[c]=1024>>-u-14,n[c|256]=1024>>-u-14|32768,i[c]=-u-1,i[c|256]=-u-1):u<=15?(n[c]=u+15<<10,n[c|256]=u+15<<10|32768,i[c]=13,i[c|256]=13):u<128?(n[c]=31744,n[c|256]=64512,i[c]=24,i[c|256]=24):(n[c]=31744,n[c|256]=64512,i[c]=13,i[c|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let c=1;c<1024;++c){let u=c<<13,h=0;for(;(u&8388608)===0;)u<<=1,h-=8388608;u&=-8388609,h+=947912704,s[c]=u|h}for(let c=1024;c<2048;++c)s[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)a[c]=c<<23;a[31]=1199570944,a[32]=2147483648;for(let c=33;c<63;++c)a[c]=2147483648+(c-32<<23);a[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(o[c]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:i,mantissaTable:s,exponentTable:a,offsetTable:o}}function eo(r){Math.abs(r)>65504&&Ht("DataUtils.toHalfFloat(): Value out of range."),r=An(r,-65504,65504),rf.floatView[0]=r;const e=rf.uint32View[0],t=e>>23&511;return rf.baseTable[t]+((e&8388607)>>rf.shiftTable[t])}function by(r){const e=r>>10;return rf.uint32View[0]=rf.mantissaTable[rf.offsetTable[e]+(r&1023)]+rf.exponentTable[e],rf.floatView[0]}class fp{static toHalfFloat(e){return eo(e)}static fromHalfFloat(e){return by(e)}}const Vs=new ae,DS=new at;let U8=0;class xi{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:U8++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=ux,this.updateRanges=[],this.gpuType=Ss,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)DS.fromBufferAttribute(this,t),DS.applyMatrix3(e),this.setXY(t,DS.x,DS.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Vs.fromBufferAttribute(this,t),Vs.applyMatrix3(e),this.setXYZ(t,Vs.x,Vs.y,Vs.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Vs.fromBufferAttribute(this,t),Vs.applyMatrix4(e),this.setXYZ(t,Vs.x,Vs.y,Vs.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Vs.fromBufferAttribute(this,t),Vs.applyNormalMatrix(e),this.setXYZ(t,Vs.x,Vs.y,Vs.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Vs.fromBufferAttribute(this,t),Vs.transformDirection(e),this.setXYZ(t,Vs.x,Vs.y,Vs.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Na(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Un(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Na(t,this.array)),t}setX(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Na(t,this.array)),t}setY(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Na(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Na(t,this.array)),t}setW(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),i=Un(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,s){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),i=Un(i,this.array),s=Un(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==ux&&(e.usage=this.usage),e}}class F8 extends xi{constructor(e,t,n){super(new Int8Array(e),t,n)}}class k8 extends xi{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class G8 extends xi{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class H8 extends xi{constructor(e,t,n){super(new Int16Array(e),t,n)}}class eD extends xi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class z8 extends xi{constructor(e,t,n){super(new Int32Array(e),t,n)}}class tD extends xi{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class V8 extends xi{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=by(this.array[e*this.itemSize]);return this.normalized&&(t=Na(t,this.array)),t}setX(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize]=eo(t),this}getY(e){let t=by(this.array[e*this.itemSize+1]);return this.normalized&&(t=Na(t,this.array)),t}setY(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+1]=eo(t),this}getZ(e){let t=by(this.array[e*this.itemSize+2]);return this.normalized&&(t=Na(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+2]=eo(t),this}getW(e){let t=by(this.array[e*this.itemSize+3]);return this.normalized&&(t=Na(t,this.array)),t}setW(e,t){return this.normalized&&(t=Un(t,this.array)),this.array[e*this.itemSize+3]=eo(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array)),this.array[e+0]=eo(t),this.array[e+1]=eo(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),i=Un(i,this.array)),this.array[e+0]=eo(t),this.array[e+1]=eo(n),this.array[e+2]=eo(i),this}setXYZW(e,t,n,i,s){return e*=this.itemSize,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),i=Un(i,this.array),s=Un(s,this.array)),this.array[e+0]=eo(t),this.array[e+1]=eo(n),this.array[e+2]=eo(i),this.array[e+3]=eo(s),this}}class tn extends xi{constructor(e,t,n){super(new Float32Array(e),t,n)}}let Y8=0;const cl=new yn,F1=new pi,l0=new ae,Co=new Fr,ay=new Fr,xr=new ae;class Ln extends hu{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Y8++}),this.uuid=Fo(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(oP(e)?tD:eD)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new Pn().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return cl.makeRotationFromQuaternion(e),this.applyMatrix4(cl),this}rotateX(e){return cl.makeRotationX(e),this.applyMatrix4(cl),this}rotateY(e){return cl.makeRotationY(e),this.applyMatrix4(cl),this}rotateZ(e){return cl.makeRotationZ(e),this.applyMatrix4(cl),this}translate(e,t,n){return cl.makeTranslation(e,t,n),this.applyMatrix4(cl),this}scale(e,t,n){return cl.makeScale(e,t,n),this.applyMatrix4(cl),this}lookAt(e){return F1.lookAt(e),F1.updateMatrix(),this.applyMatrix4(F1.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(l0).negate(),this.translate(l0.x,l0.y,l0.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let i=0,s=e.length;i<s;i++){const a=e[i];n.push(a.x,a.y,a.z||0)}this.setAttribute("position",new tn(n,3))}else{const n=Math.min(e.length,t.count);for(let i=0;i<n;i++){const s=e[i];t.setXYZ(i,s.x,s.y,s.z||0)}e.length>t.count&&Ht("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Fr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){Cn("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new ae(-1/0,-1/0,-1/0),new ae(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const s=t[n];Co.setFromBufferAttribute(s),this.morphTargetsRelative?(xr.addVectors(this.boundingBox.min,Co.min),this.boundingBox.expandByPoint(xr),xr.addVectors(this.boundingBox.max,Co.max),this.boundingBox.expandByPoint(xr)):(this.boundingBox.expandByPoint(Co.min),this.boundingBox.expandByPoint(Co.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&Cn('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Mr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){Cn("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new ae,1/0);return}if(e){const n=this.boundingSphere.center;if(Co.setFromBufferAttribute(e),t)for(let s=0,a=t.length;s<a;s++){const o=t[s];ay.setFromBufferAttribute(o),this.morphTargetsRelative?(xr.addVectors(Co.min,ay.min),Co.expandByPoint(xr),xr.addVectors(Co.max,ay.max),Co.expandByPoint(xr)):(Co.expandByPoint(ay.min),Co.expandByPoint(ay.max))}Co.getCenter(n);let i=0;for(let s=0,a=e.count;s<a;s++)xr.fromBufferAttribute(e,s),i=Math.max(i,n.distanceToSquared(xr));if(t)for(let s=0,a=t.length;s<a;s++){const o=t[s],c=this.morphTargetsRelative;for(let u=0,h=o.count;u<h;u++)xr.fromBufferAttribute(o,u),c&&(l0.fromBufferAttribute(e,u),xr.add(l0)),i=Math.max(i,n.distanceToSquared(xr))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&Cn('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){Cn("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,i=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new xi(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),o=[],c=[];for(let U=0;U<n.count;U++)o[U]=new ae,c[U]=new ae;const u=new ae,h=new ae,p=new ae,v=new at,y=new at,x=new at,S=new ae,E=new ae;function b(U,B,I){u.fromBufferAttribute(n,U),h.fromBufferAttribute(n,B),p.fromBufferAttribute(n,I),v.fromBufferAttribute(s,U),y.fromBufferAttribute(s,B),x.fromBufferAttribute(s,I),h.sub(u),p.sub(u),y.sub(v),x.sub(v);const z=1/(y.x*x.y-x.x*y.y);isFinite(z)&&(S.copy(h).multiplyScalar(x.y).addScaledVector(p,-y.y).multiplyScalar(z),E.copy(p).multiplyScalar(y.x).addScaledVector(h,-x.x).multiplyScalar(z),o[U].add(S),o[B].add(S),o[I].add(S),c[U].add(E),c[B].add(E),c[I].add(E))}let T=this.groups;T.length===0&&(T=[{start:0,count:e.count}]);for(let U=0,B=T.length;U<B;++U){const I=T[U],z=I.start,W=I.count;for(let Z=z,te=z+W;Z<te;Z+=3)b(e.getX(Z+0),e.getX(Z+1),e.getX(Z+2))}const R=new ae,D=new ae,P=new ae,O=new ae;function N(U){P.fromBufferAttribute(i,U),O.copy(P);const B=o[U];R.copy(B),R.sub(P.multiplyScalar(P.dot(B))).normalize(),D.crossVectors(O,B);const z=D.dot(c[U])<0?-1:1;a.setXYZW(U,R.x,R.y,R.z,z)}for(let U=0,B=T.length;U<B;++U){const I=T[U],z=I.start,W=I.count;for(let Z=z,te=z+W;Z<te;Z+=3)N(e.getX(Z+0)),N(e.getX(Z+1)),N(e.getX(Z+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new xi(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let v=0,y=n.count;v<y;v++)n.setXYZ(v,0,0,0);const i=new ae,s=new ae,a=new ae,o=new ae,c=new ae,u=new ae,h=new ae,p=new ae;if(e)for(let v=0,y=e.count;v<y;v+=3){const x=e.getX(v+0),S=e.getX(v+1),E=e.getX(v+2);i.fromBufferAttribute(t,x),s.fromBufferAttribute(t,S),a.fromBufferAttribute(t,E),h.subVectors(a,s),p.subVectors(i,s),h.cross(p),o.fromBufferAttribute(n,x),c.fromBufferAttribute(n,S),u.fromBufferAttribute(n,E),o.add(h),c.add(h),u.add(h),n.setXYZ(x,o.x,o.y,o.z),n.setXYZ(S,c.x,c.y,c.z),n.setXYZ(E,u.x,u.y,u.z)}else for(let v=0,y=t.count;v<y;v+=3)i.fromBufferAttribute(t,v+0),s.fromBufferAttribute(t,v+1),a.fromBufferAttribute(t,v+2),h.subVectors(a,s),p.subVectors(i,s),h.cross(p),n.setXYZ(v+0,h.x,h.y,h.z),n.setXYZ(v+1,h.x,h.y,h.z),n.setXYZ(v+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)xr.fromBufferAttribute(e,t),xr.normalize(),e.setXYZ(t,xr.x,xr.y,xr.z)}toNonIndexed(){function e(o,c){const u=o.array,h=o.itemSize,p=o.normalized,v=new u.constructor(c.length*h);let y=0,x=0;for(let S=0,E=c.length;S<E;S++){o.isInterleavedBufferAttribute?y=c[S]*o.data.stride+o.offset:y=c[S]*h;for(let b=0;b<h;b++)v[x++]=u[y++]}return new xi(v,h,p)}if(this.index===null)return Ht("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Ln,n=this.index.array,i=this.attributes;for(const o in i){const c=i[o],u=e(c,n);t.setAttribute(o,u)}const s=this.morphAttributes;for(const o in s){const c=[],u=s[o];for(let h=0,p=u.length;h<p;h++){const v=u[h],y=e(v,n);c.push(y)}t.morphAttributes[o]=c}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,c=a.length;o<c;o++){const u=a[o];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const u in c)c[u]!==void 0&&(e[u]=c[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const c in n){const u=n[c];e.data.attributes[c]=u.toJSON(e.data)}const i={};let s=!1;for(const c in this.morphAttributes){const u=this.morphAttributes[c],h=[];for(let p=0,v=u.length;p<v;p++){const y=u[p];h.push(y.toJSON(e.data))}h.length>0&&(i[c]=h,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere=o.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const i=e.attributes;for(const u in i){const h=i[u];this.setAttribute(u,h.clone(t))}const s=e.morphAttributes;for(const u in s){const h=[],p=s[u];for(let v=0,y=p.length;v<y;v++)h.push(p[v].clone(t));this.morphAttributes[u]=h}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let u=0,h=a.length;u<h;u++){const p=a[u];this.addGroup(p.start,p.count,p.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const pI=new yn,Ud=new zp,LS=new Mr,mI=new ae,wS=new ae,IS=new ae,BS=new ae,k1=new ae,OS=new ae,gI=new ae,PS=new ae;class As extends pi{constructor(e=new Ln,t=new ao){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,s=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const o=this.morphTargetInfluences;if(s&&o){OS.set(0,0,0);for(let c=0,u=s.length;c<u;c++){const h=o[c],p=s[c];h!==0&&(k1.fromBufferAttribute(p,e),a?OS.addScaledVector(k1,h):OS.addScaledVector(k1.sub(t),h))}t.add(OS)}return t}raycast(e,t){const n=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),LS.copy(n.boundingSphere),LS.applyMatrix4(s),Ud.copy(e.ray).recast(e.near),!(LS.containsPoint(Ud.origin)===!1&&(Ud.intersectSphere(LS,mI)===null||Ud.origin.distanceToSquared(mI)>(e.far-e.near)**2))&&(pI.copy(s).invert(),Ud.copy(e.ray).applyMatrix4(pI),!(n.boundingBox!==null&&Ud.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,Ud)))}_computeIntersections(e,t,n){let i;const s=this.geometry,a=this.material,o=s.index,c=s.attributes.position,u=s.attributes.uv,h=s.attributes.uv1,p=s.attributes.normal,v=s.groups,y=s.drawRange;if(o!==null)if(Array.isArray(a))for(let x=0,S=v.length;x<S;x++){const E=v[x],b=a[E.materialIndex],T=Math.max(E.start,y.start),R=Math.min(o.count,Math.min(E.start+E.count,y.start+y.count));for(let D=T,P=R;D<P;D+=3){const O=o.getX(D),N=o.getX(D+1),U=o.getX(D+2);i=NS(this,b,e,n,u,h,p,O,N,U),i&&(i.faceIndex=Math.floor(D/3),i.face.materialIndex=E.materialIndex,t.push(i))}}else{const x=Math.max(0,y.start),S=Math.min(o.count,y.start+y.count);for(let E=x,b=S;E<b;E+=3){const T=o.getX(E),R=o.getX(E+1),D=o.getX(E+2);i=NS(this,a,e,n,u,h,p,T,R,D),i&&(i.faceIndex=Math.floor(E/3),t.push(i))}}else if(c!==void 0)if(Array.isArray(a))for(let x=0,S=v.length;x<S;x++){const E=v[x],b=a[E.materialIndex],T=Math.max(E.start,y.start),R=Math.min(c.count,Math.min(E.start+E.count,y.start+y.count));for(let D=T,P=R;D<P;D+=3){const O=D,N=D+1,U=D+2;i=NS(this,b,e,n,u,h,p,O,N,U),i&&(i.faceIndex=Math.floor(D/3),i.face.materialIndex=E.materialIndex,t.push(i))}}else{const x=Math.max(0,y.start),S=Math.min(c.count,y.start+y.count);for(let E=x,b=S;E<b;E+=3){const T=E,R=E+1,D=E+2;i=NS(this,a,e,n,u,h,p,T,R,D),i&&(i.faceIndex=Math.floor(E/3),t.push(i))}}}}function X8(r,e,t,n,i,s,a,o){let c;if(e.side===Ga?c=n.intersectTriangle(a,s,i,!0,o):c=n.intersectTriangle(i,s,a,e.side===au,o),c===null)return null;PS.copy(o),PS.applyMatrix4(r.matrixWorld);const u=t.ray.origin.distanceTo(PS);return u<t.near||u>t.far?null:{distance:u,point:PS.clone(),object:r}}function NS(r,e,t,n,i,s,a,o,c,u){r.getVertexPosition(o,wS),r.getVertexPosition(c,IS),r.getVertexPosition(u,BS);const h=X8(r,e,t,n,wS,IS,BS,gI);if(h){const p=new ae;ro.getBarycoord(gI,wS,IS,BS,p),i&&(h.uv=ro.getInterpolatedAttribute(i,o,c,u,p,new at)),s&&(h.uv1=ro.getInterpolatedAttribute(s,o,c,u,p,new at)),a&&(h.normal=ro.getInterpolatedAttribute(a,o,c,u,p,new ae),h.normal.dot(n.direction)>0&&h.normal.multiplyScalar(-1));const v={a:o,b:c,c:u,normal:new ae,materialIndex:0};ro.getNormal(wS,IS,BS,v.normal),h.face=v,h.barycoord=p}return h}class Vp extends Ln{constructor(e=1,t=1,n=1,i=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:s,depthSegments:a};const o=this;i=Math.floor(i),s=Math.floor(s),a=Math.floor(a);const c=[],u=[],h=[],p=[];let v=0,y=0;x("z","y","x",-1,-1,n,t,e,a,s,0),x("z","y","x",1,-1,n,t,-e,a,s,1),x("x","z","y",1,1,e,n,t,i,a,2),x("x","z","y",1,-1,e,n,-t,i,a,3),x("x","y","z",1,-1,e,t,n,i,s,4),x("x","y","z",-1,-1,e,t,-n,i,s,5),this.setIndex(c),this.setAttribute("position",new tn(u,3)),this.setAttribute("normal",new tn(h,3)),this.setAttribute("uv",new tn(p,2));function x(S,E,b,T,R,D,P,O,N,U,B){const I=D/N,z=P/U,W=D/2,Z=P/2,te=O/2,re=N+1,k=U+1;let j=0,J=0;const oe=new ae;for(let K=0;K<k;K++){const X=K*z-Z;for(let ne=0;ne<re;ne++){const xe=ne*I-W;oe[S]=xe*T,oe[E]=X*R,oe[b]=te,u.push(oe.x,oe.y,oe.z),oe[S]=0,oe[E]=0,oe[b]=O>0?1:-1,h.push(oe.x,oe.y,oe.z),p.push(ne/N),p.push(1-K/U),j+=1}}for(let K=0;K<U;K++)for(let X=0;X<N;X++){const ne=v+X+re*K,xe=v+X+re*(K+1),_e=v+(X+1)+re*(K+1),Be=v+(X+1)+re*K;c.push(ne,xe,Be),c.push(xe,_e,Be),J+=6}o.addGroup(y,J,B),y+=J,v+=j}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Vp(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function ug(r){const e={};for(const t in r){e[t]={};for(const n in r[t]){const i=r[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(Ht("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function La(r){const e={};for(let t=0;t<r.length;t++){const n=ug(r[t]);for(const i in n)e[i]=n[i]}return e}function K8(r){const e=[];for(let t=0;t<r.length;t++)e.push(r[t].clone());return e}function hP(r){const e=r.getRenderTarget();return e===null?r.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:hi.workingColorSpace}const dP={clone:ug,merge:La};var q8=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,j8=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class za extends or{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=q8,this.fragmentShader=j8,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ug(e.uniforms),this.uniformsGroups=K8(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const a=this.uniforms[i].value;a&&a.isTexture?t.uniforms[i]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[i]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[i]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[i]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[i]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[i]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[i]={type:"m4",value:a.toArray()}:t.uniforms[i]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class jb extends pi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new yn,this.projectionMatrix=new yn,this.projectionMatrixInverse=new yn,this.coordinateSystem=No,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const lh=new ae,vI=new at,yI=new at;class cs extends jb{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=lg*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(yp*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return lg*2*Math.atan(Math.tan(yp*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){lh.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(lh.x,lh.y).multiplyScalar(-e/lh.z),lh.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(lh.x,lh.y).multiplyScalar(-e/lh.z)}getViewSize(e,t){return this.getViewBounds(e,vI,yI),t.subVectors(yI,vI)}setViewOffset(e,t,n,i,s,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(yp*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,s=-.5*i;const a=this.view;if(this.view!==null&&this.view.enabled){const c=a.fullWidth,u=a.fullHeight;s+=a.offsetX*i/c,t-=a.offsetY*n/u,i*=a.width/c,n*=a.height/u}const o=this.filmOffset;o!==0&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const c0=-90,u0=1;class pP extends pi{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new cs(c0,u0,e,t);i.layers=this.layers,this.add(i);const s=new cs(c0,u0,e,t);s.layers=this.layers,this.add(s);const a=new cs(c0,u0,e,t);a.layers=this.layers,this.add(a);const o=new cs(c0,u0,e,t);o.layers=this.layers,this.add(o);const c=new cs(c0,u0,e,t);c.layers=this.layers,this.add(c);const u=new cs(c0,u0,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,s,a,o,c]=t;for(const u of t)this.remove(u);if(e===No)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===ag)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,c,u,h]=this.children,p=e.getRenderTarget(),v=e.getActiveCubeFace(),y=e.getActiveMipmapLevel(),x=e.xr.enabled;e.xr.enabled=!1;const S=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,s),e.setRenderTarget(n,1,i),e.render(t,a),e.setRenderTarget(n,2,i),e.render(t,o),e.setRenderTarget(n,3,i),e.render(t,c),e.setRenderTarget(n,4,i),e.render(t,u),n.texture.generateMipmaps=S,e.setRenderTarget(n,5,i),e.render(t,h),e.setRenderTarget(p,v,y),e.xr.enabled=x,n.texture.needsPMREMUpdate=!0}}class Gx extends Ti{constructor(e=[],t=ou,n,i,s,a,o,c,u,h){super(e,t,n,i,s,a,o,c,u,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class nD extends Al{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new Gx(i),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Vp(5,5,5),s=new za({name:"CubemapFromEquirect",uniforms:ug(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Ga,blending:lc});s.uniforms.tEquirect.value=t;const a=new As(i,s),o=t.minFilter;return t.minFilter===ml&&(t.minFilter=yi),new pP(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,n=!0,i=!0){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,i);e.setRenderTarget(s)}}class lf extends pi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const W8={type:"move"};class ZA{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new lf,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new lf,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ae,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ae),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new lf,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ae,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ae),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,s=null,a=null;const o=this._targetRay,c=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){a=!0;for(const S of e.hand.values()){const E=t.getJointPose(S,n),b=this._getHandJoint(u,S);E!==null&&(b.matrix.fromArray(E.transform.matrix),b.matrix.decompose(b.position,b.rotation,b.scale),b.matrixWorldNeedsUpdate=!0,b.jointRadius=E.radius),b.visible=E!==null}const h=u.joints["index-finger-tip"],p=u.joints["thumb-tip"],v=h.position.distanceTo(p.position),y=.02,x=.005;u.inputState.pinching&&v>y+x?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&v<=y-x&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));o!==null&&(i=t.getPose(e.targetRaySpace,n),i===null&&s!==null&&(i=s),i!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(W8)))}return o!==null&&(o.visible=i!==null),c!==null&&(c.visible=s!==null),u!==null&&(u.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new lf;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Wb{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Ot(e),this.density=t}clone(){return new Wb(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Jb{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Ot(e),this.near=t,this.far=n}clone(){return new Jb(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Hx extends pi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Ho,this.environmentIntensity=1,this.environmentRotation=new Ho,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class zx{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=ux,this.updateRanges=[],this.version=0,this.uuid=Fo()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,s=this.stride;i<s;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Fo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Fo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ca=new ae;class Oh{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Ca.fromBufferAttribute(this,t),Ca.applyMatrix4(e),this.setXYZ(t,Ca.x,Ca.y,Ca.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ca.fromBufferAttribute(this,t),Ca.applyNormalMatrix(e),this.setXYZ(t,Ca.x,Ca.y,Ca.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ca.fromBufferAttribute(this,t),Ca.transformDirection(e),this.setXYZ(t,Ca.x,Ca.y,Ca.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=Na(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Un(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=Un(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Un(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Un(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Un(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Na(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Na(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Na(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Na(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),i=Un(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Un(t,this.array),n=Un(n,this.array),i=Un(i,this.array),s=Un(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=s,this}clone(e){if(e===void 0){hx("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return new xi(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Oh(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){hx("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class iD extends or{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ot(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let f0;const oy=new ae,h0=new ae,d0=new ae,p0=new at,ly=new at,mP=new yn,US=new ae,cy=new ae,FS=new ae,xI=new at,G1=new at,_I=new at;class gP extends pi{constructor(e=new iD){if(super(),this.isSprite=!0,this.type="Sprite",f0===void 0){f0=new Ln;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new zx(t,5);f0.setIndex([0,1,2,0,2,3]),f0.setAttribute("position",new Oh(n,3,0,!1)),f0.setAttribute("uv",new Oh(n,2,3,!1))}this.geometry=f0,this.material=e,this.center=new at(.5,.5),this.count=1}raycast(e,t){e.camera===null&&Cn('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),h0.setFromMatrixScale(this.matrixWorld),mP.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),d0.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&h0.multiplyScalar(-d0.z);const n=this.material.rotation;let i,s;n!==0&&(s=Math.cos(n),i=Math.sin(n));const a=this.center;kS(US.set(-.5,-.5,0),d0,a,h0,i,s),kS(cy.set(.5,-.5,0),d0,a,h0,i,s),kS(FS.set(.5,.5,0),d0,a,h0,i,s),xI.set(0,0),G1.set(1,0),_I.set(1,1);let o=e.ray.intersectTriangle(US,cy,FS,!1,oy);if(o===null&&(kS(cy.set(-.5,.5,0),d0,a,h0,i,s),G1.set(0,1),o=e.ray.intersectTriangle(US,FS,cy,!1,oy),o===null))return;const c=e.ray.origin.distanceTo(oy);c<e.near||c>e.far||t.push({distance:c,point:oy.clone(),uv:ro.getInterpolation(oy,US,cy,FS,xI,G1,_I,new at),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function kS(r,e,t,n,i,s){p0.subVectors(r,t).addScalar(.5).multiply(n),i!==void 0?(ly.x=s*p0.x-i*p0.y,ly.y=i*p0.x+s*p0.y):ly.copy(p0),r.copy(e),r.x+=ly.x,r.y+=ly.y,r.applyMatrix4(mP)}const GS=new ae,SI=new ae;class vP extends pi{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const s=t[n];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const i=this.levels;let s;for(s=0;s<i.length&&!(t<i[s].distance);s++);return i.splice(s,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const i=t.splice(n,1);return this.remove(i[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i;n++){let s=t[n].distance;if(t[n].object.visible&&(s-=s*t[n].hysteresis),e<s)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){GS.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(GS);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){GS.setFromMatrixPosition(e.matrixWorld),SI.setFromMatrixPosition(this.matrixWorld);const n=GS.distanceTo(SI)/e.zoom;t[0].object.visible=!0;let i,s;for(i=1,s=t.length;i<s;i++){let a=t[i].distance;if(t[i].object.visible&&(a-=a*t[i].hysteresis),n>=a)t[i-1].object.visible=!1,t[i].object.visible=!0;else break}for(this._currentLevel=i-1;i<s;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,s=n.length;i<s;i++){const a=n[i];t.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return t}}const AI=new ae,EI=new vi,bI=new vi,J8=new ae,TI=new yn,HS=new ae,H1=new Mr,MI=new yn,z1=new zp;class sD extends As{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=RC,this.bindMatrix=new yn,this.bindMatrixInverse=new yn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Fr),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,HS),this.boundingBox.expandByPoint(HS)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Mr),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,HS),this.boundingSphere.expandByPoint(HS)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),H1.copy(this.boundingSphere),H1.applyMatrix4(i),e.ray.intersectsSphere(H1)!==!1&&(MI.copy(i).invert(),z1.copy(e.ray).applyMatrix4(MI),!(this.boundingBox!==null&&z1.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,z1)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new vi,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===RC?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===KO?this.bindMatrixInverse.copy(this.bindMatrix).invert():Ht("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;EI.fromBufferAttribute(i.attributes.skinIndex,e),bI.fromBufferAttribute(i.attributes.skinWeight,e),AI.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const a=bI.getComponent(s);if(a!==0){const o=EI.getComponent(s);TI.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(J8.copy(AI).applyMatrix4(TI),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}class $b extends pi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class xl extends Ti{constructor(e=null,t=1,n=1,i,s,a,o,c,u=br,h=br,p,v){super(null,a,o,c,u,h,i,s,p,v),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const CI=new yn,$8=new yn;class Vx{constructor(e=[],t=[]){this.uuid=Fo(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){Ht("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new yn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new yn;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let s=0,a=e.length;s<a;s++){const o=e[s]?e[s].matrixWorld:$8;CI.multiplyMatrices(o,t[s]),CI.toArray(n,s*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new Vx(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new xl(t,e,e,Ns,Ss);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const s=e.bones[n];let a=t[s];a===void 0&&(Ht("Skeleton: No bone found with UUID:",s),a=new $b),this.bones.push(a),this.boneInverses.push(new yn().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,s=t.length;i<s;i++){const a=t[i];e.bones.push(a.uuid);const o=n[i];e.boneInverses.push(o.toArray())}return e}}class Lp extends xi{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const m0=new yn,RI=new yn,zS=[],DI=new Fr,Q8=new yn,uy=new As,fy=new Mr;class rD extends As{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Lp(new Float32Array(n*16),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,Q8)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Fr),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,m0),DI.copy(e.boundingBox).applyMatrix4(m0),this.boundingBox.union(DI)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Mr),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,m0),fy.copy(e.boundingSphere).applyMatrix4(m0),this.boundingSphere.union(fy)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const n=t.morphTargetInfluences,i=this.morphTexture.source.data.data,s=n.length+1,a=e*s+1;for(let o=0;o<n.length;o++)n[o]=i[a+o]}raycast(e,t){const n=this.matrixWorld,i=this.count;if(uy.geometry=this.geometry,uy.material=this.material,uy.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),fy.copy(this.boundingSphere),fy.applyMatrix4(n),e.ray.intersectsSphere(fy)!==!1))for(let s=0;s<i;s++){this.getMatrixAt(s,m0),RI.multiplyMatrices(n,m0),uy.matrixWorld=RI,uy.raycast(e,zS);for(let a=0,o=zS.length;a<o;a++){const c=zS[a];c.instanceId=s,c.object=this,t.push(c)}zS.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Lp(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const n=t.morphTargetInfluences,i=n.length+1;this.morphTexture===null&&(this.morphTexture=new xl(new Float32Array(i*this.count),i,this.count,Fx,Ss));const s=this.morphTexture.source.data.data;let a=0;for(let u=0;u<n.length;u++)a+=n[u];const o=this.geometry.morphTargetsRelative?1:1-a,c=i*e;s[c]=o,s.set(n,c+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const V1=new ae,Z8=new ae,eH=new Pn;class tf{constructor(e=new ae(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=V1.subVectors(n,t).cross(Z8.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(V1),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||eH.getNormalMatrix(e),i=this.coplanarPoint(V1).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Fd=new Mr,tH=new at(.5,.5),VS=new ae;class Cg{constructor(e=new tf,t=new tf,n=new tf,i=new tf,s=new tf,a=new tf){this.planes=[e,t,n,i,s,a]}set(e,t,n,i,s,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(s),o[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=No,n=!1){const i=this.planes,s=e.elements,a=s[0],o=s[1],c=s[2],u=s[3],h=s[4],p=s[5],v=s[6],y=s[7],x=s[8],S=s[9],E=s[10],b=s[11],T=s[12],R=s[13],D=s[14],P=s[15];if(i[0].setComponents(u-a,y-h,b-x,P-T).normalize(),i[1].setComponents(u+a,y+h,b+x,P+T).normalize(),i[2].setComponents(u+o,y+p,b+S,P+R).normalize(),i[3].setComponents(u-o,y-p,b-S,P-R).normalize(),n)i[4].setComponents(c,v,E,D).normalize(),i[5].setComponents(u-c,y-v,b-E,P-D).normalize();else if(i[4].setComponents(u-c,y-v,b-E,P-D).normalize(),t===No)i[5].setComponents(u+c,y+v,b+E,P+D).normalize();else if(t===ag)i[5].setComponents(c,v,E,D).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Fd.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Fd.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Fd)}intersectsSprite(e){Fd.center.set(0,0,0);const t=tH.distanceTo(e.center);return Fd.radius=.7071067811865476+t,Fd.applyMatrix4(e.matrixWorld),this.intersectsSphere(Fd)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(VS.x=i.normal.x>0?e.max.x:e.min.x,VS.y=i.normal.y>0?e.max.y:e.min.y,VS.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(VS)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const Xc=new yn,Kc=new Cg;class Qb{constructor(){this.coordinateSystem=No}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(Xc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Kc.setFromProjectionMatrix(Xc,i.coordinateSystem,i.reversedDepth),Kc.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(Xc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Kc.setFromProjectionMatrix(Xc,i.coordinateSystem,i.reversedDepth),Kc.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(Xc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Kc.setFromProjectionMatrix(Xc,i.coordinateSystem,i.reversedDepth),Kc.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(Xc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Kc.setFromProjectionMatrix(Xc,i.coordinateSystem,i.reversedDepth),Kc.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(Xc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Kc.setFromProjectionMatrix(Xc,i.coordinateSystem,i.reversedDepth),Kc.containsPoint(e))return!0}return!1}clone(){return new Qb}}function Y1(r,e){return r-e}function nH(r,e){return r.z-e.z}function iH(r,e){return e.z-r.z}class sH{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,i){const s=this.pool,a=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const o=s[this.index];a.push(o),this.index++,o.start=e,o.count=t,o.z=n,o.index=i}reset(){this.list.length=0,this.index=0}}const Qa=new yn,rH=new Ot(1,1,1),LI=new Cg,aH=new Qb,YS=new Fr,kd=new Mr,hy=new ae,wI=new ae,oH=new ae,X1=new sH,na=new As,XS=[];function lH(r,e,t=0){const n=e.itemSize;if(r.isInterleavedBufferAttribute||r.array.constructor!==e.array.constructor){const i=r.count;for(let s=0;s<i;s++)for(let a=0;a<n;a++)e.setComponent(s+t,a,r.getComponent(s,a))}else e.array.set(r.array,t*n);e.needsUpdate=!0}function Gd(r,e){if(r.constructor!==e.constructor){const t=Math.min(r.length,e.length);for(let n=0;n<t;n++)e[n]=r[n]}else{const t=Math.min(r.length,e.length);e.set(new r.constructor(r.buffer,0,t))}}class yP extends As{constructor(e,t,n=t*2,i){super(new Ln,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new xl(t,e,e,Ns,Ss);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new xl(t,e,e,kx,lu);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new xl(t,e,e,Ns,Ss);n.colorSpace=hi.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,i=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in e.attributes){const a=e.getAttribute(s),{array:o,itemSize:c,normalized:u}=a,h=new o.constructor(n*c),p=new xi(h,c,u);t.setAttribute(s,p)}if(e.getIndex()!==null){const s=n>65535?new Uint32Array(i):new Uint16Array(i);t.setIndex(new xi(s,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const i=e.getAttribute(n),s=t.getAttribute(n);if(i.itemSize!==s.itemSize||i.normalized!==s.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Fr);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(t[n].active===!1)continue;const s=t[n].geometryIndex;this.getMatrixAt(n,Qa),this.getBoundingBoxAt(s,YS).applyMatrix4(Qa),e.union(YS)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Mr);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(t[n].active===!1)continue;const s=t[n].geometryIndex;this.getMatrixAt(n,Qa),this.getBoundingSphereAt(s,kd).applyMatrix4(Qa),e.union(kd)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const n={visible:!0,active:!0,geometryIndex:e};let i=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(Y1),i=this._availableInstanceIds.shift(),this._instanceInfo[i]=n):(i=this._instanceInfo.length,this._instanceInfo.push(n));const s=this._matricesTexture;Qa.identity().toArray(s.image.data,i*16),s.needsUpdate=!0;const a=this._colorsTexture;return a&&(rH.toArray(a.image.data,i*4),a.needsUpdate=!0),this._visibilityChanged=!0,i}addGeometry(e,t=-1,n=-1){this._initializeGeometry(e),this._validateGeometry(e);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const a=e.getIndex();if(a!==null&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=n===-1?a.count:n),i.indexStart!==-1&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let c;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(Y1),c=this._availableGeometryIds.shift(),s[c]=i):(c=this._geometryCount,this._geometryCount++,s.push(i)),this.setGeometryAt(c,e),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,c}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,i=n.getIndex()!==null,s=n.getIndex(),a=t.getIndex(),o=this._geometryInfo[e];if(i&&a.count>o.reservedIndexCount||t.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const c=o.vertexStart,u=o.reservedVertexCount;o.vertexCount=t.getAttribute("position").count;for(const h in n.attributes){const p=t.getAttribute(h),v=n.getAttribute(h);lH(p,v,c);const y=p.itemSize;for(let x=p.count,S=u;x<S;x++){const E=c+x;for(let b=0;b<y;b++)v.setComponent(E,b,0)}v.needsUpdate=!0,v.addUpdateRange(c*y,u*y)}if(i){const h=o.indexStart,p=o.reservedIndexCount;o.indexCount=t.getIndex().count;for(let v=0;v<a.count;v++)s.setX(h+v,c+a.getX(v));for(let v=a.count,y=p;v<y;v++)s.setX(h+v,c);s.needsUpdate=!0,s.addUpdateRange(h,o.reservedIndexCount)}return o.start=i?o.indexStart:o.vertexStart,o.count=i?o.indexCount:o.vertexCount,o.boundingBox=null,t.boundingBox!==null&&(o.boundingBox=t.boundingBox.clone()),o.boundingSphere=null,t.boundingSphere!==null&&(o.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||t[e].active===!1)return this;const n=this._instanceInfo;for(let i=0,s=n.length;i<s;i++)n[i].active&&n[i].geometryIndex===e&&this.deleteInstance(i);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,i=n.map((a,o)=>o).sort((a,o)=>n[a].vertexStart-n[o].vertexStart),s=this.geometry;for(let a=0,o=n.length;a<o;a++){const c=i[a],u=n[c];if(u.active!==!1){if(s.index!==null){if(u.indexStart!==t){const{indexStart:h,vertexStart:p,reservedIndexCount:v}=u,y=s.index,x=y.array,S=e-p;for(let E=h;E<h+v;E++)x[E]=x[E]+S;y.array.copyWithin(t,h,h+v),y.addUpdateRange(t,v),u.indexStart=t}t+=u.reservedIndexCount}if(u.vertexStart!==e){const{vertexStart:h,reservedVertexCount:p}=u,v=s.attributes;for(const y in v){const x=v[y],{array:S,itemSize:E}=x;S.copyWithin(e*E,h*E,(h+p)*E),x.addUpdateRange(e*E,p*E)}u.vertexStart=e}e+=u.reservedVertexCount,u.start=s.index?u.indexStart:u.vertexStart,this._nextIndexStart=s.index?u.indexStart+u.reservedIndexCount:0,this._nextVertexStart=u.vertexStart+u.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(i.boundingBox===null){const s=new Fr,a=n.index,o=n.attributes.position;for(let c=i.start,u=i.start+i.count;c<u;c++){let h=c;a&&(h=a.getX(h)),s.expandByPoint(hy.fromBufferAttribute(o,h))}i.boundingBox=s}return t.copy(i.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(i.boundingSphere===null){const s=new Mr;this.getBoundingBoxAt(e,YS),YS.getCenter(s.center);const a=n.index,o=n.attributes.position;let c=0;for(let u=i.start,h=i.start+i.count;u<h;u++){let p=u;a&&(p=a.getX(p)),hy.fromBufferAttribute(o,p),c=Math.max(c,s.center.distanceToSquared(hy))}s.radius=Math.sqrt(c),i.boundingSphere=s}return t.copy(i.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,i=this._matricesTexture.image.data;return t.toArray(i,e*16),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,t){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t?this:(this._instanceInfo[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(Y1);t[t.length-1]===n.length-1;)n.pop(),t.pop();if(e<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const i=new Int32Array(e),s=new Int32Array(e);Gd(this._multiDrawCounts,i),Gd(this._multiDrawStarts,s),this._multiDrawCounts=i,this._multiDrawStarts=s,this._maxInstanceCount=e;const a=this._indirectTexture,o=this._matricesTexture,c=this._colorsTexture;a.dispose(),this._initIndirectTexture(),Gd(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),Gd(o.image.data,this._matricesTexture.image.data),c&&(c.dispose(),this._initColorsTexture(),Gd(c.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter(o=>o.active);if(Math.max(...n.map(o=>o.vertexStart+o.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...n.map(c=>c.indexStart+c.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Ln,this._initializeGeometry(s));const a=this.geometry;s.index&&Gd(s.index.array,a.index.array);for(const o in s.attributes)Gd(s.attributes[o].array,a.attributes[o].array)}raycast(e,t){const n=this._instanceInfo,i=this._geometryInfo,s=this.matrixWorld,a=this.geometry;na.material=this.material,na.geometry.index=a.index,na.geometry.attributes=a.attributes,na.geometry.boundingBox===null&&(na.geometry.boundingBox=new Fr),na.geometry.boundingSphere===null&&(na.geometry.boundingSphere=new Mr);for(let o=0,c=n.length;o<c;o++){if(!n[o].visible||!n[o].active)continue;const u=n[o].geometryIndex,h=i[u];na.geometry.setDrawRange(h.start,h.count),this.getMatrixAt(o,na.matrixWorld).premultiply(s),this.getBoundingBoxAt(u,na.geometry.boundingBox),this.getBoundingSphereAt(u,na.geometry.boundingSphere),na.raycast(e,XS);for(let p=0,v=XS.length;p<v;p++){const y=XS[p];y.object=this,y.batchId=o,t.push(y)}XS.length=0}na.material=null,na.geometry.index=null,na.geometry.attributes={},na.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(t=>({...t})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,n,i,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=i.getIndex(),o=a===null?1:a.array.BYTES_PER_ELEMENT,c=this._instanceInfo,u=this._multiDrawStarts,h=this._multiDrawCounts,p=this._geometryInfo,v=this.perObjectFrustumCulled,y=this._indirectTexture,x=y.image.data,S=n.isArrayCamera?aH:LI;v&&!n.isArrayCamera&&(Qa.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),LI.setFromProjectionMatrix(Qa,n.coordinateSystem,n.reversedDepth));let E=0;if(this.sortObjects){Qa.copy(this.matrixWorld).invert(),hy.setFromMatrixPosition(n.matrixWorld).applyMatrix4(Qa),wI.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(Qa);for(let R=0,D=c.length;R<D;R++)if(c[R].visible&&c[R].active){const P=c[R].geometryIndex;this.getMatrixAt(R,Qa),this.getBoundingSphereAt(P,kd).applyMatrix4(Qa);let O=!1;if(v&&(O=!S.intersectsSphere(kd,n)),!O){const N=p[P],U=oH.subVectors(kd.center,hy).dot(wI);X1.push(N.start,N.count,U,R)}}const b=X1.list,T=this.customSort;T===null?b.sort(s.transparent?iH:nH):T.call(this,b,n);for(let R=0,D=b.length;R<D;R++){const P=b[R];u[E]=P.start*o,h[E]=P.count,x[E]=P.index,E++}X1.reset()}else for(let b=0,T=c.length;b<T;b++)if(c[b].visible&&c[b].active){const R=c[b].geometryIndex;let D=!1;if(v&&(this.getMatrixAt(b,Qa),this.getBoundingSphereAt(R,kd).applyMatrix4(Qa),D=!S.intersectsSphere(kd,n)),!D){const P=p[R];u[E]=P.start*o,h[E]=P.count,x[E]=b,E++}}y.needsUpdate=!0,this._multiDrawCount=E,this._visibilityChanged=!1}onBeforeShadow(e,t,n,i,s,a){this.onBeforeRender(e,null,i,s,a)}}class ca extends or{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ot(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const ib=new ae,sb=new ae,II=new yn,dy=new zp,KS=new Mr,K1=new ae,BI=new ae;class pf extends pi{constructor(e=new Ln,t=new ca){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let i=1,s=t.count;i<s;i++)ib.fromBufferAttribute(t,i-1),sb.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=ib.distanceTo(sb);e.setAttribute("lineDistance",new tn(n,1))}else Ht("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),KS.copy(n.boundingSphere),KS.applyMatrix4(i),KS.radius+=s,e.ray.intersectsSphere(KS)===!1)return;II.copy(i).invert(),dy.copy(e.ray).applyMatrix4(II);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=o*o,u=this.isLineSegments?2:1,h=n.index,v=n.attributes.position;if(h!==null){const y=Math.max(0,a.start),x=Math.min(h.count,a.start+a.count);for(let S=y,E=x-1;S<E;S+=u){const b=h.getX(S),T=h.getX(S+1),R=qS(this,e,dy,c,b,T,S);R&&t.push(R)}if(this.isLineLoop){const S=h.getX(x-1),E=h.getX(y),b=qS(this,e,dy,c,S,E,x-1);b&&t.push(b)}}else{const y=Math.max(0,a.start),x=Math.min(v.count,a.start+a.count);for(let S=y,E=x-1;S<E;S+=u){const b=qS(this,e,dy,c,S,S+1,S);b&&t.push(b)}if(this.isLineLoop){const S=qS(this,e,dy,c,x-1,y,x-1);S&&t.push(S)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function qS(r,e,t,n,i,s,a){const o=r.geometry.attributes.position;if(ib.fromBufferAttribute(o,i),sb.fromBufferAttribute(o,s),t.distanceSqToSegment(ib,sb,K1,BI)>n)return;K1.applyMatrix4(r.matrixWorld);const u=e.ray.origin.distanceTo(K1);if(!(u<e.near||u>e.far))return{distance:u,point:BI.clone().applyMatrix4(r.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:r}}const OI=new ae,PI=new ae;class fc extends pf{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let i=0,s=t.count;i<s;i+=2)OI.fromBufferAttribute(t,i),PI.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+OI.distanceTo(PI);e.setAttribute("lineDistance",new tn(n,1))}else Ht("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class aD extends pf{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Zb extends or{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ot(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const NI=new yn,IC=new zp,jS=new Mr,WS=new ae;class oD extends pi{constructor(e=new Ln,t=new Zb){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),jS.copy(n.boundingSphere),jS.applyMatrix4(i),jS.radius+=s,e.ray.intersectsSphere(jS)===!1)return;NI.copy(i).invert(),IC.copy(e.ray).applyMatrix4(NI);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=o*o,u=n.index,p=n.attributes.position;if(u!==null){const v=Math.max(0,a.start),y=Math.min(u.count,a.start+a.count);for(let x=v,S=y;x<S;x++){const E=u.getX(x);WS.fromBufferAttribute(p,E),UI(WS,E,c,i,e,t,this)}}else{const v=Math.max(0,a.start),y=Math.min(p.count,a.start+a.count);for(let x=v,S=y;x<S;x++)WS.fromBufferAttribute(p,x),UI(WS,x,c,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function UI(r,e,t,n,i,s,a){const o=IC.distanceSqToPoint(r);if(o<t){const c=new ae;IC.closestPointToPoint(r,c),c.applyMatrix4(n);const u=i.ray.origin.distanceTo(c);if(u<i.near||u>i.far)return;s.push({distance:u,distanceToRay:Math.sqrt(o),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:a})}}class lD extends Ti{constructor(e,t,n,i,s=yi,a=yi,o,c,u){super(e,t,n,i,s,a,o,c,u),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const h=this;function p(){h.needsUpdate=!0,h._requestVideoFrameCallbackId=e.requestVideoFrameCallback(p)}"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(p))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){this._requestVideoFrameCallbackId!==0&&(this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),this._requestVideoFrameCallbackId=0),super.dispose()}}class cH extends lD{constructor(e,t,n,i,s,a,o,c){super({},e,t,n,i,s,a,o,c),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class uH extends Ti{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=br,this.minFilter=br,this.generateMipmaps=!1,this.needsUpdate=!0}}class eT extends Ti{constructor(e,t,n,i,s,a,o,c,u,h,p,v){super(null,a,o,c,u,h,i,s,p,v),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class fH extends eT{constructor(e,t,n,i,s,a){super(e,t,n,s,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=_s,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class hH extends eT{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,ou),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class dH extends Ti{constructor(e,t,n,i,s,a,o,c,u){super(e,t,n,i,s,a,o,c,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class cD extends Ti{constructor(e,t,n=lu,i,s,a,o=br,c=br,u,h=ng,p=1){if(h!==ng&&h!==ig)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const v={width:e,height:t,depth:p};super(v,i,s,a,o,c,h,n,u),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new yh(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class uD extends Ti{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class tT extends Ln{constructor(e=1,t=1,n=4,i=8,s=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:i,heightSegments:s},t=Math.max(0,t),n=Math.max(1,Math.floor(n)),i=Math.max(3,Math.floor(i)),s=Math.max(1,Math.floor(s));const a=[],o=[],c=[],u=[],h=t/2,p=Math.PI/2*e,v=t,y=2*p+v,x=n*2+s,S=i+1,E=new ae,b=new ae;for(let T=0;T<=x;T++){let R=0,D=0,P=0,O=0;if(T<=n){const B=T/n,I=B*Math.PI/2;D=-h-e*Math.cos(I),P=e*Math.sin(I),O=-e*Math.cos(I),R=B*p}else if(T<=n+s){const B=(T-n)/s;D=-h+B*t,P=e,O=0,R=p+B*v}else{const B=(T-n-s)/n,I=B*Math.PI/2;D=h+e*Math.sin(I),P=e*Math.cos(I),O=e*Math.sin(I),R=p+v+B*p}const N=Math.max(0,Math.min(1,R/y));let U=0;T===0?U=.5/i:T===x&&(U=-.5/i);for(let B=0;B<=i;B++){const I=B/i,z=I*Math.PI*2,W=Math.sin(z),Z=Math.cos(z);b.x=-P*Z,b.y=D,b.z=P*W,o.push(b.x,b.y,b.z),E.set(-P*Z,O,P*W),E.normalize(),c.push(E.x,E.y,E.z),u.push(I+U,N)}if(T>0){const B=(T-1)*S;for(let I=0;I<i;I++){const z=B+I,W=B+I+1,Z=T*S+I,te=T*S+I+1;a.push(z,W,Z),a.push(W,te,Z)}}}this.setIndex(a),this.setAttribute("position",new tn(o,3)),this.setAttribute("normal",new tn(c,3)),this.setAttribute("uv",new tn(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new tT(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class nT extends Ln{constructor(e=1,t=32,n=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const s=[],a=[],o=[],c=[],u=new ae,h=new at;a.push(0,0,0),o.push(0,0,1),c.push(.5,.5);for(let p=0,v=3;p<=t;p++,v+=3){const y=n+p/t*i;u.x=e*Math.cos(y),u.y=e*Math.sin(y),a.push(u.x,u.y,u.z),o.push(0,0,1),h.x=(a[v]/e+1)/2,h.y=(a[v+1]/e+1)/2,c.push(h.x,h.y)}for(let p=1;p<=t;p++)s.push(p,p+1,0);this.setIndex(s),this.setAttribute("position",new tn(a,3)),this.setAttribute("normal",new tn(o,3)),this.setAttribute("uv",new tn(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nT(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Yx extends Ln{constructor(e=1,t=1,n=1,i=32,s=1,a=!1,o=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:c};const u=this;i=Math.floor(i),s=Math.floor(s);const h=[],p=[],v=[],y=[];let x=0;const S=[],E=n/2;let b=0;T(),a===!1&&(e>0&&R(!0),t>0&&R(!1)),this.setIndex(h),this.setAttribute("position",new tn(p,3)),this.setAttribute("normal",new tn(v,3)),this.setAttribute("uv",new tn(y,2));function T(){const D=new ae,P=new ae;let O=0;const N=(t-e)/n;for(let U=0;U<=s;U++){const B=[],I=U/s,z=I*(t-e)+e;for(let W=0;W<=i;W++){const Z=W/i,te=Z*c+o,re=Math.sin(te),k=Math.cos(te);P.x=z*re,P.y=-I*n+E,P.z=z*k,p.push(P.x,P.y,P.z),D.set(re,N,k).normalize(),v.push(D.x,D.y,D.z),y.push(Z,1-I),B.push(x++)}S.push(B)}for(let U=0;U<i;U++)for(let B=0;B<s;B++){const I=S[B][U],z=S[B+1][U],W=S[B+1][U+1],Z=S[B][U+1];(e>0||B!==0)&&(h.push(I,z,Z),O+=3),(t>0||B!==s-1)&&(h.push(z,W,Z),O+=3)}u.addGroup(b,O,0),b+=O}function R(D){const P=x,O=new at,N=new ae;let U=0;const B=D===!0?e:t,I=D===!0?1:-1;for(let W=1;W<=i;W++)p.push(0,E*I,0),v.push(0,I,0),y.push(.5,.5),x++;const z=x;for(let W=0;W<=i;W++){const te=W/i*c+o,re=Math.cos(te),k=Math.sin(te);N.x=B*k,N.y=E*I,N.z=B*re,p.push(N.x,N.y,N.z),v.push(0,I,0),O.x=re*.5+.5,O.y=k*.5*I+.5,y.push(O.x,O.y),x++}for(let W=0;W<i;W++){const Z=P+W,te=z+W;D===!0?h.push(te,te+1,Z):h.push(te+1,te,Z),U+=3}u.addGroup(b,U,D===!0?1:2),b+=U}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Yx(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Xx extends Yx{constructor(e=1,t=1,n=32,i=1,s=!1,a=0,o=Math.PI*2){super(0,e,t,n,i,s,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(e){return new Xx(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Gh extends Ln{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const s=[],a=[];o(i),u(n),h(),this.setAttribute("position",new tn(s,3)),this.setAttribute("normal",new tn(s.slice(),3)),this.setAttribute("uv",new tn(a,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function o(T){const R=new ae,D=new ae,P=new ae;for(let O=0;O<t.length;O+=3)y(t[O+0],R),y(t[O+1],D),y(t[O+2],P),c(R,D,P,T)}function c(T,R,D,P){const O=P+1,N=[];for(let U=0;U<=O;U++){N[U]=[];const B=T.clone().lerp(D,U/O),I=R.clone().lerp(D,U/O),z=O-U;for(let W=0;W<=z;W++)W===0&&U===O?N[U][W]=B:N[U][W]=B.clone().lerp(I,W/z)}for(let U=0;U<O;U++)for(let B=0;B<2*(O-U)-1;B++){const I=Math.floor(B/2);B%2===0?(v(N[U][I+1]),v(N[U+1][I]),v(N[U][I])):(v(N[U][I+1]),v(N[U+1][I+1]),v(N[U+1][I]))}}function u(T){const R=new ae;for(let D=0;D<s.length;D+=3)R.x=s[D+0],R.y=s[D+1],R.z=s[D+2],R.normalize().multiplyScalar(T),s[D+0]=R.x,s[D+1]=R.y,s[D+2]=R.z}function h(){const T=new ae;for(let R=0;R<s.length;R+=3){T.x=s[R+0],T.y=s[R+1],T.z=s[R+2];const D=E(T)/2/Math.PI+.5,P=b(T)/Math.PI+.5;a.push(D,1-P)}x(),p()}function p(){for(let T=0;T<a.length;T+=6){const R=a[T+0],D=a[T+2],P=a[T+4],O=Math.max(R,D,P),N=Math.min(R,D,P);O>.9&&N<.1&&(R<.2&&(a[T+0]+=1),D<.2&&(a[T+2]+=1),P<.2&&(a[T+4]+=1))}}function v(T){s.push(T.x,T.y,T.z)}function y(T,R){const D=T*3;R.x=e[D+0],R.y=e[D+1],R.z=e[D+2]}function x(){const T=new ae,R=new ae,D=new ae,P=new ae,O=new at,N=new at,U=new at;for(let B=0,I=0;B<s.length;B+=9,I+=6){T.set(s[B+0],s[B+1],s[B+2]),R.set(s[B+3],s[B+4],s[B+5]),D.set(s[B+6],s[B+7],s[B+8]),O.set(a[I+0],a[I+1]),N.set(a[I+2],a[I+3]),U.set(a[I+4],a[I+5]),P.copy(T).add(R).add(D).divideScalar(3);const z=E(P);S(O,I+0,T,z),S(N,I+2,R,z),S(U,I+4,D,z)}}function S(T,R,D,P){P<0&&T.x===1&&(a[R]=T.x-1),D.x===0&&D.z===0&&(a[R]=P/2/Math.PI+.5)}function E(T){return Math.atan2(T.z,-T.x)}function b(T){return Math.atan2(-T.y,Math.sqrt(T.x*T.x+T.z*T.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Gh(e.vertices,e.indices,e.radius,e.details)}}class iT extends Gh{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new iT(e.radius,e.detail)}}const JS=new ae,$S=new ae,q1=new ae,QS=new ro;class xP extends Ln{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const i=Math.pow(10,4),s=Math.cos(yp*t),a=e.getIndex(),o=e.getAttribute("position"),c=a?a.count:o.count,u=[0,0,0],h=["a","b","c"],p=new Array(3),v={},y=[];for(let x=0;x<c;x+=3){a?(u[0]=a.getX(x),u[1]=a.getX(x+1),u[2]=a.getX(x+2)):(u[0]=x,u[1]=x+1,u[2]=x+2);const{a:S,b:E,c:b}=QS;if(S.fromBufferAttribute(o,u[0]),E.fromBufferAttribute(o,u[1]),b.fromBufferAttribute(o,u[2]),QS.getNormal(q1),p[0]=`${Math.round(S.x*i)},${Math.round(S.y*i)},${Math.round(S.z*i)}`,p[1]=`${Math.round(E.x*i)},${Math.round(E.y*i)},${Math.round(E.z*i)}`,p[2]=`${Math.round(b.x*i)},${Math.round(b.y*i)},${Math.round(b.z*i)}`,!(p[0]===p[1]||p[1]===p[2]||p[2]===p[0]))for(let T=0;T<3;T++){const R=(T+1)%3,D=p[T],P=p[R],O=QS[h[T]],N=QS[h[R]],U=`${D}_${P}`,B=`${P}_${D}`;B in v&&v[B]?(q1.dot(v[B].normal)<=s&&(y.push(O.x,O.y,O.z),y.push(N.x,N.y,N.z)),v[B]=null):U in v||(v[U]={index0:u[T],index1:u[R],normal:q1.clone()})}}for(const x in v)if(v[x]){const{index0:S,index1:E}=v[x];JS.fromBufferAttribute(o,S),$S.fromBufferAttribute(o,E),y.push(JS.x,JS.y,JS.z),y.push($S.x,$S.y,$S.z)}this.setAttribute("position",new tn(y,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class hc{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){Ht("Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),s=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),s+=n.distanceTo(i),t.push(s),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let i=0;const s=n.length;let a;t?a=t:a=e*n[s-1];let o=0,c=s-1,u;for(;o<=c;)if(i=Math.floor(o+(c-o)/2),u=n[i]-a,u<0)o=i+1;else if(u>0)c=i-1;else{c=i;break}if(i=c,n[i]===a)return i/(s-1);const h=n[i],v=n[i+1]-h,y=(a-h)/v;return(i+y)/(s-1)}getTangent(e,t){let i=e-1e-4,s=e+1e-4;i<0&&(i=0),s>1&&(s=1);const a=this.getPoint(i),o=this.getPoint(s),c=t||(a.isVector2?new at:new ae);return c.copy(o).sub(a).normalize(),c}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new ae,i=[],s=[],a=[],o=new ae,c=new yn;for(let y=0;y<=e;y++){const x=y/e;i[y]=this.getTangentAt(x,new ae)}s[0]=new ae,a[0]=new ae;let u=Number.MAX_VALUE;const h=Math.abs(i[0].x),p=Math.abs(i[0].y),v=Math.abs(i[0].z);h<=u&&(u=h,n.set(1,0,0)),p<=u&&(u=p,n.set(0,1,0)),v<=u&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),s[0].crossVectors(i[0],o),a[0].crossVectors(i[0],s[0]);for(let y=1;y<=e;y++){if(s[y]=s[y-1].clone(),a[y]=a[y-1].clone(),o.crossVectors(i[y-1],i[y]),o.length()>Number.EPSILON){o.normalize();const x=Math.acos(An(i[y-1].dot(i[y]),-1,1));s[y].applyMatrix4(c.makeRotationAxis(o,x))}a[y].crossVectors(i[y],s[y])}if(t===!0){let y=Math.acos(An(s[0].dot(s[e]),-1,1));y/=e,i[0].dot(o.crossVectors(s[0],s[e]))>0&&(y=-y);for(let x=1;x<=e;x++)s[x].applyMatrix4(c.makeRotationAxis(i[x],y*x)),a[x].crossVectors(i[x],s[x])}return{tangents:i,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class sT extends hc{constructor(e=0,t=0,n=1,i=1,s=0,a=Math.PI*2,o=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=c}getPoint(e,t=new at){const n=t,i=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(a?s=0:s=i),this.aClockwise===!0&&!a&&(s===i?s=-i:s=s-i);const o=this.aStartAngle+e*s;let c=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const h=Math.cos(this.aRotation),p=Math.sin(this.aRotation),v=c-this.aX,y=u-this.aY;c=v*h-y*p+this.aX,u=v*p+y*h+this.aY}return n.set(c,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class _P extends sT{constructor(e,t,n,i,s,a){super(e,t,n,n,i,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function fD(){let r=0,e=0,t=0,n=0;function i(s,a,o,c){r=s,e=o,t=-3*s+3*a-2*o-c,n=2*s-2*a+o+c}return{initCatmullRom:function(s,a,o,c,u){i(a,o,u*(o-s),u*(c-a))},initNonuniformCatmullRom:function(s,a,o,c,u,h,p){let v=(a-s)/u-(o-s)/(u+h)+(o-a)/h,y=(o-a)/h-(c-a)/(h+p)+(c-o)/p;v*=h,y*=h,i(a,o,v,y)},calc:function(s){const a=s*s,o=a*s;return r+e*s+t*a+n*o}}}const ZS=new ae,j1=new fD,W1=new fD,J1=new fD;class SP extends hc{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new ae){const n=t,i=this.points,s=i.length,a=(s-(this.closed?0:1))*e;let o=Math.floor(a),c=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:c===0&&o===s-1&&(o=s-2,c=1);let u,h;this.closed||o>0?u=i[(o-1)%s]:(ZS.subVectors(i[0],i[1]).add(i[0]),u=ZS);const p=i[o%s],v=i[(o+1)%s];if(this.closed||o+2<s?h=i[(o+2)%s]:(ZS.subVectors(i[s-1],i[s-2]).add(i[s-1]),h=ZS),this.curveType==="centripetal"||this.curveType==="chordal"){const y=this.curveType==="chordal"?.5:.25;let x=Math.pow(u.distanceToSquared(p),y),S=Math.pow(p.distanceToSquared(v),y),E=Math.pow(v.distanceToSquared(h),y);S<1e-4&&(S=1),x<1e-4&&(x=S),E<1e-4&&(E=S),j1.initNonuniformCatmullRom(u.x,p.x,v.x,h.x,x,S,E),W1.initNonuniformCatmullRom(u.y,p.y,v.y,h.y,x,S,E),J1.initNonuniformCatmullRom(u.z,p.z,v.z,h.z,x,S,E)}else this.curveType==="catmullrom"&&(j1.initCatmullRom(u.x,p.x,v.x,h.x,this.tension),W1.initCatmullRom(u.y,p.y,v.y,h.y,this.tension),J1.initCatmullRom(u.z,p.z,v.z,h.z,this.tension));return n.set(j1.calc(c),W1.calc(c),J1.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new ae().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function FI(r,e,t,n,i){const s=(n-e)*.5,a=(i-t)*.5,o=r*r,c=r*o;return(2*t-2*n+s+a)*c+(-3*t+3*n-2*s-a)*o+s*r+t}function pH(r,e){const t=1-r;return t*t*e}function mH(r,e){return 2*(1-r)*r*e}function gH(r,e){return r*r*e}function Hy(r,e,t,n){return pH(r,e)+mH(r,t)+gH(r,n)}function vH(r,e){const t=1-r;return t*t*t*e}function yH(r,e){const t=1-r;return 3*t*t*r*e}function xH(r,e){return 3*(1-r)*r*r*e}function _H(r,e){return r*r*r*e}function zy(r,e,t,n,i){return vH(r,e)+yH(r,t)+xH(r,n)+_H(r,i)}class hD extends hc{constructor(e=new at,t=new at,n=new at,i=new at){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new at){const n=t,i=this.v0,s=this.v1,a=this.v2,o=this.v3;return n.set(zy(e,i.x,s.x,a.x,o.x),zy(e,i.y,s.y,a.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class AP extends hc{constructor(e=new ae,t=new ae,n=new ae,i=new ae){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new ae){const n=t,i=this.v0,s=this.v1,a=this.v2,o=this.v3;return n.set(zy(e,i.x,s.x,a.x,o.x),zy(e,i.y,s.y,a.y,o.y),zy(e,i.z,s.z,a.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class dD extends hc{constructor(e=new at,t=new at){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new at){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new at){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class EP extends hc{constructor(e=new ae,t=new ae){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new ae){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ae){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class pD extends hc{constructor(e=new at,t=new at,n=new at){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new at){const n=t,i=this.v0,s=this.v1,a=this.v2;return n.set(Hy(e,i.x,s.x,a.x),Hy(e,i.y,s.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class mD extends hc{constructor(e=new ae,t=new ae,n=new ae){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new ae){const n=t,i=this.v0,s=this.v1,a=this.v2;return n.set(Hy(e,i.x,s.x,a.x),Hy(e,i.y,s.y,a.y),Hy(e,i.z,s.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class gD extends hc{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new at){const n=t,i=this.points,s=(i.length-1)*e,a=Math.floor(s),o=s-a,c=i[a===0?a:a-1],u=i[a],h=i[a>i.length-2?i.length-1:a+1],p=i[a>i.length-3?i.length-1:a+2];return n.set(FI(o,c.x,u.x,h.x,p.x),FI(o,c.y,u.y,h.y,p.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new at().fromArray(i))}return this}}var rb=Object.freeze({__proto__:null,ArcCurve:_P,CatmullRomCurve3:SP,CubicBezierCurve:hD,CubicBezierCurve3:AP,EllipseCurve:sT,LineCurve:dD,LineCurve3:EP,QuadraticBezierCurve:pD,QuadraticBezierCurve3:mD,SplineCurve:gD});class bP extends hc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new rb[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=n){const a=i[s]-n,o=this.curves[s],c=o.getLength(),u=c===0?0:1-a/c;return o.getPointAt(u,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,s=this.curves;i<s.length;i++){const a=s[i],o=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,c=a.getPoints(o);for(let u=0;u<c.length;u++){const h=c[u];n&&n.equals(h)||(t.push(h),n=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(new rb[i.type]().fromJSON(i))}return this}}class ab extends bP{constructor(e){super(),this.type="Path",this.currentPoint=new at,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new dD(this.currentPoint.clone(),new at(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const s=new pD(this.currentPoint.clone(),new at(e,t),new at(n,i));return this.curves.push(s),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,s,a){const o=new hD(this.currentPoint.clone(),new at(e,t),new at(n,i),new at(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new gD(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,s,a){const o=this.currentPoint.x,c=this.currentPoint.y;return this.absarc(e+o,t+c,n,i,s,a),this}absarc(e,t,n,i,s,a){return this.absellipse(e,t,n,n,i,s,a),this}ellipse(e,t,n,i,s,a,o,c){const u=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+u,t+h,n,i,s,a,o,c),this}absellipse(e,t,n,i,s,a,o,c){const u=new sT(e,t,n,i,s,a,o,c);if(this.curves.length>0){const p=u.getPoint(0);p.equals(this.currentPoint)||this.lineTo(p.x,p.y)}this.curves.push(u);const h=u.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class xp extends ab{constructor(e){super(e),this.uuid=Fo(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(new ab().fromJSON(i))}return this}}function SH(r,e,t=2){const n=e&&e.length,i=n?e[0]*t:r.length;let s=TP(r,0,i,t,!0);const a=[];if(!s||s.next===s.prev)return a;let o,c,u;if(n&&(s=MH(r,e,s,t)),r.length>80*t){o=r[0],c=r[1];let h=o,p=c;for(let v=t;v<i;v+=t){const y=r[v],x=r[v+1];y<o&&(o=y),x<c&&(c=x),y>h&&(h=y),x>p&&(p=x)}u=Math.max(h-o,p-c),u=u!==0?32767/u:0}return dx(s,a,t,o,c,u,0),a}function TP(r,e,t,n,i){let s;if(i===UH(r,e,t,n)>0)for(let a=e;a<t;a+=n)s=kI(a/n|0,r[a],r[a+1],s);else for(let a=t-n;a>=e;a-=n)s=kI(a/n|0,r[a],r[a+1],s);return s&&fg(s,s.next)&&(mx(s),s=s.next),s}function wp(r,e){if(!r)return r;e||(e=r);let t=r,n;do if(n=!1,!t.steiner&&(fg(t,t.next)||ys(t.prev,t,t.next)===0)){if(mx(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function dx(r,e,t,n,i,s,a){if(!r)return;!a&&s&&wH(r,n,i,s);let o=r;for(;r.prev!==r.next;){const c=r.prev,u=r.next;if(s?EH(r,n,i,s):AH(r)){e.push(c.i,r.i,u.i),mx(r),r=u.next,o=u.next;continue}if(r=u,r===o){a?a===1?(r=bH(wp(r),e),dx(r,e,t,n,i,s,2)):a===2&&TH(r,e,t,n,i,s):dx(wp(r),e,t,n,i,s,1);break}}}function AH(r){const e=r.prev,t=r,n=r.next;if(ys(e,t,n)>=0)return!1;const i=e.x,s=t.x,a=n.x,o=e.y,c=t.y,u=n.y,h=Math.min(i,s,a),p=Math.min(o,c,u),v=Math.max(i,s,a),y=Math.max(o,c,u);let x=n.next;for(;x!==e;){if(x.x>=h&&x.x<=v&&x.y>=p&&x.y<=y&&Ty(i,o,s,c,a,u,x.x,x.y)&&ys(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function EH(r,e,t,n){const i=r.prev,s=r,a=r.next;if(ys(i,s,a)>=0)return!1;const o=i.x,c=s.x,u=a.x,h=i.y,p=s.y,v=a.y,y=Math.min(o,c,u),x=Math.min(h,p,v),S=Math.max(o,c,u),E=Math.max(h,p,v),b=BC(y,x,e,t,n),T=BC(S,E,e,t,n);let R=r.prevZ,D=r.nextZ;for(;R&&R.z>=b&&D&&D.z<=T;){if(R.x>=y&&R.x<=S&&R.y>=x&&R.y<=E&&R!==i&&R!==a&&Ty(o,h,c,p,u,v,R.x,R.y)&&ys(R.prev,R,R.next)>=0||(R=R.prevZ,D.x>=y&&D.x<=S&&D.y>=x&&D.y<=E&&D!==i&&D!==a&&Ty(o,h,c,p,u,v,D.x,D.y)&&ys(D.prev,D,D.next)>=0))return!1;D=D.nextZ}for(;R&&R.z>=b;){if(R.x>=y&&R.x<=S&&R.y>=x&&R.y<=E&&R!==i&&R!==a&&Ty(o,h,c,p,u,v,R.x,R.y)&&ys(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;D&&D.z<=T;){if(D.x>=y&&D.x<=S&&D.y>=x&&D.y<=E&&D!==i&&D!==a&&Ty(o,h,c,p,u,v,D.x,D.y)&&ys(D.prev,D,D.next)>=0)return!1;D=D.nextZ}return!0}function bH(r,e){let t=r;do{const n=t.prev,i=t.next.next;!fg(n,i)&&CP(n,t,t.next,i)&&px(n,i)&&px(i,n)&&(e.push(n.i,t.i,i.i),mx(t),mx(t.next),t=r=i),t=t.next}while(t!==r);return wp(t)}function TH(r,e,t,n,i,s){let a=r;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&OH(a,o)){let c=RP(a,o);a=wp(a,a.next),c=wp(c,c.next),dx(a,e,t,n,i,s,0),dx(c,e,t,n,i,s,0);return}o=o.next}a=a.next}while(a!==r)}function MH(r,e,t,n){const i=[];for(let s=0,a=e.length;s<a;s++){const o=e[s]*n,c=s<a-1?e[s+1]*n:r.length,u=TP(r,o,c,n,!1);u===u.next&&(u.steiner=!0),i.push(BH(u))}i.sort(CH);for(let s=0;s<i.length;s++)t=RH(i[s],t);return t}function CH(r,e){let t=r.x-e.x;if(t===0&&(t=r.y-e.y,t===0)){const n=(r.next.y-r.y)/(r.next.x-r.x),i=(e.next.y-e.y)/(e.next.x-e.x);t=n-i}return t}function RH(r,e){const t=DH(r,e);if(!t)return e;const n=RP(t,r);return wp(n,n.next),wp(t,t.next)}function DH(r,e){let t=e;const n=r.x,i=r.y;let s=-1/0,a;if(fg(r,t))return t;do{if(fg(r,t.next))return t.next;if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const p=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(p<=n&&p>s&&(s=p,a=t.x<t.next.x?t:t.next,p===n))return a}t=t.next}while(t!==e);if(!a)return null;const o=a,c=a.x,u=a.y;let h=1/0;t=a;do{if(n>=t.x&&t.x>=c&&n!==t.x&&MP(i<u?n:s,i,c,u,i<u?s:n,i,t.x,t.y)){const p=Math.abs(i-t.y)/(n-t.x);px(t,r)&&(p<h||p===h&&(t.x>a.x||t.x===a.x&&LH(a,t)))&&(a=t,h=p)}t=t.next}while(t!==o);return a}function LH(r,e){return ys(r.prev,r,e.prev)<0&&ys(e.next,r,r.next)<0}function wH(r,e,t,n){let i=r;do i.z===0&&(i.z=BC(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,IH(i)}function IH(r){let e,t=1;do{let n=r,i;r=null;let s=null;for(e=0;n;){e++;let a=n,o=0;for(let u=0;u<t&&(o++,a=a.nextZ,!!a);u++);let c=t;for(;o>0||c>0&&a;)o!==0&&(c===0||!a||n.z<=a.z)?(i=n,n=n.nextZ,o--):(i=a,a=a.nextZ,c--),s?s.nextZ=i:r=i,i.prevZ=s,s=i;n=a}s.nextZ=null,t*=2}while(e>1);return r}function BC(r,e,t,n,i){return r=(r-t)*i|0,e=(e-n)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function BH(r){let e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function MP(r,e,t,n,i,s,a,o){return(i-a)*(e-o)>=(r-a)*(s-o)&&(r-a)*(n-o)>=(t-a)*(e-o)&&(t-a)*(s-o)>=(i-a)*(n-o)}function Ty(r,e,t,n,i,s,a,o){return!(r===a&&e===o)&&MP(r,e,t,n,i,s,a,o)}function OH(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!PH(r,e)&&(px(r,e)&&px(e,r)&&NH(r,e)&&(ys(r.prev,r,e.prev)||ys(r,e.prev,e))||fg(r,e)&&ys(r.prev,r,r.next)>0&&ys(e.prev,e,e.next)>0)}function ys(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function fg(r,e){return r.x===e.x&&r.y===e.y}function CP(r,e,t,n){const i=tA(ys(r,e,t)),s=tA(ys(r,e,n)),a=tA(ys(t,n,r)),o=tA(ys(t,n,e));return!!(i!==s&&a!==o||i===0&&eA(r,t,e)||s===0&&eA(r,n,e)||a===0&&eA(t,r,n)||o===0&&eA(t,e,n))}function eA(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function tA(r){return r>0?1:r<0?-1:0}function PH(r,e){let t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&CP(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function px(r,e){return ys(r.prev,r,r.next)<0?ys(r,e,r.next)>=0&&ys(r,r.prev,e)>=0:ys(r,e,r.prev)<0||ys(r,r.next,e)<0}function NH(r,e){let t=r,n=!1;const i=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==r);return n}function RP(r,e){const t=OC(r.i,r.x,r.y),n=OC(e.i,e.x,e.y),i=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=i,i.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function kI(r,e,t,n){const i=OC(r,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function mx(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function OC(r,e,t){return{i:r,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function UH(r,e,t,n){let i=0;for(let s=e,a=t-n;s<t;s+=n)i+=(r[a]-r[s])*(r[s+1]+r[a+1]),a=s;return i}class FH{static triangulate(e,t,n=2){return SH(e,t,n)}}class ac{static area(e){const t=e.length;let n=0;for(let i=t-1,s=0;s<t;i=s++)n+=e[i].x*e[s].y-e[s].x*e[i].y;return n*.5}static isClockWise(e){return ac.area(e)<0}static triangulateShape(e,t){const n=[],i=[],s=[];GI(e),HI(n,e);let a=e.length;t.forEach(GI);for(let c=0;c<t.length;c++)i.push(a),a+=t[c].length,HI(n,t[c]);const o=FH.triangulate(n,i);for(let c=0;c<o.length;c+=3)s.push(o.slice(c,c+3));return s}}function GI(r){const e=r.length;e>2&&r[e-1].equals(r[0])&&r.pop()}function HI(r,e){for(let t=0;t<e.length;t++)r.push(e[t].x),r.push(e[t].y)}class rT extends Ln{constructor(e=new xp([new at(.5,.5),new at(-.5,.5),new at(-.5,-.5),new at(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],s=[];for(let o=0,c=e.length;o<c;o++){const u=e[o];a(u)}this.setAttribute("position",new tn(i,3)),this.setAttribute("uv",new tn(s,2)),this.computeVertexNormals();function a(o){const c=[],u=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1,p=t.depth!==void 0?t.depth:1;let v=t.bevelEnabled!==void 0?t.bevelEnabled:!0,y=t.bevelThickness!==void 0?t.bevelThickness:.2,x=t.bevelSize!==void 0?t.bevelSize:y-.1,S=t.bevelOffset!==void 0?t.bevelOffset:0,E=t.bevelSegments!==void 0?t.bevelSegments:3;const b=t.extrudePath,T=t.UVGenerator!==void 0?t.UVGenerator:kH;let R,D=!1,P,O,N,U;b&&(R=b.getSpacedPoints(h),D=!0,v=!1,P=b.computeFrenetFrames(h,!1),O=new ae,N=new ae,U=new ae),v||(E=0,y=0,x=0,S=0);const B=o.extractPoints(u);let I=B.shape;const z=B.holes;if(!ac.isClockWise(I)){I=I.reverse();for(let ze=0,ie=z.length;ze<ie;ze++){const Oe=z[ze];ac.isClockWise(Oe)&&(z[ze]=Oe.reverse())}}function Z(ze){const Oe=10000000000000001e-36;let ue=ze[0];for(let st=1;st<=ze.length;st++){const $e=st%ze.length,_t=ze[$e],it=_t.x-ue.x,Tt=_t.y-ue.y,se=it*it+Tt*Tt,q=Math.max(Math.abs(_t.x),Math.abs(_t.y),Math.abs(ue.x),Math.abs(ue.y)),Ee=Oe*q*q;if(se<=Ee){ze.splice($e,1),st--;continue}ue=_t}}Z(I),z.forEach(Z);const te=z.length,re=I;for(let ze=0;ze<te;ze++){const ie=z[ze];I=I.concat(ie)}function k(ze,ie,Oe){return ie||Cn("ExtrudeGeometry: vec does not exist"),ze.clone().addScaledVector(ie,Oe)}const j=I.length;function J(ze,ie,Oe){let ue,st,$e;const _t=ze.x-ie.x,it=ze.y-ie.y,Tt=Oe.x-ze.x,se=Oe.y-ze.y,q=_t*_t+it*it,Ee=_t*se-it*Tt;if(Math.abs(Ee)>Number.EPSILON){const Ge=Math.sqrt(q),Ve=Math.sqrt(Tt*Tt+se*se),Pe=ie.x-it/Ge,wt=ie.y+_t/Ge,bt=Oe.x-se/Ve,Ft=Oe.y+Tt/Ve,Mt=((bt-Pe)*se-(Ft-wt)*Tt)/(_t*se-it*Tt);ue=Pe+_t*Mt-ze.x,st=wt+it*Mt-ze.y;const Ze=ue*ue+st*st;if(Ze<=2)return new at(ue,st);$e=Math.sqrt(Ze/2)}else{let Ge=!1;_t>Number.EPSILON?Tt>Number.EPSILON&&(Ge=!0):_t<-Number.EPSILON?Tt<-Number.EPSILON&&(Ge=!0):Math.sign(it)===Math.sign(se)&&(Ge=!0),Ge?(ue=-it,st=_t,$e=Math.sqrt(q)):(ue=_t,st=it,$e=Math.sqrt(q/2))}return new at(ue/$e,st/$e)}const oe=[];for(let ze=0,ie=re.length,Oe=ie-1,ue=ze+1;ze<ie;ze++,Oe++,ue++)Oe===ie&&(Oe=0),ue===ie&&(ue=0),oe[ze]=J(re[ze],re[Oe],re[ue]);const K=[];let X,ne=oe.concat();for(let ze=0,ie=te;ze<ie;ze++){const Oe=z[ze];X=[];for(let ue=0,st=Oe.length,$e=st-1,_t=ue+1;ue<st;ue++,$e++,_t++)$e===st&&($e=0),_t===st&&(_t=0),X[ue]=J(Oe[ue],Oe[$e],Oe[_t]);K.push(X),ne=ne.concat(X)}let xe;if(E===0)xe=ac.triangulateShape(re,z);else{const ze=[],ie=[];for(let Oe=0;Oe<E;Oe++){const ue=Oe/E,st=y*Math.cos(ue*Math.PI/2),$e=x*Math.sin(ue*Math.PI/2)+S;for(let _t=0,it=re.length;_t<it;_t++){const Tt=k(re[_t],oe[_t],$e);gt(Tt.x,Tt.y,-st),ue===0&&ze.push(Tt)}for(let _t=0,it=te;_t<it;_t++){const Tt=z[_t];X=K[_t];const se=[];for(let q=0,Ee=Tt.length;q<Ee;q++){const Ge=k(Tt[q],X[q],$e);gt(Ge.x,Ge.y,-st),ue===0&&se.push(Ge)}ue===0&&ie.push(se)}}xe=ac.triangulateShape(ze,ie)}const _e=xe.length,Be=x+S;for(let ze=0;ze<j;ze++){const ie=v?k(I[ze],ne[ze],Be):I[ze];D?(N.copy(P.normals[0]).multiplyScalar(ie.x),O.copy(P.binormals[0]).multiplyScalar(ie.y),U.copy(R[0]).add(N).add(O),gt(U.x,U.y,U.z)):gt(ie.x,ie.y,0)}for(let ze=1;ze<=h;ze++)for(let ie=0;ie<j;ie++){const Oe=v?k(I[ie],ne[ie],Be):I[ie];D?(N.copy(P.normals[ze]).multiplyScalar(Oe.x),O.copy(P.binormals[ze]).multiplyScalar(Oe.y),U.copy(R[ze]).add(N).add(O),gt(U.x,U.y,U.z)):gt(Oe.x,Oe.y,p/h*ze)}for(let ze=E-1;ze>=0;ze--){const ie=ze/E,Oe=y*Math.cos(ie*Math.PI/2),ue=x*Math.sin(ie*Math.PI/2)+S;for(let st=0,$e=re.length;st<$e;st++){const _t=k(re[st],oe[st],ue);gt(_t.x,_t.y,p+Oe)}for(let st=0,$e=z.length;st<$e;st++){const _t=z[st];X=K[st];for(let it=0,Tt=_t.length;it<Tt;it++){const se=k(_t[it],X[it],ue);D?gt(se.x,se.y+R[h-1].y,R[h-1].x+Oe):gt(se.x,se.y,p+Oe)}}}pe(),be();function pe(){const ze=i.length/3;if(v){let ie=0,Oe=j*ie;for(let ue=0;ue<_e;ue++){const st=xe[ue];St(st[2]+Oe,st[1]+Oe,st[0]+Oe)}ie=h+E*2,Oe=j*ie;for(let ue=0;ue<_e;ue++){const st=xe[ue];St(st[0]+Oe,st[1]+Oe,st[2]+Oe)}}else{for(let ie=0;ie<_e;ie++){const Oe=xe[ie];St(Oe[2],Oe[1],Oe[0])}for(let ie=0;ie<_e;ie++){const Oe=xe[ie];St(Oe[0]+j*h,Oe[1]+j*h,Oe[2]+j*h)}}n.addGroup(ze,i.length/3-ze,0)}function be(){const ze=i.length/3;let ie=0;je(re,ie),ie+=re.length;for(let Oe=0,ue=z.length;Oe<ue;Oe++){const st=z[Oe];je(st,ie),ie+=st.length}n.addGroup(ze,i.length/3-ze,1)}function je(ze,ie){let Oe=ze.length;for(;--Oe>=0;){const ue=Oe;let st=Oe-1;st<0&&(st=ze.length-1);for(let $e=0,_t=h+E*2;$e<_t;$e++){const it=j*$e,Tt=j*($e+1),se=ie+ue+it,q=ie+st+it,Ee=ie+st+Tt,Ge=ie+ue+Tt;At(se,q,Ee,Ge)}}}function gt(ze,ie,Oe){c.push(ze),c.push(ie),c.push(Oe)}function St(ze,ie,Oe){jt(ze),jt(ie),jt(Oe);const ue=i.length/3,st=T.generateTopUV(n,i,ue-3,ue-2,ue-1);vt(st[0]),vt(st[1]),vt(st[2])}function At(ze,ie,Oe,ue){jt(ze),jt(ie),jt(ue),jt(ie),jt(Oe),jt(ue);const st=i.length/3,$e=T.generateSideWallUV(n,i,st-6,st-3,st-2,st-1);vt($e[0]),vt($e[1]),vt($e[3]),vt($e[1]),vt($e[2]),vt($e[3])}function jt(ze){i.push(c[ze*3+0]),i.push(c[ze*3+1]),i.push(c[ze*3+2])}function vt(ze){s.push(ze.x),s.push(ze.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return GH(t,n,e)}static fromJSON(e,t){const n=[];for(let s=0,a=e.shapes.length;s<a;s++){const o=t[e.shapes[s]];n.push(o)}const i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new rb[i.type]().fromJSON(i)),new rT(n,e.options)}}const kH={generateTopUV:function(r,e,t,n,i){const s=e[t*3],a=e[t*3+1],o=e[n*3],c=e[n*3+1],u=e[i*3],h=e[i*3+1];return[new at(s,a),new at(o,c),new at(u,h)]},generateSideWallUV:function(r,e,t,n,i,s){const a=e[t*3],o=e[t*3+1],c=e[t*3+2],u=e[n*3],h=e[n*3+1],p=e[n*3+2],v=e[i*3],y=e[i*3+1],x=e[i*3+2],S=e[s*3],E=e[s*3+1],b=e[s*3+2];return Math.abs(o-h)<Math.abs(a-u)?[new at(a,1-c),new at(u,1-p),new at(v,1-x),new at(S,1-b)]:[new at(o,1-c),new at(h,1-p),new at(y,1-x),new at(E,1-b)]}};function GH(r,e,t){if(t.shapes=[],Array.isArray(r))for(let n=0,i=r.length;n<i;n++){const s=r[n];t.shapes.push(s.uuid)}else t.shapes.push(r.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class Kx extends Gh{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Kx(e.radius,e.detail)}}class aT extends Ln{constructor(e=[new at(0,-.5),new at(.5,0),new at(0,.5)],t=12,n=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=An(i,0,Math.PI*2);const s=[],a=[],o=[],c=[],u=[],h=1/t,p=new ae,v=new at,y=new ae,x=new ae,S=new ae;let E=0,b=0;for(let T=0;T<=e.length-1;T++)switch(T){case 0:E=e[T+1].x-e[T].x,b=e[T+1].y-e[T].y,y.x=b*1,y.y=-E,y.z=b*0,S.copy(y),y.normalize(),c.push(y.x,y.y,y.z);break;case e.length-1:c.push(S.x,S.y,S.z);break;default:E=e[T+1].x-e[T].x,b=e[T+1].y-e[T].y,y.x=b*1,y.y=-E,y.z=b*0,x.copy(y),y.x+=S.x,y.y+=S.y,y.z+=S.z,y.normalize(),c.push(y.x,y.y,y.z),S.copy(x)}for(let T=0;T<=t;T++){const R=n+T*h*i,D=Math.sin(R),P=Math.cos(R);for(let O=0;O<=e.length-1;O++){p.x=e[O].x*D,p.y=e[O].y,p.z=e[O].x*P,a.push(p.x,p.y,p.z),v.x=T/t,v.y=O/(e.length-1),o.push(v.x,v.y);const N=c[3*O+0]*D,U=c[3*O+1],B=c[3*O+0]*P;u.push(N,U,B)}}for(let T=0;T<t;T++)for(let R=0;R<e.length-1;R++){const D=R+T*e.length,P=D,O=D+e.length,N=D+e.length+1,U=D+1;s.push(P,O,U),s.push(N,U,O)}this.setIndex(s),this.setAttribute("position",new tn(a,3)),this.setAttribute("uv",new tn(o,2)),this.setAttribute("normal",new tn(u,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new aT(e.points,e.segments,e.phiStart,e.phiLength)}}class qx extends Gh{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new qx(e.radius,e.detail)}}class Hh extends Ln{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const s=e/2,a=t/2,o=Math.floor(n),c=Math.floor(i),u=o+1,h=c+1,p=e/o,v=t/c,y=[],x=[],S=[],E=[];for(let b=0;b<h;b++){const T=b*v-a;for(let R=0;R<u;R++){const D=R*p-s;x.push(D,-T,0),S.push(0,0,1),E.push(R/o),E.push(1-b/c)}}for(let b=0;b<c;b++)for(let T=0;T<o;T++){const R=T+u*b,D=T+u*(b+1),P=T+1+u*(b+1),O=T+1+u*b;y.push(R,D,O),y.push(D,P,O)}this.setIndex(y),this.setAttribute("position",new tn(x,3)),this.setAttribute("normal",new tn(S,3)),this.setAttribute("uv",new tn(E,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Hh(e.width,e.height,e.widthSegments,e.heightSegments)}}class oT extends Ln{constructor(e=.5,t=1,n=32,i=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:s,thetaLength:a},n=Math.max(3,n),i=Math.max(1,i);const o=[],c=[],u=[],h=[];let p=e;const v=(t-e)/i,y=new ae,x=new at;for(let S=0;S<=i;S++){for(let E=0;E<=n;E++){const b=s+E/n*a;y.x=p*Math.cos(b),y.y=p*Math.sin(b),c.push(y.x,y.y,y.z),u.push(0,0,1),x.x=(y.x/t+1)/2,x.y=(y.y/t+1)/2,h.push(x.x,x.y)}p+=v}for(let S=0;S<i;S++){const E=S*(n+1);for(let b=0;b<n;b++){const T=b+E,R=T,D=T+n+1,P=T+n+2,O=T+1;o.push(R,D,O),o.push(D,P,O)}}this.setIndex(o),this.setAttribute("position",new tn(c,3)),this.setAttribute("normal",new tn(u,3)),this.setAttribute("uv",new tn(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new oT(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class lT extends Ln{constructor(e=new xp([new at(0,.5),new at(-.5,-.5),new at(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],s=[],a=[];let o=0,c=0;if(Array.isArray(e)===!1)u(e);else for(let h=0;h<e.length;h++)u(e[h]),this.addGroup(o,c,h),o+=c,c=0;this.setIndex(n),this.setAttribute("position",new tn(i,3)),this.setAttribute("normal",new tn(s,3)),this.setAttribute("uv",new tn(a,2));function u(h){const p=i.length/3,v=h.extractPoints(t);let y=v.shape;const x=v.holes;ac.isClockWise(y)===!1&&(y=y.reverse());for(let E=0,b=x.length;E<b;E++){const T=x[E];ac.isClockWise(T)===!0&&(x[E]=T.reverse())}const S=ac.triangulateShape(y,x);for(let E=0,b=x.length;E<b;E++){const T=x[E];y=y.concat(T)}for(let E=0,b=y.length;E<b;E++){const T=y[E];i.push(T.x,T.y,0),s.push(0,0,1),a.push(T.x,T.y)}for(let E=0,b=S.length;E<b;E++){const T=S[E],R=T[0]+p,D=T[1]+p,P=T[2]+p;n.push(R,D,P),c+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return HH(t,e)}static fromJSON(e,t){const n=[];for(let i=0,s=e.shapes.length;i<s;i++){const a=t[e.shapes[i]];n.push(a)}return new lT(n,e.curveSegments)}}function HH(r,e){if(e.shapes=[],Array.isArray(r))for(let t=0,n=r.length;t<n;t++){const i=r[t];e.shapes.push(i.uuid)}else e.shapes.push(r.uuid);return e}class jx extends Ln{constructor(e=1,t=32,n=16,i=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:s,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const c=Math.min(a+o,Math.PI);let u=0;const h=[],p=new ae,v=new ae,y=[],x=[],S=[],E=[];for(let b=0;b<=n;b++){const T=[],R=b/n;let D=0;b===0&&a===0?D=.5/t:b===n&&c===Math.PI&&(D=-.5/t);for(let P=0;P<=t;P++){const O=P/t;p.x=-e*Math.cos(i+O*s)*Math.sin(a+R*o),p.y=e*Math.cos(a+R*o),p.z=e*Math.sin(i+O*s)*Math.sin(a+R*o),x.push(p.x,p.y,p.z),v.copy(p).normalize(),S.push(v.x,v.y,v.z),E.push(O+D,1-R),T.push(u++)}h.push(T)}for(let b=0;b<n;b++)for(let T=0;T<t;T++){const R=h[b][T+1],D=h[b][T],P=h[b+1][T],O=h[b+1][T+1];(b!==0||a>0)&&y.push(R,D,O),(b!==n-1||c<Math.PI)&&y.push(D,P,O)}this.setIndex(y),this.setAttribute("position",new tn(x,3)),this.setAttribute("normal",new tn(S,3)),this.setAttribute("uv",new tn(E,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new jx(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class cT extends Gh{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new cT(e.radius,e.detail)}}class uT extends Ln{constructor(e=1,t=.4,n=12,i=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:s},n=Math.floor(n),i=Math.floor(i);const a=[],o=[],c=[],u=[],h=new ae,p=new ae,v=new ae;for(let y=0;y<=n;y++)for(let x=0;x<=i;x++){const S=x/i*s,E=y/n*Math.PI*2;p.x=(e+t*Math.cos(E))*Math.cos(S),p.y=(e+t*Math.cos(E))*Math.sin(S),p.z=t*Math.sin(E),o.push(p.x,p.y,p.z),h.x=e*Math.cos(S),h.y=e*Math.sin(S),v.subVectors(p,h).normalize(),c.push(v.x,v.y,v.z),u.push(x/i),u.push(y/n)}for(let y=1;y<=n;y++)for(let x=1;x<=i;x++){const S=(i+1)*y+x-1,E=(i+1)*(y-1)+x-1,b=(i+1)*(y-1)+x,T=(i+1)*y+x;a.push(S,E,T),a.push(E,b,T)}this.setIndex(a),this.setAttribute("position",new tn(o,3)),this.setAttribute("normal",new tn(c,3)),this.setAttribute("uv",new tn(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uT(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class fT extends Ln{constructor(e=1,t=.4,n=64,i=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:s,q:a},n=Math.floor(n),i=Math.floor(i);const o=[],c=[],u=[],h=[],p=new ae,v=new ae,y=new ae,x=new ae,S=new ae,E=new ae,b=new ae;for(let R=0;R<=n;++R){const D=R/n*s*Math.PI*2;T(D,s,a,e,y),T(D+.01,s,a,e,x),E.subVectors(x,y),b.addVectors(x,y),S.crossVectors(E,b),b.crossVectors(S,E),S.normalize(),b.normalize();for(let P=0;P<=i;++P){const O=P/i*Math.PI*2,N=-t*Math.cos(O),U=t*Math.sin(O);p.x=y.x+(N*b.x+U*S.x),p.y=y.y+(N*b.y+U*S.y),p.z=y.z+(N*b.z+U*S.z),c.push(p.x,p.y,p.z),v.subVectors(p,y).normalize(),u.push(v.x,v.y,v.z),h.push(R/n),h.push(P/i)}}for(let R=1;R<=n;R++)for(let D=1;D<=i;D++){const P=(i+1)*(R-1)+(D-1),O=(i+1)*R+(D-1),N=(i+1)*R+D,U=(i+1)*(R-1)+D;o.push(P,O,U),o.push(O,N,U)}this.setIndex(o),this.setAttribute("position",new tn(c,3)),this.setAttribute("normal",new tn(u,3)),this.setAttribute("uv",new tn(h,2));function T(R,D,P,O,N){const U=Math.cos(R),B=Math.sin(R),I=P/D*R,z=Math.cos(I);N.x=O*(2+z)*.5*U,N.y=O*(2+z)*B*.5,N.z=O*Math.sin(I)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fT(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class hT extends Ln{constructor(e=new mD(new ae(-1,-1,0),new ae(-1,1,0),new ae(1,1,0)),t=64,n=1,i=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:s};const a=e.computeFrenetFrames(t,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new ae,c=new ae,u=new at;let h=new ae;const p=[],v=[],y=[],x=[];S(),this.setIndex(x),this.setAttribute("position",new tn(p,3)),this.setAttribute("normal",new tn(v,3)),this.setAttribute("uv",new tn(y,2));function S(){for(let R=0;R<t;R++)E(R);E(s===!1?t:0),T(),b()}function E(R){h=e.getPointAt(R/t,h);const D=a.normals[R],P=a.binormals[R];for(let O=0;O<=i;O++){const N=O/i*Math.PI*2,U=Math.sin(N),B=-Math.cos(N);c.x=B*D.x+U*P.x,c.y=B*D.y+U*P.y,c.z=B*D.z+U*P.z,c.normalize(),v.push(c.x,c.y,c.z),o.x=h.x+n*c.x,o.y=h.y+n*c.y,o.z=h.z+n*c.z,p.push(o.x,o.y,o.z)}}function b(){for(let R=1;R<=t;R++)for(let D=1;D<=i;D++){const P=(i+1)*(R-1)+(D-1),O=(i+1)*R+(D-1),N=(i+1)*R+D,U=(i+1)*(R-1)+D;x.push(P,O,U),x.push(O,N,U)}}function T(){for(let R=0;R<=t;R++)for(let D=0;D<=i;D++)u.x=R/t,u.y=D/i,y.push(u.x,u.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new hT(new rb[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class DP extends Ln{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,i=new ae,s=new ae;if(e.index!==null){const a=e.attributes.position,o=e.index;let c=e.groups;c.length===0&&(c=[{start:0,count:o.count,materialIndex:0}]);for(let u=0,h=c.length;u<h;++u){const p=c[u],v=p.start,y=p.count;for(let x=v,S=v+y;x<S;x+=3)for(let E=0;E<3;E++){const b=o.getX(x+E),T=o.getX(x+(E+1)%3);i.fromBufferAttribute(a,b),s.fromBufferAttribute(a,T),zI(i,s,n)===!0&&(t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z))}}}else{const a=e.attributes.position;for(let o=0,c=a.count/3;o<c;o++)for(let u=0;u<3;u++){const h=3*o+u,p=3*o+(u+1)%3;i.fromBufferAttribute(a,h),s.fromBufferAttribute(a,p),zI(i,s,n)===!0&&(t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new tn(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function zI(r,e,t){const n=`${r.x},${r.y},${r.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${r.x},${r.y},${r.z}`;return t.has(n)===!0||t.has(i)===!0?!1:(t.add(n),t.add(i),!0)}var VI=Object.freeze({__proto__:null,BoxGeometry:Vp,CapsuleGeometry:tT,CircleGeometry:nT,ConeGeometry:Xx,CylinderGeometry:Yx,DodecahedronGeometry:iT,EdgesGeometry:xP,ExtrudeGeometry:rT,IcosahedronGeometry:Kx,LatheGeometry:aT,OctahedronGeometry:qx,PlaneGeometry:Hh,PolyhedronGeometry:Gh,RingGeometry:oT,ShapeGeometry:lT,SphereGeometry:jx,TetrahedronGeometry:cT,TorusGeometry:uT,TorusKnotGeometry:fT,TubeGeometry:hT,WireframeGeometry:DP});class LP extends or{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ot(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class wP extends za{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Wx extends or{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Ot(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ot(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kh,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ho,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Tl extends Wx{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new at(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return An(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ot(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ot(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ot(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class IP extends or{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ot(16777215),this.specular=new Ot(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ot(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kh,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ho,this.combine=Nx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class BP extends or{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ot(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ot(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kh,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class OP extends or{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kh,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class PP extends or{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ot(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ot(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kh,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ho,this.combine=Nx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class vD extends or{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=$O,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class yD extends or{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class NP extends or{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ot(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kh,this.normalScale=new at(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class UP extends ca{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function hp(r,e){return!r||r.constructor===e?r:typeof e.BYTES_PER_ELEMENT=="number"?new e(r):Array.prototype.slice.call(r)}function FP(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function kP(r){function e(i,s){return r[i]-r[s]}const t=r.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(e),n}function PC(r,e,t){const n=r.length,i=new r.constructor(n);for(let s=0,a=0;a!==n;++s){const o=t[s]*e;for(let c=0;c!==e;++c)i[a++]=r[o+c]}return i}function xD(r,e,t,n){let i=1,s=r[0];for(;s!==void 0&&s[n]===void 0;)s=r[i++];if(s===void 0)return;let a=s[n];if(a!==void 0)if(Array.isArray(a))do a=s[n],a!==void 0&&(e.push(s.time),t.push(...a)),s=r[i++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[n],a!==void 0&&(e.push(s.time),a.toArray(t,t.length)),s=r[i++];while(s!==void 0);else do a=s[n],a!==void 0&&(e.push(s.time),t.push(a)),s=r[i++];while(s!==void 0)}function zH(r,e,t,n,i=30){const s=r.clone();s.name=e;const a=[];for(let c=0;c<s.tracks.length;++c){const u=s.tracks[c],h=u.getValueSize(),p=[],v=[];for(let y=0;y<u.times.length;++y){const x=u.times[y]*i;if(!(x<t||x>=n)){p.push(u.times[y]);for(let S=0;S<h;++S)v.push(u.values[y*h+S])}}p.length!==0&&(u.times=hp(p,u.times.constructor),u.values=hp(v,u.values.constructor),a.push(u))}s.tracks=a;let o=1/0;for(let c=0;c<s.tracks.length;++c)o>s.tracks[c].times[0]&&(o=s.tracks[c].times[0]);for(let c=0;c<s.tracks.length;++c)s.tracks[c].shift(-1*o);return s.resetDuration(),s}function VH(r,e=0,t=r,n=30){n<=0&&(n=30);const i=t.tracks.length,s=e/n;for(let a=0;a<i;++a){const o=t.tracks[a],c=o.ValueTypeName;if(c==="bool"||c==="string")continue;const u=r.tracks.find(function(b){return b.name===o.name&&b.ValueTypeName===c});if(u===void 0)continue;let h=0;const p=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=p/3);let v=0;const y=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(v=y/3);const x=o.times.length-1;let S;if(s<=o.times[0]){const b=h,T=p-h;S=o.values.slice(b,T)}else if(s>=o.times[x]){const b=x*p+h,T=b+p-h;S=o.values.slice(b,T)}else{const b=o.createInterpolant(),T=h,R=p-h;b.evaluate(s),S=b.resultBuffer.slice(T,R)}c==="quaternion"&&new Tr().fromArray(S).normalize().conjugate().toArray(S);const E=u.times.length;for(let b=0;b<E;++b){const T=b*y+v;if(c==="quaternion")Tr.multiplyQuaternionsFlat(u.values,T,S,0,u.values,T);else{const R=y-v*2;for(let D=0;D<R;++D)u.values[T+D]-=S[D]}}}return r.blendMode=WR,r}class YH{static convertArray(e,t){return hp(e,t)}static isTypedArray(e){return FP(e)}static getKeyframeOrder(e){return kP(e)}static sortedArray(e,t,n){return PC(e,t,n)}static flattenJSON(e,t,n,i){xD(e,t,n,i)}static subclip(e,t,n,i,s=30){return zH(e,t,n,i,s)}static makeClipAdditive(e,t=0,n=e,i=30){return VH(e,t,n,i)}}class Rg{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],s=t[n-1];e:{t:{let a;n:{i:if(!(e<i)){for(let o=n+2;;){if(i===void 0){if(e<s)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(s=i,i=t[++n],e<i)break t}a=t.length;break n}if(!(e>=s)){const o=t[1];e<o&&(n=2,s=o);for(let c=n-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===c)break;if(i=s,s=t[--n-1],e>=s)break t}a=n,n=0;break n}break e}for(;n<a;){const o=n+a>>>1;e<t[o]?a=o:n=o+1}if(i=t[n],s=t[n-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,i)}return this.interpolate_(n,s,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i;for(let a=0;a!==i;++a)t[a]=n[s+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class GP extends Rg{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:cp,endingEnd:cp}}intervalChanged_(e,t,n){const i=this.parameterPositions;let s=e-2,a=e+1,o=i[s],c=i[a];if(o===void 0)switch(this.getSettings_().endingStart){case up:s=e,o=2*t-n;break;case lx:s=i.length-2,o=t+i[s]-i[s+1];break;default:s=e,o=n}if(c===void 0)switch(this.getSettings_().endingEnd){case up:a=e,c=2*n-t;break;case lx:a=1,c=n+i[1]-i[0];break;default:a=e-1,c=t}const u=(n-t)*.5,h=this.valueSize;this._weightPrev=u/(t-o),this._weightNext=u/(c-n),this._offsetPrev=s*h,this._offsetNext=a*h}interpolate_(e,t,n,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,c=e*o,u=c-o,h=this._offsetPrev,p=this._offsetNext,v=this._weightPrev,y=this._weightNext,x=(n-t)/(i-t),S=x*x,E=S*x,b=-v*E+2*v*S-v*x,T=(1+v)*E+(-1.5-2*v)*S+(-.5+v)*x+1,R=(-1-y)*E+(1.5+y)*S+.5*x,D=y*E-y*S;for(let P=0;P!==o;++P)s[P]=b*a[h+P]+T*a[u+P]+R*a[c+P]+D*a[p+P];return s}}class _D extends Rg{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,c=e*o,u=c-o,h=(n-t)/(i-t),p=1-h;for(let v=0;v!==o;++v)s[v]=a[u+v]*p+a[c+v]*h;return s}}class HP extends Rg{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Ml{constructor(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=hp(t,this.TimeBufferType),this.values=hp(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:hp(e.times,Array),values:hp(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new HP(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new _D(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new GP(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case sg:t=this.InterpolantFactoryMethodDiscrete;break;case rg:t=this.InterpolantFactoryMethodLinear;break;case QA:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return Ht("KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return sg;case this.InterpolantFactoryMethodLinear:return rg;case this.InterpolantFactoryMethodSmooth:return QA}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let s=0,a=i-1;for(;s!==i&&n[s]<e;)++s;for(;a!==-1&&n[a]>t;)--a;if(++a,s!==0||a!==i){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=n.slice(s,a),this.values=this.values.slice(s*o,a*o)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(Cn("KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,s=n.length;s===0&&(Cn("KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==s;o++){const c=n[o];if(typeof c=="number"&&isNaN(c)){Cn("KeyframeTrack: Time is not a valid number.",this,o,c),e=!1;break}if(a!==null&&a>c){Cn("KeyframeTrack: Out of order keys.",this,o,c,a),e=!1;break}a=c}if(i!==void 0&&FP(i))for(let o=0,c=i.length;o!==c;++o){const u=i[o];if(isNaN(u)){Cn("KeyframeTrack: Value is not a valid number.",this,o,u),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===QA,s=e.length-1;let a=1;for(let o=1;o<s;++o){let c=!1;const u=e[o],h=e[o+1];if(u!==h&&(o!==1||u!==e[0]))if(i)c=!0;else{const p=o*n,v=p-n,y=p+n;for(let x=0;x!==n;++x){const S=t[p+x];if(S!==t[v+x]||S!==t[y+x]){c=!0;break}}}if(c){if(o!==a){e[a]=e[o];const p=o*n,v=a*n;for(let y=0;y!==n;++y)t[v+y]=t[p+y]}++a}}if(s>0){e[a]=e[s];for(let o=s*n,c=a*n,u=0;u!==n;++u)t[c+u]=t[o+u];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,i=new n(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}Ml.prototype.ValueTypeName="";Ml.prototype.TimeBufferType=Float32Array;Ml.prototype.ValueBufferType=Float32Array;Ml.prototype.DefaultInterpolation=rg;class Yp extends Ml{constructor(e,t,n){super(e,t,n)}}Yp.prototype.ValueTypeName="bool";Yp.prototype.ValueBufferType=Array;Yp.prototype.DefaultInterpolation=sg;Yp.prototype.InterpolantFactoryMethodLinear=void 0;Yp.prototype.InterpolantFactoryMethodSmooth=void 0;class SD extends Ml{constructor(e,t,n,i){super(e,t,n,i)}}SD.prototype.ValueTypeName="color";class Ip extends Ml{constructor(e,t,n,i){super(e,t,n,i)}}Ip.prototype.ValueTypeName="number";class zP extends Rg{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,c=(n-t)/(i-t);let u=e*o;for(let h=u+o;u!==h;u+=4)Tr.slerpFlat(s,0,a,u-o,a,u,c);return s}}class Bp extends Ml{constructor(e,t,n,i){super(e,t,n,i)}InterpolantFactoryMethodLinear(e){return new zP(this.times,this.values,this.getValueSize(),e)}}Bp.prototype.ValueTypeName="quaternion";Bp.prototype.InterpolantFactoryMethodSmooth=void 0;class Xp extends Ml{constructor(e,t,n){super(e,t,n)}}Xp.prototype.ValueTypeName="string";Xp.prototype.ValueBufferType=Array;Xp.prototype.DefaultInterpolation=sg;Xp.prototype.InterpolantFactoryMethodLinear=void 0;Xp.prototype.InterpolantFactoryMethodSmooth=void 0;class Op extends Ml{constructor(e,t,n,i){super(e,t,n,i)}}Op.prototype.ValueTypeName="vector";class hg{constructor(e="",t=-1,n=[],i=Xb){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Fo(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let a=0,o=n.length;a!==o;++a)t.push(KH(n[a]).scale(i));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s.userData=JSON.parse(e.userData||"{}"),s}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let s=0,a=n.length;s!==a;++s)t.push(Ml.toJSON(n[s]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const s=t.length,a=[];for(let o=0;o<s;o++){let c=[],u=[];c.push((o+s-1)%s,o,(o+1)%s),u.push(0,1,0);const h=kP(c);c=PC(c,1,h),u=PC(u,1,h),!i&&c[0]===0&&(c.push(s),u.push(u[0])),a.push(new Ip(".morphTargetInfluences["+t[o].name+"]",c,u).scale(1/n))}return new this(e,-1,a)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,c=e.length;o<c;o++){const u=e[o],h=u.name.match(s);if(h&&h.length>1){const p=h[1];let v=i[p];v||(i[p]=v=[]),v.push(u)}}const a=[];for(const o in i)a.push(this.CreateFromMorphTargetSequence(o,i[o],t,n));return a}static parseAnimation(e,t){if(Ht("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return Cn("AnimationClip: No animation in JSONLoader data."),null;const n=function(p,v,y,x,S){if(y.length!==0){const E=[],b=[];xD(y,E,b,x),E.length!==0&&S.push(new p(v,E,b))}},i=[],s=e.name||"default",a=e.fps||30,o=e.blendMode;let c=e.length||-1;const u=e.hierarchy||[];for(let p=0;p<u.length;p++){const v=u[p].keys;if(!(!v||v.length===0))if(v[0].morphTargets){const y={};let x;for(x=0;x<v.length;x++)if(v[x].morphTargets)for(let S=0;S<v[x].morphTargets.length;S++)y[v[x].morphTargets[S]]=-1;for(const S in y){const E=[],b=[];for(let T=0;T!==v[x].morphTargets.length;++T){const R=v[x];E.push(R.time),b.push(R.morphTarget===S?1:0)}i.push(new Ip(".morphTargetInfluence["+S+"]",E,b))}c=y.length*a}else{const y=".bones["+t[p].name+"]";n(Op,y+".position",v,"pos",i),n(Bp,y+".quaternion",v,"rot",i),n(Op,y+".scale",v,"scl",i)}}return i.length===0?null:new this(s,c,i,o)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,i=e.length;n!==i;++n){const s=this.tracks[n];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());const t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}function XH(r){switch(r.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ip;case"vector":case"vector2":case"vector3":case"vector4":return Op;case"color":return SD;case"quaternion":return Bp;case"bool":case"boolean":return Yp;case"string":return Xp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+r)}function KH(r){if(r.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=XH(r.type);if(r.times===void 0){const t=[],n=[];xD(r.keys,t,n,"value"),r.times=t,r.values=n}return e.parse!==void 0?e.parse(r):new e(r.name,r.times,r.values,r.interpolation)}const eu={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class dT{constructor(e,t,n){const i=this;let s=!1,a=0,o=0,c;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this._abortController=null,this.itemStart=function(h){o++,s===!1&&i.onStart!==void 0&&i.onStart(h,a,o),s=!0},this.itemEnd=function(h){a++,i.onProgress!==void 0&&i.onProgress(h,a,o),a===o&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(h){i.onError!==void 0&&i.onError(h)},this.resolveURL=function(h){return c?c(h):h},this.setURLModifier=function(h){return c=h,this},this.addHandler=function(h,p){return u.push(h,p),this},this.removeHandler=function(h){const p=u.indexOf(h);return p!==-1&&u.splice(p,2),this},this.getHandler=function(h){for(let p=0,v=u.length;p<v;p+=2){const y=u[p],x=u[p+1];if(y.global&&(y.lastIndex=0),y.test(h))return x}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const VP=new dT;class Hr{constructor(e){this.manager=e!==void 0?e:VP,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,s){n.load(e,i,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}Hr.DEFAULT_MATERIAL_NAME="__DEFAULT";const qu={};class qH extends Error{constructor(e,t){super(e),this.response=t}}class kr extends Hr{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=eu.get(`file:${e}`);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(qu[e]!==void 0){qu[e].push({onLoad:t,onProgress:n,onError:i});return}qu[e]=[],qu[e].push({onLoad:t,onProgress:n,onError:i});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,c=this.responseType;fetch(a).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&Ht("FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||u.body===void 0||u.body.getReader===void 0)return u;const h=qu[e],p=u.body.getReader(),v=u.headers.get("X-File-Size")||u.headers.get("Content-Length"),y=v?parseInt(v):0,x=y!==0;let S=0;const E=new ReadableStream({start(b){T();function T(){p.read().then(({done:R,value:D})=>{if(R)b.close();else{S+=D.byteLength;const P=new ProgressEvent("progress",{lengthComputable:x,loaded:S,total:y});for(let O=0,N=h.length;O<N;O++){const U=h[O];U.onProgress&&U.onProgress(P)}b.enqueue(D),T()}},R=>{b.error(R)})}}});return new Response(E)}else throw new qH(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`,u)}).then(u=>{switch(c){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(h=>new DOMParser().parseFromString(h,o));case"json":return u.json();default:if(o==="")return u.text();{const p=/charset="?([^;"\s]*)"?/i.exec(o),v=p&&p[1]?p[1].toLowerCase():void 0,y=new TextDecoder(v);return u.arrayBuffer().then(x=>y.decode(x))}}}).then(u=>{eu.add(`file:${e}`,u);const h=qu[e];delete qu[e];for(let p=0,v=h.length;p<v;p++){const y=h[p];y.onLoad&&y.onLoad(u)}}).catch(u=>{const h=qu[e];if(h===void 0)throw this.manager.itemError(e),u;delete qu[e];for(let p=0,v=h.length;p<v;p++){const y=h[p];y.onError&&y.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class jH extends Hr{constructor(e){super(e)}load(e,t,n,i){const s=this,a=new kr(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(c){i?i(c):Cn(c),s.manager.itemError(e)}},n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=hg.parse(e[n]);t.push(i)}return t}}class WH extends Hr{constructor(e){super(e)}load(e,t,n,i){const s=this,a=[],o=new eT,c=new kr(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(s.withCredentials);let u=0;function h(p){c.load(e[p],function(v){const y=s.parse(v,!0);a[p]={width:y.width,height:y.height,format:y.format,mipmaps:y.mipmaps},u+=1,u===6&&(y.mipmapCount===1&&(o.minFilter=yi),o.image=a,o.format=y.format,o.needsUpdate=!0,t&&t(o))},n,i)}if(Array.isArray(e))for(let p=0,v=e.length;p<v;++p)h(p);else c.load(e,function(p){const v=s.parse(p,!0);if(v.isCubemap){const y=v.mipmaps.length/v.mipmapCount;for(let x=0;x<y;x++){a[x]={mipmaps:[]};for(let S=0;S<v.mipmapCount;S++)a[x].mipmaps.push(v.mipmaps[x*v.mipmapCount+S]),a[x].format=v.format,a[x].width=v.width,a[x].height=v.height}o.image=a}else o.image.width=v.width,o.image.height=v.height,o.mipmaps=v.mipmaps;v.mipmapCount===1&&(o.minFilter=yi),o.format=v.format,o.needsUpdate=!0,t&&t(o)},n,i);return o}}const g0=new WeakMap;class gx extends Hr{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=eu.get(`image:${e}`);if(a!==void 0){if(a.complete===!0)s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0);else{let p=g0.get(a);p===void 0&&(p=[],g0.set(a,p)),p.push({onLoad:t,onError:i})}return a}const o=fx("img");function c(){h(),t&&t(this);const p=g0.get(this)||[];for(let v=0;v<p.length;v++){const y=p[v];y.onLoad&&y.onLoad(this)}g0.delete(this),s.manager.itemEnd(e)}function u(p){h(),i&&i(p),eu.remove(`image:${e}`);const v=g0.get(this)||[];for(let y=0;y<v.length;y++){const x=v[y];x.onError&&x.onError(p)}g0.delete(this),s.manager.itemError(e),s.manager.itemEnd(e)}function h(){o.removeEventListener("load",c,!1),o.removeEventListener("error",u,!1)}return o.addEventListener("load",c,!1),o.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),eu.add(`image:${e}`,o),s.manager.itemStart(e),o.src=e,o}}class YP extends Hr{constructor(e){super(e)}load(e,t,n,i){const s=new Gx;s.colorSpace=sr;const a=new gx(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function c(u){a.load(e[u],function(h){s.images[u]=h,o++,o===6&&(s.needsUpdate=!0,t&&t(s))},void 0,i)}for(let u=0;u<e.length;++u)c(u);return s}}class AD extends Hr{constructor(e){super(e)}load(e,t,n,i){const s=this,a=new xl,o=new kr(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(e,function(c){let u;try{u=s.parse(c)}catch(h){if(i!==void 0)i(h);else{h(h);return}}u.image!==void 0?a.image=u.image:u.data!==void 0&&(a.image.width=u.width,a.image.height=u.height,a.image.data=u.data),a.wrapS=u.wrapS!==void 0?u.wrapS:_s,a.wrapT=u.wrapT!==void 0?u.wrapT:_s,a.magFilter=u.magFilter!==void 0?u.magFilter:yi,a.minFilter=u.minFilter!==void 0?u.minFilter:yi,a.anisotropy=u.anisotropy!==void 0?u.anisotropy:1,u.colorSpace!==void 0&&(a.colorSpace=u.colorSpace),u.flipY!==void 0&&(a.flipY=u.flipY),u.format!==void 0&&(a.format=u.format),u.type!==void 0&&(a.type=u.type),u.mipmaps!==void 0&&(a.mipmaps=u.mipmaps,a.minFilter=ml),u.mipmapCount===1&&(a.minFilter=yi),u.generateMipmaps!==void 0&&(a.generateMipmaps=u.generateMipmaps),a.needsUpdate=!0,t&&t(a,u)},n,i),a}}class Jx extends Hr{constructor(e){super(e)}load(e,t,n,i){const s=new Ti,a=new gx(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){s.image=o,s.needsUpdate=!0,t!==void 0&&t(s)},n,i),s}}class zh extends pi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ot(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class XP extends zh{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(pi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ot(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const $1=new yn,YI=new ae,XI=new ae;class ED{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new at(512,512),this.mapType=Ha,this.map=null,this.mapPass=null,this.matrix=new yn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Cg,this._frameExtents=new at(1,1),this._viewportCount=1,this._viewports=[new vi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;YI.setFromMatrixPosition(e.matrixWorld),t.position.copy(YI),XI.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(XI),t.updateMatrixWorld(),$1.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix($1,t.coordinateSystem,t.reversedDepth),t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply($1)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class JH extends ED{constructor(){super(new cs(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=lg*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height*this.aspect,s=e.distance||t.far;(n!==t.fov||i!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=i,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class bD extends zh{constructor(e,t,n=0,i=Math.PI/3,s=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(pi.DEFAULT_UP),this.updateMatrix(),this.target=new pi,this.distance=n,this.angle=i,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new JH}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const KI=new yn,py=new ae,Q1=new ae;class $H extends ED{constructor(){super(new cs(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new at(4,2),this._viewportCount=6,this._viewports=[new vi(2,1,1,1),new vi(0,1,1,1),new vi(3,1,1,1),new vi(1,1,1,1),new vi(3,0,1,1),new vi(1,0,1,1)],this._cubeDirections=[new ae(1,0,0),new ae(-1,0,0),new ae(0,0,1),new ae(0,0,-1),new ae(0,1,0),new ae(0,-1,0)],this._cubeUps=[new ae(0,1,0),new ae(0,1,0),new ae(0,1,0),new ae(0,1,0),new ae(0,0,1),new ae(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),py.setFromMatrixPosition(e.matrixWorld),n.position.copy(py),Q1.copy(n.position),Q1.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Q1),n.updateMatrixWorld(),i.makeTranslation(-py.x,-py.y,-py.z),KI.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(KI,n.coordinateSystem,n.reversedDepth)}}class TD extends zh{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new $H}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class _l extends jb{constructor(e=-1,t=1,n=1,i=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=n-e,a=n+e,o=i+t,c=i-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=u*this.view.offsetX,a=s+u*this.view.width,o-=h*this.view.offsetY,c=o-h*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,c,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class QH extends ED{constructor(){super(new _l(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class MD extends zh{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(pi.DEFAULT_UP),this.updateMatrix(),this.target=new pi,this.shadow=new QH}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class KP extends zh{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class qP extends zh{constructor(e,t,n=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class jP{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ae)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*s),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],1.092548*(n*i)),t.addScaledVector(a[5],1.092548*(i*s)),t.addScaledVector(a[6],.315392*(3*s*s-1)),t.addScaledVector(a[7],1.092548*(n*s)),t.addScaledVector(a[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],2*.511664*i),t.addScaledVector(a[2],2*.511664*s),t.addScaledVector(a[3],2*.511664*n),t.addScaledVector(a[4],2*.429043*n*i),t.addScaledVector(a[5],2*.429043*i*s),t.addScaledVector(a[6],.743125*s*s-.247708),t.addScaledVector(a[7],2*.429043*n*s),t.addScaledVector(a[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const n=e.x,i=e.y,s=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-i*i)}}class WP extends zh{constructor(e=new jP,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class pT extends Hr{constructor(e){super(e),this.textures={}}load(e,t,n,i){const s=this,a=new kr(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(c){i?i(c):Cn(c),s.manager.itemError(e)}},n,i)}parse(e){const t=this.textures;function n(s){return t[s]===void 0&&Ht("MaterialLoader: Undefined texture",s),t[s]}const i=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=e.sheen),e.sheenColor!==void 0&&(i.sheenColor=new Ot().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(i.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.specularIntensity!==void 0&&(i.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(i.dispersion=e.dispersion),e.iridescence!==void 0&&(i.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(i.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(i.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(i.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(i.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(i.depthFunc=e.depthFunc),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(i.blendSrc=e.blendSrc),e.blendDst!==void 0&&(i.blendDst=e.blendDst),e.blendEquation!==void 0&&(i.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(i.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(i.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(i.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&i.blendColor!==void 0&&i.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(i.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==void 0&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(i.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const a=e.uniforms[s];switch(i.uniforms[s]={},a.type){case"t":i.uniforms[s].value=n(a.value);break;case"c":i.uniforms[s].value=new Ot().setHex(a.value);break;case"v2":i.uniforms[s].value=new at().fromArray(a.value);break;case"v3":i.uniforms[s].value=new ae().fromArray(a.value);break;case"v4":i.uniforms[s].value=new vi().fromArray(a.value);break;case"m3":i.uniforms[s].value=new Pn().fromArray(a.value);break;case"m4":i.uniforms[s].value=new yn().fromArray(a.value);break;default:i.uniforms[s].value=a.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(i.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)i.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(i.lights=e.lights),e.clipping!==void 0&&(i.clipping=e.clipping),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=n(e.map)),e.matcap!==void 0&&(i.matcap=n(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),i.normalScale=new at().fromArray(s)}return e.displacementMap!==void 0&&(i.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(i.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(i.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(i.envMap=n(e.envMap)),e.envMapRotation!==void 0&&i.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new at().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(i.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(i.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=n(e.thicknessMap)),e.anisotropyMap!==void 0&&(i.anisotropyMap=n(e.anisotropyMap)),e.sheenColorMap!==void 0&&(i.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return pT.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:LP,SpriteMaterial:iD,RawShaderMaterial:wP,ShaderMaterial:za,PointsMaterial:Zb,MeshPhysicalMaterial:Tl,MeshStandardMaterial:Wx,MeshPhongMaterial:IP,MeshToonMaterial:BP,MeshNormalMaterial:OP,MeshLambertMaterial:PP,MeshDepthMaterial:vD,MeshDistanceMaterial:yD,MeshBasicMaterial:ao,MeshMatcapMaterial:NP,LineDashedMaterial:UP,LineBasicMaterial:ca,Material:or};return new t[e]}}class Mh{static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class JP extends Ln{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class $P extends Hr{constructor(e){super(e)}load(e,t,n,i){const s=this,a=new kr(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{t(s.parse(JSON.parse(o)))}catch(c){i?i(c):Cn(c),s.manager.itemError(e)}},n,i)}parse(e){const t={},n={};function i(y,x){if(t[x]!==void 0)return t[x];const E=y.interleavedBuffers[x],b=s(y,E.buffer),T=O0(E.type,b),R=new zx(T,E.stride);return R.uuid=E.uuid,t[x]=R,R}function s(y,x){if(n[x]!==void 0)return n[x];const E=y.arrayBuffers[x],b=new Uint32Array(E).buffer;return n[x]=b,b}const a=e.isInstancedBufferGeometry?new JP:new Ln,o=e.data.index;if(o!==void 0){const y=O0(o.type,o.array);a.setIndex(new xi(y,1))}const c=e.data.attributes;for(const y in c){const x=c[y];let S;if(x.isInterleavedBufferAttribute){const E=i(e.data,x.data);S=new Oh(E,x.itemSize,x.offset,x.normalized)}else{const E=O0(x.type,x.array),b=x.isInstancedBufferAttribute?Lp:xi;S=new b(E,x.itemSize,x.normalized)}x.name!==void 0&&(S.name=x.name),x.usage!==void 0&&S.setUsage(x.usage),a.setAttribute(y,S)}const u=e.data.morphAttributes;if(u)for(const y in u){const x=u[y],S=[];for(let E=0,b=x.length;E<b;E++){const T=x[E];let R;if(T.isInterleavedBufferAttribute){const D=i(e.data,T.data);R=new Oh(D,T.itemSize,T.offset,T.normalized)}else{const D=O0(T.type,T.array);R=new xi(D,T.itemSize,T.normalized)}T.name!==void 0&&(R.name=T.name),S.push(R)}a.morphAttributes[y]=S}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const p=e.data.groups||e.data.drawcalls||e.data.offsets;if(p!==void 0)for(let y=0,x=p.length;y!==x;++y){const S=p[y];a.addGroup(S.start,S.count,S.materialIndex)}const v=e.data.boundingSphere;return v!==void 0&&(a.boundingSphere=new Mr().fromJSON(v)),e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class ZH extends Hr{constructor(e){super(e)}load(e,t,n,i){const s=this,a=this.path===""?Mh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new kr(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(c){let u=null;try{u=JSON.parse(c)}catch(p){i!==void 0&&i(p),p("ObjectLoader: Can't parse "+e+".",p.message);return}const h=u.metadata;if(h===void 0||h.type===void 0||h.type.toLowerCase()==="geometry"){i!==void 0&&i(new Error("THREE.ObjectLoader: Can't load "+e)),Cn("ObjectLoader: Can't load "+e);return}s.parse(u,t)},n,i)}async loadAsync(e,t){const n=this,i=this.path===""?Mh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const s=new kr(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(e,t),o=JSON.parse(a),c=o.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(o)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,i),a=this.parseImages(e.images,function(){t!==void 0&&t(u)}),o=this.parseTextures(e.textures,a),c=this.parseMaterials(e.materials,o),u=this.parseObject(e.object,s,c,o,n),h=this.parseSkeletons(e.skeletons,u);if(this.bindSkeletons(u,h),this.bindLightTargets(u),t!==void 0){let p=!1;for(const v in a)if(a[v].data instanceof HTMLImageElement){p=!0;break}p===!1&&t(u)}return u}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),s=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,i,o,a,t),u=this.parseSkeletons(e.skeletons,c);return this.bindSkeletons(c,u),this.bindLightTargets(c),c}parseShapes(e){const t={};if(e!==void 0)for(let n=0,i=e.length;n<i;n++){const s=new xp().fromJSON(e[n]);t[s.uuid]=s}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse(function(s){s.isBone&&(i[s.uuid]=s)}),e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=new Vx().fromJSON(e[s],i);n[o.uuid]=o}return n}parseGeometries(e,t){const n={};if(e!==void 0){const i=new $P;for(let s=0,a=e.length;s<a;s++){let o;const c=e[s];switch(c.type){case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(c);break;default:c.type in VI?o=VI[c.type].fromJSON(c,t):Ht(`ObjectLoader: Unsupported geometry type "${c.type}"`)}o.uuid=c.uuid,c.name!==void 0&&(o.name=c.name),c.userData!==void 0&&(o.userData=c.userData),n[c.uuid]=o}}return n}parseMaterials(e,t){const n={},i={};if(e!==void 0){const s=new pT;s.setTextures(t);for(let a=0,o=e.length;a<o;a++){const c=e[a];n[c.uuid]===void 0&&(n[c.uuid]=s.parse(c)),i[c.uuid]=n[c.uuid]}}return i}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const i=e[n],s=hg.parse(i);t[s.uuid]=s}return t}parseImages(e,t){const n=this,i={};let s;function a(c){return n.manager.itemStart(c),s.load(c,function(){n.manager.itemEnd(c)},void 0,function(){n.manager.itemError(c),n.manager.itemEnd(c)})}function o(c){if(typeof c=="string"){const u=c,h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u)?u:n.resourcePath+u;return a(h)}else return c.data?{data:O0(c.type,c.data),width:c.width,height:c.height}:null}if(e!==void 0&&e.length>0){const c=new dT(t);s=new gx(c),s.setCrossOrigin(this.crossOrigin);for(let u=0,h=e.length;u<h;u++){const p=e[u],v=p.url;if(Array.isArray(v)){const y=[];for(let x=0,S=v.length;x<S;x++){const E=v[x],b=o(E);b!==null&&(b instanceof HTMLImageElement?y.push(b):y.push(new xl(b.data,b.width,b.height)))}i[p.uuid]=new yh(y)}else{const y=o(p.url);i[p.uuid]=new yh(y)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function s(a){if(typeof a=="string"){const o=a,c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:t.resourcePath+o;return await i.loadAsync(c)}else return a.data?{data:O0(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){i=new gx(this.manager),i.setCrossOrigin(this.crossOrigin);for(let a=0,o=e.length;a<o;a++){const c=e[a],u=c.url;if(Array.isArray(u)){const h=[];for(let p=0,v=u.length;p<v;p++){const y=u[p],x=await s(y);x!==null&&(x instanceof HTMLImageElement?h.push(x):h.push(new xl(x.data,x.width,x.height)))}n[c.uuid]=new yh(h)}else{const h=await s(c.url);n[c.uuid]=new yh(h)}}}return n}parseTextures(e,t){function n(s,a){return typeof s=="number"?s:(Ht("ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const i={};if(e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=e[s];o.image===void 0&&Ht('ObjectLoader: No "image" specified for',o.uuid),t[o.image]===void 0&&Ht("ObjectLoader: Undefined image",o.image);const c=t[o.image],u=c.data;let h;Array.isArray(u)?(h=new Gx,u.length===6&&(h.needsUpdate=!0)):(u&&u.data?h=new xl:h=new Ti,u&&(h.needsUpdate=!0)),h.source=c,h.uuid=o.uuid,o.name!==void 0&&(h.name=o.name),o.mapping!==void 0&&(h.mapping=n(o.mapping,e5)),o.channel!==void 0&&(h.channel=o.channel),o.offset!==void 0&&h.offset.fromArray(o.offset),o.repeat!==void 0&&h.repeat.fromArray(o.repeat),o.center!==void 0&&h.center.fromArray(o.center),o.rotation!==void 0&&(h.rotation=o.rotation),o.wrap!==void 0&&(h.wrapS=n(o.wrap[0],qI),h.wrapT=n(o.wrap[1],qI)),o.format!==void 0&&(h.format=o.format),o.internalFormat!==void 0&&(h.internalFormat=o.internalFormat),o.type!==void 0&&(h.type=o.type),o.colorSpace!==void 0&&(h.colorSpace=o.colorSpace),o.minFilter!==void 0&&(h.minFilter=n(o.minFilter,jI)),o.magFilter!==void 0&&(h.magFilter=n(o.magFilter,jI)),o.anisotropy!==void 0&&(h.anisotropy=o.anisotropy),o.flipY!==void 0&&(h.flipY=o.flipY),o.generateMipmaps!==void 0&&(h.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(h.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(h.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(h.compareFunction=o.compareFunction),o.userData!==void 0&&(h.userData=o.userData),i[o.uuid]=h}return i}parseObject(e,t,n,i,s){let a;function o(v){return t[v]===void 0&&Ht("ObjectLoader: Undefined geometry",v),t[v]}function c(v){if(v!==void 0){if(Array.isArray(v)){const y=[];for(let x=0,S=v.length;x<S;x++){const E=v[x];n[E]===void 0&&Ht("ObjectLoader: Undefined material",E),y.push(n[E])}return y}return n[v]===void 0&&Ht("ObjectLoader: Undefined material",v),n[v]}}function u(v){return i[v]===void 0&&Ht("ObjectLoader: Undefined texture",v),i[v]}let h,p;switch(e.type){case"Scene":a=new Hx,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new Ot(e.background):a.background=u(e.background)),e.environment!==void 0&&(a.environment=u(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new Jb(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new Wb(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(a.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new cs(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new _l(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new KP(e.color,e.intensity);break;case"DirectionalLight":a=new MD(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new TD(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new qP(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new bD(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new XP(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new WP().fromJSON(e);break;case"SkinnedMesh":h=o(e.geometry),p=c(e.material),a=new sD(h,p),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":h=o(e.geometry),p=c(e.material),a=new As(h,p);break;case"InstancedMesh":h=o(e.geometry),p=c(e.material);const v=e.count,y=e.instanceMatrix,x=e.instanceColor;a=new rD(h,p,v),a.instanceMatrix=new Lp(new Float32Array(y.array),16),x!==void 0&&(a.instanceColor=new Lp(new Float32Array(x.array),x.itemSize));break;case"BatchedMesh":h=o(e.geometry),p=c(e.material),a=new yP(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,p),a.geometry=h,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._geometryInfo=e.geometryInfo.map(S=>{let E=null,b=null;return S.boundingBox!==void 0&&(E=new Fr().fromJSON(S.boundingBox)),S.boundingSphere!==void 0&&(b=new Mr().fromJSON(S.boundingSphere)),{...S,boundingBox:E,boundingSphere:b}}),a._instanceInfo=e.instanceInfo,a._availableInstanceIds=e._availableInstanceIds,a._availableGeometryIds=e._availableGeometryIds,a._nextIndexStart=e.nextIndexStart,a._nextVertexStart=e.nextVertexStart,a._geometryCount=e.geometryCount,a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._matricesTexture=u(e.matricesTexture.uuid),a._indirectTexture=u(e.indirectTexture.uuid),e.colorsTexture!==void 0&&(a._colorsTexture=u(e.colorsTexture.uuid)),e.boundingSphere!==void 0&&(a.boundingSphere=new Mr().fromJSON(e.boundingSphere)),e.boundingBox!==void 0&&(a.boundingBox=new Fr().fromJSON(e.boundingBox));break;case"LOD":a=new vP;break;case"Line":a=new pf(o(e.geometry),c(e.material));break;case"LineLoop":a=new aD(o(e.geometry),c(e.material));break;case"LineSegments":a=new fc(o(e.geometry),c(e.material));break;case"PointCloud":case"Points":a=new oD(o(e.geometry),c(e.material));break;case"Sprite":a=new gP(c(e.material));break;case"Group":a=new lf;break;case"Bone":a=new $b;break;default:a=new pi}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(a.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const v=e.children;for(let y=0;y<v.length;y++)a.add(this.parseObject(v[y],t,n,i,s))}if(e.animations!==void 0){const v=e.animations;for(let y=0;y<v.length;y++){const x=v[y];a.animations.push(s[x])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const v=e.levels;for(let y=0;y<v.length;y++){const x=v[y],S=a.getObjectByProperty("uuid",x.object);S!==void 0&&a.addLevel(S,x.distance,x.hysteresis)}}return a}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const i=t[n.skeleton];i===void 0?Ht("ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(i,n.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,i=e.getObjectByProperty("uuid",n);i!==void 0?t.target=i:t.target=new pi}})}}const e5={UVMapping:Lh,CubeReflectionMapping:ou,CubeRefractionMapping:wh,EquirectangularReflectionMapping:Q0,EquirectangularRefractionMapping:ox,CubeUVReflectionMapping:Mg},qI={RepeatWrapping:Ih,ClampToEdgeWrapping:_s,MirroredRepeatWrapping:Z0},jI={NearestFilter:br,NearestMipmapNearestFilter:Ub,NearestMipmapLinearFilter:lp,LinearFilter:yi,LinearMipmapNearestFilter:k0,LinearMipmapLinearFilter:ml},Z1=new WeakMap;class QP extends Hr{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&Ht("ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&Ht("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=eu.get(`image-bitmap:${e}`);if(a!==void 0){if(s.manager.itemStart(e),a.then){a.then(u=>{if(Z1.has(a)===!0)i&&i(Z1.get(a)),s.manager.itemError(e),s.manager.itemEnd(e);else return t&&t(u),s.manager.itemEnd(e),u});return}return setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,o.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const c=fetch(e,o).then(function(u){return u.blob()}).then(function(u){return createImageBitmap(u,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(u){return eu.add(`image-bitmap:${e}`,u),t&&t(u),s.manager.itemEnd(e),u}).catch(function(u){i&&i(u),Z1.set(c,u),eu.remove(`image-bitmap:${e}`),s.manager.itemError(e),s.manager.itemEnd(e)});eu.add(`image-bitmap:${e}`,c),s.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let nA;class CD{static getContext(){return nA===void 0&&(nA=new(window.AudioContext||window.webkitAudioContext)),nA}static setContext(e){nA=e}}class t5 extends Hr{constructor(e){super(e)}load(e,t,n,i){const s=this,a=new kr(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{const u=c.slice(0);CD.getContext().decodeAudioData(u,function(p){t(p)}).catch(o)}catch(u){o(u)}},n,i);function o(c){i?i(c):Cn(c),s.manager.itemError(e)}}}const WI=new yn,JI=new yn,Hd=new yn;class n5{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new cs,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new cs,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Hd.copy(e.projectionMatrix);const i=t.eyeSep/2,s=i*t.near/t.focus,a=t.near*Math.tan(yp*t.fov*.5)/t.zoom;let o,c;JI.elements[12]=-i,WI.elements[12]=i,o=-a*t.aspect+s,c=a*t.aspect+s,Hd.elements[0]=2*t.near/(c-o),Hd.elements[8]=(c+o)/(c-o),this.cameraL.projectionMatrix.copy(Hd),o=-a*t.aspect-s,c=a*t.aspect-s,Hd.elements[0]=2*t.near/(c-o),Hd.elements[8]=(c+o)/(c-o),this.cameraR.projectionMatrix.copy(Hd)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(JI),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(WI)}}class ZP extends cs{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class RD{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const zd=new ae,eM=new Tr,i5=new ae,Vd=new ae,Yd=new ae;class s5 extends pi{constructor(){super(),this.type="AudioListener",this.context=CD.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new RD}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(zd,eM,i5),Vd.set(0,0,-1).applyQuaternion(eM),Yd.set(0,1,0).applyQuaternion(eM),t.positionX){const n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(zd.x,n),t.positionY.linearRampToValueAtTime(zd.y,n),t.positionZ.linearRampToValueAtTime(zd.z,n),t.forwardX.linearRampToValueAtTime(Vd.x,n),t.forwardY.linearRampToValueAtTime(Vd.y,n),t.forwardZ.linearRampToValueAtTime(Vd.z,n),t.upX.linearRampToValueAtTime(Yd.x,n),t.upY.linearRampToValueAtTime(Yd.y,n),t.upZ.linearRampToValueAtTime(Yd.z,n)}else t.setPosition(zd.x,zd.y,zd.z),t.setOrientation(Vd.x,Vd.y,Vd.z,Yd.x,Yd.y,Yd.z)}}class eN extends pi{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){Ht("Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){Ht("Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){Ht("Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){Ht("Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){Ht("Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(Ht("Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){Ht("Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),e.sourceType!=="buffer"?(Ht("Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const Xd=new ae,$I=new Tr,r5=new ae,Kd=new ae;class a5 extends eN{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Xd,$I,r5),Kd.set(0,0,1).applyQuaternion($I);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Xd.x,n),t.positionY.linearRampToValueAtTime(Xd.y,n),t.positionZ.linearRampToValueAtTime(Xd.z,n),t.orientationX.linearRampToValueAtTime(Kd.x,n),t.orientationY.linearRampToValueAtTime(Kd.y,n),t.orientationZ.linearRampToValueAtTime(Kd.z,n)}else t.setPosition(Xd.x,Xd.y,Xd.z),t.setOrientation(Kd.x,Kd.y,Kd.z)}}class o5{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class tN{constructor(e,t,n){this.binding=e,this.valueSize=n;let i,s,a;switch(t){case"quaternion":i=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,s=e*i+i;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==i;++o)n[s+o]=n[o];a=t}else{a+=t;const o=t/a;this._mixBufferRegion(n,s,0,o,i)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const c=t*this._origIndex;this._mixBufferRegion(n,i,c,1-s,t)}a>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let c=t,u=t+t;c!==u;++c)if(n[c]!==n[c+t]){o.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let s=n,a=i;s!==a;++s)t[s]=t[i+s%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,s){if(i>=.5)for(let a=0;a!==s;++a)e[t+a]=e[n+a]}_slerp(e,t,n,i){Tr.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,s){const a=this._workIndex*s;Tr.multiplyQuaternionsFlat(e,a,e,t,e,n),Tr.slerpFlat(e,t,e,t,e,a,i)}_lerp(e,t,n,i,s){const a=1-i;for(let o=0;o!==s;++o){const c=t+o;e[c]=e[c]*a+e[n+o]*i}}_lerpAdditive(e,t,n,i,s){for(let a=0;a!==s;++a){const o=t+a;e[o]=e[o]+e[n+a]*i}}}const DD="\\[\\]\\.:\\/",l5=new RegExp("["+DD+"]","g"),LD="[^"+DD+"]",c5="[^"+DD.replace("\\.","")+"]",u5=/((?:WC+[\/:])*)/.source.replace("WC",LD),f5=/(WCOD+)?/.source.replace("WCOD",c5),h5=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",LD),d5=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",LD),p5=new RegExp("^"+u5+f5+h5+d5+"$"),m5=["material","materials","bones","map"];class g5{constructor(e,t,n){const i=n||mi.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=n.length;i!==s;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class mi{constructor(e,t,n){this.path=t,this.parsedPath=n||mi.parseTrackName(t),this.node=mi.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new mi.Composite(e,t,n):new mi(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(l5,"")}static parseTrackName(e){const t=p5.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const s=n.nodeName.substring(i+1);m5.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===t||o.uuid===t)return o;const c=n(o.children);if(c)return c}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let s=t.propertyIndex;if(e||(e=mi.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){Ht("PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let u=t.objectIndex;switch(n){case"materials":if(!e.material){Cn("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){Cn("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){Cn("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===u){u=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){Cn("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){Cn("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){Cn("PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(u!==void 0){if(e[u]===void 0){Cn("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[u]}}const a=e[i];if(a===void 0){const u=t.nodeName;Cn("PropertyBinding: Trying to update property for track: "+u+"."+i+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?o=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(s!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){Cn("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){Cn("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}mi.Composite=g5;mi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};mi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};mi.prototype.GetterByBindingType=[mi.prototype._getValue_direct,mi.prototype._getValue_array,mi.prototype._getValue_arrayElement,mi.prototype._getValue_toArray];mi.prototype.SetterByBindingTypeAndVersioning=[[mi.prototype._setValue_direct,mi.prototype._setValue_direct_setNeedsUpdate,mi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[mi.prototype._setValue_array,mi.prototype._setValue_array_setNeedsUpdate,mi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[mi.prototype._setValue_arrayElement,mi.prototype._setValue_arrayElement_setNeedsUpdate,mi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[mi.prototype._setValue_fromArray,mi.prototype._setValue_fromArray_setNeedsUpdate,mi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class v5{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Fo(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,s=this._bindings,a=s.length;let o,c=e.length,u=this.nCachedObjects_;for(let h=0,p=arguments.length;h!==p;++h){const v=arguments[h],y=v.uuid;let x=t[y];if(x===void 0){x=c++,t[y]=x,e.push(v);for(let S=0,E=a;S!==E;++S)s[S].push(new mi(v,n[S],i[S]))}else if(x<u){o=e[x];const S=--u,E=e[S];t[E.uuid]=x,e[x]=E,t[y]=S,e[S]=v;for(let b=0,T=a;b!==T;++b){const R=s[b],D=R[S];let P=R[x];R[x]=D,P===void 0&&(P=new mi(v,n[b],i[b])),R[S]=P}}else e[x]!==o&&Cn("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const c=arguments[a],u=c.uuid,h=t[u];if(h!==void 0&&h>=s){const p=s++,v=e[p];t[v.uuid]=h,e[h]=v,t[u]=p,e[p]=c;for(let y=0,x=i;y!==x;++y){const S=n[y],E=S[p],b=S[h];S[h]=E,S[p]=b}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let s=this.nCachedObjects_,a=e.length;for(let o=0,c=arguments.length;o!==c;++o){const u=arguments[o],h=u.uuid,p=t[h];if(p!==void 0)if(delete t[h],p<s){const v=--s,y=e[v],x=--a,S=e[x];t[y.uuid]=p,e[p]=y,t[S.uuid]=v,e[v]=S,e.pop();for(let E=0,b=i;E!==b;++E){const T=n[E],R=T[v],D=T[x];T[p]=R,T[v]=D,T.pop()}}else{const v=--a,y=e[v];v>0&&(t[y.uuid]=p),e[p]=y,e.pop();for(let x=0,S=i;x!==S;++x){const E=n[x];E[p]=E[v],E.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const s=this._bindings;if(i!==void 0)return s[i];const a=this._paths,o=this._parsedPaths,c=this._objects,u=c.length,h=this.nCachedObjects_,p=new Array(u);i=s.length,n[e]=i,a.push(e),o.push(t),s.push(p);for(let v=h,y=c.length;v!==y;++v){const x=c[v];p[v]=new mi(x,e,t)}return p}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const i=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,c=a[o],u=e[o];t[u]=n,a[n]=c,a.pop(),s[n]=s[o],s.pop(),i[n]=i[o],i.pop()}}}class nN{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const s=t.tracks,a=s.length,o=new Array(a),c={endingStart:cp,endingEnd:cp};for(let u=0;u!==a;++u){const h=s[u].createInterpolant(null);o[u]=h,h.settings=c}this._interpolantSettings=c,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=jO,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n=!1){if(e.fadeOut(t),this.fadeIn(t),n===!0){const i=this._clip.duration,s=e._clip.duration,a=s/i,o=i/s;e.warp(1,a,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n=!1){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,s=i.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const c=o.parameterPositions,u=o.sampleValues;return c[0]=s,c[1]=s+n,u[0]=e/a,u[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const c=(e-s)*n;c<0||n===0?t=0:(this._startTime=null,t=n*c)}t*=this._updateTimeScale(e);const a=this._updateTime(t),o=this._updateWeight(e);if(o>0){const c=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case WR:for(let h=0,p=c.length;h!==p;++h)c[h].evaluate(a),u[h].accumulateAdditive(o);break;case Xb:default:for(let h=0,p=c.length;h!==p;++h)c[h].evaluate(a),u[h].accumulate(i,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,s=this._loopCount;const a=n===WO;if(e===0)return s===-1?i:a&&(s&1)===1?t-i:i;if(n===qO){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),i>=t||i<0){const o=Math.floor(i/t);i-=t*o,s+=Math.abs(o);const c=this.repetitions-s;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(c===1){const u=e<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(a&&(s&1)===1)return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=up,i.endingEnd=up):(e?i.endingStart=this.zeroSlopeAtStart?up:cp:i.endingStart=lx,t?i.endingEnd=this.zeroSlopeAtEnd?up:cp:i.endingEnd=lx)}_scheduleFading(e,t,n){const i=this._mixer,s=i.time;let a=this._weightInterpolant;a===null&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,c=a.sampleValues;return o[0]=s,c[0]=t,o[1]=s+e,c[1]=n,this}}const y5=new Float32Array(1);class x5 extends hu{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,s=i.length,a=e._propertyBindings,o=e._interpolants,c=n.uuid,u=this._bindingsByRootAndName;let h=u[c];h===void 0&&(h={},u[c]=h);for(let p=0;p!==s;++p){const v=i[p],y=v.name;let x=h[y];if(x!==void 0)++x.referenceCount,a[p]=x;else{if(x=a[p],x!==void 0){x._cacheIndex===null&&(++x.referenceCount,this._addInactiveBinding(x,c,y));continue}const S=t&&t._propertyBindings[p].binding.parsedPath;x=new tN(mi.create(n,y,S),v.ValueTypeName,v.getValueSize()),++x.referenceCount,this._addInactiveBinding(x,c,y),a[p]=x}o[p].resultBuffer=x.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,i=e._clip.uuid,s=this._actionsByClip[i];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,i,n)}const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const s=t[n];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const s=t[n];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,s=this._actionsByClip;let a=s[t];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=a;else{const o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,a=this._actionsByClip,o=a[s],c=o.knownActions,u=c[c.length-1],h=e._byClipCacheIndex;u._byClipCacheIndex=h,c[h]=u,c.pop(),e._byClipCacheIndex=null;const p=o.actionByRoot,v=(e._localRoot||this._root).uuid;delete p[v],c.length===0&&delete a[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const s=t[n];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,s=this._bindings;let a=i[t];a===void 0&&(a={},i[t]=a),a[n]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,s=n.path,a=this._bindingsByRootAndName,o=a[i],c=t[t.length-1],u=e._cacheIndex;c._cacheIndex=u,t[u]=c,t.pop(),delete o[s],Object.keys(o).length===0&&delete a[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new _D(new Float32Array(2),new Float32Array(2),1,y5),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,s=t[i];e.__cacheIndex=i,t[i]=e,s.__cacheIndex=n,t[n]=s}clipAction(e,t,n){const i=t||this._root,s=i.uuid;let a=typeof e=="string"?hg.findByName(i,e):e;const o=a!==null?a.uuid:e,c=this._actionsByClip[o];let u=null;if(n===void 0&&(a!==null?n=a.blendMode:n=Xb),c!==void 0){const p=c.actionByRoot[s];if(p!==void 0&&p.blendMode===n)return p;u=c.knownActions[0],a===null&&(a=u._clip)}if(a===null)return null;const h=new nN(this,a,t,n);return this._bindAction(h,u),this._addInactiveAction(h,o,s),h}existingAction(e,t){const n=t||this._root,i=n.uuid,s=typeof e=="string"?hg.findByName(n,e):e,a=s?s.uuid:e,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[i]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,s=Math.sign(e),a=this._accuIndex^=1;for(let u=0;u!==n;++u)t[u]._update(i,e,s,a);const o=this._bindings,c=this._nActiveBindings;for(let u=0;u!==c;++u)o[u].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,s=i[n];if(s!==void 0){const a=s.knownActions;for(let o=0,c=a.length;o!==c;++o){const u=a[o];this._deactivateAction(u);const h=u._cacheIndex,p=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,p._cacheIndex=h,t[h]=p,t.pop(),this._removeInactiveBindingsForAction(u)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const a in n){const o=n[a].actionByRoot,c=o[t];c!==void 0&&(this._deactivateAction(c),this._removeInactiveAction(c))}const i=this._bindingsByRootAndName,s=i[t];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class _5 extends ZR{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isRenderTarget3D=!0,this.depth=n,this.texture=new qb(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class wD{constructor(e){this.value=e}clone(){return new wD(this.value.clone===void 0?this.value:this.value.clone())}}let S5=0;class A5 extends hu{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:S5++}),this.name="",this.usage=ux,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,i=t.length;n<i;n++){const s=Array.isArray(t[n])?t[n]:[t[n]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class E5 extends zx{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class b5{constructor(e,t,n,i,s,a=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=s,this.normalized=a,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const QI=new yn;class ID{constructor(e,t,n=0,i=1/0){this.ray=new zp(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new cg,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):Cn("Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return QI.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(QI),this}intersectObject(e,t=!0,n=[]){return NC(e,this,n,t),n.sort(ZI),n}intersectObjects(e,t=!0,n=[]){for(let i=0,s=e.length;i<s;i++)NC(e[i],this,n,t);return n.sort(ZI),n}}function ZI(r,e){return r.distance-e.distance}function NC(r,e,t,n){let i=!0;if(r.layers.test(e.layers)&&r.raycast(e,t)===!1&&(i=!1),i===!0&&n===!0){const s=r.children;for(let a=0,o=s.length;a<o;a++)NC(s[a],e,t,!0)}}class T5{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,e.hidden!==void 0&&(this._pageVisibilityHandler=M5.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){this._pageVisibilityHandler!==null&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return this._pageVisibilityHandler!==null&&this._document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(e!==void 0?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function M5(){this._document.hidden===!1&&this.reset()}class UC{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=An(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(An(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class C5{constructor(e=1,t=0,n=0){this.radius=e,this.theta=t,this.y=n}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}class BD{constructor(e,t,n,i){BD.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,i)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,i){const s=this.elements;return s[0]=e,s[2]=t,s[1]=n,s[3]=i,this}}const e2=new at;class R5{constructor(e=new at(1/0,1/0),t=new at(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=e2.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,e2).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const t2=new ae,iA=new ae,v0=new ae,y0=new ae,tM=new ae,D5=new ae,L5=new ae;class w5{constructor(e=new ae,t=new ae){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){t2.subVectors(e,this.start),iA.subVectors(this.end,this.start);const n=iA.dot(iA);let s=iA.dot(t2)/n;return t&&(s=An(s,0,1)),s}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}distanceSqToLine3(e,t=D5,n=L5){const i=10000000000000001e-32;let s,a;const o=this.start,c=e.start,u=this.end,h=e.end;v0.subVectors(u,o),y0.subVectors(h,c),tM.subVectors(o,c);const p=v0.dot(v0),v=y0.dot(y0),y=y0.dot(tM);if(p<=i&&v<=i)return t.copy(o),n.copy(c),t.sub(n),t.dot(t);if(p<=i)s=0,a=y/v,a=An(a,0,1);else{const x=v0.dot(tM);if(v<=i)a=0,s=An(-x/p,0,1);else{const S=v0.dot(y0),E=p*v-S*S;E!==0?s=An((S*y-x*v)/E,0,1):s=0,a=(S*s+y)/v,a<0?(a=0,s=An(-x/p,0,1)):a>1&&(a=1,s=An((S-x)/p,0,1))}}return t.copy(o).add(v0.multiplyScalar(s)),n.copy(c).add(y0.multiplyScalar(a)),t.sub(n),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const n2=new ae;class I5 extends pi{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Ln,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,c=32;a<c;a++,o++){const u=a/c*Math.PI*2,h=o/c*Math.PI*2;i.push(Math.cos(u),Math.sin(u),1,Math.cos(h),Math.sin(h),1)}n.setAttribute("position",new tn(i,3));const s=new ca({fog:!1,toneMapped:!1});this.cone=new fc(n,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),n2.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(n2),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const ch=new ae,sA=new yn,nM=new yn;class B5 extends fc{constructor(e){const t=iN(e),n=new Ln,i=[],s=[];for(let u=0;u<t.length;u++){const h=t[u];h.parent&&h.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),s.push(0,0,0),s.push(0,0,0))}n.setAttribute("position",new tn(i,3)),n.setAttribute("color",new tn(s,3));const a=new ca({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,a),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const o=new Ot(255),c=new Ot(65280);this.setColors(o,c)}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");nM.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<t.length;s++){const o=t[s];o.parent&&o.parent.isBone&&(sA.multiplyMatrices(nM,o.matrixWorld),ch.setFromMatrixPosition(sA),i.setXYZ(a,ch.x,ch.y,ch.z),sA.multiplyMatrices(nM,o.parent.matrixWorld),ch.setFromMatrixPosition(sA),i.setXYZ(a+1,ch.x,ch.y,ch.z),a+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const i=this.geometry.getAttribute("color");for(let s=0;s<i.count;s+=2)i.setXYZ(s,e.r,e.g,e.b),i.setXYZ(s+1,t.r,t.g,t.b);return i.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function iN(r){const e=[];r.isBone===!0&&e.push(r);for(let t=0;t<r.children.length;t++)e.push(...iN(r.children[t]));return e}class O5 extends As{constructor(e,t,n){const i=new jx(t,4,2),s=new ao({wireframe:!0,fog:!1,toneMapped:!1});super(i,s),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const P5=new ae,i2=new Ot,s2=new Ot;class N5 extends pi{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new qx(t);i.rotateY(Math.PI*.5),this.material=new ao({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=i.getAttribute("position"),a=new Float32Array(s.count*3);i.setAttribute("color",new xi(a,3)),this.add(new As(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");i2.copy(this.light.color),s2.copy(this.light.groundColor);for(let n=0,i=t.count;n<i;n++){const s=n<i/2?i2:s2;t.setXYZ(n,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(P5.setFromMatrixPosition(this.light.matrixWorld).negate())}}class U5 extends fc{constructor(e=10,t=10,n=4473924,i=8947848){n=new Ot(n),i=new Ot(i);const s=t/2,a=e/t,o=e/2,c=[],u=[];for(let v=0,y=0,x=-o;v<=t;v++,x+=a){c.push(-o,0,x,o,0,x),c.push(x,0,-o,x,0,o);const S=v===s?n:i;S.toArray(u,y),y+=3,S.toArray(u,y),y+=3,S.toArray(u,y),y+=3,S.toArray(u,y),y+=3}const h=new Ln;h.setAttribute("position",new tn(c,3)),h.setAttribute("color",new tn(u,3));const p=new ca({vertexColors:!0,toneMapped:!1});super(h,p),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class F5 extends fc{constructor(e=10,t=16,n=8,i=64,s=4473924,a=8947848){s=new Ot(s),a=new Ot(a);const o=[],c=[];if(t>1)for(let p=0;p<t;p++){const v=p/t*(Math.PI*2),y=Math.sin(v)*e,x=Math.cos(v)*e;o.push(0,0,0),o.push(y,0,x);const S=p&1?s:a;c.push(S.r,S.g,S.b),c.push(S.r,S.g,S.b)}for(let p=0;p<n;p++){const v=p&1?s:a,y=e-e/n*p;for(let x=0;x<i;x++){let S=x/i*(Math.PI*2),E=Math.sin(S)*y,b=Math.cos(S)*y;o.push(E,0,b),c.push(v.r,v.g,v.b),S=(x+1)/i*(Math.PI*2),E=Math.sin(S)*y,b=Math.cos(S)*y,o.push(E,0,b),c.push(v.r,v.g,v.b)}}const u=new Ln;u.setAttribute("position",new tn(o,3)),u.setAttribute("color",new tn(c,3));const h=new ca({vertexColors:!0,toneMapped:!1});super(u,h),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const r2=new ae,rA=new ae,a2=new ae;class k5 extends pi{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let i=new Ln;i.setAttribute("position",new tn([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new ca({fog:!1,toneMapped:!1});this.lightPlane=new pf(i,s),this.add(this.lightPlane),i=new Ln,i.setAttribute("position",new tn([0,0,0,0,0,1],3)),this.targetLine=new pf(i,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),r2.setFromMatrixPosition(this.light.matrixWorld),rA.setFromMatrixPosition(this.light.target.matrixWorld),a2.subVectors(rA,r2),this.lightPlane.lookAt(rA),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(rA),this.targetLine.scale.z=a2.length()}}const aA=new ae,Ms=new jb;class G5 extends fc{constructor(e){const t=new Ln,n=new ca({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(x,S){c(x),c(S)}function c(x){i.push(0,0,0),s.push(0,0,0),a[x]===void 0&&(a[x]=[]),a[x].push(i.length/3-1)}t.setAttribute("position",new tn(i,3)),t.setAttribute("color",new tn(s,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const u=new Ot(16755200),h=new Ot(16711680),p=new Ot(43775),v=new Ot(16777215),y=new Ot(3355443);this.setColors(u,h,p,v,y)}setColors(e,t,n,i,s){const o=this.geometry.getAttribute("color");return o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,t.r,t.g,t.b),o.setXYZ(25,t.r,t.g,t.b),o.setXYZ(26,t.r,t.g,t.b),o.setXYZ(27,t.r,t.g,t.b),o.setXYZ(28,t.r,t.g,t.b),o.setXYZ(29,t.r,t.g,t.b),o.setXYZ(30,t.r,t.g,t.b),o.setXYZ(31,t.r,t.g,t.b),o.setXYZ(32,n.r,n.g,n.b),o.setXYZ(33,n.r,n.g,n.b),o.setXYZ(34,n.r,n.g,n.b),o.setXYZ(35,n.r,n.g,n.b),o.setXYZ(36,n.r,n.g,n.b),o.setXYZ(37,n.r,n.g,n.b),o.setXYZ(38,i.r,i.g,i.b),o.setXYZ(39,i.r,i.g,i.b),o.setXYZ(40,s.r,s.g,s.b),o.setXYZ(41,s.r,s.g,s.b),o.setXYZ(42,s.r,s.g,s.b),o.setXYZ(43,s.r,s.g,s.b),o.setXYZ(44,s.r,s.g,s.b),o.setXYZ(45,s.r,s.g,s.b),o.setXYZ(46,s.r,s.g,s.b),o.setXYZ(47,s.r,s.g,s.b),o.setXYZ(48,s.r,s.g,s.b),o.setXYZ(49,s.r,s.g,s.b),o.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap,n=1,i=1;let s,a;if(Ms.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),this.camera.reversedDepth===!0)s=1,a=0;else if(this.camera.coordinateSystem===No)s=-1,a=1;else if(this.camera.coordinateSystem===ag)s=0,a=1;else throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);Bs("c",t,e,Ms,0,0,s),Bs("t",t,e,Ms,0,0,a),Bs("n1",t,e,Ms,-n,-i,s),Bs("n2",t,e,Ms,n,-i,s),Bs("n3",t,e,Ms,-n,i,s),Bs("n4",t,e,Ms,n,i,s),Bs("f1",t,e,Ms,-n,-i,a),Bs("f2",t,e,Ms,n,-i,a),Bs("f3",t,e,Ms,-n,i,a),Bs("f4",t,e,Ms,n,i,a),Bs("u1",t,e,Ms,n*.7,i*1.1,s),Bs("u2",t,e,Ms,-n*.7,i*1.1,s),Bs("u3",t,e,Ms,0,i*2,s),Bs("cf1",t,e,Ms,-n,0,a),Bs("cf2",t,e,Ms,n,0,a),Bs("cf3",t,e,Ms,0,-i,a),Bs("cf4",t,e,Ms,0,i,a),Bs("cn1",t,e,Ms,-n,0,s),Bs("cn2",t,e,Ms,n,0,s),Bs("cn3",t,e,Ms,0,-i,s),Bs("cn4",t,e,Ms,0,i,s),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Bs(r,e,t,n,i,s,a){aA.set(i,s,a).unproject(n);const o=e[r];if(o!==void 0){const c=t.getAttribute("position");for(let u=0,h=o.length;u<h;u++)c.setXYZ(o[u],aA.x,aA.y,aA.z)}}const oA=new Fr;class H5 extends fc{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),s=new Ln;s.setIndex(new xi(n,1)),s.setAttribute("position",new xi(i,3)),super(s,new ca({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&oA.setFromObject(this.object),oA.isEmpty())return;const e=oA.min,t=oA.max,n=this.geometry.attributes.position,i=n.array;i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=e.x,i[4]=t.y,i[5]=t.z,i[6]=e.x,i[7]=e.y,i[8]=t.z,i[9]=t.x,i[10]=e.y,i[11]=t.z,i[12]=t.x,i[13]=t.y,i[14]=e.z,i[15]=e.x,i[16]=t.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=t.x,i[22]=e.y,i[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class z5 extends fc{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new Ln;s.setIndex(new xi(n,1)),s.setAttribute("position",new tn(i,3)),super(s,new ca({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class V5 extends pf{constructor(e,t=1,n=16776960){const i=n,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new Ln;a.setAttribute("position",new tn(s,3)),a.computeBoundingSphere(),super(a,new ca({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],c=new Ln;c.setAttribute("position",new tn(o,3)),c.computeBoundingSphere(),this.add(new As(c,new ao({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const o2=new ae;let lA,iM;class Y5 extends pi{constructor(e=new ae(0,0,1),t=new ae(0,0,0),n=1,i=16776960,s=n*.2,a=s*.2){super(),this.type="ArrowHelper",lA===void 0&&(lA=new Ln,lA.setAttribute("position",new tn([0,0,0,0,1,0],3)),iM=new Xx(.5,1,5,1),iM.translate(0,-.5,0)),this.position.copy(t),this.line=new pf(lA,new ca({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new As(iM,new ao({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,s,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{o2.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(o2,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class X5 extends fc{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new Ln;i.setAttribute("position",new tn(t,3)),i.setAttribute("color",new tn(n,3));const s=new ca({vertexColors:!0,toneMapped:!1});super(i,s),this.type="AxesHelper"}setColors(e,t,n){const i=new Ot,s=this.geometry.attributes.color.array;return i.set(e),i.toArray(s,0),i.toArray(s,3),i.set(t),i.toArray(s,6),i.toArray(s,9),i.set(n),i.toArray(s,12),i.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class K5{constructor(){this.type="ShapePath",this.color=new Ot,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new ab,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,s,a){return this.currentPath.bezierCurveTo(e,t,n,i,s,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(b){const T=[];for(let R=0,D=b.length;R<D;R++){const P=b[R],O=new xp;O.curves=P.curves,T.push(O)}return T}function n(b,T){const R=T.length;let D=!1;for(let P=R-1,O=0;O<R;P=O++){let N=T[P],U=T[O],B=U.x-N.x,I=U.y-N.y;if(Math.abs(I)>Number.EPSILON){if(I<0&&(N=T[O],B=-B,U=T[P],I=-I),b.y<N.y||b.y>U.y)continue;if(b.y===N.y){if(b.x===N.x)return!0}else{const z=I*(b.x-N.x)-B*(b.y-N.y);if(z===0)return!0;if(z<0)continue;D=!D}}else{if(b.y!==N.y)continue;if(U.x<=b.x&&b.x<=N.x||N.x<=b.x&&b.x<=U.x)return!0}}return D}const i=ac.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,c;const u=[];if(s.length===1)return o=s[0],c=new xp,c.curves=o.curves,u.push(c),u;let h=!i(s[0].getPoints());h=e?!h:h;const p=[],v=[];let y=[],x=0,S;v[x]=void 0,y[x]=[];for(let b=0,T=s.length;b<T;b++)o=s[b],S=o.getPoints(),a=i(S),a=e?!a:a,a?(!h&&v[x]&&x++,v[x]={s:new xp,p:S},v[x].s.curves=o.curves,h&&x++,y[x]=[]):y[x].push({h:o,p:S[0]});if(!v[0])return t(s);if(v.length>1){let b=!1,T=0;for(let R=0,D=v.length;R<D;R++)p[R]=[];for(let R=0,D=v.length;R<D;R++){const P=y[R];for(let O=0;O<P.length;O++){const N=P[O];let U=!0;for(let B=0;B<v.length;B++)n(N.p,v[B].p)&&(R!==B&&T++,U?(U=!1,p[B].push(N)):b=!0);U&&p[R].push(N)}}T>0&&b===!1&&(y=p)}let E;for(let b=0,T=v.length;b<T;b++){c=v[b].s,u.push(c),E=y[b];for(let R=0,D=E.length;R<D;R++)c.holes.push(E[R].h)}return u}}class q5 extends hu{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){Ht("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function j5(r,e){const t=r.image&&r.image.width?r.image.width/r.image.height:1;return t>e?(r.repeat.x=1,r.repeat.y=t/e,r.offset.x=0,r.offset.y=(1-r.repeat.y)/2):(r.repeat.x=e/t,r.repeat.y=1,r.offset.x=(1-r.repeat.x)/2,r.offset.y=0),r}function W5(r,e){const t=r.image&&r.image.width?r.image.width/r.image.height:1;return t>e?(r.repeat.x=e/t,r.repeat.y=1,r.offset.x=(1-r.repeat.x)/2,r.offset.y=0):(r.repeat.x=1,r.repeat.y=t/e,r.offset.x=0,r.offset.y=(1-r.repeat.y)/2),r}function J5(r){return r.repeat.x=1,r.repeat.y=1,r.offset.x=0,r.offset.y=0,r}function FC(r,e,t,n){const i=$5(n);switch(t){case qR:return r*e;case Fx:return r*e/i.components*i.byteLength;case kx:return r*e/i.components*i.byteLength;case zb:return r*e*2/i.components*i.byteLength;case Vb:return r*e*2/i.components*i.byteLength;case jR:return r*e*3/i.components*i.byteLength;case Ns:return r*e*4/i.components*i.byteLength;case Yb:return r*e*4/i.components*i.byteLength;case Ny:case Uy:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case Fy:case ky:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case DE:case wE:return Math.max(r,16)*Math.max(e,8)/4;case RE:case LE:return Math.max(r,8)*Math.max(e,8)/2;case IE:case BE:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case OE:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case PE:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case NE:return Math.floor((r+4)/5)*Math.floor((e+3)/4)*16;case UE:return Math.floor((r+4)/5)*Math.floor((e+4)/5)*16;case FE:return Math.floor((r+5)/6)*Math.floor((e+4)/5)*16;case kE:return Math.floor((r+5)/6)*Math.floor((e+5)/6)*16;case GE:return Math.floor((r+7)/8)*Math.floor((e+4)/5)*16;case HE:return Math.floor((r+7)/8)*Math.floor((e+5)/6)*16;case zE:return Math.floor((r+7)/8)*Math.floor((e+7)/8)*16;case VE:return Math.floor((r+9)/10)*Math.floor((e+4)/5)*16;case YE:return Math.floor((r+9)/10)*Math.floor((e+5)/6)*16;case XE:return Math.floor((r+9)/10)*Math.floor((e+7)/8)*16;case KE:return Math.floor((r+9)/10)*Math.floor((e+9)/10)*16;case qE:return Math.floor((r+11)/12)*Math.floor((e+9)/10)*16;case jE:return Math.floor((r+11)/12)*Math.floor((e+11)/12)*16;case WE:case JE:case $E:return Math.ceil(r/4)*Math.ceil(e/4)*16;case QE:case ZE:return Math.ceil(r/4)*Math.ceil(e/4)*8;case eb:case tb:return Math.ceil(r/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function $5(r){switch(r){case Ha:case Fb:return{byteLength:1,components:1};case eg:case kb:case ar:return{byteLength:2,components:1};case Gb:case Hb:return{byteLength:2,components:4};case lu:case Ux:case Ss:return{byteLength:4,components:1};case XR:case KR:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${r}.`)}class Q5{static contain(e,t){return j5(e,t)}static cover(e,t){return W5(e,t)}static fill(e){return J5(e)}static getByteLength(e,t,n,i){return FC(e,t,n,i)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Px}}));typeof window<"u"&&(window.__THREE__?Ht("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Px);function sN(){let r=null,e=!1,t=null,n=null;function i(s,a){t(s,a),n=r.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=r.requestAnimationFrame(i),e=!0)},stop:function(){r.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){r=s}}}function Z5(r){const e=new WeakMap;function t(o,c){const u=o.array,h=o.usage,p=u.byteLength,v=r.createBuffer();r.bindBuffer(c,v),r.bufferData(c,u,h),o.onUploadCallback();let y;if(u instanceof Float32Array)y=r.FLOAT;else if(typeof Float16Array<"u"&&u instanceof Float16Array)y=r.HALF_FLOAT;else if(u instanceof Uint16Array)o.isFloat16BufferAttribute?y=r.HALF_FLOAT:y=r.UNSIGNED_SHORT;else if(u instanceof Int16Array)y=r.SHORT;else if(u instanceof Uint32Array)y=r.UNSIGNED_INT;else if(u instanceof Int32Array)y=r.INT;else if(u instanceof Int8Array)y=r.BYTE;else if(u instanceof Uint8Array)y=r.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)y=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:v,type:y,bytesPerElement:u.BYTES_PER_ELEMENT,version:o.version,size:p}}function n(o,c,u){const h=c.array,p=c.updateRanges;if(r.bindBuffer(u,o),p.length===0)r.bufferSubData(u,0,h);else{p.sort((y,x)=>y.start-x.start);let v=0;for(let y=1;y<p.length;y++){const x=p[v],S=p[y];S.start<=x.start+x.count+1?x.count=Math.max(x.count,S.start+S.count-x.start):(++v,p[v]=S)}p.length=v+1;for(let y=0,x=p.length;y<x;y++){const S=p[y];r.bufferSubData(u,S.start*h.BYTES_PER_ELEMENT,h,S.start,S.count)}c.clearUpdateRanges()}c.onUploadCallback()}function i(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function s(o){o.isInterleavedBufferAttribute&&(o=o.data);const c=e.get(o);c&&(r.deleteBuffer(c.buffer),e.delete(o))}function a(o,c){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const h=e.get(o);(!h||h.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const u=e.get(o);if(u===void 0)e.set(o,t(o,c));else if(u.version<o.version){if(u.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(u.buffer,o,c),u.version=o.version}}return{get:i,remove:s,update:a}}var ez=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,tz=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,nz=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,iz=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,sz=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,rz=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,az=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,oz=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,lz=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,cz=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,uz=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,fz=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,hz=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,dz=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,pz=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,mz=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,gz=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,vz=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,yz=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,xz=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,_z=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Sz=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,Az=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,Ez=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,bz=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Tz=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Mz=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Cz=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Rz=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Dz=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Lz="gl_FragColor = linearToOutputTexel( gl_FragColor );",wz=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Iz=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Bz=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,Oz=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Pz=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Nz=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Uz=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Fz=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,kz=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Gz=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Hz=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,zz=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Vz=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Yz=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Xz=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Kz=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,qz=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,jz=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Wz=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Jz=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,$z=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,Qz=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 uv = vec2( roughness, dotNV );
	return texture2D( dfgLUT, uv ).rg;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = DFGApprox( vec3(0.0, 0.0, 1.0), vec3(sqrt(1.0 - dotNV * dotNV), 0.0, dotNV), material.roughness );
	vec2 dfgL = DFGApprox( vec3(0.0, 0.0, 1.0), vec3(sqrt(1.0 - dotNL * dotNL), 0.0, dotNL), material.roughness );
	vec3 FssEss_V = material.specularColor * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColor * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColor + ( 1.0 - material.specularColor ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Zz=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,e6=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,t6=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,n6=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,i6=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,s6=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,r6=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,a6=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,o6=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,l6=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,c6=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,u6=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,f6=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,h6=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,d6=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,p6=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,m6=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,g6=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,v6=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,y6=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,x6=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,_6=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,S6=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,A6=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,E6=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,b6=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,T6=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,M6=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,C6=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,R6=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,D6=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,L6=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,w6=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,I6=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,B6=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,O6=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,P6=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		float depth = unpackRGBAToDepth( texture2D( depths, uv ) );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			return step( depth, compare );
		#else
			return step( compare, depth );
		#endif
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow( sampler2D shadow, vec2 uv, float compare ) {
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			float hard_shadow = step( distribution.x, compare );
		#else
			float hard_shadow = step( compare, distribution.x );
		#endif
		if ( hard_shadow != 1.0 ) {
			float distance = compare - distribution.x;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,N6=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,U6=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,F6=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,k6=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,G6=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,H6=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,z6=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,V6=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Y6=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,X6=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,K6=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,q6=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,j6=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,W6=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,J6=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,$6=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Q6=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Z6=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,e9=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,t9=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,n9=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,i9=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,s9=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,r9=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,a9=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,o9=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,l9=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,c9=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,u9=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,f9=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,h9=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,d9=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,p9=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,m9=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,g9=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,v9=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,y9=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,x9=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,_9=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,S9=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,A9=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,E9=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,b9=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,T9=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,M9=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,C9=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,R9=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,D9=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,L9=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,w9=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,I9=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Gn={alphahash_fragment:ez,alphahash_pars_fragment:tz,alphamap_fragment:nz,alphamap_pars_fragment:iz,alphatest_fragment:sz,alphatest_pars_fragment:rz,aomap_fragment:az,aomap_pars_fragment:oz,batching_pars_vertex:lz,batching_vertex:cz,begin_vertex:uz,beginnormal_vertex:fz,bsdfs:hz,iridescence_fragment:dz,bumpmap_pars_fragment:pz,clipping_planes_fragment:mz,clipping_planes_pars_fragment:gz,clipping_planes_pars_vertex:vz,clipping_planes_vertex:yz,color_fragment:xz,color_pars_fragment:_z,color_pars_vertex:Sz,color_vertex:Az,common:Ez,cube_uv_reflection_fragment:bz,defaultnormal_vertex:Tz,displacementmap_pars_vertex:Mz,displacementmap_vertex:Cz,emissivemap_fragment:Rz,emissivemap_pars_fragment:Dz,colorspace_fragment:Lz,colorspace_pars_fragment:wz,envmap_fragment:Iz,envmap_common_pars_fragment:Bz,envmap_pars_fragment:Oz,envmap_pars_vertex:Pz,envmap_physical_pars_fragment:Kz,envmap_vertex:Nz,fog_vertex:Uz,fog_pars_vertex:Fz,fog_fragment:kz,fog_pars_fragment:Gz,gradientmap_pars_fragment:Hz,lightmap_pars_fragment:zz,lights_lambert_fragment:Vz,lights_lambert_pars_fragment:Yz,lights_pars_begin:Xz,lights_toon_fragment:qz,lights_toon_pars_fragment:jz,lights_phong_fragment:Wz,lights_phong_pars_fragment:Jz,lights_physical_fragment:$z,lights_physical_pars_fragment:Qz,lights_fragment_begin:Zz,lights_fragment_maps:e6,lights_fragment_end:t6,logdepthbuf_fragment:n6,logdepthbuf_pars_fragment:i6,logdepthbuf_pars_vertex:s6,logdepthbuf_vertex:r6,map_fragment:a6,map_pars_fragment:o6,map_particle_fragment:l6,map_particle_pars_fragment:c6,metalnessmap_fragment:u6,metalnessmap_pars_fragment:f6,morphinstance_vertex:h6,morphcolor_vertex:d6,morphnormal_vertex:p6,morphtarget_pars_vertex:m6,morphtarget_vertex:g6,normal_fragment_begin:v6,normal_fragment_maps:y6,normal_pars_fragment:x6,normal_pars_vertex:_6,normal_vertex:S6,normalmap_pars_fragment:A6,clearcoat_normal_fragment_begin:E6,clearcoat_normal_fragment_maps:b6,clearcoat_pars_fragment:T6,iridescence_pars_fragment:M6,opaque_fragment:C6,packing:R6,premultiplied_alpha_fragment:D6,project_vertex:L6,dithering_fragment:w6,dithering_pars_fragment:I6,roughnessmap_fragment:B6,roughnessmap_pars_fragment:O6,shadowmap_pars_fragment:P6,shadowmap_pars_vertex:N6,shadowmap_vertex:U6,shadowmask_pars_fragment:F6,skinbase_vertex:k6,skinning_pars_vertex:G6,skinning_vertex:H6,skinnormal_vertex:z6,specularmap_fragment:V6,specularmap_pars_fragment:Y6,tonemapping_fragment:X6,tonemapping_pars_fragment:K6,transmission_fragment:q6,transmission_pars_fragment:j6,uv_pars_fragment:W6,uv_pars_vertex:J6,uv_vertex:$6,worldpos_vertex:Q6,background_vert:Z6,background_frag:e9,backgroundCube_vert:t9,backgroundCube_frag:n9,cube_vert:i9,cube_frag:s9,depth_vert:r9,depth_frag:a9,distanceRGBA_vert:o9,distanceRGBA_frag:l9,equirect_vert:c9,equirect_frag:u9,linedashed_vert:f9,linedashed_frag:h9,meshbasic_vert:d9,meshbasic_frag:p9,meshlambert_vert:m9,meshlambert_frag:g9,meshmatcap_vert:v9,meshmatcap_frag:y9,meshnormal_vert:x9,meshnormal_frag:_9,meshphong_vert:S9,meshphong_frag:A9,meshphysical_vert:E9,meshphysical_frag:b9,meshtoon_vert:T9,meshtoon_frag:M9,points_vert:C9,points_frag:R9,shadow_vert:D9,shadow_frag:L9,sprite_vert:w9,sprite_frag:I9},Gt={common:{diffuse:{value:new Ot(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Pn},alphaMap:{value:null},alphaMapTransform:{value:new Pn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Pn}},envmap:{envMap:{value:null},envMapRotation:{value:new Pn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Pn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Pn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Pn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Pn},normalScale:{value:new at(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Pn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Pn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Pn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Pn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ot(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ot(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Pn},alphaTest:{value:0},uvTransform:{value:new Pn}},sprite:{diffuse:{value:new Ot(16777215)},opacity:{value:1},center:{value:new at(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Pn},alphaMap:{value:null},alphaMapTransform:{value:new Pn},alphaTest:{value:0}}},sc={basic:{uniforms:La([Gt.common,Gt.specularmap,Gt.envmap,Gt.aomap,Gt.lightmap,Gt.fog]),vertexShader:Gn.meshbasic_vert,fragmentShader:Gn.meshbasic_frag},lambert:{uniforms:La([Gt.common,Gt.specularmap,Gt.envmap,Gt.aomap,Gt.lightmap,Gt.emissivemap,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.fog,Gt.lights,{emissive:{value:new Ot(0)}}]),vertexShader:Gn.meshlambert_vert,fragmentShader:Gn.meshlambert_frag},phong:{uniforms:La([Gt.common,Gt.specularmap,Gt.envmap,Gt.aomap,Gt.lightmap,Gt.emissivemap,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.fog,Gt.lights,{emissive:{value:new Ot(0)},specular:{value:new Ot(1118481)},shininess:{value:30}}]),vertexShader:Gn.meshphong_vert,fragmentShader:Gn.meshphong_frag},standard:{uniforms:La([Gt.common,Gt.envmap,Gt.aomap,Gt.lightmap,Gt.emissivemap,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.roughnessmap,Gt.metalnessmap,Gt.fog,Gt.lights,{emissive:{value:new Ot(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Gn.meshphysical_vert,fragmentShader:Gn.meshphysical_frag},toon:{uniforms:La([Gt.common,Gt.aomap,Gt.lightmap,Gt.emissivemap,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.gradientmap,Gt.fog,Gt.lights,{emissive:{value:new Ot(0)}}]),vertexShader:Gn.meshtoon_vert,fragmentShader:Gn.meshtoon_frag},matcap:{uniforms:La([Gt.common,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.fog,{matcap:{value:null}}]),vertexShader:Gn.meshmatcap_vert,fragmentShader:Gn.meshmatcap_frag},points:{uniforms:La([Gt.points,Gt.fog]),vertexShader:Gn.points_vert,fragmentShader:Gn.points_frag},dashed:{uniforms:La([Gt.common,Gt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Gn.linedashed_vert,fragmentShader:Gn.linedashed_frag},depth:{uniforms:La([Gt.common,Gt.displacementmap]),vertexShader:Gn.depth_vert,fragmentShader:Gn.depth_frag},normal:{uniforms:La([Gt.common,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,{opacity:{value:1}}]),vertexShader:Gn.meshnormal_vert,fragmentShader:Gn.meshnormal_frag},sprite:{uniforms:La([Gt.sprite,Gt.fog]),vertexShader:Gn.sprite_vert,fragmentShader:Gn.sprite_frag},background:{uniforms:{uvTransform:{value:new Pn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Gn.background_vert,fragmentShader:Gn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Pn}},vertexShader:Gn.backgroundCube_vert,fragmentShader:Gn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Gn.cube_vert,fragmentShader:Gn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Gn.equirect_vert,fragmentShader:Gn.equirect_frag},distanceRGBA:{uniforms:La([Gt.common,Gt.displacementmap,{referencePosition:{value:new ae},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Gn.distanceRGBA_vert,fragmentShader:Gn.distanceRGBA_frag},shadow:{uniforms:La([Gt.lights,Gt.fog,{color:{value:new Ot(0)},opacity:{value:1}}]),vertexShader:Gn.shadow_vert,fragmentShader:Gn.shadow_frag}};sc.physical={uniforms:La([sc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Pn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Pn},clearcoatNormalScale:{value:new at(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Pn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Pn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Pn},sheen:{value:0},sheenColor:{value:new Ot(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Pn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Pn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Pn},transmissionSamplerSize:{value:new at},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Pn},attenuationDistance:{value:0},attenuationColor:{value:new Ot(0)},specularColor:{value:new Ot(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Pn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Pn},anisotropyVector:{value:new at},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Pn}}]),vertexShader:Gn.meshphysical_vert,fragmentShader:Gn.meshphysical_frag};const cA={r:0,b:0,g:0},qd=new Ho,B9=new yn;function O9(r,e,t,n,i,s,a){const o=new Ot(0);let c=s===!0?0:1,u,h,p=null,v=0,y=null;function x(R){let D=R.isScene===!0?R.background:null;return D&&D.isTexture&&(D=(R.backgroundBlurriness>0?t:e).get(D)),D}function S(R){let D=!1;const P=x(R);P===null?b(o,c):P&&P.isColor&&(b(P,1),D=!0);const O=r.xr.getEnvironmentBlendMode();O==="additive"?n.buffers.color.setClear(0,0,0,1,a):O==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,a),(r.autoClear||D)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil))}function E(R,D){const P=x(D);P&&(P.isCubeTexture||P.mapping===Mg)?(h===void 0&&(h=new As(new Vp(1,1,1),new za({name:"BackgroundCubeMaterial",uniforms:ug(sc.backgroundCube.uniforms),vertexShader:sc.backgroundCube.vertexShader,fragmentShader:sc.backgroundCube.fragmentShader,side:Ga,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(O,N,U){this.matrixWorld.copyPosition(U.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(h)),qd.copy(D.backgroundRotation),qd.x*=-1,qd.y*=-1,qd.z*=-1,P.isCubeTexture&&P.isRenderTargetTexture===!1&&(qd.y*=-1,qd.z*=-1),h.material.uniforms.envMap.value=P,h.material.uniforms.flipEnvMap.value=P.isCubeTexture&&P.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=D.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=D.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(B9.makeRotationFromEuler(qd)),h.material.toneMapped=hi.getTransfer(P.colorSpace)!==Bi,(p!==P||v!==P.version||y!==r.toneMapping)&&(h.material.needsUpdate=!0,p=P,v=P.version,y=r.toneMapping),h.layers.enableAll(),R.unshift(h,h.geometry,h.material,0,0,null)):P&&P.isTexture&&(u===void 0&&(u=new As(new Hh(2,2),new za({name:"BackgroundMaterial",uniforms:ug(sc.background.uniforms),vertexShader:sc.background.vertexShader,fragmentShader:sc.background.fragmentShader,side:au,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(u)),u.material.uniforms.t2D.value=P,u.material.uniforms.backgroundIntensity.value=D.backgroundIntensity,u.material.toneMapped=hi.getTransfer(P.colorSpace)!==Bi,P.matrixAutoUpdate===!0&&P.updateMatrix(),u.material.uniforms.uvTransform.value.copy(P.matrix),(p!==P||v!==P.version||y!==r.toneMapping)&&(u.material.needsUpdate=!0,p=P,v=P.version,y=r.toneMapping),u.layers.enableAll(),R.unshift(u,u.geometry,u.material,0,0,null))}function b(R,D){R.getRGB(cA,hP(r)),n.buffers.color.setClear(cA.r,cA.g,cA.b,D,a)}function T(){h!==void 0&&(h.geometry.dispose(),h.material.dispose(),h=void 0),u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0)}return{getClearColor:function(){return o},setClearColor:function(R,D=1){o.set(R),c=D,b(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(R){c=R,b(o,c)},render:S,addToRenderList:E,dispose:T}}function P9(r,e){const t=r.getParameter(r.MAX_VERTEX_ATTRIBS),n={},i=v(null);let s=i,a=!1;function o(I,z,W,Z,te){let re=!1;const k=p(Z,W,z);s!==k&&(s=k,u(s.object)),re=y(I,Z,W,te),re&&x(I,Z,W,te),te!==null&&e.update(te,r.ELEMENT_ARRAY_BUFFER),(re||a)&&(a=!1,D(I,z,W,Z),te!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.get(te).buffer))}function c(){return r.createVertexArray()}function u(I){return r.bindVertexArray(I)}function h(I){return r.deleteVertexArray(I)}function p(I,z,W){const Z=W.wireframe===!0;let te=n[I.id];te===void 0&&(te={},n[I.id]=te);let re=te[z.id];re===void 0&&(re={},te[z.id]=re);let k=re[Z];return k===void 0&&(k=v(c()),re[Z]=k),k}function v(I){const z=[],W=[],Z=[];for(let te=0;te<t;te++)z[te]=0,W[te]=0,Z[te]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:z,enabledAttributes:W,attributeDivisors:Z,object:I,attributes:{},index:null}}function y(I,z,W,Z){const te=s.attributes,re=z.attributes;let k=0;const j=W.getAttributes();for(const J in j)if(j[J].location>=0){const K=te[J];let X=re[J];if(X===void 0&&(J==="instanceMatrix"&&I.instanceMatrix&&(X=I.instanceMatrix),J==="instanceColor"&&I.instanceColor&&(X=I.instanceColor)),K===void 0||K.attribute!==X||X&&K.data!==X.data)return!0;k++}return s.attributesNum!==k||s.index!==Z}function x(I,z,W,Z){const te={},re=z.attributes;let k=0;const j=W.getAttributes();for(const J in j)if(j[J].location>=0){let K=re[J];K===void 0&&(J==="instanceMatrix"&&I.instanceMatrix&&(K=I.instanceMatrix),J==="instanceColor"&&I.instanceColor&&(K=I.instanceColor));const X={};X.attribute=K,K&&K.data&&(X.data=K.data),te[J]=X,k++}s.attributes=te,s.attributesNum=k,s.index=Z}function S(){const I=s.newAttributes;for(let z=0,W=I.length;z<W;z++)I[z]=0}function E(I){b(I,0)}function b(I,z){const W=s.newAttributes,Z=s.enabledAttributes,te=s.attributeDivisors;W[I]=1,Z[I]===0&&(r.enableVertexAttribArray(I),Z[I]=1),te[I]!==z&&(r.vertexAttribDivisor(I,z),te[I]=z)}function T(){const I=s.newAttributes,z=s.enabledAttributes;for(let W=0,Z=z.length;W<Z;W++)z[W]!==I[W]&&(r.disableVertexAttribArray(W),z[W]=0)}function R(I,z,W,Z,te,re,k){k===!0?r.vertexAttribIPointer(I,z,W,te,re):r.vertexAttribPointer(I,z,W,Z,te,re)}function D(I,z,W,Z){S();const te=Z.attributes,re=W.getAttributes(),k=z.defaultAttributeValues;for(const j in re){const J=re[j];if(J.location>=0){let oe=te[j];if(oe===void 0&&(j==="instanceMatrix"&&I.instanceMatrix&&(oe=I.instanceMatrix),j==="instanceColor"&&I.instanceColor&&(oe=I.instanceColor)),oe!==void 0){const K=oe.normalized,X=oe.itemSize,ne=e.get(oe);if(ne===void 0)continue;const xe=ne.buffer,_e=ne.type,Be=ne.bytesPerElement,pe=_e===r.INT||_e===r.UNSIGNED_INT||oe.gpuType===Ux;if(oe.isInterleavedBufferAttribute){const be=oe.data,je=be.stride,gt=oe.offset;if(be.isInstancedInterleavedBuffer){for(let St=0;St<J.locationSize;St++)b(J.location+St,be.meshPerAttribute);I.isInstancedMesh!==!0&&Z._maxInstanceCount===void 0&&(Z._maxInstanceCount=be.meshPerAttribute*be.count)}else for(let St=0;St<J.locationSize;St++)E(J.location+St);r.bindBuffer(r.ARRAY_BUFFER,xe);for(let St=0;St<J.locationSize;St++)R(J.location+St,X/J.locationSize,_e,K,je*Be,(gt+X/J.locationSize*St)*Be,pe)}else{if(oe.isInstancedBufferAttribute){for(let be=0;be<J.locationSize;be++)b(J.location+be,oe.meshPerAttribute);I.isInstancedMesh!==!0&&Z._maxInstanceCount===void 0&&(Z._maxInstanceCount=oe.meshPerAttribute*oe.count)}else for(let be=0;be<J.locationSize;be++)E(J.location+be);r.bindBuffer(r.ARRAY_BUFFER,xe);for(let be=0;be<J.locationSize;be++)R(J.location+be,X/J.locationSize,_e,K,X*Be,X/J.locationSize*be*Be,pe)}}else if(k!==void 0){const K=k[j];if(K!==void 0)switch(K.length){case 2:r.vertexAttrib2fv(J.location,K);break;case 3:r.vertexAttrib3fv(J.location,K);break;case 4:r.vertexAttrib4fv(J.location,K);break;default:r.vertexAttrib1fv(J.location,K)}}}}T()}function P(){U();for(const I in n){const z=n[I];for(const W in z){const Z=z[W];for(const te in Z)h(Z[te].object),delete Z[te];delete z[W]}delete n[I]}}function O(I){if(n[I.id]===void 0)return;const z=n[I.id];for(const W in z){const Z=z[W];for(const te in Z)h(Z[te].object),delete Z[te];delete z[W]}delete n[I.id]}function N(I){for(const z in n){const W=n[z];if(W[I.id]===void 0)continue;const Z=W[I.id];for(const te in Z)h(Z[te].object),delete Z[te];delete W[I.id]}}function U(){B(),a=!0,s!==i&&(s=i,u(s.object))}function B(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:o,reset:U,resetDefaultState:B,dispose:P,releaseStatesOfGeometry:O,releaseStatesOfProgram:N,initAttributes:S,enableAttribute:E,disableUnusedAttributes:T}}function N9(r,e,t){let n;function i(u){n=u}function s(u,h){r.drawArrays(n,u,h),t.update(h,n,1)}function a(u,h,p){p!==0&&(r.drawArraysInstanced(n,u,h,p),t.update(h,n,p))}function o(u,h,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,u,0,h,0,p);let y=0;for(let x=0;x<p;x++)y+=h[x];t.update(y,n,1)}function c(u,h,p,v){if(p===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let x=0;x<u.length;x++)a(u[x],h[x],v[x]);else{y.multiDrawArraysInstancedWEBGL(n,u,0,h,0,v,0,p);let x=0;for(let S=0;S<p;S++)x+=h[S]*v[S];t.update(x,n,1)}}this.setMode=i,this.render=s,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=c}function U9(r,e,t,n){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const N=e.get("EXT_texture_filter_anisotropic");i=r.getParameter(N.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function a(N){return!(N!==Ns&&n.convert(N)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(N){const U=N===ar&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(N!==Ha&&n.convert(N)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_TYPE)&&N!==Ss&&!U)}function c(N){if(N==="highp"){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";N="mediump"}return N==="mediump"&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=t.precision!==void 0?t.precision:"highp";const h=c(u);h!==u&&(Ht("WebGLRenderer:",u,"not supported, using",h,"instead."),u=h);const p=t.logarithmicDepthBuffer===!0,v=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),y=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),x=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),S=r.getParameter(r.MAX_TEXTURE_SIZE),E=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),b=r.getParameter(r.MAX_VERTEX_ATTRIBS),T=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),R=r.getParameter(r.MAX_VARYING_VECTORS),D=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),P=x>0,O=r.getParameter(r.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:a,textureTypeReadable:o,precision:u,logarithmicDepthBuffer:p,reversedDepthBuffer:v,maxTextures:y,maxVertexTextures:x,maxTextureSize:S,maxCubemapSize:E,maxAttributes:b,maxVertexUniforms:T,maxVaryings:R,maxFragmentUniforms:D,vertexTextures:P,maxSamples:O}}function F9(r){const e=this;let t=null,n=0,i=!1,s=!1;const a=new tf,o=new Pn,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(p,v){const y=p.length!==0||v||n!==0||i;return i=v,n=p.length,y},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(p,v){t=h(p,v,0)},this.setState=function(p,v,y){const x=p.clippingPlanes,S=p.clipIntersection,E=p.clipShadows,b=r.get(p);if(!i||x===null||x.length===0||s&&!E)s?h(null):u();else{const T=s?0:n,R=T*4;let D=b.clippingState||null;c.value=D,D=h(x,v,R,y);for(let P=0;P!==R;++P)D[P]=t[P];b.clippingState=D,this.numIntersection=S?this.numPlanes:0,this.numPlanes+=T}};function u(){c.value!==t&&(c.value=t,c.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function h(p,v,y,x){const S=p!==null?p.length:0;let E=null;if(S!==0){if(E=c.value,x!==!0||E===null){const b=y+S*4,T=v.matrixWorldInverse;o.getNormalMatrix(T),(E===null||E.length<b)&&(E=new Float32Array(b));for(let R=0,D=y;R!==S;++R,D+=4)a.copy(p[R]).applyMatrix4(T,o),a.normal.toArray(E,D),E[D+3]=a.constant}c.value=E,c.needsUpdate=!0}return e.numPlanes=S,e.numIntersection=0,E}}function k9(r){let e=new WeakMap;function t(a,o){return o===Q0?a.mapping=ou:o===ox&&(a.mapping=wh),a}function n(a){if(a&&a.isTexture){const o=a.mapping;if(o===Q0||o===ox)if(e.has(a)){const c=e.get(a).texture;return t(c,a.mapping)}else{const c=a.image;if(c&&c.height>0){const u=new nD(c.height);return u.fromEquirectangularTexture(r,a),e.set(a,u),a.addEventListener("dispose",i),t(u.texture,a.mapping)}else return null}}return a}function i(a){const o=a.target;o.removeEventListener("dispose",i);const c=e.get(o);c!==void 0&&(e.delete(o),c.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}const xh=4,l2=[.125,.215,.35,.446,.526,.582],op=20,G9=256,my=new _l,c2=new Ot;let sM=null,rM=0,aM=0,oM=!1;const H9=new ae;class kC{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,t=0,n=.1,i=100,s={}){const{size:a=256,position:o=H9}=s;sM=this._renderer.getRenderTarget(),rM=this._renderer.getActiveCubeFace(),aM=this._renderer.getActiveMipmapLevel(),oM=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,n,i,c,o),t>0&&this._blur(c,0,0,t),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=h2(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=f2(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(sM,rM,aM),this._renderer.xr.enabled=oM,e.scissorTest=!1,x0(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ou||e.mapping===wh?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),sM=this._renderer.getRenderTarget(),rM=this._renderer.getActiveCubeFace(),aM=this._renderer.getActiveMipmapLevel(),oM=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:yi,minFilter:yi,generateMipmaps:!1,type:ar,format:Ns,colorSpace:cc,depthBuffer:!1},i=u2(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=u2(e,t,n);const{_lodMax:s}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=z9(s)),this._blurMaterial=Y9(s,e,t),this._ggxMaterial=V9(s,e,t)}return i}_compileMaterial(e){const t=new As(new Ln,e);this._renderer.compile(t,my)}_sceneToCubeUV(e,t,n,i,s){const c=new cs(90,1,t,n),u=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],p=this._renderer,v=p.autoClear,y=p.toneMapping;p.getClearColor(c2),p.toneMapping=su,p.autoClear=!1,p.state.buffers.depth.getReversed()&&(p.setRenderTarget(i),p.clearDepth(),p.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new As(new Vp,new ao({name:"PMREM.Background",side:Ga,depthWrite:!1,depthTest:!1})));const S=this._backgroundBox,E=S.material;let b=!1;const T=e.background;T?T.isColor&&(E.color.copy(T),e.background=null,b=!0):(E.color.copy(c2),b=!0);for(let R=0;R<6;R++){const D=R%3;D===0?(c.up.set(0,u[R],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x+h[R],s.y,s.z)):D===1?(c.up.set(0,0,u[R]),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y+h[R],s.z)):(c.up.set(0,u[R],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y,s.z+h[R]));const P=this._cubeSize;x0(i,D*P,R>2?P:0,P,P),p.setRenderTarget(i),b&&p.render(S,c),p.render(e,c)}p.toneMapping=y,p.autoClear=v,e.background=T}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===ou||e.mapping===wh;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=h2()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=f2());const s=i?this._cubemapMaterial:this._equirectMaterial,a=this._lodMeshes[0];a.material=s;const o=s.uniforms;o.envMap.value=e;const c=this._cubeSize;x0(t,0,0,3*c,2*c),n.setRenderTarget(t),n.render(a,my)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodMeshes.length;for(let s=1;s<i;s++)this._applyGGXFilter(e,s-1,s);t.autoClear=n}_applyGGXFilter(e,t,n){const i=this._renderer,s=this._pingPongRenderTarget,a=this._ggxMaterial,o=this._lodMeshes[n];o.material=a;const c=a.uniforms,u=n/(this._lodMeshes.length-1),h=t/(this._lodMeshes.length-1),p=Math.sqrt(u*u-h*h),v=.05+u*.95,y=p*v,{_lodMax:x}=this,S=this._sizeLods[n],E=3*S*(n>x-xh?n-x+xh:0),b=4*(this._cubeSize-S);c.envMap.value=e.texture,c.roughness.value=y,c.mipInt.value=x-t,x0(s,E,b,3*S,2*S),i.setRenderTarget(s),i.render(o,my),c.envMap.value=s.texture,c.roughness.value=0,c.mipInt.value=x-n,x0(e,E,b,3*S,2*S),i.setRenderTarget(e),i.render(o,my)}_blur(e,t,n,i,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",s),this._halfBlur(a,e,n,n,i,"longitudinal",s)}_halfBlur(e,t,n,i,s,a,o){const c=this._renderer,u=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&Cn("blur direction must be either latitudinal or longitudinal!");const h=3,p=this._lodMeshes[i];p.material=u;const v=u.uniforms,y=this._sizeLods[n]-1,x=isFinite(s)?Math.PI/(2*y):2*Math.PI/(2*op-1),S=s/x,E=isFinite(s)?1+Math.floor(h*S):op;E>op&&Ht(`sigmaRadians, ${s}, is too large and will clip, as it requested ${E} samples when the maximum is set to ${op}`);const b=[];let T=0;for(let N=0;N<op;++N){const U=N/S,B=Math.exp(-U*U/2);b.push(B),N===0?T+=B:N<E&&(T+=2*B)}for(let N=0;N<b.length;N++)b[N]=b[N]/T;v.envMap.value=e.texture,v.samples.value=E,v.weights.value=b,v.latitudinal.value=a==="latitudinal",o&&(v.poleAxis.value=o);const{_lodMax:R}=this;v.dTheta.value=x,v.mipInt.value=R-n;const D=this._sizeLods[i],P=3*D*(i>R-xh?i-R+xh:0),O=4*(this._cubeSize-D);x0(t,P,O,3*D,2*D),c.setRenderTarget(t),c.render(p,my)}}function z9(r){const e=[],t=[],n=[];let i=r;const s=r-xh+1+l2.length;for(let a=0;a<s;a++){const o=Math.pow(2,i);e.push(o);let c=1/o;a>r-xh?c=l2[a-r+xh-1]:a===0&&(c=0),t.push(c);const u=1/(o-2),h=-u,p=1+u,v=[h,h,p,h,p,p,h,h,p,p,h,p],y=6,x=6,S=3,E=2,b=1,T=new Float32Array(S*x*y),R=new Float32Array(E*x*y),D=new Float32Array(b*x*y);for(let O=0;O<y;O++){const N=O%3*2/3-1,U=O>2?0:-1,B=[N,U,0,N+2/3,U,0,N+2/3,U+1,0,N,U,0,N+2/3,U+1,0,N,U+1,0];T.set(B,S*x*O),R.set(v,E*x*O);const I=[O,O,O,O,O,O];D.set(I,b*x*O)}const P=new Ln;P.setAttribute("position",new xi(T,S)),P.setAttribute("uv",new xi(R,E)),P.setAttribute("faceIndex",new xi(D,b)),n.push(new As(P,null)),i>xh&&i--}return{lodMeshes:n,sizeLods:e,sigmas:t}}function u2(r,e,t){const n=new Al(r,e,t);return n.texture.mapping=Mg,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function x0(r,e,t,n,i){r.viewport.set(e,t,n,i),r.scissor.set(e,t,n,i)}function V9(r,e,t){return new za({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:G9,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:mT(),fragmentShader:`

			precision highp float;
			precision highp int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:lc,depthTest:!1,depthWrite:!1})}function Y9(r,e,t){const n=new Float32Array(op),i=new ae(0,1,0);return new za({name:"SphericalGaussianBlur",defines:{n:op,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:mT(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:lc,depthTest:!1,depthWrite:!1})}function f2(){return new za({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:mT(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:lc,depthTest:!1,depthWrite:!1})}function h2(){return new za({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:mT(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:lc,depthTest:!1,depthWrite:!1})}function mT(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function X9(r){let e=new WeakMap,t=null;function n(o){if(o&&o.isTexture){const c=o.mapping,u=c===Q0||c===ox,h=c===ou||c===wh;if(u||h){let p=e.get(o);const v=p!==void 0?p.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==v)return t===null&&(t=new kC(r)),p=u?t.fromEquirectangular(o,p):t.fromCubemap(o,p),p.texture.pmremVersion=o.pmremVersion,e.set(o,p),p.texture;if(p!==void 0)return p.texture;{const y=o.image;return u&&y&&y.height>0||h&&y&&i(y)?(t===null&&(t=new kC(r)),p=u?t.fromEquirectangular(o):t.fromCubemap(o),p.texture.pmremVersion=o.pmremVersion,e.set(o,p),o.addEventListener("dispose",s),p.texture):null}}}return o}function i(o){let c=0;const u=6;for(let h=0;h<u;h++)o[h]!==void 0&&c++;return c===u}function s(o){const c=o.target;c.removeEventListener("dispose",s);const u=e.get(c);u!==void 0&&(e.delete(c),u.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:a}}function K9(r){const e={};function t(n){if(e[n]!==void 0)return e[n];const i=r.getExtension(n);return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const i=t(n);return i===null&&og("WebGLRenderer: "+n+" extension not supported."),i}}}function q9(r,e,t,n){const i={},s=new WeakMap;function a(p){const v=p.target;v.index!==null&&e.remove(v.index);for(const x in v.attributes)e.remove(v.attributes[x]);v.removeEventListener("dispose",a),delete i[v.id];const y=s.get(v);y&&(e.remove(y),s.delete(v)),n.releaseStatesOfGeometry(v),v.isInstancedBufferGeometry===!0&&delete v._maxInstanceCount,t.memory.geometries--}function o(p,v){return i[v.id]===!0||(v.addEventListener("dispose",a),i[v.id]=!0,t.memory.geometries++),v}function c(p){const v=p.attributes;for(const y in v)e.update(v[y],r.ARRAY_BUFFER)}function u(p){const v=[],y=p.index,x=p.attributes.position;let S=0;if(y!==null){const T=y.array;S=y.version;for(let R=0,D=T.length;R<D;R+=3){const P=T[R+0],O=T[R+1],N=T[R+2];v.push(P,O,O,N,N,P)}}else if(x!==void 0){const T=x.array;S=x.version;for(let R=0,D=T.length/3-1;R<D;R+=3){const P=R+0,O=R+1,N=R+2;v.push(P,O,O,N,N,P)}}else return;const E=new(oP(v)?tD:eD)(v,1);E.version=S;const b=s.get(p);b&&e.remove(b),s.set(p,E)}function h(p){const v=s.get(p);if(v){const y=p.index;y!==null&&v.version<y.version&&u(p)}else u(p);return s.get(p)}return{get:o,update:c,getWireframeAttribute:h}}function j9(r,e,t){let n;function i(v){n=v}let s,a;function o(v){s=v.type,a=v.bytesPerElement}function c(v,y){r.drawElements(n,y,s,v*a),t.update(y,n,1)}function u(v,y,x){x!==0&&(r.drawElementsInstanced(n,y,s,v*a,x),t.update(y,n,x))}function h(v,y,x){if(x===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,y,0,s,v,0,x);let E=0;for(let b=0;b<x;b++)E+=y[b];t.update(E,n,1)}function p(v,y,x,S){if(x===0)return;const E=e.get("WEBGL_multi_draw");if(E===null)for(let b=0;b<v.length;b++)u(v[b]/a,y[b],S[b]);else{E.multiDrawElementsInstancedWEBGL(n,y,0,s,v,0,S,0,x);let b=0;for(let T=0;T<x;T++)b+=y[T]*S[T];t.update(b,n,1)}}this.setMode=i,this.setIndex=o,this.render=c,this.renderInstances=u,this.renderMultiDraw=h,this.renderMultiDrawInstances=p}function W9(r){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,a,o){switch(t.calls++,a){case r.TRIANGLES:t.triangles+=o*(s/3);break;case r.LINES:t.lines+=o*(s/2);break;case r.LINE_STRIP:t.lines+=o*(s-1);break;case r.LINE_LOOP:t.lines+=o*s;break;case r.POINTS:t.points+=o*s;break;default:Cn("WebGLInfo: Unknown draw mode:",a);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function J9(r,e,t){const n=new WeakMap,i=new vi;function s(a,o,c){const u=a.morphTargetInfluences,h=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,p=h!==void 0?h.length:0;let v=n.get(o);if(v===void 0||v.count!==p){let B=function(){N.dispose(),n.delete(o),o.removeEventListener("dispose",B)};v!==void 0&&v.texture.dispose();const y=o.morphAttributes.position!==void 0,x=o.morphAttributes.normal!==void 0,S=o.morphAttributes.color!==void 0,E=o.morphAttributes.position||[],b=o.morphAttributes.normal||[],T=o.morphAttributes.color||[];let R=0;y===!0&&(R=1),x===!0&&(R=2),S===!0&&(R=3);let D=o.attributes.position.count*R,P=1;D>e.maxTextureSize&&(P=Math.ceil(D/e.maxTextureSize),D=e.maxTextureSize);const O=new Float32Array(D*P*4*p),N=new Kb(O,D,P,p);N.type=Ss,N.needsUpdate=!0;const U=R*4;for(let I=0;I<p;I++){const z=E[I],W=b[I],Z=T[I],te=D*P*4*I;for(let re=0;re<z.count;re++){const k=re*U;y===!0&&(i.fromBufferAttribute(z,re),O[te+k+0]=i.x,O[te+k+1]=i.y,O[te+k+2]=i.z,O[te+k+3]=0),x===!0&&(i.fromBufferAttribute(W,re),O[te+k+4]=i.x,O[te+k+5]=i.y,O[te+k+6]=i.z,O[te+k+7]=0),S===!0&&(i.fromBufferAttribute(Z,re),O[te+k+8]=i.x,O[te+k+9]=i.y,O[te+k+10]=i.z,O[te+k+11]=Z.itemSize===4?i.w:1)}}v={count:p,texture:N,size:new at(D,P)},n.set(o,v),o.addEventListener("dispose",B)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)c.getUniforms().setValue(r,"morphTexture",a.morphTexture,t);else{let y=0;for(let S=0;S<u.length;S++)y+=u[S];const x=o.morphTargetsRelative?1:1-y;c.getUniforms().setValue(r,"morphTargetBaseInfluence",x),c.getUniforms().setValue(r,"morphTargetInfluences",u)}c.getUniforms().setValue(r,"morphTargetsTexture",v.texture,t),c.getUniforms().setValue(r,"morphTargetsTextureSize",v.size)}return{update:s}}function $9(r,e,t,n){let i=new WeakMap;function s(c){const u=n.render.frame,h=c.geometry,p=e.get(c,h);if(i.get(p)!==u&&(e.update(p),i.set(p,u)),c.isInstancedMesh&&(c.hasEventListener("dispose",o)===!1&&c.addEventListener("dispose",o),i.get(c)!==u&&(t.update(c.instanceMatrix,r.ARRAY_BUFFER),c.instanceColor!==null&&t.update(c.instanceColor,r.ARRAY_BUFFER),i.set(c,u))),c.isSkinnedMesh){const v=c.skeleton;i.get(v)!==u&&(v.update(),i.set(v,u))}return p}function a(){i=new WeakMap}function o(c){const u=c.target;u.removeEventListener("dispose",o),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:s,dispose:a}}const rN=new Ti,d2=new cD(1,1),aN=new Kb,oN=new qb,lN=new Gx,p2=[],m2=[],g2=new Float32Array(16),v2=new Float32Array(9),y2=new Float32Array(4);function Dg(r,e,t){const n=r[0];if(n<=0||n>0)return r;const i=e*t;let s=p2[i];if(s===void 0&&(s=new Float32Array(i),p2[i]=s),e!==0){n.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=t,r[a].toArray(s,o)}return s}function lr(r,e){if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;t++)if(r[t]!==e[t])return!1;return!0}function cr(r,e){for(let t=0,n=e.length;t<n;t++)r[t]=e[t]}function gT(r,e){let t=m2[e];t===void 0&&(t=new Int32Array(e),m2[e]=t);for(let n=0;n!==e;++n)t[n]=r.allocateTextureUnit();return t}function Q9(r,e){const t=this.cache;t[0]!==e&&(r.uniform1f(this.addr,e),t[0]=e)}function Z9(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(lr(t,e))return;r.uniform2fv(this.addr,e),cr(t,e)}}function eV(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(lr(t,e))return;r.uniform3fv(this.addr,e),cr(t,e)}}function tV(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(lr(t,e))return;r.uniform4fv(this.addr,e),cr(t,e)}}function nV(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(lr(t,e))return;r.uniformMatrix2fv(this.addr,!1,e),cr(t,e)}else{if(lr(t,n))return;y2.set(n),r.uniformMatrix2fv(this.addr,!1,y2),cr(t,n)}}function iV(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(lr(t,e))return;r.uniformMatrix3fv(this.addr,!1,e),cr(t,e)}else{if(lr(t,n))return;v2.set(n),r.uniformMatrix3fv(this.addr,!1,v2),cr(t,n)}}function sV(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(lr(t,e))return;r.uniformMatrix4fv(this.addr,!1,e),cr(t,e)}else{if(lr(t,n))return;g2.set(n),r.uniformMatrix4fv(this.addr,!1,g2),cr(t,n)}}function rV(r,e){const t=this.cache;t[0]!==e&&(r.uniform1i(this.addr,e),t[0]=e)}function aV(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(lr(t,e))return;r.uniform2iv(this.addr,e),cr(t,e)}}function oV(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(lr(t,e))return;r.uniform3iv(this.addr,e),cr(t,e)}}function lV(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(lr(t,e))return;r.uniform4iv(this.addr,e),cr(t,e)}}function cV(r,e){const t=this.cache;t[0]!==e&&(r.uniform1ui(this.addr,e),t[0]=e)}function uV(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(lr(t,e))return;r.uniform2uiv(this.addr,e),cr(t,e)}}function fV(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(lr(t,e))return;r.uniform3uiv(this.addr,e),cr(t,e)}}function hV(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(lr(t,e))return;r.uniform4uiv(this.addr,e),cr(t,e)}}function dV(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i);let s;this.type===r.SAMPLER_2D_SHADOW?(d2.compareFunction=$R,s=d2):s=rN,t.setTexture2D(e||s,i)}function pV(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||oN,i)}function mV(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTextureCube(e||lN,i)}function gV(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||aN,i)}function vV(r){switch(r){case 5126:return Q9;case 35664:return Z9;case 35665:return eV;case 35666:return tV;case 35674:return nV;case 35675:return iV;case 35676:return sV;case 5124:case 35670:return rV;case 35667:case 35671:return aV;case 35668:case 35672:return oV;case 35669:case 35673:return lV;case 5125:return cV;case 36294:return uV;case 36295:return fV;case 36296:return hV;case 35678:case 36198:case 36298:case 36306:case 35682:return dV;case 35679:case 36299:case 36307:return pV;case 35680:case 36300:case 36308:case 36293:return mV;case 36289:case 36303:case 36311:case 36292:return gV}}function yV(r,e){r.uniform1fv(this.addr,e)}function xV(r,e){const t=Dg(e,this.size,2);r.uniform2fv(this.addr,t)}function _V(r,e){const t=Dg(e,this.size,3);r.uniform3fv(this.addr,t)}function SV(r,e){const t=Dg(e,this.size,4);r.uniform4fv(this.addr,t)}function AV(r,e){const t=Dg(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,t)}function EV(r,e){const t=Dg(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,t)}function bV(r,e){const t=Dg(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,t)}function TV(r,e){r.uniform1iv(this.addr,e)}function MV(r,e){r.uniform2iv(this.addr,e)}function CV(r,e){r.uniform3iv(this.addr,e)}function RV(r,e){r.uniform4iv(this.addr,e)}function DV(r,e){r.uniform1uiv(this.addr,e)}function LV(r,e){r.uniform2uiv(this.addr,e)}function wV(r,e){r.uniform3uiv(this.addr,e)}function IV(r,e){r.uniform4uiv(this.addr,e)}function BV(r,e,t){const n=this.cache,i=e.length,s=gT(t,i);lr(n,s)||(r.uniform1iv(this.addr,s),cr(n,s));for(let a=0;a!==i;++a)t.setTexture2D(e[a]||rN,s[a])}function OV(r,e,t){const n=this.cache,i=e.length,s=gT(t,i);lr(n,s)||(r.uniform1iv(this.addr,s),cr(n,s));for(let a=0;a!==i;++a)t.setTexture3D(e[a]||oN,s[a])}function PV(r,e,t){const n=this.cache,i=e.length,s=gT(t,i);lr(n,s)||(r.uniform1iv(this.addr,s),cr(n,s));for(let a=0;a!==i;++a)t.setTextureCube(e[a]||lN,s[a])}function NV(r,e,t){const n=this.cache,i=e.length,s=gT(t,i);lr(n,s)||(r.uniform1iv(this.addr,s),cr(n,s));for(let a=0;a!==i;++a)t.setTexture2DArray(e[a]||aN,s[a])}function UV(r){switch(r){case 5126:return yV;case 35664:return xV;case 35665:return _V;case 35666:return SV;case 35674:return AV;case 35675:return EV;case 35676:return bV;case 5124:case 35670:return TV;case 35667:case 35671:return MV;case 35668:case 35672:return CV;case 35669:case 35673:return RV;case 5125:return DV;case 36294:return LV;case 36295:return wV;case 36296:return IV;case 35678:case 36198:case 36298:case 36306:case 35682:return BV;case 35679:case 36299:case 36307:return OV;case 35680:case 36300:case 36308:case 36293:return PV;case 36289:case 36303:case 36311:case 36292:return NV}}class FV{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=vV(t.type)}}class kV{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=UV(t.type)}}class GV{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let s=0,a=i.length;s!==a;++s){const o=i[s];o.setValue(e,t[o.id],n)}}}const lM=/(\w+)(\])?(\[|\.)?/g;function x2(r,e){r.seq.push(e),r.map[e.id]=e}function HV(r,e,t){const n=r.name,i=n.length;for(lM.lastIndex=0;;){const s=lM.exec(n),a=lM.lastIndex;let o=s[1];const c=s[2]==="]",u=s[3];if(c&&(o=o|0),u===void 0||u==="["&&a+2===i){x2(t,u===void 0?new FV(o,r,e):new kV(o,r,e));break}else{let p=t.map[o];p===void 0&&(p=new GV(o),x2(t,p)),t=p}}}class eE{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const s=e.getActiveUniform(t,i),a=e.getUniformLocation(t,s.name);HV(s,a,this)}}setValue(e,t,n,i){const s=this.map[t];s!==void 0&&s.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];i!==void 0&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let s=0,a=t.length;s!==a;++s){const o=t[s],c=n[o.id];c.needsUpdate!==!1&&o.setValue(e,c.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,s=e.length;i!==s;++i){const a=e[i];a.id in t&&n.push(a)}return n}}function _2(r,e,t){const n=r.createShader(e);return r.shaderSource(n,t),r.compileShader(n),n}const zV=37297;let VV=0;function YV(r,e){const t=r.split(`
`),n=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let a=i;a<s;a++){const o=a+1;n.push(`${o===e?">":" "} ${o}: ${t[a]}`)}return n.join(`
`)}const S2=new Pn;function XV(r){hi._getMatrix(S2,hi.workingColorSpace,r);const e=`mat3( ${S2.elements.map(t=>t.toFixed(4))} )`;switch(hi.getTransfer(r)){case cx:return[e,"LinearTransferOETF"];case Bi:return[e,"sRGBTransferOETF"];default:return Ht("WebGLProgram: Unsupported color space: ",r),[e,"LinearTransferOETF"]}}function A2(r,e,t){const n=r.getShaderParameter(e,r.COMPILE_STATUS),s=(r.getShaderInfoLog(e)||"").trim();if(n&&s==="")return"";const a=/ERROR: 0:(\d+)/.exec(s);if(a){const o=parseInt(a[1]);return t.toUpperCase()+`

`+s+`

`+YV(r.getShaderSource(e),o)}else return s}function KV(r,e){const t=XV(e);return[`vec4 ${r}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function qV(r,e){let t;switch(e){case GO:t="Linear";break;case HO:t="Reinhard";break;case zO:t="Cineon";break;case YR:t="ACESFilmic";break;case YO:t="AgX";break;case XO:t="Neutral";break;case VO:t="Custom";break;default:Ht("WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+r+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const uA=new ae;function jV(){hi.getLuminanceCoefficients(uA);const r=uA.x.toFixed(4),e=uA.y.toFixed(4),t=uA.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${r}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function WV(r){return[r.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",r.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(My).join(`
`)}function JV(r){const e=[];for(const t in r){const n=r[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function $V(r,e){const t={},n=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const s=r.getActiveAttrib(e,i),a=s.name;let o=1;s.type===r.FLOAT_MAT2&&(o=2),s.type===r.FLOAT_MAT3&&(o=3),s.type===r.FLOAT_MAT4&&(o=4),t[a]={type:s.type,location:r.getAttribLocation(e,a),locationSize:o}}return t}function My(r){return r!==""}function E2(r,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function b2(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const QV=/^[ \t]*#include +<([\w\d./]+)>/gm;function GC(r){return r.replace(QV,e7)}const ZV=new Map;function e7(r,e){let t=Gn[e];if(t===void 0){const n=ZV.get(e);if(n!==void 0)t=Gn[n],Ht('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return GC(t)}const t7=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function T2(r){return r.replace(t7,n7)}function n7(r,e,t,n){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function M2(r){let e=`precision ${r.precision} float;
	precision ${r.precision} int;
	precision ${r.precision} sampler2D;
	precision ${r.precision} samplerCube;
	precision ${r.precision} sampler3D;
	precision ${r.precision} sampler2DArray;
	precision ${r.precision} sampler2DShadow;
	precision ${r.precision} samplerCubeShadow;
	precision ${r.precision} sampler2DArrayShadow;
	precision ${r.precision} isampler2D;
	precision ${r.precision} isampler3D;
	precision ${r.precision} isamplerCube;
	precision ${r.precision} isampler2DArray;
	precision ${r.precision} usampler2D;
	precision ${r.precision} usampler3D;
	precision ${r.precision} usamplerCube;
	precision ${r.precision} usampler2DArray;
	`;return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function i7(r){let e="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===Nb?e="SHADOWMAP_TYPE_PCF":r.shadowMapType===Py?e="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===ic&&(e="SHADOWMAP_TYPE_VSM"),e}function s7(r){let e="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case ou:case wh:e="ENVMAP_TYPE_CUBE";break;case Mg:e="ENVMAP_TYPE_CUBE_UV";break}return e}function r7(r){let e="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case wh:e="ENVMAP_MODE_REFRACTION";break}return e}function a7(r){let e="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case Nx:e="ENVMAP_BLENDING_MULTIPLY";break;case FO:e="ENVMAP_BLENDING_MIX";break;case kO:e="ENVMAP_BLENDING_ADD";break}return e}function o7(r){const e=r.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}function l7(r,e,t,n){const i=r.getContext(),s=t.defines;let a=t.vertexShader,o=t.fragmentShader;const c=i7(t),u=s7(t),h=r7(t),p=a7(t),v=o7(t),y=WV(t),x=JV(s),S=i.createProgram();let E,b,T=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(E=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,x].filter(My).join(`
`),E.length>0&&(E+=`
`),b=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,x].filter(My).join(`
`),b.length>0&&(b+=`
`)):(E=[M2(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,x,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(My).join(`
`),b=[M2(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,x,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",t.envMap?"#define "+p:"",v?"#define CUBEUV_TEXEL_WIDTH "+v.texelWidth:"",v?"#define CUBEUV_TEXEL_HEIGHT "+v.texelHeight:"",v?"#define CUBEUV_MAX_MIP "+v.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==su?"#define TONE_MAPPING":"",t.toneMapping!==su?Gn.tonemapping_pars_fragment:"",t.toneMapping!==su?qV("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Gn.colorspace_pars_fragment,KV("linearToOutputTexel",t.outputColorSpace),jV(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(My).join(`
`)),a=GC(a),a=E2(a,t),a=b2(a,t),o=GC(o),o=E2(o,t),o=b2(o,t),a=T2(a),o=T2(o),t.isRawShaderMaterial!==!0&&(T=`#version 300 es
`,E=[y,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+E,b=["#define varying in",t.glslVersion===wC?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===wC?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+b);const R=T+E+a,D=T+b+o,P=_2(i,i.VERTEX_SHADER,R),O=_2(i,i.FRAGMENT_SHADER,D);i.attachShader(S,P),i.attachShader(S,O),t.index0AttributeName!==void 0?i.bindAttribLocation(S,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(S,0,"position"),i.linkProgram(S);function N(z){if(r.debug.checkShaderErrors){const W=i.getProgramInfoLog(S)||"",Z=i.getShaderInfoLog(P)||"",te=i.getShaderInfoLog(O)||"",re=W.trim(),k=Z.trim(),j=te.trim();let J=!0,oe=!0;if(i.getProgramParameter(S,i.LINK_STATUS)===!1)if(J=!1,typeof r.debug.onShaderError=="function")r.debug.onShaderError(i,S,P,O);else{const K=A2(i,P,"vertex"),X=A2(i,O,"fragment");Cn("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(S,i.VALIDATE_STATUS)+`

Material Name: `+z.name+`
Material Type: `+z.type+`

Program Info Log: `+re+`
`+K+`
`+X)}else re!==""?Ht("WebGLProgram: Program Info Log:",re):(k===""||j==="")&&(oe=!1);oe&&(z.diagnostics={runnable:J,programLog:re,vertexShader:{log:k,prefix:E},fragmentShader:{log:j,prefix:b}})}i.deleteShader(P),i.deleteShader(O),U=new eE(i,S),B=$V(i,S)}let U;this.getUniforms=function(){return U===void 0&&N(this),U};let B;this.getAttributes=function(){return B===void 0&&N(this),B};let I=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return I===!1&&(I=i.getProgramParameter(S,zV)),I},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(S),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=VV++,this.cacheKey=e,this.usedTimes=1,this.program=S,this.vertexShader=P,this.fragmentShader=O,this}let c7=0;class u7{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),s=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return a.has(i)===!1&&(a.add(i),i.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new f7(e),t.set(e,n)),n}}class f7{constructor(e){this.id=c7++,this.code=e,this.usedTimes=0}}function h7(r,e,t,n,i,s,a){const o=new cg,c=new u7,u=new Set,h=[],p=i.logarithmicDepthBuffer,v=i.vertexTextures;let y=i.precision;const x={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function S(B){return u.add(B),B===0?"uv":`uv${B}`}function E(B,I,z,W,Z){const te=W.fog,re=Z.geometry,k=B.isMeshStandardMaterial?W.environment:null,j=(B.isMeshStandardMaterial?t:e).get(B.envMap||k),J=j&&j.mapping===Mg?j.image.height:null,oe=x[B.type];B.precision!==null&&(y=i.getMaxPrecision(B.precision),y!==B.precision&&Ht("WebGLProgram.getParameters:",B.precision,"not supported, using",y,"instead."));const K=re.morphAttributes.position||re.morphAttributes.normal||re.morphAttributes.color,X=K!==void 0?K.length:0;let ne=0;re.morphAttributes.position!==void 0&&(ne=1),re.morphAttributes.normal!==void 0&&(ne=2),re.morphAttributes.color!==void 0&&(ne=3);let xe,_e,Be,pe;if(oe){const Dt=sc[oe];xe=Dt.vertexShader,_e=Dt.fragmentShader}else xe=B.vertexShader,_e=B.fragmentShader,c.update(B),Be=c.getVertexShaderID(B),pe=c.getFragmentShaderID(B);const be=r.getRenderTarget(),je=r.state.buffers.depth.getReversed(),gt=Z.isInstancedMesh===!0,St=Z.isBatchedMesh===!0,At=!!B.map,jt=!!B.matcap,vt=!!j,ze=!!B.aoMap,ie=!!B.lightMap,Oe=!!B.bumpMap,ue=!!B.normalMap,st=!!B.displacementMap,$e=!!B.emissiveMap,_t=!!B.metalnessMap,it=!!B.roughnessMap,Tt=B.anisotropy>0,se=B.clearcoat>0,q=B.dispersion>0,Ee=B.iridescence>0,Ge=B.sheen>0,Ve=B.transmission>0,Pe=Tt&&!!B.anisotropyMap,wt=se&&!!B.clearcoatMap,bt=se&&!!B.clearcoatNormalMap,Ft=se&&!!B.clearcoatRoughnessMap,Mt=Ee&&!!B.iridescenceMap,Ze=Ee&&!!B.iridescenceThicknessMap,Je=Ge&&!!B.sheenColorMap,Nt=Ge&&!!B.sheenRoughnessMap,he=!!B.specularMap,Ce=!!B.specularColorMap,tt=!!B.specularIntensityMap,le=Ve&&!!B.transmissionMap,Re=Ve&&!!B.thicknessMap,ht=!!B.gradientMap,yt=!!B.alphaMap,ut=B.alphaTest>0,Qe=!!B.alphaHash,Rt=!!B.extensions;let Vt=su;B.toneMapped&&(be===null||be.isXRRenderTarget===!0)&&(Vt=r.toneMapping);const En={shaderID:oe,shaderType:B.type,shaderName:B.name,vertexShader:xe,fragmentShader:_e,defines:B.defines,customVertexShaderID:Be,customFragmentShaderID:pe,isRawShaderMaterial:B.isRawShaderMaterial===!0,glslVersion:B.glslVersion,precision:y,batching:St,batchingColor:St&&Z._colorsTexture!==null,instancing:gt,instancingColor:gt&&Z.instanceColor!==null,instancingMorph:gt&&Z.morphTexture!==null,supportsVertexTextures:v,outputColorSpace:be===null?r.outputColorSpace:be.isXRRenderTarget===!0?be.texture.colorSpace:cc,alphaToCoverage:!!B.alphaToCoverage,map:At,matcap:jt,envMap:vt,envMapMode:vt&&j.mapping,envMapCubeUVHeight:J,aoMap:ze,lightMap:ie,bumpMap:Oe,normalMap:ue,displacementMap:v&&st,emissiveMap:$e,normalMapObjectSpace:ue&&B.normalMapType===ZO,normalMapTangentSpace:ue&&B.normalMapType===kh,metalnessMap:_t,roughnessMap:it,anisotropy:Tt,anisotropyMap:Pe,clearcoat:se,clearcoatMap:wt,clearcoatNormalMap:bt,clearcoatRoughnessMap:Ft,dispersion:q,iridescence:Ee,iridescenceMap:Mt,iridescenceThicknessMap:Ze,sheen:Ge,sheenColorMap:Je,sheenRoughnessMap:Nt,specularMap:he,specularColorMap:Ce,specularIntensityMap:tt,transmission:Ve,transmissionMap:le,thicknessMap:Re,gradientMap:ht,opaque:B.transparent===!1&&B.blending===vp&&B.alphaToCoverage===!1,alphaMap:yt,alphaTest:ut,alphaHash:Qe,combine:B.combine,mapUv:At&&S(B.map.channel),aoMapUv:ze&&S(B.aoMap.channel),lightMapUv:ie&&S(B.lightMap.channel),bumpMapUv:Oe&&S(B.bumpMap.channel),normalMapUv:ue&&S(B.normalMap.channel),displacementMapUv:st&&S(B.displacementMap.channel),emissiveMapUv:$e&&S(B.emissiveMap.channel),metalnessMapUv:_t&&S(B.metalnessMap.channel),roughnessMapUv:it&&S(B.roughnessMap.channel),anisotropyMapUv:Pe&&S(B.anisotropyMap.channel),clearcoatMapUv:wt&&S(B.clearcoatMap.channel),clearcoatNormalMapUv:bt&&S(B.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ft&&S(B.clearcoatRoughnessMap.channel),iridescenceMapUv:Mt&&S(B.iridescenceMap.channel),iridescenceThicknessMapUv:Ze&&S(B.iridescenceThicknessMap.channel),sheenColorMapUv:Je&&S(B.sheenColorMap.channel),sheenRoughnessMapUv:Nt&&S(B.sheenRoughnessMap.channel),specularMapUv:he&&S(B.specularMap.channel),specularColorMapUv:Ce&&S(B.specularColorMap.channel),specularIntensityMapUv:tt&&S(B.specularIntensityMap.channel),transmissionMapUv:le&&S(B.transmissionMap.channel),thicknessMapUv:Re&&S(B.thicknessMap.channel),alphaMapUv:yt&&S(B.alphaMap.channel),vertexTangents:!!re.attributes.tangent&&(ue||Tt),vertexColors:B.vertexColors,vertexAlphas:B.vertexColors===!0&&!!re.attributes.color&&re.attributes.color.itemSize===4,pointsUvs:Z.isPoints===!0&&!!re.attributes.uv&&(At||yt),fog:!!te,useFog:B.fog===!0,fogExp2:!!te&&te.isFogExp2,flatShading:B.flatShading===!0&&B.wireframe===!1,sizeAttenuation:B.sizeAttenuation===!0,logarithmicDepthBuffer:p,reversedDepthBuffer:je,skinning:Z.isSkinnedMesh===!0,morphTargets:re.morphAttributes.position!==void 0,morphNormals:re.morphAttributes.normal!==void 0,morphColors:re.morphAttributes.color!==void 0,morphTargetsCount:X,morphTextureStride:ne,numDirLights:I.directional.length,numPointLights:I.point.length,numSpotLights:I.spot.length,numSpotLightMaps:I.spotLightMap.length,numRectAreaLights:I.rectArea.length,numHemiLights:I.hemi.length,numDirLightShadows:I.directionalShadowMap.length,numPointLightShadows:I.pointShadowMap.length,numSpotLightShadows:I.spotShadowMap.length,numSpotLightShadowsWithMaps:I.numSpotLightShadowsWithMaps,numLightProbes:I.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:B.dithering,shadowMapEnabled:r.shadowMap.enabled&&z.length>0,shadowMapType:r.shadowMap.type,toneMapping:Vt,decodeVideoTexture:At&&B.map.isVideoTexture===!0&&hi.getTransfer(B.map.colorSpace)===Bi,decodeVideoTextureEmissive:$e&&B.emissiveMap.isVideoTexture===!0&&hi.getTransfer(B.emissiveMap.colorSpace)===Bi,premultipliedAlpha:B.premultipliedAlpha,doubleSided:B.side===so,flipSided:B.side===Ga,useDepthPacking:B.depthPacking>=0,depthPacking:B.depthPacking||0,index0AttributeName:B.index0AttributeName,extensionClipCullDistance:Rt&&B.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Rt&&B.extensions.multiDraw===!0||St)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:B.customProgramCacheKey()};return En.vertexUv1s=u.has(1),En.vertexUv2s=u.has(2),En.vertexUv3s=u.has(3),u.clear(),En}function b(B){const I=[];if(B.shaderID?I.push(B.shaderID):(I.push(B.customVertexShaderID),I.push(B.customFragmentShaderID)),B.defines!==void 0)for(const z in B.defines)I.push(z),I.push(B.defines[z]);return B.isRawShaderMaterial===!1&&(T(I,B),R(I,B),I.push(r.outputColorSpace)),I.push(B.customProgramCacheKey),I.join()}function T(B,I){B.push(I.precision),B.push(I.outputColorSpace),B.push(I.envMapMode),B.push(I.envMapCubeUVHeight),B.push(I.mapUv),B.push(I.alphaMapUv),B.push(I.lightMapUv),B.push(I.aoMapUv),B.push(I.bumpMapUv),B.push(I.normalMapUv),B.push(I.displacementMapUv),B.push(I.emissiveMapUv),B.push(I.metalnessMapUv),B.push(I.roughnessMapUv),B.push(I.anisotropyMapUv),B.push(I.clearcoatMapUv),B.push(I.clearcoatNormalMapUv),B.push(I.clearcoatRoughnessMapUv),B.push(I.iridescenceMapUv),B.push(I.iridescenceThicknessMapUv),B.push(I.sheenColorMapUv),B.push(I.sheenRoughnessMapUv),B.push(I.specularMapUv),B.push(I.specularColorMapUv),B.push(I.specularIntensityMapUv),B.push(I.transmissionMapUv),B.push(I.thicknessMapUv),B.push(I.combine),B.push(I.fogExp2),B.push(I.sizeAttenuation),B.push(I.morphTargetsCount),B.push(I.morphAttributeCount),B.push(I.numDirLights),B.push(I.numPointLights),B.push(I.numSpotLights),B.push(I.numSpotLightMaps),B.push(I.numHemiLights),B.push(I.numRectAreaLights),B.push(I.numDirLightShadows),B.push(I.numPointLightShadows),B.push(I.numSpotLightShadows),B.push(I.numSpotLightShadowsWithMaps),B.push(I.numLightProbes),B.push(I.shadowMapType),B.push(I.toneMapping),B.push(I.numClippingPlanes),B.push(I.numClipIntersection),B.push(I.depthPacking)}function R(B,I){o.disableAll(),I.supportsVertexTextures&&o.enable(0),I.instancing&&o.enable(1),I.instancingColor&&o.enable(2),I.instancingMorph&&o.enable(3),I.matcap&&o.enable(4),I.envMap&&o.enable(5),I.normalMapObjectSpace&&o.enable(6),I.normalMapTangentSpace&&o.enable(7),I.clearcoat&&o.enable(8),I.iridescence&&o.enable(9),I.alphaTest&&o.enable(10),I.vertexColors&&o.enable(11),I.vertexAlphas&&o.enable(12),I.vertexUv1s&&o.enable(13),I.vertexUv2s&&o.enable(14),I.vertexUv3s&&o.enable(15),I.vertexTangents&&o.enable(16),I.anisotropy&&o.enable(17),I.alphaHash&&o.enable(18),I.batching&&o.enable(19),I.dispersion&&o.enable(20),I.batchingColor&&o.enable(21),I.gradientMap&&o.enable(22),B.push(o.mask),o.disableAll(),I.fog&&o.enable(0),I.useFog&&o.enable(1),I.flatShading&&o.enable(2),I.logarithmicDepthBuffer&&o.enable(3),I.reversedDepthBuffer&&o.enable(4),I.skinning&&o.enable(5),I.morphTargets&&o.enable(6),I.morphNormals&&o.enable(7),I.morphColors&&o.enable(8),I.premultipliedAlpha&&o.enable(9),I.shadowMapEnabled&&o.enable(10),I.doubleSided&&o.enable(11),I.flipSided&&o.enable(12),I.useDepthPacking&&o.enable(13),I.dithering&&o.enable(14),I.transmission&&o.enable(15),I.sheen&&o.enable(16),I.opaque&&o.enable(17),I.pointsUvs&&o.enable(18),I.decodeVideoTexture&&o.enable(19),I.decodeVideoTextureEmissive&&o.enable(20),I.alphaToCoverage&&o.enable(21),B.push(o.mask)}function D(B){const I=x[B.type];let z;if(I){const W=sc[I];z=dP.clone(W.uniforms)}else z=B.uniforms;return z}function P(B,I){let z;for(let W=0,Z=h.length;W<Z;W++){const te=h[W];if(te.cacheKey===I){z=te,++z.usedTimes;break}}return z===void 0&&(z=new l7(r,I,B,s),h.push(z)),z}function O(B){if(--B.usedTimes===0){const I=h.indexOf(B);h[I]=h[h.length-1],h.pop(),B.destroy()}}function N(B){c.remove(B)}function U(){c.dispose()}return{getParameters:E,getProgramCacheKey:b,getUniforms:D,acquireProgram:P,releaseProgram:O,releaseShaderCache:N,programs:h,dispose:U}}function d7(){let r=new WeakMap;function e(a){return r.has(a)}function t(a){let o=r.get(a);return o===void 0&&(o={},r.set(a,o)),o}function n(a){r.delete(a)}function i(a,o,c){r.get(a)[o]=c}function s(){r=new WeakMap}return{has:e,get:t,remove:n,update:i,dispose:s}}function p7(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function C2(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function R2(){const r=[];let e=0;const t=[],n=[],i=[];function s(){e=0,t.length=0,n.length=0,i.length=0}function a(p,v,y,x,S,E){let b=r[e];return b===void 0?(b={id:p.id,object:p,geometry:v,material:y,groupOrder:x,renderOrder:p.renderOrder,z:S,group:E},r[e]=b):(b.id=p.id,b.object=p,b.geometry=v,b.material=y,b.groupOrder=x,b.renderOrder=p.renderOrder,b.z=S,b.group=E),e++,b}function o(p,v,y,x,S,E){const b=a(p,v,y,x,S,E);y.transmission>0?n.push(b):y.transparent===!0?i.push(b):t.push(b)}function c(p,v,y,x,S,E){const b=a(p,v,y,x,S,E);y.transmission>0?n.unshift(b):y.transparent===!0?i.unshift(b):t.unshift(b)}function u(p,v){t.length>1&&t.sort(p||p7),n.length>1&&n.sort(v||C2),i.length>1&&i.sort(v||C2)}function h(){for(let p=e,v=r.length;p<v;p++){const y=r[p];if(y.id===null)break;y.id=null,y.object=null,y.geometry=null,y.material=null,y.group=null}}return{opaque:t,transmissive:n,transparent:i,init:s,push:o,unshift:c,finish:h,sort:u}}function m7(){let r=new WeakMap;function e(n,i){const s=r.get(n);let a;return s===void 0?(a=new R2,r.set(n,[a])):i>=s.length?(a=new R2,s.push(a)):a=s[i],a}function t(){r=new WeakMap}return{get:e,dispose:t}}function g7(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new ae,color:new Ot};break;case"SpotLight":t={position:new ae,direction:new ae,color:new Ot,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new ae,color:new Ot,distance:0,decay:0};break;case"HemisphereLight":t={direction:new ae,skyColor:new Ot,groundColor:new Ot};break;case"RectAreaLight":t={color:new Ot,position:new ae,halfWidth:new ae,halfHeight:new ae};break}return r[e.id]=t,t}}}function v7(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new at};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new at};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new at,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[e.id]=t,t}}}let y7=0;function x7(r,e){return(e.castShadow?2:0)-(r.castShadow?2:0)+(e.map?1:0)-(r.map?1:0)}function _7(r){const e=new g7,t=v7(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)n.probe.push(new ae);const i=new ae,s=new yn,a=new yn;function o(u){let h=0,p=0,v=0;for(let B=0;B<9;B++)n.probe[B].set(0,0,0);let y=0,x=0,S=0,E=0,b=0,T=0,R=0,D=0,P=0,O=0,N=0;u.sort(x7);for(let B=0,I=u.length;B<I;B++){const z=u[B],W=z.color,Z=z.intensity,te=z.distance,re=z.shadow&&z.shadow.map?z.shadow.map.texture:null;if(z.isAmbientLight)h+=W.r*Z,p+=W.g*Z,v+=W.b*Z;else if(z.isLightProbe){for(let k=0;k<9;k++)n.probe[k].addScaledVector(z.sh.coefficients[k],Z);N++}else if(z.isDirectionalLight){const k=e.get(z);if(k.color.copy(z.color).multiplyScalar(z.intensity),z.castShadow){const j=z.shadow,J=t.get(z);J.shadowIntensity=j.intensity,J.shadowBias=j.bias,J.shadowNormalBias=j.normalBias,J.shadowRadius=j.radius,J.shadowMapSize=j.mapSize,n.directionalShadow[y]=J,n.directionalShadowMap[y]=re,n.directionalShadowMatrix[y]=z.shadow.matrix,T++}n.directional[y]=k,y++}else if(z.isSpotLight){const k=e.get(z);k.position.setFromMatrixPosition(z.matrixWorld),k.color.copy(W).multiplyScalar(Z),k.distance=te,k.coneCos=Math.cos(z.angle),k.penumbraCos=Math.cos(z.angle*(1-z.penumbra)),k.decay=z.decay,n.spot[S]=k;const j=z.shadow;if(z.map&&(n.spotLightMap[P]=z.map,P++,j.updateMatrices(z),z.castShadow&&O++),n.spotLightMatrix[S]=j.matrix,z.castShadow){const J=t.get(z);J.shadowIntensity=j.intensity,J.shadowBias=j.bias,J.shadowNormalBias=j.normalBias,J.shadowRadius=j.radius,J.shadowMapSize=j.mapSize,n.spotShadow[S]=J,n.spotShadowMap[S]=re,D++}S++}else if(z.isRectAreaLight){const k=e.get(z);k.color.copy(W).multiplyScalar(Z),k.halfWidth.set(z.width*.5,0,0),k.halfHeight.set(0,z.height*.5,0),n.rectArea[E]=k,E++}else if(z.isPointLight){const k=e.get(z);if(k.color.copy(z.color).multiplyScalar(z.intensity),k.distance=z.distance,k.decay=z.decay,z.castShadow){const j=z.shadow,J=t.get(z);J.shadowIntensity=j.intensity,J.shadowBias=j.bias,J.shadowNormalBias=j.normalBias,J.shadowRadius=j.radius,J.shadowMapSize=j.mapSize,J.shadowCameraNear=j.camera.near,J.shadowCameraFar=j.camera.far,n.pointShadow[x]=J,n.pointShadowMap[x]=re,n.pointShadowMatrix[x]=z.shadow.matrix,R++}n.point[x]=k,x++}else if(z.isHemisphereLight){const k=e.get(z);k.skyColor.copy(z.color).multiplyScalar(Z),k.groundColor.copy(z.groundColor).multiplyScalar(Z),n.hemi[b]=k,b++}}E>0&&(r.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Gt.LTC_FLOAT_1,n.rectAreaLTC2=Gt.LTC_FLOAT_2):(n.rectAreaLTC1=Gt.LTC_HALF_1,n.rectAreaLTC2=Gt.LTC_HALF_2)),n.ambient[0]=h,n.ambient[1]=p,n.ambient[2]=v;const U=n.hash;(U.directionalLength!==y||U.pointLength!==x||U.spotLength!==S||U.rectAreaLength!==E||U.hemiLength!==b||U.numDirectionalShadows!==T||U.numPointShadows!==R||U.numSpotShadows!==D||U.numSpotMaps!==P||U.numLightProbes!==N)&&(n.directional.length=y,n.spot.length=S,n.rectArea.length=E,n.point.length=x,n.hemi.length=b,n.directionalShadow.length=T,n.directionalShadowMap.length=T,n.pointShadow.length=R,n.pointShadowMap.length=R,n.spotShadow.length=D,n.spotShadowMap.length=D,n.directionalShadowMatrix.length=T,n.pointShadowMatrix.length=R,n.spotLightMatrix.length=D+P-O,n.spotLightMap.length=P,n.numSpotLightShadowsWithMaps=O,n.numLightProbes=N,U.directionalLength=y,U.pointLength=x,U.spotLength=S,U.rectAreaLength=E,U.hemiLength=b,U.numDirectionalShadows=T,U.numPointShadows=R,U.numSpotShadows=D,U.numSpotMaps=P,U.numLightProbes=N,n.version=y7++)}function c(u,h){let p=0,v=0,y=0,x=0,S=0;const E=h.matrixWorldInverse;for(let b=0,T=u.length;b<T;b++){const R=u[b];if(R.isDirectionalLight){const D=n.directional[p];D.direction.setFromMatrixPosition(R.matrixWorld),i.setFromMatrixPosition(R.target.matrixWorld),D.direction.sub(i),D.direction.transformDirection(E),p++}else if(R.isSpotLight){const D=n.spot[y];D.position.setFromMatrixPosition(R.matrixWorld),D.position.applyMatrix4(E),D.direction.setFromMatrixPosition(R.matrixWorld),i.setFromMatrixPosition(R.target.matrixWorld),D.direction.sub(i),D.direction.transformDirection(E),y++}else if(R.isRectAreaLight){const D=n.rectArea[x];D.position.setFromMatrixPosition(R.matrixWorld),D.position.applyMatrix4(E),a.identity(),s.copy(R.matrixWorld),s.premultiply(E),a.extractRotation(s),D.halfWidth.set(R.width*.5,0,0),D.halfHeight.set(0,R.height*.5,0),D.halfWidth.applyMatrix4(a),D.halfHeight.applyMatrix4(a),x++}else if(R.isPointLight){const D=n.point[v];D.position.setFromMatrixPosition(R.matrixWorld),D.position.applyMatrix4(E),v++}else if(R.isHemisphereLight){const D=n.hemi[S];D.direction.setFromMatrixPosition(R.matrixWorld),D.direction.transformDirection(E),S++}}}return{setup:o,setupView:c,state:n}}function D2(r){const e=new _7(r),t=[],n=[];function i(h){u.camera=h,t.length=0,n.length=0}function s(h){t.push(h)}function a(h){n.push(h)}function o(){e.setup(t)}function c(h){e.setupView(t,h)}const u={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:u,setupLights:o,setupLightsView:c,pushLight:s,pushShadow:a}}function S7(r){let e=new WeakMap;function t(i,s=0){const a=e.get(i);let o;return a===void 0?(o=new D2(r),e.set(i,[o])):s>=a.length?(o=new D2(r),a.push(o)):o=a[s],o}function n(){e=new WeakMap}return{get:t,dispose:n}}const A7=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,E7=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function b7(r,e,t){let n=new Cg;const i=new at,s=new at,a=new vi,o=new vD({depthPacking:QO}),c=new yD,u={},h=t.maxTextureSize,p={[au]:Ga,[Ga]:au,[so]:so},v=new za({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new at},radius:{value:4}},vertexShader:A7,fragmentShader:E7}),y=v.clone();y.defines.HORIZONTAL_PASS=1;const x=new Ln;x.setAttribute("position",new xi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const S=new As(x,v),E=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Nb;let b=this.type;this.render=function(O,N,U){if(E.enabled===!1||E.autoUpdate===!1&&E.needsUpdate===!1||O.length===0)return;const B=r.getRenderTarget(),I=r.getActiveCubeFace(),z=r.getActiveMipmapLevel(),W=r.state;W.setBlending(lc),W.buffers.depth.getReversed()===!0?W.buffers.color.setClear(0,0,0,0):W.buffers.color.setClear(1,1,1,1),W.buffers.depth.setTest(!0),W.setScissorTest(!1);const Z=b!==ic&&this.type===ic,te=b===ic&&this.type!==ic;for(let re=0,k=O.length;re<k;re++){const j=O[re],J=j.shadow;if(J===void 0){Ht("WebGLShadowMap:",j,"has no shadow.");continue}if(J.autoUpdate===!1&&J.needsUpdate===!1)continue;i.copy(J.mapSize);const oe=J.getFrameExtents();if(i.multiply(oe),s.copy(J.mapSize),(i.x>h||i.y>h)&&(i.x>h&&(s.x=Math.floor(h/oe.x),i.x=s.x*oe.x,J.mapSize.x=s.x),i.y>h&&(s.y=Math.floor(h/oe.y),i.y=s.y*oe.y,J.mapSize.y=s.y)),J.map===null||Z===!0||te===!0){const X=this.type!==ic?{minFilter:br,magFilter:br}:{};J.map!==null&&J.map.dispose(),J.map=new Al(i.x,i.y,X),J.map.texture.name=j.name+".shadowMap",J.camera.updateProjectionMatrix()}r.setRenderTarget(J.map),r.clear();const K=J.getViewportCount();for(let X=0;X<K;X++){const ne=J.getViewport(X);a.set(s.x*ne.x,s.y*ne.y,s.x*ne.z,s.y*ne.w),W.viewport(a),J.updateMatrices(j,X),n=J.getFrustum(),D(N,U,J.camera,j,this.type)}J.isPointLightShadow!==!0&&this.type===ic&&T(J,U),J.needsUpdate=!1}b=this.type,E.needsUpdate=!1,r.setRenderTarget(B,I,z)};function T(O,N){const U=e.update(S);v.defines.VSM_SAMPLES!==O.blurSamples&&(v.defines.VSM_SAMPLES=O.blurSamples,y.defines.VSM_SAMPLES=O.blurSamples,v.needsUpdate=!0,y.needsUpdate=!0),O.mapPass===null&&(O.mapPass=new Al(i.x,i.y)),v.uniforms.shadow_pass.value=O.map.texture,v.uniforms.resolution.value=O.mapSize,v.uniforms.radius.value=O.radius,r.setRenderTarget(O.mapPass),r.clear(),r.renderBufferDirect(N,null,U,v,S,null),y.uniforms.shadow_pass.value=O.mapPass.texture,y.uniforms.resolution.value=O.mapSize,y.uniforms.radius.value=O.radius,r.setRenderTarget(O.map),r.clear(),r.renderBufferDirect(N,null,U,y,S,null)}function R(O,N,U,B){let I=null;const z=U.isPointLight===!0?O.customDistanceMaterial:O.customDepthMaterial;if(z!==void 0)I=z;else if(I=U.isPointLight===!0?c:o,r.localClippingEnabled&&N.clipShadows===!0&&Array.isArray(N.clippingPlanes)&&N.clippingPlanes.length!==0||N.displacementMap&&N.displacementScale!==0||N.alphaMap&&N.alphaTest>0||N.map&&N.alphaTest>0||N.alphaToCoverage===!0){const W=I.uuid,Z=N.uuid;let te=u[W];te===void 0&&(te={},u[W]=te);let re=te[Z];re===void 0&&(re=I.clone(),te[Z]=re,N.addEventListener("dispose",P)),I=re}if(I.visible=N.visible,I.wireframe=N.wireframe,B===ic?I.side=N.shadowSide!==null?N.shadowSide:N.side:I.side=N.shadowSide!==null?N.shadowSide:p[N.side],I.alphaMap=N.alphaMap,I.alphaTest=N.alphaToCoverage===!0?.5:N.alphaTest,I.map=N.map,I.clipShadows=N.clipShadows,I.clippingPlanes=N.clippingPlanes,I.clipIntersection=N.clipIntersection,I.displacementMap=N.displacementMap,I.displacementScale=N.displacementScale,I.displacementBias=N.displacementBias,I.wireframeLinewidth=N.wireframeLinewidth,I.linewidth=N.linewidth,U.isPointLight===!0&&I.isMeshDistanceMaterial===!0){const W=r.properties.get(I);W.light=U}return I}function D(O,N,U,B,I){if(O.visible===!1)return;if(O.layers.test(N.layers)&&(O.isMesh||O.isLine||O.isPoints)&&(O.castShadow||O.receiveShadow&&I===ic)&&(!O.frustumCulled||n.intersectsObject(O))){O.modelViewMatrix.multiplyMatrices(U.matrixWorldInverse,O.matrixWorld);const Z=e.update(O),te=O.material;if(Array.isArray(te)){const re=Z.groups;for(let k=0,j=re.length;k<j;k++){const J=re[k],oe=te[J.materialIndex];if(oe&&oe.visible){const K=R(O,oe,B,I);O.onBeforeShadow(r,O,N,U,Z,K,J),r.renderBufferDirect(U,null,Z,K,O,J),O.onAfterShadow(r,O,N,U,Z,K,J)}}}else if(te.visible){const re=R(O,te,B,I);O.onBeforeShadow(r,O,N,U,Z,re,null),r.renderBufferDirect(U,null,Z,re,O,null),O.onAfterShadow(r,O,N,U,Z,re,null)}}const W=O.children;for(let Z=0,te=W.length;Z<te;Z++)D(W[Z],N,U,B,I)}function P(O){O.target.removeEventListener("dispose",P);for(const U in u){const B=u[U],I=O.target.uuid;I in B&&(B[I].dispose(),delete B[I])}}}const T7={[SE]:AE,[EE]:ME,[bE]:CE,[Dp]:TE,[AE]:SE,[ME]:EE,[CE]:bE,[TE]:Dp};function M7(r,e){function t(){let le=!1;const Re=new vi;let ht=null;const yt=new vi(0,0,0,0);return{setMask:function(ut){ht!==ut&&!le&&(r.colorMask(ut,ut,ut,ut),ht=ut)},setLocked:function(ut){le=ut},setClear:function(ut,Qe,Rt,Vt,En){En===!0&&(ut*=Vt,Qe*=Vt,Rt*=Vt),Re.set(ut,Qe,Rt,Vt),yt.equals(Re)===!1&&(r.clearColor(ut,Qe,Rt,Vt),yt.copy(Re))},reset:function(){le=!1,ht=null,yt.set(-1,0,0,0)}}}function n(){let le=!1,Re=!1,ht=null,yt=null,ut=null;return{setReversed:function(Qe){if(Re!==Qe){const Rt=e.get("EXT_clip_control");Qe?Rt.clipControlEXT(Rt.LOWER_LEFT_EXT,Rt.ZERO_TO_ONE_EXT):Rt.clipControlEXT(Rt.LOWER_LEFT_EXT,Rt.NEGATIVE_ONE_TO_ONE_EXT),Re=Qe;const Vt=ut;ut=null,this.setClear(Vt)}},getReversed:function(){return Re},setTest:function(Qe){Qe?be(r.DEPTH_TEST):je(r.DEPTH_TEST)},setMask:function(Qe){ht!==Qe&&!le&&(r.depthMask(Qe),ht=Qe)},setFunc:function(Qe){if(Re&&(Qe=T7[Qe]),yt!==Qe){switch(Qe){case SE:r.depthFunc(r.NEVER);break;case AE:r.depthFunc(r.ALWAYS);break;case EE:r.depthFunc(r.LESS);break;case Dp:r.depthFunc(r.LEQUAL);break;case bE:r.depthFunc(r.EQUAL);break;case TE:r.depthFunc(r.GEQUAL);break;case ME:r.depthFunc(r.GREATER);break;case CE:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}yt=Qe}},setLocked:function(Qe){le=Qe},setClear:function(Qe){ut!==Qe&&(Re&&(Qe=1-Qe),r.clearDepth(Qe),ut=Qe)},reset:function(){le=!1,ht=null,yt=null,ut=null,Re=!1}}}function i(){let le=!1,Re=null,ht=null,yt=null,ut=null,Qe=null,Rt=null,Vt=null,En=null;return{setTest:function(Dt){le||(Dt?be(r.STENCIL_TEST):je(r.STENCIL_TEST))},setMask:function(Dt){Re!==Dt&&!le&&(r.stencilMask(Dt),Re=Dt)},setFunc:function(Dt,Ut,dn){(ht!==Dt||yt!==Ut||ut!==dn)&&(r.stencilFunc(Dt,Ut,dn),ht=Dt,yt=Ut,ut=dn)},setOp:function(Dt,Ut,dn){(Qe!==Dt||Rt!==Ut||Vt!==dn)&&(r.stencilOp(Dt,Ut,dn),Qe=Dt,Rt=Ut,Vt=dn)},setLocked:function(Dt){le=Dt},setClear:function(Dt){En!==Dt&&(r.clearStencil(Dt),En=Dt)},reset:function(){le=!1,Re=null,ht=null,yt=null,ut=null,Qe=null,Rt=null,Vt=null,En=null}}}const s=new t,a=new n,o=new i,c=new WeakMap,u=new WeakMap;let h={},p={},v=new WeakMap,y=[],x=null,S=!1,E=null,b=null,T=null,R=null,D=null,P=null,O=null,N=new Ot(0,0,0),U=0,B=!1,I=null,z=null,W=null,Z=null,te=null;const re=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let k=!1,j=0;const J=r.getParameter(r.VERSION);J.indexOf("WebGL")!==-1?(j=parseFloat(/^WebGL (\d)/.exec(J)[1]),k=j>=1):J.indexOf("OpenGL ES")!==-1&&(j=parseFloat(/^OpenGL ES (\d)/.exec(J)[1]),k=j>=2);let oe=null,K={};const X=r.getParameter(r.SCISSOR_BOX),ne=r.getParameter(r.VIEWPORT),xe=new vi().fromArray(X),_e=new vi().fromArray(ne);function Be(le,Re,ht,yt){const ut=new Uint8Array(4),Qe=r.createTexture();r.bindTexture(le,Qe),r.texParameteri(le,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(le,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let Rt=0;Rt<ht;Rt++)le===r.TEXTURE_3D||le===r.TEXTURE_2D_ARRAY?r.texImage3D(Re,0,r.RGBA,1,1,yt,0,r.RGBA,r.UNSIGNED_BYTE,ut):r.texImage2D(Re+Rt,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,ut);return Qe}const pe={};pe[r.TEXTURE_2D]=Be(r.TEXTURE_2D,r.TEXTURE_2D,1),pe[r.TEXTURE_CUBE_MAP]=Be(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),pe[r.TEXTURE_2D_ARRAY]=Be(r.TEXTURE_2D_ARRAY,r.TEXTURE_2D_ARRAY,1,1),pe[r.TEXTURE_3D]=Be(r.TEXTURE_3D,r.TEXTURE_3D,1,1),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),be(r.DEPTH_TEST),a.setFunc(Dp),Oe(!1),ue(bC),be(r.CULL_FACE),ze(lc);function be(le){h[le]!==!0&&(r.enable(le),h[le]=!0)}function je(le){h[le]!==!1&&(r.disable(le),h[le]=!1)}function gt(le,Re){return p[le]!==Re?(r.bindFramebuffer(le,Re),p[le]=Re,le===r.DRAW_FRAMEBUFFER&&(p[r.FRAMEBUFFER]=Re),le===r.FRAMEBUFFER&&(p[r.DRAW_FRAMEBUFFER]=Re),!0):!1}function St(le,Re){let ht=y,yt=!1;if(le){ht=v.get(Re),ht===void 0&&(ht=[],v.set(Re,ht));const ut=le.textures;if(ht.length!==ut.length||ht[0]!==r.COLOR_ATTACHMENT0){for(let Qe=0,Rt=ut.length;Qe<Rt;Qe++)ht[Qe]=r.COLOR_ATTACHMENT0+Qe;ht.length=ut.length,yt=!0}}else ht[0]!==r.BACK&&(ht[0]=r.BACK,yt=!0);yt&&r.drawBuffers(ht)}function At(le){return x!==le?(r.useProgram(le),x=le,!0):!1}const jt={[vh]:r.FUNC_ADD,[SO]:r.FUNC_SUBTRACT,[AO]:r.FUNC_REVERSE_SUBTRACT};jt[EO]=r.MIN,jt[bO]=r.MAX;const vt={[TO]:r.ZERO,[MO]:r.ONE,[CO]:r.SRC_COLOR,[xE]:r.SRC_ALPHA,[BO]:r.SRC_ALPHA_SATURATE,[wO]:r.DST_COLOR,[DO]:r.DST_ALPHA,[RO]:r.ONE_MINUS_SRC_COLOR,[_E]:r.ONE_MINUS_SRC_ALPHA,[IO]:r.ONE_MINUS_DST_COLOR,[LO]:r.ONE_MINUS_DST_ALPHA,[OO]:r.CONSTANT_COLOR,[PO]:r.ONE_MINUS_CONSTANT_COLOR,[NO]:r.CONSTANT_ALPHA,[UO]:r.ONE_MINUS_CONSTANT_ALPHA};function ze(le,Re,ht,yt,ut,Qe,Rt,Vt,En,Dt){if(le===lc){S===!0&&(je(r.BLEND),S=!1);return}if(S===!1&&(be(r.BLEND),S=!0),le!==_O){if(le!==E||Dt!==B){if((b!==vh||D!==vh)&&(r.blendEquation(r.FUNC_ADD),b=vh,D=vh),Dt)switch(le){case vp:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case TC:r.blendFunc(r.ONE,r.ONE);break;case MC:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case CC:r.blendFuncSeparate(r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ZERO,r.ONE);break;default:Cn("WebGLState: Invalid blending: ",le);break}else switch(le){case vp:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case TC:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE,r.ONE,r.ONE);break;case MC:Cn("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case CC:Cn("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Cn("WebGLState: Invalid blending: ",le);break}T=null,R=null,P=null,O=null,N.set(0,0,0),U=0,E=le,B=Dt}return}ut=ut||Re,Qe=Qe||ht,Rt=Rt||yt,(Re!==b||ut!==D)&&(r.blendEquationSeparate(jt[Re],jt[ut]),b=Re,D=ut),(ht!==T||yt!==R||Qe!==P||Rt!==O)&&(r.blendFuncSeparate(vt[ht],vt[yt],vt[Qe],vt[Rt]),T=ht,R=yt,P=Qe,O=Rt),(Vt.equals(N)===!1||En!==U)&&(r.blendColor(Vt.r,Vt.g,Vt.b,En),N.copy(Vt),U=En),E=le,B=!1}function ie(le,Re){le.side===so?je(r.CULL_FACE):be(r.CULL_FACE);let ht=le.side===Ga;Re&&(ht=!ht),Oe(ht),le.blending===vp&&le.transparent===!1?ze(lc):ze(le.blending,le.blendEquation,le.blendSrc,le.blendDst,le.blendEquationAlpha,le.blendSrcAlpha,le.blendDstAlpha,le.blendColor,le.blendAlpha,le.premultipliedAlpha),a.setFunc(le.depthFunc),a.setTest(le.depthTest),a.setMask(le.depthWrite),s.setMask(le.colorWrite);const yt=le.stencilWrite;o.setTest(yt),yt&&(o.setMask(le.stencilWriteMask),o.setFunc(le.stencilFunc,le.stencilRef,le.stencilFuncMask),o.setOp(le.stencilFail,le.stencilZFail,le.stencilZPass)),$e(le.polygonOffset,le.polygonOffsetFactor,le.polygonOffsetUnits),le.alphaToCoverage===!0?be(r.SAMPLE_ALPHA_TO_COVERAGE):je(r.SAMPLE_ALPHA_TO_COVERAGE)}function Oe(le){I!==le&&(le?r.frontFace(r.CW):r.frontFace(r.CCW),I=le)}function ue(le){le!==vO?(be(r.CULL_FACE),le!==z&&(le===bC?r.cullFace(r.BACK):le===yO?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))):je(r.CULL_FACE),z=le}function st(le){le!==W&&(k&&r.lineWidth(le),W=le)}function $e(le,Re,ht){le?(be(r.POLYGON_OFFSET_FILL),(Z!==Re||te!==ht)&&(r.polygonOffset(Re,ht),Z=Re,te=ht)):je(r.POLYGON_OFFSET_FILL)}function _t(le){le?be(r.SCISSOR_TEST):je(r.SCISSOR_TEST)}function it(le){le===void 0&&(le=r.TEXTURE0+re-1),oe!==le&&(r.activeTexture(le),oe=le)}function Tt(le,Re,ht){ht===void 0&&(oe===null?ht=r.TEXTURE0+re-1:ht=oe);let yt=K[ht];yt===void 0&&(yt={type:void 0,texture:void 0},K[ht]=yt),(yt.type!==le||yt.texture!==Re)&&(oe!==ht&&(r.activeTexture(ht),oe=ht),r.bindTexture(le,Re||pe[le]),yt.type=le,yt.texture=Re)}function se(){const le=K[oe];le!==void 0&&le.type!==void 0&&(r.bindTexture(le.type,null),le.type=void 0,le.texture=void 0)}function q(){try{r.compressedTexImage2D(...arguments)}catch(le){le("WebGLState:",le)}}function Ee(){try{r.compressedTexImage3D(...arguments)}catch(le){le("WebGLState:",le)}}function Ge(){try{r.texSubImage2D(...arguments)}catch(le){le("WebGLState:",le)}}function Ve(){try{r.texSubImage3D(...arguments)}catch(le){le("WebGLState:",le)}}function Pe(){try{r.compressedTexSubImage2D(...arguments)}catch(le){le("WebGLState:",le)}}function wt(){try{r.compressedTexSubImage3D(...arguments)}catch(le){le("WebGLState:",le)}}function bt(){try{r.texStorage2D(...arguments)}catch(le){le("WebGLState:",le)}}function Ft(){try{r.texStorage3D(...arguments)}catch(le){le("WebGLState:",le)}}function Mt(){try{r.texImage2D(...arguments)}catch(le){le("WebGLState:",le)}}function Ze(){try{r.texImage3D(...arguments)}catch(le){le("WebGLState:",le)}}function Je(le){xe.equals(le)===!1&&(r.scissor(le.x,le.y,le.z,le.w),xe.copy(le))}function Nt(le){_e.equals(le)===!1&&(r.viewport(le.x,le.y,le.z,le.w),_e.copy(le))}function he(le,Re){let ht=u.get(Re);ht===void 0&&(ht=new WeakMap,u.set(Re,ht));let yt=ht.get(le);yt===void 0&&(yt=r.getUniformBlockIndex(Re,le.name),ht.set(le,yt))}function Ce(le,Re){const yt=u.get(Re).get(le);c.get(Re)!==yt&&(r.uniformBlockBinding(Re,yt,le.__bindingPointIndex),c.set(Re,yt))}function tt(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.blendColor(0,0,0,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),a.setReversed(!1),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),h={},oe=null,K={},p={},v=new WeakMap,y=[],x=null,S=!1,E=null,b=null,T=null,R=null,D=null,P=null,O=null,N=new Ot(0,0,0),U=0,B=!1,I=null,z=null,W=null,Z=null,te=null,xe.set(0,0,r.canvas.width,r.canvas.height),_e.set(0,0,r.canvas.width,r.canvas.height),s.reset(),a.reset(),o.reset()}return{buffers:{color:s,depth:a,stencil:o},enable:be,disable:je,bindFramebuffer:gt,drawBuffers:St,useProgram:At,setBlending:ze,setMaterial:ie,setFlipSided:Oe,setCullFace:ue,setLineWidth:st,setPolygonOffset:$e,setScissorTest:_t,activeTexture:it,bindTexture:Tt,unbindTexture:se,compressedTexImage2D:q,compressedTexImage3D:Ee,texImage2D:Mt,texImage3D:Ze,updateUBOMapping:he,uniformBlockBinding:Ce,texStorage2D:bt,texStorage3D:Ft,texSubImage2D:Ge,texSubImage3D:Ve,compressedTexSubImage2D:Pe,compressedTexSubImage3D:wt,scissor:Je,viewport:Nt,reset:tt}}function C7(r,e,t,n,i,s,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new at,h=new WeakMap;let p;const v=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function x(se,q){return y?new OffscreenCanvas(se,q):fx("canvas")}function S(se,q,Ee){let Ge=1;const Ve=Tt(se);if((Ve.width>Ee||Ve.height>Ee)&&(Ge=Ee/Math.max(Ve.width,Ve.height)),Ge<1)if(typeof HTMLImageElement<"u"&&se instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&se instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&se instanceof ImageBitmap||typeof VideoFrame<"u"&&se instanceof VideoFrame){const Pe=Math.floor(Ge*Ve.width),wt=Math.floor(Ge*Ve.height);p===void 0&&(p=x(Pe,wt));const bt=q?x(Pe,wt):p;return bt.width=Pe,bt.height=wt,bt.getContext("2d").drawImage(se,0,0,Pe,wt),Ht("WebGLRenderer: Texture has been resized from ("+Ve.width+"x"+Ve.height+") to ("+Pe+"x"+wt+")."),bt}else return"data"in se&&Ht("WebGLRenderer: Image in DataTexture is too big ("+Ve.width+"x"+Ve.height+")."),se;return se}function E(se){return se.generateMipmaps}function b(se){r.generateMipmap(se)}function T(se){return se.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:se.isWebGL3DRenderTarget?r.TEXTURE_3D:se.isWebGLArrayRenderTarget||se.isCompressedArrayTexture?r.TEXTURE_2D_ARRAY:r.TEXTURE_2D}function R(se,q,Ee,Ge,Ve=!1){if(se!==null){if(r[se]!==void 0)return r[se];Ht("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+se+"'")}let Pe=q;if(q===r.RED&&(Ee===r.FLOAT&&(Pe=r.R32F),Ee===r.HALF_FLOAT&&(Pe=r.R16F),Ee===r.UNSIGNED_BYTE&&(Pe=r.R8)),q===r.RED_INTEGER&&(Ee===r.UNSIGNED_BYTE&&(Pe=r.R8UI),Ee===r.UNSIGNED_SHORT&&(Pe=r.R16UI),Ee===r.UNSIGNED_INT&&(Pe=r.R32UI),Ee===r.BYTE&&(Pe=r.R8I),Ee===r.SHORT&&(Pe=r.R16I),Ee===r.INT&&(Pe=r.R32I)),q===r.RG&&(Ee===r.FLOAT&&(Pe=r.RG32F),Ee===r.HALF_FLOAT&&(Pe=r.RG16F),Ee===r.UNSIGNED_BYTE&&(Pe=r.RG8)),q===r.RG_INTEGER&&(Ee===r.UNSIGNED_BYTE&&(Pe=r.RG8UI),Ee===r.UNSIGNED_SHORT&&(Pe=r.RG16UI),Ee===r.UNSIGNED_INT&&(Pe=r.RG32UI),Ee===r.BYTE&&(Pe=r.RG8I),Ee===r.SHORT&&(Pe=r.RG16I),Ee===r.INT&&(Pe=r.RG32I)),q===r.RGB_INTEGER&&(Ee===r.UNSIGNED_BYTE&&(Pe=r.RGB8UI),Ee===r.UNSIGNED_SHORT&&(Pe=r.RGB16UI),Ee===r.UNSIGNED_INT&&(Pe=r.RGB32UI),Ee===r.BYTE&&(Pe=r.RGB8I),Ee===r.SHORT&&(Pe=r.RGB16I),Ee===r.INT&&(Pe=r.RGB32I)),q===r.RGBA_INTEGER&&(Ee===r.UNSIGNED_BYTE&&(Pe=r.RGBA8UI),Ee===r.UNSIGNED_SHORT&&(Pe=r.RGBA16UI),Ee===r.UNSIGNED_INT&&(Pe=r.RGBA32UI),Ee===r.BYTE&&(Pe=r.RGBA8I),Ee===r.SHORT&&(Pe=r.RGBA16I),Ee===r.INT&&(Pe=r.RGBA32I)),q===r.RGB&&(Ee===r.UNSIGNED_INT_5_9_9_9_REV&&(Pe=r.RGB9_E5),Ee===r.UNSIGNED_INT_10F_11F_11F_REV&&(Pe=r.R11F_G11F_B10F)),q===r.RGBA){const wt=Ve?cx:hi.getTransfer(Ge);Ee===r.FLOAT&&(Pe=r.RGBA32F),Ee===r.HALF_FLOAT&&(Pe=r.RGBA16F),Ee===r.UNSIGNED_BYTE&&(Pe=wt===Bi?r.SRGB8_ALPHA8:r.RGBA8),Ee===r.UNSIGNED_SHORT_4_4_4_4&&(Pe=r.RGBA4),Ee===r.UNSIGNED_SHORT_5_5_5_1&&(Pe=r.RGB5_A1)}return(Pe===r.R16F||Pe===r.R32F||Pe===r.RG16F||Pe===r.RG32F||Pe===r.RGBA16F||Pe===r.RGBA32F)&&e.get("EXT_color_buffer_float"),Pe}function D(se,q){let Ee;return se?q===null||q===lu||q===tg?Ee=r.DEPTH24_STENCIL8:q===Ss?Ee=r.DEPTH32F_STENCIL8:q===eg&&(Ee=r.DEPTH24_STENCIL8,Ht("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):q===null||q===lu||q===tg?Ee=r.DEPTH_COMPONENT24:q===Ss?Ee=r.DEPTH_COMPONENT32F:q===eg&&(Ee=r.DEPTH_COMPONENT16),Ee}function P(se,q){return E(se)===!0||se.isFramebufferTexture&&se.minFilter!==br&&se.minFilter!==yi?Math.log2(Math.max(q.width,q.height))+1:se.mipmaps!==void 0&&se.mipmaps.length>0?se.mipmaps.length:se.isCompressedTexture&&Array.isArray(se.image)?q.mipmaps.length:1}function O(se){const q=se.target;q.removeEventListener("dispose",O),U(q),q.isVideoTexture&&h.delete(q)}function N(se){const q=se.target;q.removeEventListener("dispose",N),I(q)}function U(se){const q=n.get(se);if(q.__webglInit===void 0)return;const Ee=se.source,Ge=v.get(Ee);if(Ge){const Ve=Ge[q.__cacheKey];Ve.usedTimes--,Ve.usedTimes===0&&B(se),Object.keys(Ge).length===0&&v.delete(Ee)}n.remove(se)}function B(se){const q=n.get(se);r.deleteTexture(q.__webglTexture);const Ee=se.source,Ge=v.get(Ee);delete Ge[q.__cacheKey],a.memory.textures--}function I(se){const q=n.get(se);if(se.depthTexture&&(se.depthTexture.dispose(),n.remove(se.depthTexture)),se.isWebGLCubeRenderTarget)for(let Ge=0;Ge<6;Ge++){if(Array.isArray(q.__webglFramebuffer[Ge]))for(let Ve=0;Ve<q.__webglFramebuffer[Ge].length;Ve++)r.deleteFramebuffer(q.__webglFramebuffer[Ge][Ve]);else r.deleteFramebuffer(q.__webglFramebuffer[Ge]);q.__webglDepthbuffer&&r.deleteRenderbuffer(q.__webglDepthbuffer[Ge])}else{if(Array.isArray(q.__webglFramebuffer))for(let Ge=0;Ge<q.__webglFramebuffer.length;Ge++)r.deleteFramebuffer(q.__webglFramebuffer[Ge]);else r.deleteFramebuffer(q.__webglFramebuffer);if(q.__webglDepthbuffer&&r.deleteRenderbuffer(q.__webglDepthbuffer),q.__webglMultisampledFramebuffer&&r.deleteFramebuffer(q.__webglMultisampledFramebuffer),q.__webglColorRenderbuffer)for(let Ge=0;Ge<q.__webglColorRenderbuffer.length;Ge++)q.__webglColorRenderbuffer[Ge]&&r.deleteRenderbuffer(q.__webglColorRenderbuffer[Ge]);q.__webglDepthRenderbuffer&&r.deleteRenderbuffer(q.__webglDepthRenderbuffer)}const Ee=se.textures;for(let Ge=0,Ve=Ee.length;Ge<Ve;Ge++){const Pe=n.get(Ee[Ge]);Pe.__webglTexture&&(r.deleteTexture(Pe.__webglTexture),a.memory.textures--),n.remove(Ee[Ge])}n.remove(se)}let z=0;function W(){z=0}function Z(){const se=z;return se>=i.maxTextures&&Ht("WebGLTextures: Trying to use "+se+" texture units while this GPU supports only "+i.maxTextures),z+=1,se}function te(se){const q=[];return q.push(se.wrapS),q.push(se.wrapT),q.push(se.wrapR||0),q.push(se.magFilter),q.push(se.minFilter),q.push(se.anisotropy),q.push(se.internalFormat),q.push(se.format),q.push(se.type),q.push(se.generateMipmaps),q.push(se.premultiplyAlpha),q.push(se.flipY),q.push(se.unpackAlignment),q.push(se.colorSpace),q.join()}function re(se,q){const Ee=n.get(se);if(se.isVideoTexture&&_t(se),se.isRenderTargetTexture===!1&&se.isExternalTexture!==!0&&se.version>0&&Ee.__version!==se.version){const Ge=se.image;if(Ge===null)Ht("WebGLRenderer: Texture marked for update but no image data found.");else if(Ge.complete===!1)Ht("WebGLRenderer: Texture marked for update but image is incomplete");else{pe(Ee,se,q);return}}else se.isExternalTexture&&(Ee.__webglTexture=se.sourceTexture?se.sourceTexture:null);t.bindTexture(r.TEXTURE_2D,Ee.__webglTexture,r.TEXTURE0+q)}function k(se,q){const Ee=n.get(se);if(se.isRenderTargetTexture===!1&&se.version>0&&Ee.__version!==se.version){pe(Ee,se,q);return}else se.isExternalTexture&&(Ee.__webglTexture=se.sourceTexture?se.sourceTexture:null);t.bindTexture(r.TEXTURE_2D_ARRAY,Ee.__webglTexture,r.TEXTURE0+q)}function j(se,q){const Ee=n.get(se);if(se.isRenderTargetTexture===!1&&se.version>0&&Ee.__version!==se.version){pe(Ee,se,q);return}t.bindTexture(r.TEXTURE_3D,Ee.__webglTexture,r.TEXTURE0+q)}function J(se,q){const Ee=n.get(se);if(se.version>0&&Ee.__version!==se.version){be(Ee,se,q);return}t.bindTexture(r.TEXTURE_CUBE_MAP,Ee.__webglTexture,r.TEXTURE0+q)}const oe={[Ih]:r.REPEAT,[_s]:r.CLAMP_TO_EDGE,[Z0]:r.MIRRORED_REPEAT},K={[br]:r.NEAREST,[Ub]:r.NEAREST_MIPMAP_NEAREST,[lp]:r.NEAREST_MIPMAP_LINEAR,[yi]:r.LINEAR,[k0]:r.LINEAR_MIPMAP_NEAREST,[ml]:r.LINEAR_MIPMAP_LINEAR},X={[eP]:r.NEVER,[aP]:r.ALWAYS,[tP]:r.LESS,[$R]:r.LEQUAL,[nP]:r.EQUAL,[rP]:r.GEQUAL,[iP]:r.GREATER,[sP]:r.NOTEQUAL};function ne(se,q){if(q.type===Ss&&e.has("OES_texture_float_linear")===!1&&(q.magFilter===yi||q.magFilter===k0||q.magFilter===lp||q.magFilter===ml||q.minFilter===yi||q.minFilter===k0||q.minFilter===lp||q.minFilter===ml)&&Ht("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),r.texParameteri(se,r.TEXTURE_WRAP_S,oe[q.wrapS]),r.texParameteri(se,r.TEXTURE_WRAP_T,oe[q.wrapT]),(se===r.TEXTURE_3D||se===r.TEXTURE_2D_ARRAY)&&r.texParameteri(se,r.TEXTURE_WRAP_R,oe[q.wrapR]),r.texParameteri(se,r.TEXTURE_MAG_FILTER,K[q.magFilter]),r.texParameteri(se,r.TEXTURE_MIN_FILTER,K[q.minFilter]),q.compareFunction&&(r.texParameteri(se,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(se,r.TEXTURE_COMPARE_FUNC,X[q.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(q.magFilter===br||q.minFilter!==lp&&q.minFilter!==ml||q.type===Ss&&e.has("OES_texture_float_linear")===!1)return;if(q.anisotropy>1||n.get(q).__currentAnisotropy){const Ee=e.get("EXT_texture_filter_anisotropic");r.texParameterf(se,Ee.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(q.anisotropy,i.getMaxAnisotropy())),n.get(q).__currentAnisotropy=q.anisotropy}}}function xe(se,q){let Ee=!1;se.__webglInit===void 0&&(se.__webglInit=!0,q.addEventListener("dispose",O));const Ge=q.source;let Ve=v.get(Ge);Ve===void 0&&(Ve={},v.set(Ge,Ve));const Pe=te(q);if(Pe!==se.__cacheKey){Ve[Pe]===void 0&&(Ve[Pe]={texture:r.createTexture(),usedTimes:0},a.memory.textures++,Ee=!0),Ve[Pe].usedTimes++;const wt=Ve[se.__cacheKey];wt!==void 0&&(Ve[se.__cacheKey].usedTimes--,wt.usedTimes===0&&B(q)),se.__cacheKey=Pe,se.__webglTexture=Ve[Pe].texture}return Ee}function _e(se,q,Ee){return Math.floor(Math.floor(se/Ee)/q)}function Be(se,q,Ee,Ge){const Pe=se.updateRanges;if(Pe.length===0)t.texSubImage2D(r.TEXTURE_2D,0,0,0,q.width,q.height,Ee,Ge,q.data);else{Pe.sort((Ze,Je)=>Ze.start-Je.start);let wt=0;for(let Ze=1;Ze<Pe.length;Ze++){const Je=Pe[wt],Nt=Pe[Ze],he=Je.start+Je.count,Ce=_e(Nt.start,q.width,4),tt=_e(Je.start,q.width,4);Nt.start<=he+1&&Ce===tt&&_e(Nt.start+Nt.count-1,q.width,4)===Ce?Je.count=Math.max(Je.count,Nt.start+Nt.count-Je.start):(++wt,Pe[wt]=Nt)}Pe.length=wt+1;const bt=r.getParameter(r.UNPACK_ROW_LENGTH),Ft=r.getParameter(r.UNPACK_SKIP_PIXELS),Mt=r.getParameter(r.UNPACK_SKIP_ROWS);r.pixelStorei(r.UNPACK_ROW_LENGTH,q.width);for(let Ze=0,Je=Pe.length;Ze<Je;Ze++){const Nt=Pe[Ze],he=Math.floor(Nt.start/4),Ce=Math.ceil(Nt.count/4),tt=he%q.width,le=Math.floor(he/q.width),Re=Ce,ht=1;r.pixelStorei(r.UNPACK_SKIP_PIXELS,tt),r.pixelStorei(r.UNPACK_SKIP_ROWS,le),t.texSubImage2D(r.TEXTURE_2D,0,tt,le,Re,ht,Ee,Ge,q.data)}se.clearUpdateRanges(),r.pixelStorei(r.UNPACK_ROW_LENGTH,bt),r.pixelStorei(r.UNPACK_SKIP_PIXELS,Ft),r.pixelStorei(r.UNPACK_SKIP_ROWS,Mt)}}function pe(se,q,Ee){let Ge=r.TEXTURE_2D;(q.isDataArrayTexture||q.isCompressedArrayTexture)&&(Ge=r.TEXTURE_2D_ARRAY),q.isData3DTexture&&(Ge=r.TEXTURE_3D);const Ve=xe(se,q),Pe=q.source;t.bindTexture(Ge,se.__webglTexture,r.TEXTURE0+Ee);const wt=n.get(Pe);if(Pe.version!==wt.__version||Ve===!0){t.activeTexture(r.TEXTURE0+Ee);const bt=hi.getPrimaries(hi.workingColorSpace),Ft=q.colorSpace===sf?null:hi.getPrimaries(q.colorSpace),Mt=q.colorSpace===sf||bt===Ft?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,q.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,q.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,q.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,Mt);let Ze=S(q.image,!1,i.maxTextureSize);Ze=it(q,Ze);const Je=s.convert(q.format,q.colorSpace),Nt=s.convert(q.type);let he=R(q.internalFormat,Je,Nt,q.colorSpace,q.isVideoTexture);ne(Ge,q);let Ce;const tt=q.mipmaps,le=q.isVideoTexture!==!0,Re=wt.__version===void 0||Ve===!0,ht=Pe.dataReady,yt=P(q,Ze);if(q.isDepthTexture)he=D(q.format===ig,q.type),Re&&(le?t.texStorage2D(r.TEXTURE_2D,1,he,Ze.width,Ze.height):t.texImage2D(r.TEXTURE_2D,0,he,Ze.width,Ze.height,0,Je,Nt,null));else if(q.isDataTexture)if(tt.length>0){le&&Re&&t.texStorage2D(r.TEXTURE_2D,yt,he,tt[0].width,tt[0].height);for(let ut=0,Qe=tt.length;ut<Qe;ut++)Ce=tt[ut],le?ht&&t.texSubImage2D(r.TEXTURE_2D,ut,0,0,Ce.width,Ce.height,Je,Nt,Ce.data):t.texImage2D(r.TEXTURE_2D,ut,he,Ce.width,Ce.height,0,Je,Nt,Ce.data);q.generateMipmaps=!1}else le?(Re&&t.texStorage2D(r.TEXTURE_2D,yt,he,Ze.width,Ze.height),ht&&Be(q,Ze,Je,Nt)):t.texImage2D(r.TEXTURE_2D,0,he,Ze.width,Ze.height,0,Je,Nt,Ze.data);else if(q.isCompressedTexture)if(q.isCompressedArrayTexture){le&&Re&&t.texStorage3D(r.TEXTURE_2D_ARRAY,yt,he,tt[0].width,tt[0].height,Ze.depth);for(let ut=0,Qe=tt.length;ut<Qe;ut++)if(Ce=tt[ut],q.format!==Ns)if(Je!==null)if(le){if(ht)if(q.layerUpdates.size>0){const Rt=FC(Ce.width,Ce.height,q.format,q.type);for(const Vt of q.layerUpdates){const En=Ce.data.subarray(Vt*Rt/Ce.data.BYTES_PER_ELEMENT,(Vt+1)*Rt/Ce.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,ut,0,0,Vt,Ce.width,Ce.height,1,Je,En)}q.clearLayerUpdates()}else t.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,ut,0,0,0,Ce.width,Ce.height,Ze.depth,Je,Ce.data)}else t.compressedTexImage3D(r.TEXTURE_2D_ARRAY,ut,he,Ce.width,Ce.height,Ze.depth,0,Ce.data,0,0);else Ht("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else le?ht&&t.texSubImage3D(r.TEXTURE_2D_ARRAY,ut,0,0,0,Ce.width,Ce.height,Ze.depth,Je,Nt,Ce.data):t.texImage3D(r.TEXTURE_2D_ARRAY,ut,he,Ce.width,Ce.height,Ze.depth,0,Je,Nt,Ce.data)}else{le&&Re&&t.texStorage2D(r.TEXTURE_2D,yt,he,tt[0].width,tt[0].height);for(let ut=0,Qe=tt.length;ut<Qe;ut++)Ce=tt[ut],q.format!==Ns?Je!==null?le?ht&&t.compressedTexSubImage2D(r.TEXTURE_2D,ut,0,0,Ce.width,Ce.height,Je,Ce.data):t.compressedTexImage2D(r.TEXTURE_2D,ut,he,Ce.width,Ce.height,0,Ce.data):Ht("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):le?ht&&t.texSubImage2D(r.TEXTURE_2D,ut,0,0,Ce.width,Ce.height,Je,Nt,Ce.data):t.texImage2D(r.TEXTURE_2D,ut,he,Ce.width,Ce.height,0,Je,Nt,Ce.data)}else if(q.isDataArrayTexture)if(le){if(Re&&t.texStorage3D(r.TEXTURE_2D_ARRAY,yt,he,Ze.width,Ze.height,Ze.depth),ht)if(q.layerUpdates.size>0){const ut=FC(Ze.width,Ze.height,q.format,q.type);for(const Qe of q.layerUpdates){const Rt=Ze.data.subarray(Qe*ut/Ze.data.BYTES_PER_ELEMENT,(Qe+1)*ut/Ze.data.BYTES_PER_ELEMENT);t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,Qe,Ze.width,Ze.height,1,Je,Nt,Rt)}q.clearLayerUpdates()}else t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,Ze.width,Ze.height,Ze.depth,Je,Nt,Ze.data)}else t.texImage3D(r.TEXTURE_2D_ARRAY,0,he,Ze.width,Ze.height,Ze.depth,0,Je,Nt,Ze.data);else if(q.isData3DTexture)le?(Re&&t.texStorage3D(r.TEXTURE_3D,yt,he,Ze.width,Ze.height,Ze.depth),ht&&t.texSubImage3D(r.TEXTURE_3D,0,0,0,0,Ze.width,Ze.height,Ze.depth,Je,Nt,Ze.data)):t.texImage3D(r.TEXTURE_3D,0,he,Ze.width,Ze.height,Ze.depth,0,Je,Nt,Ze.data);else if(q.isFramebufferTexture){if(Re)if(le)t.texStorage2D(r.TEXTURE_2D,yt,he,Ze.width,Ze.height);else{let ut=Ze.width,Qe=Ze.height;for(let Rt=0;Rt<yt;Rt++)t.texImage2D(r.TEXTURE_2D,Rt,he,ut,Qe,0,Je,Nt,null),ut>>=1,Qe>>=1}}else if(tt.length>0){if(le&&Re){const ut=Tt(tt[0]);t.texStorage2D(r.TEXTURE_2D,yt,he,ut.width,ut.height)}for(let ut=0,Qe=tt.length;ut<Qe;ut++)Ce=tt[ut],le?ht&&t.texSubImage2D(r.TEXTURE_2D,ut,0,0,Je,Nt,Ce):t.texImage2D(r.TEXTURE_2D,ut,he,Je,Nt,Ce);q.generateMipmaps=!1}else if(le){if(Re){const ut=Tt(Ze);t.texStorage2D(r.TEXTURE_2D,yt,he,ut.width,ut.height)}ht&&t.texSubImage2D(r.TEXTURE_2D,0,0,0,Je,Nt,Ze)}else t.texImage2D(r.TEXTURE_2D,0,he,Je,Nt,Ze);E(q)&&b(Ge),wt.__version=Pe.version,q.onUpdate&&q.onUpdate(q)}se.__version=q.version}function be(se,q,Ee){if(q.image.length!==6)return;const Ge=xe(se,q),Ve=q.source;t.bindTexture(r.TEXTURE_CUBE_MAP,se.__webglTexture,r.TEXTURE0+Ee);const Pe=n.get(Ve);if(Ve.version!==Pe.__version||Ge===!0){t.activeTexture(r.TEXTURE0+Ee);const wt=hi.getPrimaries(hi.workingColorSpace),bt=q.colorSpace===sf?null:hi.getPrimaries(q.colorSpace),Ft=q.colorSpace===sf||wt===bt?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,q.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,q.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,q.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ft);const Mt=q.isCompressedTexture||q.image[0].isCompressedTexture,Ze=q.image[0]&&q.image[0].isDataTexture,Je=[];for(let Qe=0;Qe<6;Qe++)!Mt&&!Ze?Je[Qe]=S(q.image[Qe],!0,i.maxCubemapSize):Je[Qe]=Ze?q.image[Qe].image:q.image[Qe],Je[Qe]=it(q,Je[Qe]);const Nt=Je[0],he=s.convert(q.format,q.colorSpace),Ce=s.convert(q.type),tt=R(q.internalFormat,he,Ce,q.colorSpace),le=q.isVideoTexture!==!0,Re=Pe.__version===void 0||Ge===!0,ht=Ve.dataReady;let yt=P(q,Nt);ne(r.TEXTURE_CUBE_MAP,q);let ut;if(Mt){le&&Re&&t.texStorage2D(r.TEXTURE_CUBE_MAP,yt,tt,Nt.width,Nt.height);for(let Qe=0;Qe<6;Qe++){ut=Je[Qe].mipmaps;for(let Rt=0;Rt<ut.length;Rt++){const Vt=ut[Rt];q.format!==Ns?he!==null?le?ht&&t.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,Rt,0,0,Vt.width,Vt.height,he,Vt.data):t.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,Rt,tt,Vt.width,Vt.height,0,Vt.data):Ht("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):le?ht&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,Rt,0,0,Vt.width,Vt.height,he,Ce,Vt.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,Rt,tt,Vt.width,Vt.height,0,he,Ce,Vt.data)}}}else{if(ut=q.mipmaps,le&&Re){ut.length>0&&yt++;const Qe=Tt(Je[0]);t.texStorage2D(r.TEXTURE_CUBE_MAP,yt,tt,Qe.width,Qe.height)}for(let Qe=0;Qe<6;Qe++)if(Ze){le?ht&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,0,0,0,Je[Qe].width,Je[Qe].height,he,Ce,Je[Qe].data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,0,tt,Je[Qe].width,Je[Qe].height,0,he,Ce,Je[Qe].data);for(let Rt=0;Rt<ut.length;Rt++){const En=ut[Rt].image[Qe].image;le?ht&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,Rt+1,0,0,En.width,En.height,he,Ce,En.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,Rt+1,tt,En.width,En.height,0,he,Ce,En.data)}}else{le?ht&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,0,0,0,he,Ce,Je[Qe]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,0,tt,he,Ce,Je[Qe]);for(let Rt=0;Rt<ut.length;Rt++){const Vt=ut[Rt];le?ht&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,Rt+1,0,0,he,Ce,Vt.image[Qe]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,Rt+1,tt,he,Ce,Vt.image[Qe])}}}E(q)&&b(r.TEXTURE_CUBE_MAP),Pe.__version=Ve.version,q.onUpdate&&q.onUpdate(q)}se.__version=q.version}function je(se,q,Ee,Ge,Ve,Pe){const wt=s.convert(Ee.format,Ee.colorSpace),bt=s.convert(Ee.type),Ft=R(Ee.internalFormat,wt,bt,Ee.colorSpace),Mt=n.get(q),Ze=n.get(Ee);if(Ze.__renderTarget=q,!Mt.__hasExternalTextures){const Je=Math.max(1,q.width>>Pe),Nt=Math.max(1,q.height>>Pe);Ve===r.TEXTURE_3D||Ve===r.TEXTURE_2D_ARRAY?t.texImage3D(Ve,Pe,Ft,Je,Nt,q.depth,0,wt,bt,null):t.texImage2D(Ve,Pe,Ft,Je,Nt,0,wt,bt,null)}t.bindFramebuffer(r.FRAMEBUFFER,se),$e(q)?o.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,Ge,Ve,Ze.__webglTexture,0,st(q)):(Ve===r.TEXTURE_2D||Ve>=r.TEXTURE_CUBE_MAP_POSITIVE_X&&Ve<=r.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&r.framebufferTexture2D(r.FRAMEBUFFER,Ge,Ve,Ze.__webglTexture,Pe),t.bindFramebuffer(r.FRAMEBUFFER,null)}function gt(se,q,Ee){if(r.bindRenderbuffer(r.RENDERBUFFER,se),q.depthBuffer){const Ge=q.depthTexture,Ve=Ge&&Ge.isDepthTexture?Ge.type:null,Pe=D(q.stencilBuffer,Ve),wt=q.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,bt=st(q);$e(q)?o.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,bt,Pe,q.width,q.height):Ee?r.renderbufferStorageMultisample(r.RENDERBUFFER,bt,Pe,q.width,q.height):r.renderbufferStorage(r.RENDERBUFFER,Pe,q.width,q.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,wt,r.RENDERBUFFER,se)}else{const Ge=q.textures;for(let Ve=0;Ve<Ge.length;Ve++){const Pe=Ge[Ve],wt=s.convert(Pe.format,Pe.colorSpace),bt=s.convert(Pe.type),Ft=R(Pe.internalFormat,wt,bt,Pe.colorSpace),Mt=st(q);Ee&&$e(q)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,Mt,Ft,q.width,q.height):$e(q)?o.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,Mt,Ft,q.width,q.height):r.renderbufferStorage(r.RENDERBUFFER,Ft,q.width,q.height)}}r.bindRenderbuffer(r.RENDERBUFFER,null)}function St(se,q){if(q&&q.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(r.FRAMEBUFFER,se),!(q.depthTexture&&q.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Ge=n.get(q.depthTexture);Ge.__renderTarget=q,(!Ge.__webglTexture||q.depthTexture.image.width!==q.width||q.depthTexture.image.height!==q.height)&&(q.depthTexture.image.width=q.width,q.depthTexture.image.height=q.height,q.depthTexture.needsUpdate=!0),re(q.depthTexture,0);const Ve=Ge.__webglTexture,Pe=st(q);if(q.depthTexture.format===ng)$e(q)?o.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Ve,0,Pe):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Ve,0);else if(q.depthTexture.format===ig)$e(q)?o.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Ve,0,Pe):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Ve,0);else throw new Error("Unknown depthTexture format")}function At(se){const q=n.get(se),Ee=se.isWebGLCubeRenderTarget===!0;if(q.__boundDepthTexture!==se.depthTexture){const Ge=se.depthTexture;if(q.__depthDisposeCallback&&q.__depthDisposeCallback(),Ge){const Ve=()=>{delete q.__boundDepthTexture,delete q.__depthDisposeCallback,Ge.removeEventListener("dispose",Ve)};Ge.addEventListener("dispose",Ve),q.__depthDisposeCallback=Ve}q.__boundDepthTexture=Ge}if(se.depthTexture&&!q.__autoAllocateDepthBuffer){if(Ee)throw new Error("target.depthTexture not supported in Cube render targets");const Ge=se.texture.mipmaps;Ge&&Ge.length>0?St(q.__webglFramebuffer[0],se):St(q.__webglFramebuffer,se)}else if(Ee){q.__webglDepthbuffer=[];for(let Ge=0;Ge<6;Ge++)if(t.bindFramebuffer(r.FRAMEBUFFER,q.__webglFramebuffer[Ge]),q.__webglDepthbuffer[Ge]===void 0)q.__webglDepthbuffer[Ge]=r.createRenderbuffer(),gt(q.__webglDepthbuffer[Ge],se,!1);else{const Ve=se.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Pe=q.__webglDepthbuffer[Ge];r.bindRenderbuffer(r.RENDERBUFFER,Pe),r.framebufferRenderbuffer(r.FRAMEBUFFER,Ve,r.RENDERBUFFER,Pe)}}else{const Ge=se.texture.mipmaps;if(Ge&&Ge.length>0?t.bindFramebuffer(r.FRAMEBUFFER,q.__webglFramebuffer[0]):t.bindFramebuffer(r.FRAMEBUFFER,q.__webglFramebuffer),q.__webglDepthbuffer===void 0)q.__webglDepthbuffer=r.createRenderbuffer(),gt(q.__webglDepthbuffer,se,!1);else{const Ve=se.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Pe=q.__webglDepthbuffer;r.bindRenderbuffer(r.RENDERBUFFER,Pe),r.framebufferRenderbuffer(r.FRAMEBUFFER,Ve,r.RENDERBUFFER,Pe)}}t.bindFramebuffer(r.FRAMEBUFFER,null)}function jt(se,q,Ee){const Ge=n.get(se);q!==void 0&&je(Ge.__webglFramebuffer,se,se.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,0),Ee!==void 0&&At(se)}function vt(se){const q=se.texture,Ee=n.get(se),Ge=n.get(q);se.addEventListener("dispose",N);const Ve=se.textures,Pe=se.isWebGLCubeRenderTarget===!0,wt=Ve.length>1;if(wt||(Ge.__webglTexture===void 0&&(Ge.__webglTexture=r.createTexture()),Ge.__version=q.version,a.memory.textures++),Pe){Ee.__webglFramebuffer=[];for(let bt=0;bt<6;bt++)if(q.mipmaps&&q.mipmaps.length>0){Ee.__webglFramebuffer[bt]=[];for(let Ft=0;Ft<q.mipmaps.length;Ft++)Ee.__webglFramebuffer[bt][Ft]=r.createFramebuffer()}else Ee.__webglFramebuffer[bt]=r.createFramebuffer()}else{if(q.mipmaps&&q.mipmaps.length>0){Ee.__webglFramebuffer=[];for(let bt=0;bt<q.mipmaps.length;bt++)Ee.__webglFramebuffer[bt]=r.createFramebuffer()}else Ee.__webglFramebuffer=r.createFramebuffer();if(wt)for(let bt=0,Ft=Ve.length;bt<Ft;bt++){const Mt=n.get(Ve[bt]);Mt.__webglTexture===void 0&&(Mt.__webglTexture=r.createTexture(),a.memory.textures++)}if(se.samples>0&&$e(se)===!1){Ee.__webglMultisampledFramebuffer=r.createFramebuffer(),Ee.__webglColorRenderbuffer=[],t.bindFramebuffer(r.FRAMEBUFFER,Ee.__webglMultisampledFramebuffer);for(let bt=0;bt<Ve.length;bt++){const Ft=Ve[bt];Ee.__webglColorRenderbuffer[bt]=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,Ee.__webglColorRenderbuffer[bt]);const Mt=s.convert(Ft.format,Ft.colorSpace),Ze=s.convert(Ft.type),Je=R(Ft.internalFormat,Mt,Ze,Ft.colorSpace,se.isXRRenderTarget===!0),Nt=st(se);r.renderbufferStorageMultisample(r.RENDERBUFFER,Nt,Je,se.width,se.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+bt,r.RENDERBUFFER,Ee.__webglColorRenderbuffer[bt])}r.bindRenderbuffer(r.RENDERBUFFER,null),se.depthBuffer&&(Ee.__webglDepthRenderbuffer=r.createRenderbuffer(),gt(Ee.__webglDepthRenderbuffer,se,!0)),t.bindFramebuffer(r.FRAMEBUFFER,null)}}if(Pe){t.bindTexture(r.TEXTURE_CUBE_MAP,Ge.__webglTexture),ne(r.TEXTURE_CUBE_MAP,q);for(let bt=0;bt<6;bt++)if(q.mipmaps&&q.mipmaps.length>0)for(let Ft=0;Ft<q.mipmaps.length;Ft++)je(Ee.__webglFramebuffer[bt][Ft],se,q,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+bt,Ft);else je(Ee.__webglFramebuffer[bt],se,q,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+bt,0);E(q)&&b(r.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(wt){for(let bt=0,Ft=Ve.length;bt<Ft;bt++){const Mt=Ve[bt],Ze=n.get(Mt);let Je=r.TEXTURE_2D;(se.isWebGL3DRenderTarget||se.isWebGLArrayRenderTarget)&&(Je=se.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY),t.bindTexture(Je,Ze.__webglTexture),ne(Je,Mt),je(Ee.__webglFramebuffer,se,Mt,r.COLOR_ATTACHMENT0+bt,Je,0),E(Mt)&&b(Je)}t.unbindTexture()}else{let bt=r.TEXTURE_2D;if((se.isWebGL3DRenderTarget||se.isWebGLArrayRenderTarget)&&(bt=se.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY),t.bindTexture(bt,Ge.__webglTexture),ne(bt,q),q.mipmaps&&q.mipmaps.length>0)for(let Ft=0;Ft<q.mipmaps.length;Ft++)je(Ee.__webglFramebuffer[Ft],se,q,r.COLOR_ATTACHMENT0,bt,Ft);else je(Ee.__webglFramebuffer,se,q,r.COLOR_ATTACHMENT0,bt,0);E(q)&&b(bt),t.unbindTexture()}se.depthBuffer&&At(se)}function ze(se){const q=se.textures;for(let Ee=0,Ge=q.length;Ee<Ge;Ee++){const Ve=q[Ee];if(E(Ve)){const Pe=T(se),wt=n.get(Ve).__webglTexture;t.bindTexture(Pe,wt),b(Pe),t.unbindTexture()}}}const ie=[],Oe=[];function ue(se){if(se.samples>0){if($e(se)===!1){const q=se.textures,Ee=se.width,Ge=se.height;let Ve=r.COLOR_BUFFER_BIT;const Pe=se.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,wt=n.get(se),bt=q.length>1;if(bt)for(let Mt=0;Mt<q.length;Mt++)t.bindFramebuffer(r.FRAMEBUFFER,wt.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+Mt,r.RENDERBUFFER,null),t.bindFramebuffer(r.FRAMEBUFFER,wt.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+Mt,r.TEXTURE_2D,null,0);t.bindFramebuffer(r.READ_FRAMEBUFFER,wt.__webglMultisampledFramebuffer);const Ft=se.texture.mipmaps;Ft&&Ft.length>0?t.bindFramebuffer(r.DRAW_FRAMEBUFFER,wt.__webglFramebuffer[0]):t.bindFramebuffer(r.DRAW_FRAMEBUFFER,wt.__webglFramebuffer);for(let Mt=0;Mt<q.length;Mt++){if(se.resolveDepthBuffer&&(se.depthBuffer&&(Ve|=r.DEPTH_BUFFER_BIT),se.stencilBuffer&&se.resolveStencilBuffer&&(Ve|=r.STENCIL_BUFFER_BIT)),bt){r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,wt.__webglColorRenderbuffer[Mt]);const Ze=n.get(q[Mt]).__webglTexture;r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,Ze,0)}r.blitFramebuffer(0,0,Ee,Ge,0,0,Ee,Ge,Ve,r.NEAREST),c===!0&&(ie.length=0,Oe.length=0,ie.push(r.COLOR_ATTACHMENT0+Mt),se.depthBuffer&&se.resolveDepthBuffer===!1&&(ie.push(Pe),Oe.push(Pe),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,Oe)),r.invalidateFramebuffer(r.READ_FRAMEBUFFER,ie))}if(t.bindFramebuffer(r.READ_FRAMEBUFFER,null),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),bt)for(let Mt=0;Mt<q.length;Mt++){t.bindFramebuffer(r.FRAMEBUFFER,wt.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+Mt,r.RENDERBUFFER,wt.__webglColorRenderbuffer[Mt]);const Ze=n.get(q[Mt]).__webglTexture;t.bindFramebuffer(r.FRAMEBUFFER,wt.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+Mt,r.TEXTURE_2D,Ze,0)}t.bindFramebuffer(r.DRAW_FRAMEBUFFER,wt.__webglMultisampledFramebuffer)}else if(se.depthBuffer&&se.resolveDepthBuffer===!1&&c){const q=se.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT;r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[q])}}}function st(se){return Math.min(i.maxSamples,se.samples)}function $e(se){const q=n.get(se);return se.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&q.__useRenderToTexture!==!1}function _t(se){const q=a.render.frame;h.get(se)!==q&&(h.set(se,q),se.update())}function it(se,q){const Ee=se.colorSpace,Ge=se.format,Ve=se.type;return se.isCompressedTexture===!0||se.isVideoTexture===!0||Ee!==cc&&Ee!==sf&&(hi.getTransfer(Ee)===Bi?(Ge!==Ns||Ve!==Ha)&&Ht("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):Cn("WebGLTextures: Unsupported texture color space:",Ee)),q}function Tt(se){return typeof HTMLImageElement<"u"&&se instanceof HTMLImageElement?(u.width=se.naturalWidth||se.width,u.height=se.naturalHeight||se.height):typeof VideoFrame<"u"&&se instanceof VideoFrame?(u.width=se.displayWidth,u.height=se.displayHeight):(u.width=se.width,u.height=se.height),u}this.allocateTextureUnit=Z,this.resetTextureUnits=W,this.setTexture2D=re,this.setTexture2DArray=k,this.setTexture3D=j,this.setTextureCube=J,this.rebindTextures=jt,this.setupRenderTarget=vt,this.updateRenderTargetMipmap=ze,this.updateMultisampleRenderTarget=ue,this.setupDepthRenderbuffer=At,this.setupFrameBufferTexture=je,this.useMultisampledRTT=$e}function cN(r,e){function t(n,i=sf){let s;const a=hi.getTransfer(i);if(n===Ha)return r.UNSIGNED_BYTE;if(n===Gb)return r.UNSIGNED_SHORT_4_4_4_4;if(n===Hb)return r.UNSIGNED_SHORT_5_5_5_1;if(n===XR)return r.UNSIGNED_INT_5_9_9_9_REV;if(n===KR)return r.UNSIGNED_INT_10F_11F_11F_REV;if(n===Fb)return r.BYTE;if(n===kb)return r.SHORT;if(n===eg)return r.UNSIGNED_SHORT;if(n===Ux)return r.INT;if(n===lu)return r.UNSIGNED_INT;if(n===Ss)return r.FLOAT;if(n===ar)return r.HALF_FLOAT;if(n===qR)return r.ALPHA;if(n===jR)return r.RGB;if(n===Ns)return r.RGBA;if(n===ng)return r.DEPTH_COMPONENT;if(n===ig)return r.DEPTH_STENCIL;if(n===Fx)return r.RED;if(n===kx)return r.RED_INTEGER;if(n===zb)return r.RG;if(n===Vb)return r.RG_INTEGER;if(n===Yb)return r.RGBA_INTEGER;if(n===Ny||n===Uy||n===Fy||n===ky)if(a===Bi)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(n===Ny)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Uy)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Fy)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===ky)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(n===Ny)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Uy)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Fy)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===ky)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===RE||n===DE||n===LE||n===wE)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(n===RE)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===DE)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===LE)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===wE)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===IE||n===BE||n===OE)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(n===IE||n===BE)return a===Bi?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===OE)return a===Bi?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===PE||n===NE||n===UE||n===FE||n===kE||n===GE||n===HE||n===zE||n===VE||n===YE||n===XE||n===KE||n===qE||n===jE)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(n===PE)return a===Bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===NE)return a===Bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===UE)return a===Bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===FE)return a===Bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===kE)return a===Bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===GE)return a===Bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===HE)return a===Bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===zE)return a===Bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===VE)return a===Bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===YE)return a===Bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===XE)return a===Bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===KE)return a===Bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===qE)return a===Bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===jE)return a===Bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===WE||n===JE||n===$E)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(n===WE)return a===Bi?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===JE)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===$E)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===QE||n===ZE||n===eb||n===tb)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(n===QE)return s.COMPRESSED_RED_RGTC1_EXT;if(n===ZE)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===eb)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===tb)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===tg?r.UNSIGNED_INT_24_8:r[n]!==void 0?r[n]:null}return{convert:t}}const R7=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,D7=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class L7{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const n=new uD(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new za({vertexShader:R7,fragmentShader:D7,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new As(new Hh(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class w7 extends hu{constructor(e,t){super();const n=this;let i=null,s=1,a=null,o="local-floor",c=1,u=null,h=null,p=null,v=null,y=null,x=null;const S=typeof XRWebGLBinding<"u",E=new L7,b={},T=t.getContextAttributes();let R=null,D=null;const P=[],O=[],N=new at;let U=null;const B=new cs;B.viewport=new vi;const I=new cs;I.viewport=new vi;const z=[B,I],W=new ZP;let Z=null,te=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(pe){let be=P[pe];return be===void 0&&(be=new ZA,P[pe]=be),be.getTargetRaySpace()},this.getControllerGrip=function(pe){let be=P[pe];return be===void 0&&(be=new ZA,P[pe]=be),be.getGripSpace()},this.getHand=function(pe){let be=P[pe];return be===void 0&&(be=new ZA,P[pe]=be),be.getHandSpace()};function re(pe){const be=O.indexOf(pe.inputSource);if(be===-1)return;const je=P[be];je!==void 0&&(je.update(pe.inputSource,pe.frame,u||a),je.dispatchEvent({type:pe.type,data:pe.inputSource}))}function k(){i.removeEventListener("select",re),i.removeEventListener("selectstart",re),i.removeEventListener("selectend",re),i.removeEventListener("squeeze",re),i.removeEventListener("squeezestart",re),i.removeEventListener("squeezeend",re),i.removeEventListener("end",k),i.removeEventListener("inputsourceschange",j);for(let pe=0;pe<P.length;pe++){const be=O[pe];be!==null&&(O[pe]=null,P[pe].disconnect(be))}Z=null,te=null,E.reset();for(const pe in b)delete b[pe];e.setRenderTarget(R),y=null,v=null,p=null,i=null,D=null,Be.stop(),n.isPresenting=!1,e.setPixelRatio(U),e.setSize(N.width,N.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(pe){s=pe,n.isPresenting===!0&&Ht("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(pe){o=pe,n.isPresenting===!0&&Ht("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||a},this.setReferenceSpace=function(pe){u=pe},this.getBaseLayer=function(){return v!==null?v:y},this.getBinding=function(){return p===null&&S&&(p=new XRWebGLBinding(i,t)),p},this.getFrame=function(){return x},this.getSession=function(){return i},this.setSession=async function(pe){if(i=pe,i!==null){if(R=e.getRenderTarget(),i.addEventListener("select",re),i.addEventListener("selectstart",re),i.addEventListener("selectend",re),i.addEventListener("squeeze",re),i.addEventListener("squeezestart",re),i.addEventListener("squeezeend",re),i.addEventListener("end",k),i.addEventListener("inputsourceschange",j),T.xrCompatible!==!0&&await t.makeXRCompatible(),U=e.getPixelRatio(),e.getSize(N),S&&"createProjectionLayer"in XRWebGLBinding.prototype){let je=null,gt=null,St=null;T.depth&&(St=T.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,je=T.stencil?ig:ng,gt=T.stencil?tg:lu);const At={colorFormat:t.RGBA8,depthFormat:St,scaleFactor:s};p=this.getBinding(),v=p.createProjectionLayer(At),i.updateRenderState({layers:[v]}),e.setPixelRatio(1),e.setSize(v.textureWidth,v.textureHeight,!1),D=new Al(v.textureWidth,v.textureHeight,{format:Ns,type:Ha,depthTexture:new cD(v.textureWidth,v.textureHeight,gt,void 0,void 0,void 0,void 0,void 0,void 0,je),stencilBuffer:T.stencil,colorSpace:e.outputColorSpace,samples:T.antialias?4:0,resolveDepthBuffer:v.ignoreDepthValues===!1,resolveStencilBuffer:v.ignoreDepthValues===!1})}else{const je={antialias:T.antialias,alpha:!0,depth:T.depth,stencil:T.stencil,framebufferScaleFactor:s};y=new XRWebGLLayer(i,t,je),i.updateRenderState({baseLayer:y}),e.setPixelRatio(1),e.setSize(y.framebufferWidth,y.framebufferHeight,!1),D=new Al(y.framebufferWidth,y.framebufferHeight,{format:Ns,type:Ha,colorSpace:e.outputColorSpace,stencilBuffer:T.stencil,resolveDepthBuffer:y.ignoreDepthValues===!1,resolveStencilBuffer:y.ignoreDepthValues===!1})}D.isXRRenderTarget=!0,this.setFoveation(c),u=null,a=await i.requestReferenceSpace(o),Be.setContext(i),Be.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return E.getDepthTexture()};function j(pe){for(let be=0;be<pe.removed.length;be++){const je=pe.removed[be],gt=O.indexOf(je);gt>=0&&(O[gt]=null,P[gt].disconnect(je))}for(let be=0;be<pe.added.length;be++){const je=pe.added[be];let gt=O.indexOf(je);if(gt===-1){for(let At=0;At<P.length;At++)if(At>=O.length){O.push(je),gt=At;break}else if(O[At]===null){O[At]=je,gt=At;break}if(gt===-1)break}const St=P[gt];St&&St.connect(je)}}const J=new ae,oe=new ae;function K(pe,be,je){J.setFromMatrixPosition(be.matrixWorld),oe.setFromMatrixPosition(je.matrixWorld);const gt=J.distanceTo(oe),St=be.projectionMatrix.elements,At=je.projectionMatrix.elements,jt=St[14]/(St[10]-1),vt=St[14]/(St[10]+1),ze=(St[9]+1)/St[5],ie=(St[9]-1)/St[5],Oe=(St[8]-1)/St[0],ue=(At[8]+1)/At[0],st=jt*Oe,$e=jt*ue,_t=gt/(-Oe+ue),it=_t*-Oe;if(be.matrixWorld.decompose(pe.position,pe.quaternion,pe.scale),pe.translateX(it),pe.translateZ(_t),pe.matrixWorld.compose(pe.position,pe.quaternion,pe.scale),pe.matrixWorldInverse.copy(pe.matrixWorld).invert(),St[10]===-1)pe.projectionMatrix.copy(be.projectionMatrix),pe.projectionMatrixInverse.copy(be.projectionMatrixInverse);else{const Tt=jt+_t,se=vt+_t,q=st-it,Ee=$e+(gt-it),Ge=ze*vt/se*Tt,Ve=ie*vt/se*Tt;pe.projectionMatrix.makePerspective(q,Ee,Ge,Ve,Tt,se),pe.projectionMatrixInverse.copy(pe.projectionMatrix).invert()}}function X(pe,be){be===null?pe.matrixWorld.copy(pe.matrix):pe.matrixWorld.multiplyMatrices(be.matrixWorld,pe.matrix),pe.matrixWorldInverse.copy(pe.matrixWorld).invert()}this.updateCamera=function(pe){if(i===null)return;let be=pe.near,je=pe.far;E.texture!==null&&(E.depthNear>0&&(be=E.depthNear),E.depthFar>0&&(je=E.depthFar)),W.near=I.near=B.near=be,W.far=I.far=B.far=je,(Z!==W.near||te!==W.far)&&(i.updateRenderState({depthNear:W.near,depthFar:W.far}),Z=W.near,te=W.far),W.layers.mask=pe.layers.mask|6,B.layers.mask=W.layers.mask&3,I.layers.mask=W.layers.mask&5;const gt=pe.parent,St=W.cameras;X(W,gt);for(let At=0;At<St.length;At++)X(St[At],gt);St.length===2?K(W,B,I):W.projectionMatrix.copy(B.projectionMatrix),ne(pe,W,gt)};function ne(pe,be,je){je===null?pe.matrix.copy(be.matrixWorld):(pe.matrix.copy(je.matrixWorld),pe.matrix.invert(),pe.matrix.multiply(be.matrixWorld)),pe.matrix.decompose(pe.position,pe.quaternion,pe.scale),pe.updateMatrixWorld(!0),pe.projectionMatrix.copy(be.projectionMatrix),pe.projectionMatrixInverse.copy(be.projectionMatrixInverse),pe.isPerspectiveCamera&&(pe.fov=lg*2*Math.atan(1/pe.projectionMatrix.elements[5]),pe.zoom=1)}this.getCamera=function(){return W},this.getFoveation=function(){if(!(v===null&&y===null))return c},this.setFoveation=function(pe){c=pe,v!==null&&(v.fixedFoveation=pe),y!==null&&y.fixedFoveation!==void 0&&(y.fixedFoveation=pe)},this.hasDepthSensing=function(){return E.texture!==null},this.getDepthSensingMesh=function(){return E.getMesh(W)},this.getCameraTexture=function(pe){return b[pe]};let xe=null;function _e(pe,be){if(h=be.getViewerPose(u||a),x=be,h!==null){const je=h.views;y!==null&&(e.setRenderTargetFramebuffer(D,y.framebuffer),e.setRenderTarget(D));let gt=!1;je.length!==W.cameras.length&&(W.cameras.length=0,gt=!0);for(let vt=0;vt<je.length;vt++){const ze=je[vt];let ie=null;if(y!==null)ie=y.getViewport(ze);else{const ue=p.getViewSubImage(v,ze);ie=ue.viewport,vt===0&&(e.setRenderTargetTextures(D,ue.colorTexture,ue.depthStencilTexture),e.setRenderTarget(D))}let Oe=z[vt];Oe===void 0&&(Oe=new cs,Oe.layers.enable(vt),Oe.viewport=new vi,z[vt]=Oe),Oe.matrix.fromArray(ze.transform.matrix),Oe.matrix.decompose(Oe.position,Oe.quaternion,Oe.scale),Oe.projectionMatrix.fromArray(ze.projectionMatrix),Oe.projectionMatrixInverse.copy(Oe.projectionMatrix).invert(),Oe.viewport.set(ie.x,ie.y,ie.width,ie.height),vt===0&&(W.matrix.copy(Oe.matrix),W.matrix.decompose(W.position,W.quaternion,W.scale)),gt===!0&&W.cameras.push(Oe)}const St=i.enabledFeatures;if(St&&St.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&S){p=n.getBinding();const vt=p.getDepthInformation(je[0]);vt&&vt.isValid&&vt.texture&&E.init(vt,i.renderState)}if(St&&St.includes("camera-access")&&S){e.state.unbindTexture(),p=n.getBinding();for(let vt=0;vt<je.length;vt++){const ze=je[vt].camera;if(ze){let ie=b[ze];ie||(ie=new uD,b[ze]=ie);const Oe=p.getCameraImage(ze);ie.sourceTexture=Oe}}}}for(let je=0;je<P.length;je++){const gt=O[je],St=P[je];gt!==null&&St!==void 0&&St.update(gt,be,u||a)}xe&&xe(pe,be),be.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:be}),x=null}const Be=new sN;Be.setAnimationLoop(_e),this.setAnimationLoop=function(pe){xe=pe},this.dispose=function(){}}}const jd=new Ho,I7=new yn;function B7(r,e){function t(E,b){E.matrixAutoUpdate===!0&&E.updateMatrix(),b.value.copy(E.matrix)}function n(E,b){b.color.getRGB(E.fogColor.value,hP(r)),b.isFog?(E.fogNear.value=b.near,E.fogFar.value=b.far):b.isFogExp2&&(E.fogDensity.value=b.density)}function i(E,b,T,R,D){b.isMeshBasicMaterial||b.isMeshLambertMaterial?s(E,b):b.isMeshToonMaterial?(s(E,b),p(E,b)):b.isMeshPhongMaterial?(s(E,b),h(E,b)):b.isMeshStandardMaterial?(s(E,b),v(E,b),b.isMeshPhysicalMaterial&&y(E,b,D)):b.isMeshMatcapMaterial?(s(E,b),x(E,b)):b.isMeshDepthMaterial?s(E,b):b.isMeshDistanceMaterial?(s(E,b),S(E,b)):b.isMeshNormalMaterial?s(E,b):b.isLineBasicMaterial?(a(E,b),b.isLineDashedMaterial&&o(E,b)):b.isPointsMaterial?c(E,b,T,R):b.isSpriteMaterial?u(E,b):b.isShadowMaterial?(E.color.value.copy(b.color),E.opacity.value=b.opacity):b.isShaderMaterial&&(b.uniformsNeedUpdate=!1)}function s(E,b){E.opacity.value=b.opacity,b.color&&E.diffuse.value.copy(b.color),b.emissive&&E.emissive.value.copy(b.emissive).multiplyScalar(b.emissiveIntensity),b.map&&(E.map.value=b.map,t(b.map,E.mapTransform)),b.alphaMap&&(E.alphaMap.value=b.alphaMap,t(b.alphaMap,E.alphaMapTransform)),b.bumpMap&&(E.bumpMap.value=b.bumpMap,t(b.bumpMap,E.bumpMapTransform),E.bumpScale.value=b.bumpScale,b.side===Ga&&(E.bumpScale.value*=-1)),b.normalMap&&(E.normalMap.value=b.normalMap,t(b.normalMap,E.normalMapTransform),E.normalScale.value.copy(b.normalScale),b.side===Ga&&E.normalScale.value.negate()),b.displacementMap&&(E.displacementMap.value=b.displacementMap,t(b.displacementMap,E.displacementMapTransform),E.displacementScale.value=b.displacementScale,E.displacementBias.value=b.displacementBias),b.emissiveMap&&(E.emissiveMap.value=b.emissiveMap,t(b.emissiveMap,E.emissiveMapTransform)),b.specularMap&&(E.specularMap.value=b.specularMap,t(b.specularMap,E.specularMapTransform)),b.alphaTest>0&&(E.alphaTest.value=b.alphaTest);const T=e.get(b),R=T.envMap,D=T.envMapRotation;R&&(E.envMap.value=R,jd.copy(D),jd.x*=-1,jd.y*=-1,jd.z*=-1,R.isCubeTexture&&R.isRenderTargetTexture===!1&&(jd.y*=-1,jd.z*=-1),E.envMapRotation.value.setFromMatrix4(I7.makeRotationFromEuler(jd)),E.flipEnvMap.value=R.isCubeTexture&&R.isRenderTargetTexture===!1?-1:1,E.reflectivity.value=b.reflectivity,E.ior.value=b.ior,E.refractionRatio.value=b.refractionRatio),b.lightMap&&(E.lightMap.value=b.lightMap,E.lightMapIntensity.value=b.lightMapIntensity,t(b.lightMap,E.lightMapTransform)),b.aoMap&&(E.aoMap.value=b.aoMap,E.aoMapIntensity.value=b.aoMapIntensity,t(b.aoMap,E.aoMapTransform))}function a(E,b){E.diffuse.value.copy(b.color),E.opacity.value=b.opacity,b.map&&(E.map.value=b.map,t(b.map,E.mapTransform))}function o(E,b){E.dashSize.value=b.dashSize,E.totalSize.value=b.dashSize+b.gapSize,E.scale.value=b.scale}function c(E,b,T,R){E.diffuse.value.copy(b.color),E.opacity.value=b.opacity,E.size.value=b.size*T,E.scale.value=R*.5,b.map&&(E.map.value=b.map,t(b.map,E.uvTransform)),b.alphaMap&&(E.alphaMap.value=b.alphaMap,t(b.alphaMap,E.alphaMapTransform)),b.alphaTest>0&&(E.alphaTest.value=b.alphaTest)}function u(E,b){E.diffuse.value.copy(b.color),E.opacity.value=b.opacity,E.rotation.value=b.rotation,b.map&&(E.map.value=b.map,t(b.map,E.mapTransform)),b.alphaMap&&(E.alphaMap.value=b.alphaMap,t(b.alphaMap,E.alphaMapTransform)),b.alphaTest>0&&(E.alphaTest.value=b.alphaTest)}function h(E,b){E.specular.value.copy(b.specular),E.shininess.value=Math.max(b.shininess,1e-4)}function p(E,b){b.gradientMap&&(E.gradientMap.value=b.gradientMap)}function v(E,b){E.metalness.value=b.metalness,b.metalnessMap&&(E.metalnessMap.value=b.metalnessMap,t(b.metalnessMap,E.metalnessMapTransform)),E.roughness.value=b.roughness,b.roughnessMap&&(E.roughnessMap.value=b.roughnessMap,t(b.roughnessMap,E.roughnessMapTransform)),b.envMap&&(E.envMapIntensity.value=b.envMapIntensity)}function y(E,b,T){E.ior.value=b.ior,b.sheen>0&&(E.sheenColor.value.copy(b.sheenColor).multiplyScalar(b.sheen),E.sheenRoughness.value=b.sheenRoughness,b.sheenColorMap&&(E.sheenColorMap.value=b.sheenColorMap,t(b.sheenColorMap,E.sheenColorMapTransform)),b.sheenRoughnessMap&&(E.sheenRoughnessMap.value=b.sheenRoughnessMap,t(b.sheenRoughnessMap,E.sheenRoughnessMapTransform))),b.clearcoat>0&&(E.clearcoat.value=b.clearcoat,E.clearcoatRoughness.value=b.clearcoatRoughness,b.clearcoatMap&&(E.clearcoatMap.value=b.clearcoatMap,t(b.clearcoatMap,E.clearcoatMapTransform)),b.clearcoatRoughnessMap&&(E.clearcoatRoughnessMap.value=b.clearcoatRoughnessMap,t(b.clearcoatRoughnessMap,E.clearcoatRoughnessMapTransform)),b.clearcoatNormalMap&&(E.clearcoatNormalMap.value=b.clearcoatNormalMap,t(b.clearcoatNormalMap,E.clearcoatNormalMapTransform),E.clearcoatNormalScale.value.copy(b.clearcoatNormalScale),b.side===Ga&&E.clearcoatNormalScale.value.negate())),b.dispersion>0&&(E.dispersion.value=b.dispersion),b.iridescence>0&&(E.iridescence.value=b.iridescence,E.iridescenceIOR.value=b.iridescenceIOR,E.iridescenceThicknessMinimum.value=b.iridescenceThicknessRange[0],E.iridescenceThicknessMaximum.value=b.iridescenceThicknessRange[1],b.iridescenceMap&&(E.iridescenceMap.value=b.iridescenceMap,t(b.iridescenceMap,E.iridescenceMapTransform)),b.iridescenceThicknessMap&&(E.iridescenceThicknessMap.value=b.iridescenceThicknessMap,t(b.iridescenceThicknessMap,E.iridescenceThicknessMapTransform))),b.transmission>0&&(E.transmission.value=b.transmission,E.transmissionSamplerMap.value=T.texture,E.transmissionSamplerSize.value.set(T.width,T.height),b.transmissionMap&&(E.transmissionMap.value=b.transmissionMap,t(b.transmissionMap,E.transmissionMapTransform)),E.thickness.value=b.thickness,b.thicknessMap&&(E.thicknessMap.value=b.thicknessMap,t(b.thicknessMap,E.thicknessMapTransform)),E.attenuationDistance.value=b.attenuationDistance,E.attenuationColor.value.copy(b.attenuationColor)),b.anisotropy>0&&(E.anisotropyVector.value.set(b.anisotropy*Math.cos(b.anisotropyRotation),b.anisotropy*Math.sin(b.anisotropyRotation)),b.anisotropyMap&&(E.anisotropyMap.value=b.anisotropyMap,t(b.anisotropyMap,E.anisotropyMapTransform))),E.specularIntensity.value=b.specularIntensity,E.specularColor.value.copy(b.specularColor),b.specularColorMap&&(E.specularColorMap.value=b.specularColorMap,t(b.specularColorMap,E.specularColorMapTransform)),b.specularIntensityMap&&(E.specularIntensityMap.value=b.specularIntensityMap,t(b.specularIntensityMap,E.specularIntensityMapTransform))}function x(E,b){b.matcap&&(E.matcap.value=b.matcap)}function S(E,b){const T=e.get(b).light;E.referencePosition.value.setFromMatrixPosition(T.matrixWorld),E.nearDistance.value=T.shadow.camera.near,E.farDistance.value=T.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function O7(r,e,t,n){let i={},s={},a=[];const o=r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS);function c(T,R){const D=R.program;n.uniformBlockBinding(T,D)}function u(T,R){let D=i[T.id];D===void 0&&(x(T),D=h(T),i[T.id]=D,T.addEventListener("dispose",E));const P=R.program;n.updateUBOMapping(T,P);const O=e.render.frame;s[T.id]!==O&&(v(T),s[T.id]=O)}function h(T){const R=p();T.__bindingPointIndex=R;const D=r.createBuffer(),P=T.__size,O=T.usage;return r.bindBuffer(r.UNIFORM_BUFFER,D),r.bufferData(r.UNIFORM_BUFFER,P,O),r.bindBuffer(r.UNIFORM_BUFFER,null),r.bindBufferBase(r.UNIFORM_BUFFER,R,D),D}function p(){for(let T=0;T<o;T++)if(a.indexOf(T)===-1)return a.push(T),T;return Cn("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function v(T){const R=i[T.id],D=T.uniforms,P=T.__cache;r.bindBuffer(r.UNIFORM_BUFFER,R);for(let O=0,N=D.length;O<N;O++){const U=Array.isArray(D[O])?D[O]:[D[O]];for(let B=0,I=U.length;B<I;B++){const z=U[B];if(y(z,O,B,P)===!0){const W=z.__offset,Z=Array.isArray(z.value)?z.value:[z.value];let te=0;for(let re=0;re<Z.length;re++){const k=Z[re],j=S(k);typeof k=="number"||typeof k=="boolean"?(z.__data[0]=k,r.bufferSubData(r.UNIFORM_BUFFER,W+te,z.__data)):k.isMatrix3?(z.__data[0]=k.elements[0],z.__data[1]=k.elements[1],z.__data[2]=k.elements[2],z.__data[3]=0,z.__data[4]=k.elements[3],z.__data[5]=k.elements[4],z.__data[6]=k.elements[5],z.__data[7]=0,z.__data[8]=k.elements[6],z.__data[9]=k.elements[7],z.__data[10]=k.elements[8],z.__data[11]=0):(k.toArray(z.__data,te),te+=j.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(r.UNIFORM_BUFFER,W,z.__data)}}}r.bindBuffer(r.UNIFORM_BUFFER,null)}function y(T,R,D,P){const O=T.value,N=R+"_"+D;if(P[N]===void 0)return typeof O=="number"||typeof O=="boolean"?P[N]=O:P[N]=O.clone(),!0;{const U=P[N];if(typeof O=="number"||typeof O=="boolean"){if(U!==O)return P[N]=O,!0}else if(U.equals(O)===!1)return U.copy(O),!0}return!1}function x(T){const R=T.uniforms;let D=0;const P=16;for(let N=0,U=R.length;N<U;N++){const B=Array.isArray(R[N])?R[N]:[R[N]];for(let I=0,z=B.length;I<z;I++){const W=B[I],Z=Array.isArray(W.value)?W.value:[W.value];for(let te=0,re=Z.length;te<re;te++){const k=Z[te],j=S(k),J=D%P,oe=J%j.boundary,K=J+oe;D+=oe,K!==0&&P-K<j.storage&&(D+=P-K),W.__data=new Float32Array(j.storage/Float32Array.BYTES_PER_ELEMENT),W.__offset=D,D+=j.storage}}}const O=D%P;return O>0&&(D+=P-O),T.__size=D,T.__cache={},this}function S(T){const R={boundary:0,storage:0};return typeof T=="number"||typeof T=="boolean"?(R.boundary=4,R.storage=4):T.isVector2?(R.boundary=8,R.storage=8):T.isVector3||T.isColor?(R.boundary=16,R.storage=12):T.isVector4?(R.boundary=16,R.storage=16):T.isMatrix3?(R.boundary=48,R.storage=48):T.isMatrix4?(R.boundary=64,R.storage=64):T.isTexture?Ht("WebGLRenderer: Texture samplers can not be part of an uniforms group."):Ht("WebGLRenderer: Unsupported uniform value type.",T),R}function E(T){const R=T.target;R.removeEventListener("dispose",E);const D=a.indexOf(R.__bindingPointIndex);a.splice(D,1),r.deleteBuffer(i[R.id]),delete i[R.id],delete s[R.id]}function b(){for(const T in i)r.deleteBuffer(i[T]);a=[],i={},s={}}return{bind:c,update:u,dispose:b}}const P7=new Uint16Array([11481,15204,11534,15171,11808,15015,12385,14843,12894,14716,13396,14600,13693,14483,13976,14366,14237,14171,14405,13961,14511,13770,14605,13598,14687,13444,14760,13305,14822,13066,14876,12857,14923,12675,14963,12517,14997,12379,15025,12230,15049,12023,15070,11843,15086,11687,15100,11551,15111,11433,15120,11330,15127,11217,15132,11060,15135,10922,15138,10801,15139,10695,15139,10600,13012,14923,13020,14917,13064,14886,13176,14800,13349,14666,13513,14526,13724,14398,13960,14230,14200,14020,14383,13827,14488,13651,14583,13491,14667,13348,14740,13132,14803,12908,14856,12713,14901,12542,14938,12394,14968,12241,14992,12017,15010,11822,15024,11654,15034,11507,15041,11380,15044,11269,15044,11081,15042,10913,15037,10764,15031,10635,15023,10520,15014,10419,15003,10330,13657,14676,13658,14673,13670,14660,13698,14622,13750,14547,13834,14442,13956,14317,14112,14093,14291,13889,14407,13704,14499,13538,14586,13389,14664,13201,14733,12966,14792,12758,14842,12577,14882,12418,14915,12272,14940,12033,14959,11826,14972,11646,14980,11490,14983,11355,14983,11212,14979,11008,14971,10830,14961,10675,14950,10540,14936,10420,14923,10315,14909,10204,14894,10041,14089,14460,14090,14459,14096,14452,14112,14431,14141,14388,14186,14305,14252,14130,14341,13941,14399,13756,14467,13585,14539,13430,14610,13272,14677,13026,14737,12808,14790,12617,14833,12449,14869,12303,14896,12065,14916,11845,14929,11655,14937,11490,14939,11347,14936,11184,14930,10970,14921,10783,14912,10621,14900,10480,14885,10356,14867,10247,14848,10062,14827,9894,14805,9745,14400,14208,14400,14206,14402,14198,14406,14174,14415,14122,14427,14035,14444,13913,14469,13767,14504,13613,14548,13463,14598,13324,14651,13082,14704,12858,14752,12658,14795,12483,14831,12330,14860,12106,14881,11875,14895,11675,14903,11501,14905,11351,14903,11178,14900,10953,14892,10757,14880,10589,14865,10442,14847,10313,14827,10162,14805,9965,14782,9792,14757,9642,14731,9507,14562,13883,14562,13883,14563,13877,14566,13862,14570,13830,14576,13773,14584,13689,14595,13582,14613,13461,14637,13336,14668,13120,14704,12897,14741,12695,14776,12516,14808,12358,14835,12150,14856,11910,14870,11701,14878,11519,14882,11361,14884,11187,14880,10951,14871,10748,14858,10572,14842,10418,14823,10286,14801,10099,14777,9897,14751,9722,14725,9567,14696,9430,14666,9309,14702,13604,14702,13604,14702,13600,14703,13591,14705,13570,14707,13533,14709,13477,14712,13400,14718,13305,14727,13106,14743,12907,14762,12716,14784,12539,14807,12380,14827,12190,14844,11943,14855,11727,14863,11539,14870,11376,14871,11204,14868,10960,14858,10748,14845,10565,14829,10406,14809,10269,14786,10058,14761,9852,14734,9671,14705,9512,14674,9374,14641,9253,14608,9076,14821,13366,14821,13365,14821,13364,14821,13358,14821,13344,14821,13320,14819,13252,14817,13145,14815,13011,14814,12858,14817,12698,14823,12539,14832,12389,14841,12214,14850,11968,14856,11750,14861,11558,14866,11390,14867,11226,14862,10972,14853,10754,14840,10565,14823,10401,14803,10259,14780,10032,14754,9820,14725,9635,14694,9473,14661,9333,14627,9203,14593,8988,14557,8798,14923,13014,14922,13014,14922,13012,14922,13004,14920,12987,14919,12957,14915,12907,14909,12834,14902,12738,14894,12623,14888,12498,14883,12370,14880,12203,14878,11970,14875,11759,14873,11569,14874,11401,14872,11243,14865,10986,14855,10762,14842,10568,14825,10401,14804,10255,14781,10017,14754,9799,14725,9611,14692,9445,14658,9301,14623,9139,14587,8920,14548,8729,14509,8562,15008,12672,15008,12672,15008,12671,15007,12667,15005,12656,15001,12637,14997,12605,14989,12556,14978,12490,14966,12407,14953,12313,14940,12136,14927,11934,14914,11742,14903,11563,14896,11401,14889,11247,14879,10992,14866,10767,14851,10570,14833,10400,14812,10252,14789,10007,14761,9784,14731,9592,14698,9424,14663,9279,14627,9088,14588,8868,14548,8676,14508,8508,14467,8360,15080,12386,15080,12386,15079,12385,15078,12383,15076,12378,15072,12367,15066,12347,15057,12315,15045,12253,15030,12138,15012,11998,14993,11845,14972,11685,14951,11530,14935,11383,14920,11228,14904,10981,14887,10762,14870,10567,14850,10397,14827,10248,14803,9997,14774,9771,14743,9578,14710,9407,14674,9259,14637,9048,14596,8826,14555,8632,14514,8464,14471,8317,14427,8182,15139,12008,15139,12008,15138,12008,15137,12007,15135,12003,15130,11990,15124,11969,15115,11929,15102,11872,15086,11794,15064,11693,15041,11581,15013,11459,14987,11336,14966,11170,14944,10944,14921,10738,14898,10552,14875,10387,14850,10239,14824,9983,14794,9758,14762,9563,14728,9392,14692,9244,14653,9014,14611,8791,14569,8597,14526,8427,14481,8281,14436,8110,14391,7885,15188,11617,15188,11617,15187,11617,15186,11618,15183,11617,15179,11612,15173,11601,15163,11581,15150,11546,15133,11495,15110,11427,15083,11346,15051,11246,15024,11057,14996,10868,14967,10687,14938,10517,14911,10362,14882,10206,14853,9956,14821,9737,14787,9543,14752,9375,14715,9228,14675,8980,14632,8760,14589,8565,14544,8395,14498,8248,14451,8049,14404,7824,14357,7630,15228,11298,15228,11298,15227,11299,15226,11301,15223,11303,15219,11302,15213,11299,15204,11290,15191,11271,15174,11217,15150,11129,15119,11015,15087,10886,15057,10744,15024,10599,14990,10455,14957,10318,14924,10143,14891,9911,14856,9701,14820,9516,14782,9352,14744,9200,14703,8946,14659,8725,14615,8533,14568,8366,14521,8220,14472,7992,14423,7770,14374,7578,14315,7408,15260,10819,15260,10819,15259,10822,15258,10826,15256,10832,15251,10836,15246,10841,15237,10838,15225,10821,15207,10788,15183,10734,15151,10660,15120,10571,15087,10469,15049,10359,15012,10249,14974,10041,14937,9837,14900,9647,14860,9475,14820,9320,14779,9147,14736,8902,14691,8688,14646,8499,14598,8335,14549,8189,14499,7940,14448,7720,14397,7529,14347,7363,14256,7218,15285,10410,15285,10411,15285,10413,15284,10418,15282,10425,15278,10434,15272,10442,15264,10449,15252,10445,15235,10433,15210,10403,15179,10358,15149,10301,15113,10218,15073,10059,15033,9894,14991,9726,14951,9565,14909,9413,14865,9273,14822,9073,14777,8845,14730,8641,14682,8459,14633,8300,14583,8129,14531,7883,14479,7670,14426,7482,14373,7321,14305,7176,14201,6939,15305,9939,15305,9940,15305,9945,15304,9955,15302,9967,15298,9989,15293,10010,15286,10033,15274,10044,15258,10045,15233,10022,15205,9975,15174,9903,15136,9808,15095,9697,15053,9578,15009,9451,14965,9327,14918,9198,14871,8973,14825,8766,14775,8579,14725,8408,14675,8259,14622,8058,14569,7821,14515,7615,14460,7435,14405,7276,14350,7108,14256,6866,14149,6653,15321,9444,15321,9445,15321,9448,15320,9458,15317,9470,15314,9490,15310,9515,15302,9540,15292,9562,15276,9579,15251,9577,15226,9559,15195,9519,15156,9463,15116,9389,15071,9304,15025,9208,14978,9023,14927,8838,14878,8661,14827,8496,14774,8344,14722,8206,14667,7973,14612,7749,14556,7555,14499,7382,14443,7229,14385,7025,14322,6791,14210,6588,14100,6409,15333,8920,15333,8921,15332,8927,15332,8943,15329,8965,15326,9002,15322,9048,15316,9106,15307,9162,15291,9204,15267,9221,15244,9221,15212,9196,15175,9134,15133,9043,15088,8930,15040,8801,14990,8665,14938,8526,14886,8391,14830,8261,14775,8087,14719,7866,14661,7664,14603,7482,14544,7322,14485,7178,14426,6936,14367,6713,14281,6517,14166,6348,14054,6198,15341,8360,15341,8361,15341,8366,15341,8379,15339,8399,15336,8431,15332,8473,15326,8527,15318,8585,15302,8632,15281,8670,15258,8690,15227,8690,15191,8664,15149,8612,15104,8543,15055,8456,15001,8360,14948,8259,14892,8122,14834,7923,14776,7734,14716,7558,14656,7397,14595,7250,14534,7070,14472,6835,14410,6628,14350,6443,14243,6283,14125,6135,14010,5889,15348,7715,15348,7717,15348,7725,15347,7745,15345,7780,15343,7836,15339,7905,15334,8e3,15326,8103,15310,8193,15293,8239,15270,8270,15240,8287,15204,8283,15163,8260,15118,8223,15067,8143,15014,8014,14958,7873,14899,7723,14839,7573,14778,7430,14715,7293,14652,7164,14588,6931,14524,6720,14460,6531,14396,6362,14330,6210,14207,6015,14086,5781,13969,5576,15352,7114,15352,7116,15352,7128,15352,7159,15350,7195,15348,7237,15345,7299,15340,7374,15332,7457,15317,7544,15301,7633,15280,7703,15251,7754,15216,7775,15176,7767,15131,7733,15079,7670,15026,7588,14967,7492,14906,7387,14844,7278,14779,7171,14714,6965,14648,6770,14581,6587,14515,6420,14448,6269,14382,6123,14299,5881,14172,5665,14049,5477,13929,5310,15355,6329,15355,6330,15355,6339,15355,6362,15353,6410,15351,6472,15349,6572,15344,6688,15337,6835,15323,6985,15309,7142,15287,7220,15260,7277,15226,7310,15188,7326,15142,7318,15090,7285,15036,7239,14976,7177,14914,7045,14849,6892,14782,6736,14714,6581,14645,6433,14576,6293,14506,6164,14438,5946,14369,5733,14270,5540,14140,5369,14014,5216,13892,5043,15357,5483,15357,5484,15357,5496,15357,5528,15356,5597,15354,5692,15351,5835,15347,6011,15339,6195,15328,6317,15314,6446,15293,6566,15268,6668,15235,6746,15197,6796,15152,6811,15101,6790,15046,6748,14985,6673,14921,6583,14854,6479,14785,6371,14714,6259,14643,6149,14571,5946,14499,5750,14428,5567,14358,5401,14242,5250,14109,5111,13980,4870,13856,4657,15359,4555,15359,4557,15358,4573,15358,4633,15357,4715,15355,4841,15353,5061,15349,5216,15342,5391,15331,5577,15318,5770,15299,5967,15274,6150,15243,6223,15206,6280,15161,6310,15111,6317,15055,6300,14994,6262,14928,6208,14860,6141,14788,5994,14715,5838,14641,5684,14566,5529,14492,5384,14418,5247,14346,5121,14216,4892,14079,4682,13948,4496,13822,4330,15359,3498,15359,3501,15359,3520,15359,3598,15358,3719,15356,3860,15355,4137,15351,4305,15344,4563,15334,4809,15321,5116,15303,5273,15280,5418,15250,5547,15214,5653,15170,5722,15120,5761,15064,5763,15002,5733,14935,5673,14865,5597,14792,5504,14716,5400,14640,5294,14563,5185,14486,5041,14410,4841,14335,4655,14191,4482,14051,4325,13918,4183,13790,4012,15360,2282,15360,2285,15360,2306,15360,2401,15359,2547,15357,2748,15355,3103,15352,3349,15345,3675,15336,4020,15324,4272,15307,4496,15285,4716,15255,4908,15220,5086,15178,5170,15128,5214,15072,5234,15010,5231,14943,5206,14871,5166,14796,5102,14718,4971,14639,4833,14559,4687,14480,4541,14402,4401,14315,4268,14167,4142,14025,3958,13888,3747,13759,3556,15360,923,15360,925,15360,946,15360,1052,15359,1214,15357,1494,15356,1892,15352,2274,15346,2663,15338,3099,15326,3393,15309,3679,15288,3980,15260,4183,15226,4325,15185,4437,15136,4517,15080,4570,15018,4591,14950,4581,14877,4545,14800,4485,14720,4411,14638,4325,14556,4231,14475,4136,14395,3988,14297,3803,14145,3628,13999,3465,13861,3314,13729,3177,15360,263,15360,264,15360,272,15360,325,15359,407,15358,548,15356,780,15352,1144,15347,1580,15339,2099,15328,2425,15312,2795,15292,3133,15264,3329,15232,3517,15191,3689,15143,3819,15088,3923,15025,3978,14956,3999,14882,3979,14804,3931,14722,3855,14639,3756,14554,3645,14470,3529,14388,3409,14279,3289,14124,3173,13975,3055,13834,2848,13701,2658,15360,49,15360,49,15360,52,15360,75,15359,111,15358,201,15356,283,15353,519,15348,726,15340,1045,15329,1415,15314,1795,15295,2173,15269,2410,15237,2649,15197,2866,15150,3054,15095,3140,15032,3196,14963,3228,14888,3236,14808,3224,14725,3191,14639,3146,14553,3088,14466,2976,14382,2836,14262,2692,14103,2549,13952,2409,13808,2278,13674,2154,15360,4,15360,4,15360,4,15360,13,15359,33,15358,59,15357,112,15353,199,15348,302,15341,456,15331,628,15316,827,15297,1082,15272,1332,15241,1601,15202,1851,15156,2069,15101,2172,15039,2256,14970,2314,14894,2348,14813,2358,14728,2344,14640,2311,14551,2263,14463,2203,14376,2133,14247,2059,14084,1915,13930,1761,13784,1609,13648,1464,15360,0,15360,0,15360,0,15360,3,15359,18,15358,26,15357,53,15354,80,15348,97,15341,165,15332,238,15318,326,15299,427,15275,529,15245,654,15207,771,15161,885,15108,994,15046,1089,14976,1170,14900,1229,14817,1266,14731,1284,14641,1282,14550,1260,14460,1223,14370,1174,14232,1116,14066,1050,13909,981,13761,910,13623,839]);let ju=null;function N7(){return ju===null&&(ju=new xl(P7,32,32,zb,ar),ju.minFilter=yi,ju.magFilter=yi,ju.wrapS=_s,ju.wrapT=_s,ju.generateMipmaps=!1,ju.needsUpdate=!0),ju}class OD{constructor(e={}){const{canvas:t=lP(),context:n=null,depth:i=!0,stencil:s=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:u=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:p=!1,reversedDepthBuffer:v=!1}=e;this.isWebGLRenderer=!0;let y;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");y=n.getContextAttributes().alpha}else y=a;const x=new Set([Yb,Vb,kx]),S=new Set([Ha,lu,eg,tg,Gb,Hb]),E=new Uint32Array(4),b=new Int32Array(4);let T=null,R=null;const D=[],P=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=su,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const O=this;let N=!1;this._outputColorSpace=sr;let U=0,B=0,I=null,z=-1,W=null;const Z=new vi,te=new vi;let re=null;const k=new Ot(0);let j=0,J=t.width,oe=t.height,K=1,X=null,ne=null;const xe=new vi(0,0,J,oe),_e=new vi(0,0,J,oe);let Be=!1;const pe=new Cg;let be=!1,je=!1;const gt=new yn,St=new ae,At=new vi,jt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let vt=!1;function ze(){return I===null?K:1}let ie=n;function Oe(Y,ce){return t.getContext(Y,ce)}try{const Y={alpha:!0,depth:i,stencil:s,antialias:o,premultipliedAlpha:c,preserveDrawingBuffer:u,powerPreference:h,failIfMajorPerformanceCaveat:p};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Px}`),t.addEventListener("webglcontextlost",ut,!1),t.addEventListener("webglcontextrestored",Qe,!1),t.addEventListener("webglcontextcreationerror",Rt,!1),ie===null){const ce="webgl2";if(ie=Oe(ce,Y),ie===null)throw Oe(ce)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Y){throw Y("WebGLRenderer: "+Y.message),Y}let ue,st,$e,_t,it,Tt,se,q,Ee,Ge,Ve,Pe,wt,bt,Ft,Mt,Ze,Je,Nt,he,Ce,tt,le,Re;function ht(){ue=new K9(ie),ue.init(),tt=new cN(ie,ue),st=new U9(ie,ue,e,tt),$e=new M7(ie,ue),st.reversedDepthBuffer&&v&&$e.buffers.depth.setReversed(!0),_t=new W9(ie),it=new d7,Tt=new C7(ie,ue,$e,it,st,tt,_t),se=new k9(O),q=new X9(O),Ee=new Z5(ie),le=new P9(ie,Ee),Ge=new q9(ie,Ee,_t,le),Ve=new $9(ie,Ge,Ee,_t),Nt=new J9(ie,st,Tt),Mt=new F9(it),Pe=new h7(O,se,q,ue,st,le,Mt),wt=new B7(O,it),bt=new m7,Ft=new S7(ue),Je=new O9(O,se,q,$e,Ve,y,c),Ze=new b7(O,Ve,st),Re=new O7(ie,_t,st,$e),he=new N9(ie,ue,_t),Ce=new j9(ie,ue,_t),_t.programs=Pe.programs,O.capabilities=st,O.extensions=ue,O.properties=it,O.renderLists=bt,O.shadowMap=Ze,O.state=$e,O.info=_t}ht();const yt=new w7(O,ie);this.xr=yt,this.getContext=function(){return ie},this.getContextAttributes=function(){return ie.getContextAttributes()},this.forceContextLoss=function(){const Y=ue.get("WEBGL_lose_context");Y&&Y.loseContext()},this.forceContextRestore=function(){const Y=ue.get("WEBGL_lose_context");Y&&Y.restoreContext()},this.getPixelRatio=function(){return K},this.setPixelRatio=function(Y){Y!==void 0&&(K=Y,this.setSize(J,oe,!1))},this.getSize=function(Y){return Y.set(J,oe)},this.setSize=function(Y,ce,fe=!0){if(yt.isPresenting){Ht("WebGLRenderer: Can't change size while VR device is presenting.");return}J=Y,oe=ce,t.width=Math.floor(Y*K),t.height=Math.floor(ce*K),fe===!0&&(t.style.width=Y+"px",t.style.height=ce+"px"),this.setViewport(0,0,Y,ce)},this.getDrawingBufferSize=function(Y){return Y.set(J*K,oe*K).floor()},this.setDrawingBufferSize=function(Y,ce,fe){J=Y,oe=ce,K=fe,t.width=Math.floor(Y*fe),t.height=Math.floor(ce*fe),this.setViewport(0,0,Y,ce)},this.getCurrentViewport=function(Y){return Y.copy(Z)},this.getViewport=function(Y){return Y.copy(xe)},this.setViewport=function(Y,ce,fe,Se){Y.isVector4?xe.set(Y.x,Y.y,Y.z,Y.w):xe.set(Y,ce,fe,Se),$e.viewport(Z.copy(xe).multiplyScalar(K).round())},this.getScissor=function(Y){return Y.copy(_e)},this.setScissor=function(Y,ce,fe,Se){Y.isVector4?_e.set(Y.x,Y.y,Y.z,Y.w):_e.set(Y,ce,fe,Se),$e.scissor(te.copy(_e).multiplyScalar(K).round())},this.getScissorTest=function(){return Be},this.setScissorTest=function(Y){$e.setScissorTest(Be=Y)},this.setOpaqueSort=function(Y){X=Y},this.setTransparentSort=function(Y){ne=Y},this.getClearColor=function(Y){return Y.copy(Je.getClearColor())},this.setClearColor=function(){Je.setClearColor(...arguments)},this.getClearAlpha=function(){return Je.getClearAlpha()},this.setClearAlpha=function(){Je.setClearAlpha(...arguments)},this.clear=function(Y=!0,ce=!0,fe=!0){let Se=0;if(Y){let de=!1;if(I!==null){const Ke=I.texture.format;de=x.has(Ke)}if(de){const Ke=I.texture.type,et=S.has(Ke),pt=Je.getClearColor(),xt=Je.getClearAlpha(),Lt=pt.r,Pt=pt.g,Bt=pt.b;et?(E[0]=Lt,E[1]=Pt,E[2]=Bt,E[3]=xt,ie.clearBufferuiv(ie.COLOR,0,E)):(b[0]=Lt,b[1]=Pt,b[2]=Bt,b[3]=xt,ie.clearBufferiv(ie.COLOR,0,b))}else Se|=ie.COLOR_BUFFER_BIT}ce&&(Se|=ie.DEPTH_BUFFER_BIT),fe&&(Se|=ie.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ie.clear(Se)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ut,!1),t.removeEventListener("webglcontextrestored",Qe,!1),t.removeEventListener("webglcontextcreationerror",Rt,!1),Je.dispose(),bt.dispose(),Ft.dispose(),it.dispose(),se.dispose(),q.dispose(),Ve.dispose(),le.dispose(),Re.dispose(),Pe.dispose(),yt.dispose(),yt.removeEventListener("sessionstart",pn),yt.removeEventListener("sessionend",Wt),$t.stop()};function ut(Y){Y.preventDefault(),hx("WebGLRenderer: Context Lost."),N=!0}function Qe(){hx("WebGLRenderer: Context Restored."),N=!1;const Y=_t.autoReset,ce=Ze.enabled,fe=Ze.autoUpdate,Se=Ze.needsUpdate,de=Ze.type;ht(),_t.autoReset=Y,Ze.enabled=ce,Ze.autoUpdate=fe,Ze.needsUpdate=Se,Ze.type=de}function Rt(Y){Cn("WebGLRenderer: A WebGL context could not be created. Reason: ",Y.statusMessage)}function Vt(Y){const ce=Y.target;ce.removeEventListener("dispose",Vt),En(ce)}function En(Y){Dt(Y),it.remove(Y)}function Dt(Y){const ce=it.get(Y).programs;ce!==void 0&&(ce.forEach(function(fe){Pe.releaseProgram(fe)}),Y.isShaderMaterial&&Pe.releaseShaderCache(Y))}this.renderBufferDirect=function(Y,ce,fe,Se,de,Ke){ce===null&&(ce=jt);const et=de.isMesh&&de.matrixWorld.determinant()<0,pt=De(Y,ce,fe,Se,de);$e.setMaterial(Se,et);let xt=fe.index,Lt=1;if(Se.wireframe===!0){if(xt=Ge.getWireframeAttribute(fe),xt===void 0)return;Lt=2}const Pt=fe.drawRange,Bt=fe.attributes.position;let Kt=Pt.start*Lt,bn=(Pt.start+Pt.count)*Lt;Ke!==null&&(Kt=Math.max(Kt,Ke.start*Lt),bn=Math.min(bn,(Ke.start+Ke.count)*Lt)),xt!==null?(Kt=Math.max(Kt,0),bn=Math.min(bn,xt.count)):Bt!=null&&(Kt=Math.max(Kt,0),bn=Math.min(bn,Bt.count));const nn=bn-Kt;if(nn<0||nn===1/0)return;le.setup(de,Se,pt,fe,xt);let fn,Nn=he;if(xt!==null&&(fn=Ee.get(xt),Nn=Ce,Nn.setIndex(fn)),de.isMesh)Se.wireframe===!0?($e.setLineWidth(Se.wireframeLinewidth*ze()),Nn.setMode(ie.LINES)):Nn.setMode(ie.TRIANGLES);else if(de.isLine){let sn=Se.linewidth;sn===void 0&&(sn=1),$e.setLineWidth(sn*ze()),de.isLineSegments?Nn.setMode(ie.LINES):de.isLineLoop?Nn.setMode(ie.LINE_LOOP):Nn.setMode(ie.LINE_STRIP)}else de.isPoints?Nn.setMode(ie.POINTS):de.isSprite&&Nn.setMode(ie.TRIANGLES);if(de.isBatchedMesh)if(de._multiDrawInstances!==null)og("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Nn.renderMultiDrawInstances(de._multiDrawStarts,de._multiDrawCounts,de._multiDrawCount,de._multiDrawInstances);else if(ue.get("WEBGL_multi_draw"))Nn.renderMultiDraw(de._multiDrawStarts,de._multiDrawCounts,de._multiDrawCount);else{const sn=de._multiDrawStarts,In=de._multiDrawCounts,Qt=de._multiDrawCount,zn=xt?Ee.get(xt).bytesPerElement:1,ni=it.get(Se).currentProgram.getUniforms();for(let ln=0;ln<Qt;ln++)ni.setValue(ie,"_gl_DrawID",ln),Nn.render(sn[ln]/zn,In[ln])}else if(de.isInstancedMesh)Nn.renderInstances(Kt,nn,de.count);else if(fe.isInstancedBufferGeometry){const sn=fe._maxInstanceCount!==void 0?fe._maxInstanceCount:1/0,In=Math.min(fe.instanceCount,sn);Nn.renderInstances(Kt,nn,In)}else Nn.render(Kt,nn)};function Ut(Y,ce,fe){Y.transparent===!0&&Y.side===so&&Y.forceSinglePass===!1?(Y.side=Ga,Y.needsUpdate=!0,V(Y,ce,fe),Y.side=au,Y.needsUpdate=!0,V(Y,ce,fe),Y.side=so):V(Y,ce,fe)}this.compile=function(Y,ce,fe=null){fe===null&&(fe=Y),R=Ft.get(fe),R.init(ce),P.push(R),fe.traverseVisible(function(de){de.isLight&&de.layers.test(ce.layers)&&(R.pushLight(de),de.castShadow&&R.pushShadow(de))}),Y!==fe&&Y.traverseVisible(function(de){de.isLight&&de.layers.test(ce.layers)&&(R.pushLight(de),de.castShadow&&R.pushShadow(de))}),R.setupLights();const Se=new Set;return Y.traverse(function(de){if(!(de.isMesh||de.isPoints||de.isLine||de.isSprite))return;const Ke=de.material;if(Ke)if(Array.isArray(Ke))for(let et=0;et<Ke.length;et++){const pt=Ke[et];Ut(pt,fe,de),Se.add(pt)}else Ut(Ke,fe,de),Se.add(Ke)}),R=P.pop(),Se},this.compileAsync=function(Y,ce,fe=null){const Se=this.compile(Y,ce,fe);return new Promise(de=>{function Ke(){if(Se.forEach(function(et){it.get(et).currentProgram.isReady()&&Se.delete(et)}),Se.size===0){de(Y);return}setTimeout(Ke,10)}ue.get("KHR_parallel_shader_compile")!==null?Ke():setTimeout(Ke,10)})};let dn=null;function It(Y){dn&&dn(Y)}function pn(){$t.stop()}function Wt(){$t.start()}const $t=new sN;$t.setAnimationLoop(It),typeof self<"u"&&$t.setContext(self),this.setAnimationLoop=function(Y){dn=Y,yt.setAnimationLoop(Y),Y===null?$t.stop():$t.start()},yt.addEventListener("sessionstart",pn),yt.addEventListener("sessionend",Wt),this.render=function(Y,ce){if(ce!==void 0&&ce.isCamera!==!0){Cn("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(N===!0)return;if(Y.matrixWorldAutoUpdate===!0&&Y.updateMatrixWorld(),ce.parent===null&&ce.matrixWorldAutoUpdate===!0&&ce.updateMatrixWorld(),yt.enabled===!0&&yt.isPresenting===!0&&(yt.cameraAutoUpdate===!0&&yt.updateCamera(ce),ce=yt.getCamera()),Y.isScene===!0&&Y.onBeforeRender(O,Y,ce,I),R=Ft.get(Y,P.length),R.init(ce),P.push(R),gt.multiplyMatrices(ce.projectionMatrix,ce.matrixWorldInverse),pe.setFromProjectionMatrix(gt,No,ce.reversedDepth),je=this.localClippingEnabled,be=Mt.init(this.clippingPlanes,je),T=bt.get(Y,D.length),T.init(),D.push(T),yt.enabled===!0&&yt.isPresenting===!0){const Ke=O.xr.getDepthSensingMesh();Ke!==null&&ai(Ke,ce,-1/0,O.sortObjects)}ai(Y,ce,0,O.sortObjects),T.finish(),O.sortObjects===!0&&T.sort(X,ne),vt=yt.enabled===!1||yt.isPresenting===!1||yt.hasDepthSensing()===!1,vt&&Je.addToRenderList(T,Y),this.info.render.frame++,be===!0&&Mt.beginShadows();const fe=R.state.shadowsArray;Ze.render(fe,Y,ce),be===!0&&Mt.endShadows(),this.info.autoReset===!0&&this.info.reset();const Se=T.opaque,de=T.transmissive;if(R.setupLights(),ce.isArrayCamera){const Ke=ce.cameras;if(de.length>0)for(let et=0,pt=Ke.length;et<pt;et++){const xt=Ke[et];Yt(Se,de,Y,xt)}vt&&Je.render(Y);for(let et=0,pt=Ke.length;et<pt;et++){const xt=Ke[et];hn(T,Y,xt,xt.viewport)}}else de.length>0&&Yt(Se,de,Y,ce),vt&&Je.render(Y),hn(T,Y,ce);I!==null&&B===0&&(Tt.updateMultisampleRenderTarget(I),Tt.updateRenderTargetMipmap(I)),Y.isScene===!0&&Y.onAfterRender(O,Y,ce),le.resetDefaultState(),z=-1,W=null,P.pop(),P.length>0?(R=P[P.length-1],be===!0&&Mt.setGlobalState(O.clippingPlanes,R.state.camera)):R=null,D.pop(),D.length>0?T=D[D.length-1]:T=null};function ai(Y,ce,fe,Se){if(Y.visible===!1)return;if(Y.layers.test(ce.layers)){if(Y.isGroup)fe=Y.renderOrder;else if(Y.isLOD)Y.autoUpdate===!0&&Y.update(ce);else if(Y.isLight)R.pushLight(Y),Y.castShadow&&R.pushShadow(Y);else if(Y.isSprite){if(!Y.frustumCulled||pe.intersectsSprite(Y)){Se&&At.setFromMatrixPosition(Y.matrixWorld).applyMatrix4(gt);const et=Ve.update(Y),pt=Y.material;pt.visible&&T.push(Y,et,pt,fe,At.z,null)}}else if((Y.isMesh||Y.isLine||Y.isPoints)&&(!Y.frustumCulled||pe.intersectsObject(Y))){const et=Ve.update(Y),pt=Y.material;if(Se&&(Y.boundingSphere!==void 0?(Y.boundingSphere===null&&Y.computeBoundingSphere(),At.copy(Y.boundingSphere.center)):(et.boundingSphere===null&&et.computeBoundingSphere(),At.copy(et.boundingSphere.center)),At.applyMatrix4(Y.matrixWorld).applyMatrix4(gt)),Array.isArray(pt)){const xt=et.groups;for(let Lt=0,Pt=xt.length;Lt<Pt;Lt++){const Bt=xt[Lt],Kt=pt[Bt.materialIndex];Kt&&Kt.visible&&T.push(Y,et,Kt,fe,At.z,Bt)}}else pt.visible&&T.push(Y,et,pt,fe,At.z,null)}}const Ke=Y.children;for(let et=0,pt=Ke.length;et<pt;et++)ai(Ke[et],ce,fe,Se)}function hn(Y,ce,fe,Se){const{opaque:de,transmissive:Ke,transparent:et}=Y;R.setupLightsView(fe),be===!0&&Mt.setGlobalState(O.clippingPlanes,fe),Se&&$e.viewport(Z.copy(Se)),de.length>0&&Xn(de,ce,fe),Ke.length>0&&Xn(Ke,ce,fe),et.length>0&&Xn(et,ce,fe),$e.buffers.depth.setTest(!0),$e.buffers.depth.setMask(!0),$e.buffers.color.setMask(!0),$e.setPolygonOffset(!1)}function Yt(Y,ce,fe,Se){if((fe.isScene===!0?fe.overrideMaterial:null)!==null)return;R.state.transmissionRenderTarget[Se.id]===void 0&&(R.state.transmissionRenderTarget[Se.id]=new Al(1,1,{generateMipmaps:!0,type:ue.has("EXT_color_buffer_half_float")||ue.has("EXT_color_buffer_float")?ar:Ha,minFilter:ml,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:hi.workingColorSpace}));const Ke=R.state.transmissionRenderTarget[Se.id],et=Se.viewport||Z;Ke.setSize(et.z*O.transmissionResolutionScale,et.w*O.transmissionResolutionScale);const pt=O.getRenderTarget(),xt=O.getActiveCubeFace(),Lt=O.getActiveMipmapLevel();O.setRenderTarget(Ke),O.getClearColor(k),j=O.getClearAlpha(),j<1&&O.setClearColor(16777215,.5),O.clear(),vt&&Je.render(fe);const Pt=O.toneMapping;O.toneMapping=su;const Bt=Se.viewport;if(Se.viewport!==void 0&&(Se.viewport=void 0),R.setupLightsView(Se),be===!0&&Mt.setGlobalState(O.clippingPlanes,Se),Xn(Y,fe,Se),Tt.updateMultisampleRenderTarget(Ke),Tt.updateRenderTargetMipmap(Ke),ue.has("WEBGL_multisampled_render_to_texture")===!1){let Kt=!1;for(let bn=0,nn=ce.length;bn<nn;bn++){const fn=ce[bn],{object:Nn,geometry:sn,material:In,group:Qt}=fn;if(In.side===so&&Nn.layers.test(Se.layers)){const zn=In.side;In.side=Ga,In.needsUpdate=!0,Jt(Nn,fe,Se,sn,In,Qt),In.side=zn,In.needsUpdate=!0,Kt=!0}}Kt===!0&&(Tt.updateMultisampleRenderTarget(Ke),Tt.updateRenderTargetMipmap(Ke))}O.setRenderTarget(pt,xt,Lt),O.setClearColor(k,j),Bt!==void 0&&(Se.viewport=Bt),O.toneMapping=Pt}function Xn(Y,ce,fe){const Se=ce.isScene===!0?ce.overrideMaterial:null;for(let de=0,Ke=Y.length;de<Ke;de++){const et=Y[de],{object:pt,geometry:xt,group:Lt}=et;let Pt=et.material;Pt.allowOverride===!0&&Se!==null&&(Pt=Se),pt.layers.test(fe.layers)&&Jt(pt,ce,fe,xt,Pt,Lt)}}function Jt(Y,ce,fe,Se,de,Ke){Y.onBeforeRender(O,ce,fe,Se,de,Ke),Y.modelViewMatrix.multiplyMatrices(fe.matrixWorldInverse,Y.matrixWorld),Y.normalMatrix.getNormalMatrix(Y.modelViewMatrix),de.onBeforeRender(O,ce,fe,Se,Y,Ke),de.transparent===!0&&de.side===so&&de.forceSinglePass===!1?(de.side=Ga,de.needsUpdate=!0,O.renderBufferDirect(fe,ce,Se,de,Y,Ke),de.side=au,de.needsUpdate=!0,O.renderBufferDirect(fe,ce,Se,de,Y,Ke),de.side=so):O.renderBufferDirect(fe,ce,Se,de,Y,Ke),Y.onAfterRender(O,ce,fe,Se,de,Ke)}function V(Y,ce,fe){ce.isScene!==!0&&(ce=jt);const Se=it.get(Y),de=R.state.lights,Ke=R.state.shadowsArray,et=de.state.version,pt=Pe.getParameters(Y,de.state,Ke,ce,fe),xt=Pe.getProgramCacheKey(pt);let Lt=Se.programs;Se.environment=Y.isMeshStandardMaterial?ce.environment:null,Se.fog=ce.fog,Se.envMap=(Y.isMeshStandardMaterial?q:se).get(Y.envMap||Se.environment),Se.envMapRotation=Se.environment!==null&&Y.envMap===null?ce.environmentRotation:Y.envMapRotation,Lt===void 0&&(Y.addEventListener("dispose",Vt),Lt=new Map,Se.programs=Lt);let Pt=Lt.get(xt);if(Pt!==void 0){if(Se.currentProgram===Pt&&Se.lightsStateVersion===et)return me(Y,pt),Pt}else pt.uniforms=Pe.getUniforms(Y),Y.onBeforeCompile(pt,O),Pt=Pe.acquireProgram(pt,xt),Lt.set(xt,Pt),Se.uniforms=pt.uniforms;const Bt=Se.uniforms;return(!Y.isShaderMaterial&&!Y.isRawShaderMaterial||Y.clipping===!0)&&(Bt.clippingPlanes=Mt.uniform),me(Y,pt),Se.needsLights=Xe(Y),Se.lightsStateVersion=et,Se.needsLights&&(Bt.ambientLightColor.value=de.state.ambient,Bt.lightProbe.value=de.state.probe,Bt.directionalLights.value=de.state.directional,Bt.directionalLightShadows.value=de.state.directionalShadow,Bt.spotLights.value=de.state.spot,Bt.spotLightShadows.value=de.state.spotShadow,Bt.rectAreaLights.value=de.state.rectArea,Bt.ltc_1.value=de.state.rectAreaLTC1,Bt.ltc_2.value=de.state.rectAreaLTC2,Bt.pointLights.value=de.state.point,Bt.pointLightShadows.value=de.state.pointShadow,Bt.hemisphereLights.value=de.state.hemi,Bt.directionalShadowMap.value=de.state.directionalShadowMap,Bt.directionalShadowMatrix.value=de.state.directionalShadowMatrix,Bt.spotShadowMap.value=de.state.spotShadowMap,Bt.spotLightMatrix.value=de.state.spotLightMatrix,Bt.spotLightMap.value=de.state.spotLightMap,Bt.pointShadowMap.value=de.state.pointShadowMap,Bt.pointShadowMatrix.value=de.state.pointShadowMatrix),Se.currentProgram=Pt,Se.uniformsList=null,Pt}function $(Y){if(Y.uniformsList===null){const ce=Y.currentProgram.getUniforms();Y.uniformsList=eE.seqWithValue(ce.seq,Y.uniforms)}return Y.uniformsList}function me(Y,ce){const fe=it.get(Y);fe.outputColorSpace=ce.outputColorSpace,fe.batching=ce.batching,fe.batchingColor=ce.batchingColor,fe.instancing=ce.instancing,fe.instancingColor=ce.instancingColor,fe.instancingMorph=ce.instancingMorph,fe.skinning=ce.skinning,fe.morphTargets=ce.morphTargets,fe.morphNormals=ce.morphNormals,fe.morphColors=ce.morphColors,fe.morphTargetsCount=ce.morphTargetsCount,fe.numClippingPlanes=ce.numClippingPlanes,fe.numIntersection=ce.numClipIntersection,fe.vertexAlphas=ce.vertexAlphas,fe.vertexTangents=ce.vertexTangents,fe.toneMapping=ce.toneMapping}function De(Y,ce,fe,Se,de){ce.isScene!==!0&&(ce=jt),Tt.resetTextureUnits();const Ke=ce.fog,et=Se.isMeshStandardMaterial?ce.environment:null,pt=I===null?O.outputColorSpace:I.isXRRenderTarget===!0?I.texture.colorSpace:cc,xt=(Se.isMeshStandardMaterial?q:se).get(Se.envMap||et),Lt=Se.vertexColors===!0&&!!fe.attributes.color&&fe.attributes.color.itemSize===4,Pt=!!fe.attributes.tangent&&(!!Se.normalMap||Se.anisotropy>0),Bt=!!fe.morphAttributes.position,Kt=!!fe.morphAttributes.normal,bn=!!fe.morphAttributes.color;let nn=su;Se.toneMapped&&(I===null||I.isXRRenderTarget===!0)&&(nn=O.toneMapping);const fn=fe.morphAttributes.position||fe.morphAttributes.normal||fe.morphAttributes.color,Nn=fn!==void 0?fn.length:0,sn=it.get(Se),In=R.state.lights;if(be===!0&&(je===!0||Y!==W)){const Ds=Y===W&&Se.id===z;Mt.setState(Se,Y,Ds)}let Qt=!1;Se.version===sn.__version?(sn.needsLights&&sn.lightsStateVersion!==In.state.version||sn.outputColorSpace!==pt||de.isBatchedMesh&&sn.batching===!1||!de.isBatchedMesh&&sn.batching===!0||de.isBatchedMesh&&sn.batchingColor===!0&&de.colorTexture===null||de.isBatchedMesh&&sn.batchingColor===!1&&de.colorTexture!==null||de.isInstancedMesh&&sn.instancing===!1||!de.isInstancedMesh&&sn.instancing===!0||de.isSkinnedMesh&&sn.skinning===!1||!de.isSkinnedMesh&&sn.skinning===!0||de.isInstancedMesh&&sn.instancingColor===!0&&de.instanceColor===null||de.isInstancedMesh&&sn.instancingColor===!1&&de.instanceColor!==null||de.isInstancedMesh&&sn.instancingMorph===!0&&de.morphTexture===null||de.isInstancedMesh&&sn.instancingMorph===!1&&de.morphTexture!==null||sn.envMap!==xt||Se.fog===!0&&sn.fog!==Ke||sn.numClippingPlanes!==void 0&&(sn.numClippingPlanes!==Mt.numPlanes||sn.numIntersection!==Mt.numIntersection)||sn.vertexAlphas!==Lt||sn.vertexTangents!==Pt||sn.morphTargets!==Bt||sn.morphNormals!==Kt||sn.morphColors!==bn||sn.toneMapping!==nn||sn.morphTargetsCount!==Nn)&&(Qt=!0):(Qt=!0,sn.__version=Se.version);let zn=sn.currentProgram;Qt===!0&&(zn=V(Se,ce,de));let ni=!1,ln=!1,Ji=!1;const $n=zn.getUniforms(),oi=sn.uniforms;if($e.useProgram(zn.program)&&(ni=!0,ln=!0,Ji=!0),Se.id!==z&&(z=Se.id,ln=!0),ni||W!==Y){$e.buffers.depth.getReversed()&&Y.reversedDepth!==!0&&(Y._reversedDepth=!0,Y.updateProjectionMatrix()),$n.setValue(ie,"projectionMatrix",Y.projectionMatrix),$n.setValue(ie,"viewMatrix",Y.matrixWorldInverse);const es=$n.map.cameraPosition;es!==void 0&&es.setValue(ie,St.setFromMatrixPosition(Y.matrixWorld)),st.logarithmicDepthBuffer&&$n.setValue(ie,"logDepthBufFC",2/(Math.log(Y.far+1)/Math.LN2)),(Se.isMeshPhongMaterial||Se.isMeshToonMaterial||Se.isMeshLambertMaterial||Se.isMeshBasicMaterial||Se.isMeshStandardMaterial||Se.isShaderMaterial)&&$n.setValue(ie,"isOrthographic",Y.isOrthographicCamera===!0),W!==Y&&(W=Y,ln=!0,Ji=!0)}if(de.isSkinnedMesh){$n.setOptional(ie,de,"bindMatrix"),$n.setOptional(ie,de,"bindMatrixInverse");const Ds=de.skeleton;Ds&&(Ds.boneTexture===null&&Ds.computeBoneTexture(),$n.setValue(ie,"boneTexture",Ds.boneTexture,Tt))}de.isBatchedMesh&&($n.setOptional(ie,de,"batchingTexture"),$n.setValue(ie,"batchingTexture",de._matricesTexture,Tt),$n.setOptional(ie,de,"batchingIdTexture"),$n.setValue(ie,"batchingIdTexture",de._indirectTexture,Tt),$n.setOptional(ie,de,"batchingColorTexture"),de._colorsTexture!==null&&$n.setValue(ie,"batchingColorTexture",de._colorsTexture,Tt));const Ri=fe.morphAttributes;if((Ri.position!==void 0||Ri.normal!==void 0||Ri.color!==void 0)&&Nt.update(de,fe,zn),(ln||sn.receiveShadow!==de.receiveShadow)&&(sn.receiveShadow=de.receiveShadow,$n.setValue(ie,"receiveShadow",de.receiveShadow)),Se.isMeshGouraudMaterial&&Se.envMap!==null&&(oi.envMap.value=xt,oi.flipEnvMap.value=xt.isCubeTexture&&xt.isRenderTargetTexture===!1?-1:1),Se.isMeshStandardMaterial&&Se.envMap===null&&ce.environment!==null&&(oi.envMapIntensity.value=ce.environmentIntensity),oi.dfgLUT!==void 0&&(oi.dfgLUT.value=N7()),ln&&($n.setValue(ie,"toneMappingExposure",O.toneMappingExposure),sn.needsLights&&Ye(oi,Ji),Ke&&Se.fog===!0&&wt.refreshFogUniforms(oi,Ke),wt.refreshMaterialUniforms(oi,Se,K,oe,R.state.transmissionRenderTarget[Y.id]),eE.upload(ie,$(sn),oi,Tt)),Se.isShaderMaterial&&Se.uniformsNeedUpdate===!0&&(eE.upload(ie,$(sn),oi,Tt),Se.uniformsNeedUpdate=!1),Se.isSpriteMaterial&&$n.setValue(ie,"center",de.center),$n.setValue(ie,"modelViewMatrix",de.modelViewMatrix),$n.setValue(ie,"normalMatrix",de.normalMatrix),$n.setValue(ie,"modelMatrix",de.matrixWorld),Se.isShaderMaterial||Se.isRawShaderMaterial){const Ds=Se.uniformsGroups;for(let es=0,po=Ds.length;es<po;es++){const Va=Ds[es];Re.update(Va,zn),Re.bind(Va,zn)}}return zn}function Ye(Y,ce){Y.ambientLightColor.needsUpdate=ce,Y.lightProbe.needsUpdate=ce,Y.directionalLights.needsUpdate=ce,Y.directionalLightShadows.needsUpdate=ce,Y.pointLights.needsUpdate=ce,Y.pointLightShadows.needsUpdate=ce,Y.spotLights.needsUpdate=ce,Y.spotLightShadows.needsUpdate=ce,Y.rectAreaLights.needsUpdate=ce,Y.hemisphereLights.needsUpdate=ce}function Xe(Y){return Y.isMeshLambertMaterial||Y.isMeshToonMaterial||Y.isMeshPhongMaterial||Y.isMeshStandardMaterial||Y.isShadowMaterial||Y.isShaderMaterial&&Y.lights===!0}this.getActiveCubeFace=function(){return U},this.getActiveMipmapLevel=function(){return B},this.getRenderTarget=function(){return I},this.setRenderTargetTextures=function(Y,ce,fe){const Se=it.get(Y);Se.__autoAllocateDepthBuffer=Y.resolveDepthBuffer===!1,Se.__autoAllocateDepthBuffer===!1&&(Se.__useRenderToTexture=!1),it.get(Y.texture).__webglTexture=ce,it.get(Y.depthTexture).__webglTexture=Se.__autoAllocateDepthBuffer?void 0:fe,Se.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(Y,ce){const fe=it.get(Y);fe.__webglFramebuffer=ce,fe.__useDefaultFramebuffer=ce===void 0};const dt=ie.createFramebuffer();this.setRenderTarget=function(Y,ce=0,fe=0){I=Y,U=ce,B=fe;let Se=!0,de=null,Ke=!1,et=!1;if(Y){const xt=it.get(Y);if(xt.__useDefaultFramebuffer!==void 0)$e.bindFramebuffer(ie.FRAMEBUFFER,null),Se=!1;else if(xt.__webglFramebuffer===void 0)Tt.setupRenderTarget(Y);else if(xt.__hasExternalTextures)Tt.rebindTextures(Y,it.get(Y.texture).__webglTexture,it.get(Y.depthTexture).__webglTexture);else if(Y.depthBuffer){const Bt=Y.depthTexture;if(xt.__boundDepthTexture!==Bt){if(Bt!==null&&it.has(Bt)&&(Y.width!==Bt.image.width||Y.height!==Bt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Tt.setupDepthRenderbuffer(Y)}}const Lt=Y.texture;(Lt.isData3DTexture||Lt.isDataArrayTexture||Lt.isCompressedArrayTexture)&&(et=!0);const Pt=it.get(Y).__webglFramebuffer;Y.isWebGLCubeRenderTarget?(Array.isArray(Pt[ce])?de=Pt[ce][fe]:de=Pt[ce],Ke=!0):Y.samples>0&&Tt.useMultisampledRTT(Y)===!1?de=it.get(Y).__webglMultisampledFramebuffer:Array.isArray(Pt)?de=Pt[fe]:de=Pt,Z.copy(Y.viewport),te.copy(Y.scissor),re=Y.scissorTest}else Z.copy(xe).multiplyScalar(K).floor(),te.copy(_e).multiplyScalar(K).floor(),re=Be;if(fe!==0&&(de=dt),$e.bindFramebuffer(ie.FRAMEBUFFER,de)&&Se&&$e.drawBuffers(Y,de),$e.viewport(Z),$e.scissor(te),$e.setScissorTest(re),Ke){const xt=it.get(Y.texture);ie.framebufferTexture2D(ie.FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_CUBE_MAP_POSITIVE_X+ce,xt.__webglTexture,fe)}else if(et){const xt=ce;for(let Lt=0;Lt<Y.textures.length;Lt++){const Pt=it.get(Y.textures[Lt]);ie.framebufferTextureLayer(ie.FRAMEBUFFER,ie.COLOR_ATTACHMENT0+Lt,Pt.__webglTexture,fe,xt)}}else if(Y!==null&&fe!==0){const xt=it.get(Y.texture);ie.framebufferTexture2D(ie.FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_2D,xt.__webglTexture,fe)}z=-1},this.readRenderTargetPixels=function(Y,ce,fe,Se,de,Ke,et,pt=0){if(!(Y&&Y.isWebGLRenderTarget)){Cn("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let xt=it.get(Y).__webglFramebuffer;if(Y.isWebGLCubeRenderTarget&&et!==void 0&&(xt=xt[et]),xt){$e.bindFramebuffer(ie.FRAMEBUFFER,xt);try{const Lt=Y.textures[pt],Pt=Lt.format,Bt=Lt.type;if(!st.textureFormatReadable(Pt)){Cn("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!st.textureTypeReadable(Bt)){Cn("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ce>=0&&ce<=Y.width-Se&&fe>=0&&fe<=Y.height-de&&(Y.textures.length>1&&ie.readBuffer(ie.COLOR_ATTACHMENT0+pt),ie.readPixels(ce,fe,Se,de,tt.convert(Pt),tt.convert(Bt),Ke))}finally{const Lt=I!==null?it.get(I).__webglFramebuffer:null;$e.bindFramebuffer(ie.FRAMEBUFFER,Lt)}}},this.readRenderTargetPixelsAsync=async function(Y,ce,fe,Se,de,Ke,et,pt=0){if(!(Y&&Y.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let xt=it.get(Y).__webglFramebuffer;if(Y.isWebGLCubeRenderTarget&&et!==void 0&&(xt=xt[et]),xt)if(ce>=0&&ce<=Y.width-Se&&fe>=0&&fe<=Y.height-de){$e.bindFramebuffer(ie.FRAMEBUFFER,xt);const Lt=Y.textures[pt],Pt=Lt.format,Bt=Lt.type;if(!st.textureFormatReadable(Pt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!st.textureTypeReadable(Bt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Kt=ie.createBuffer();ie.bindBuffer(ie.PIXEL_PACK_BUFFER,Kt),ie.bufferData(ie.PIXEL_PACK_BUFFER,Ke.byteLength,ie.STREAM_READ),Y.textures.length>1&&ie.readBuffer(ie.COLOR_ATTACHMENT0+pt),ie.readPixels(ce,fe,Se,de,tt.convert(Pt),tt.convert(Bt),0);const bn=I!==null?it.get(I).__webglFramebuffer:null;$e.bindFramebuffer(ie.FRAMEBUFFER,bn);const nn=ie.fenceSync(ie.SYNC_GPU_COMMANDS_COMPLETE,0);return ie.flush(),await a8(ie,nn,4),ie.bindBuffer(ie.PIXEL_PACK_BUFFER,Kt),ie.getBufferSubData(ie.PIXEL_PACK_BUFFER,0,Ke),ie.deleteBuffer(Kt),ie.deleteSync(nn),Ke}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(Y,ce=null,fe=0){const Se=Math.pow(2,-fe),de=Math.floor(Y.image.width*Se),Ke=Math.floor(Y.image.height*Se),et=ce!==null?ce.x:0,pt=ce!==null?ce.y:0;Tt.setTexture2D(Y,0),ie.copyTexSubImage2D(ie.TEXTURE_2D,fe,0,0,et,pt,de,Ke),$e.unbindTexture()};const rt=ie.createFramebuffer(),ct=ie.createFramebuffer();this.copyTextureToTexture=function(Y,ce,fe=null,Se=null,de=0,Ke=null){Ke===null&&(de!==0?(og("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Ke=de,de=0):Ke=0);let et,pt,xt,Lt,Pt,Bt,Kt,bn,nn;const fn=Y.isCompressedTexture?Y.mipmaps[Ke]:Y.image;if(fe!==null)et=fe.max.x-fe.min.x,pt=fe.max.y-fe.min.y,xt=fe.isBox3?fe.max.z-fe.min.z:1,Lt=fe.min.x,Pt=fe.min.y,Bt=fe.isBox3?fe.min.z:0;else{const Ri=Math.pow(2,-de);et=Math.floor(fn.width*Ri),pt=Math.floor(fn.height*Ri),Y.isDataArrayTexture?xt=fn.depth:Y.isData3DTexture?xt=Math.floor(fn.depth*Ri):xt=1,Lt=0,Pt=0,Bt=0}Se!==null?(Kt=Se.x,bn=Se.y,nn=Se.z):(Kt=0,bn=0,nn=0);const Nn=tt.convert(ce.format),sn=tt.convert(ce.type);let In;ce.isData3DTexture?(Tt.setTexture3D(ce,0),In=ie.TEXTURE_3D):ce.isDataArrayTexture||ce.isCompressedArrayTexture?(Tt.setTexture2DArray(ce,0),In=ie.TEXTURE_2D_ARRAY):(Tt.setTexture2D(ce,0),In=ie.TEXTURE_2D),ie.pixelStorei(ie.UNPACK_FLIP_Y_WEBGL,ce.flipY),ie.pixelStorei(ie.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ce.premultiplyAlpha),ie.pixelStorei(ie.UNPACK_ALIGNMENT,ce.unpackAlignment);const Qt=ie.getParameter(ie.UNPACK_ROW_LENGTH),zn=ie.getParameter(ie.UNPACK_IMAGE_HEIGHT),ni=ie.getParameter(ie.UNPACK_SKIP_PIXELS),ln=ie.getParameter(ie.UNPACK_SKIP_ROWS),Ji=ie.getParameter(ie.UNPACK_SKIP_IMAGES);ie.pixelStorei(ie.UNPACK_ROW_LENGTH,fn.width),ie.pixelStorei(ie.UNPACK_IMAGE_HEIGHT,fn.height),ie.pixelStorei(ie.UNPACK_SKIP_PIXELS,Lt),ie.pixelStorei(ie.UNPACK_SKIP_ROWS,Pt),ie.pixelStorei(ie.UNPACK_SKIP_IMAGES,Bt);const $n=Y.isDataArrayTexture||Y.isData3DTexture,oi=ce.isDataArrayTexture||ce.isData3DTexture;if(Y.isDepthTexture){const Ri=it.get(Y),Ds=it.get(ce),es=it.get(Ri.__renderTarget),po=it.get(Ds.__renderTarget);$e.bindFramebuffer(ie.READ_FRAMEBUFFER,es.__webglFramebuffer),$e.bindFramebuffer(ie.DRAW_FRAMEBUFFER,po.__webglFramebuffer);for(let Va=0;Va<xt;Va++)$n&&(ie.framebufferTextureLayer(ie.READ_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,it.get(Y).__webglTexture,de,Bt+Va),ie.framebufferTextureLayer(ie.DRAW_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,it.get(ce).__webglTexture,Ke,nn+Va)),ie.blitFramebuffer(Lt,Pt,et,pt,Kt,bn,et,pt,ie.DEPTH_BUFFER_BIT,ie.NEAREST);$e.bindFramebuffer(ie.READ_FRAMEBUFFER,null),$e.bindFramebuffer(ie.DRAW_FRAMEBUFFER,null)}else if(de!==0||Y.isRenderTargetTexture||it.has(Y)){const Ri=it.get(Y),Ds=it.get(ce);$e.bindFramebuffer(ie.READ_FRAMEBUFFER,rt),$e.bindFramebuffer(ie.DRAW_FRAMEBUFFER,ct);for(let es=0;es<xt;es++)$n?ie.framebufferTextureLayer(ie.READ_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,Ri.__webglTexture,de,Bt+es):ie.framebufferTexture2D(ie.READ_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_2D,Ri.__webglTexture,de),oi?ie.framebufferTextureLayer(ie.DRAW_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,Ds.__webglTexture,Ke,nn+es):ie.framebufferTexture2D(ie.DRAW_FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_2D,Ds.__webglTexture,Ke),de!==0?ie.blitFramebuffer(Lt,Pt,et,pt,Kt,bn,et,pt,ie.COLOR_BUFFER_BIT,ie.NEAREST):oi?ie.copyTexSubImage3D(In,Ke,Kt,bn,nn+es,Lt,Pt,et,pt):ie.copyTexSubImage2D(In,Ke,Kt,bn,Lt,Pt,et,pt);$e.bindFramebuffer(ie.READ_FRAMEBUFFER,null),$e.bindFramebuffer(ie.DRAW_FRAMEBUFFER,null)}else oi?Y.isDataTexture||Y.isData3DTexture?ie.texSubImage3D(In,Ke,Kt,bn,nn,et,pt,xt,Nn,sn,fn.data):ce.isCompressedArrayTexture?ie.compressedTexSubImage3D(In,Ke,Kt,bn,nn,et,pt,xt,Nn,fn.data):ie.texSubImage3D(In,Ke,Kt,bn,nn,et,pt,xt,Nn,sn,fn):Y.isDataTexture?ie.texSubImage2D(ie.TEXTURE_2D,Ke,Kt,bn,et,pt,Nn,sn,fn.data):Y.isCompressedTexture?ie.compressedTexSubImage2D(ie.TEXTURE_2D,Ke,Kt,bn,fn.width,fn.height,Nn,fn.data):ie.texSubImage2D(ie.TEXTURE_2D,Ke,Kt,bn,et,pt,Nn,sn,fn);ie.pixelStorei(ie.UNPACK_ROW_LENGTH,Qt),ie.pixelStorei(ie.UNPACK_IMAGE_HEIGHT,zn),ie.pixelStorei(ie.UNPACK_SKIP_PIXELS,ni),ie.pixelStorei(ie.UNPACK_SKIP_ROWS,ln),ie.pixelStorei(ie.UNPACK_SKIP_IMAGES,Ji),Ke===0&&ce.generateMipmaps&&ie.generateMipmap(In),$e.unbindTexture()},this.initRenderTarget=function(Y){it.get(Y).__webglFramebuffer===void 0&&Tt.setupRenderTarget(Y)},this.initTexture=function(Y){Y.isCubeTexture?Tt.setTextureCube(Y,0):Y.isData3DTexture?Tt.setTexture3D(Y,0):Y.isDataArrayTexture||Y.isCompressedArrayTexture?Tt.setTexture2DArray(Y,0):Tt.setTexture2D(Y,0),$e.unbindTexture()},this.resetState=function(){U=0,B=0,I=null,$e.reset(),le.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return No}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=hi._getDrawingBufferColorSpace(e),t.unpackColorSpace=hi._getUnpackColorSpace()}}const U7=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:YR,AddEquation:vh,AddOperation:kO,AdditiveAnimationBlendMode:WR,AdditiveBlending:TC,AgXToneMapping:YO,AlphaFormat:qR,AlwaysCompare:aP,AlwaysDepth:AE,AlwaysStencilFunc:LC,AmbientLight:KP,AnimationAction:nN,AnimationClip:hg,AnimationLoader:jH,AnimationMixer:x5,AnimationObjectGroup:v5,AnimationUtils:YH,ArcCurve:_P,ArrayCamera:ZP,ArrowHelper:Y5,AttachedBindMode:RC,Audio:eN,AudioAnalyser:o5,AudioContext:CD,AudioListener:s5,AudioLoader:t5,AxesHelper:X5,BackSide:Ga,BasicDepthPacking:$O,BasicShadowMap:xO,BatchedMesh:yP,Bone:$b,BooleanKeyframeTrack:Yp,Box2:R5,Box3:Fr,Box3Helper:z5,BoxGeometry:Vp,BoxHelper:H5,BufferAttribute:xi,BufferGeometry:Ln,BufferGeometryLoader:$P,ByteType:Fb,Cache:eu,Camera:jb,CameraHelper:G5,CanvasTexture:dH,CapsuleGeometry:tT,CatmullRomCurve3:SP,CineonToneMapping:zO,CircleGeometry:nT,ClampToEdgeWrapping:_s,Clock:RD,Color:Ot,ColorKeyframeTrack:SD,ColorManagement:hi,CompressedArrayTexture:fH,CompressedCubeTexture:hH,CompressedTexture:eT,CompressedTextureLoader:WH,ConeGeometry:Xx,ConstantAlphaFactor:NO,ConstantColorFactor:OO,Controls:q5,CubeCamera:pP,CubeReflectionMapping:ou,CubeRefractionMapping:wh,CubeTexture:Gx,CubeTextureLoader:YP,CubeUVReflectionMapping:Mg,CubicBezierCurve:hD,CubicBezierCurve3:AP,CubicInterpolant:GP,CullFaceBack:bC,CullFaceFront:yO,CullFaceFrontBack:bG,CullFaceNone:vO,Curve:hc,CurvePath:bP,CustomBlending:_O,CustomToneMapping:VO,CylinderGeometry:Yx,Cylindrical:C5,Data3DTexture:qb,DataArrayTexture:Kb,DataTexture:xl,DataTextureLoader:AD,DataUtils:fp,DecrementStencilOp:OG,DecrementWrapStencilOp:NG,DefaultLoadingManager:VP,DepthFormat:ng,DepthStencilFormat:ig,DepthTexture:cD,DetachedBindMode:KO,DirectionalLight:MD,DirectionalLightHelper:k5,DiscreteInterpolant:HP,DodecahedronGeometry:iT,DoubleSide:so,DstAlphaFactor:DO,DstColorFactor:wO,DynamicCopyUsage:$G,DynamicDrawUsage:XG,DynamicReadUsage:jG,EdgesGeometry:xP,EllipseCurve:sT,EqualCompare:nP,EqualDepth:bE,EqualStencilFunc:GG,EquirectangularReflectionMapping:Q0,EquirectangularRefractionMapping:ox,Euler:Ho,EventDispatcher:hu,ExternalTexture:uD,ExtrudeGeometry:rT,FileLoader:kr,Float16BufferAttribute:V8,Float32BufferAttribute:tn,FloatType:Ss,Fog:Jb,FogExp2:Wb,FramebufferTexture:uH,FrontSide:au,Frustum:Cg,FrustumArray:Qb,GLBufferAttribute:b5,GLSL1:ZG,GLSL3:wC,GreaterCompare:iP,GreaterDepth:ME,GreaterEqualCompare:rP,GreaterEqualDepth:TE,GreaterEqualStencilFunc:YG,GreaterStencilFunc:zG,GridHelper:U5,Group:lf,HalfFloatType:ar,HemisphereLight:XP,HemisphereLightHelper:N5,IcosahedronGeometry:Kx,ImageBitmapLoader:QP,ImageLoader:gx,ImageUtils:uP,IncrementStencilOp:BG,IncrementWrapStencilOp:PG,InstancedBufferAttribute:Lp,InstancedBufferGeometry:JP,InstancedInterleavedBuffer:E5,InstancedMesh:rD,Int16BufferAttribute:H8,Int32BufferAttribute:z8,Int8BufferAttribute:F8,IntType:Ux,InterleavedBuffer:zx,InterleavedBufferAttribute:Oh,Interpolant:Rg,InterpolateDiscrete:sg,InterpolateLinear:rg,InterpolateSmooth:QA,InterpolationSamplingMode:n8,InterpolationSamplingType:t8,InvertStencilOp:UG,KeepStencilOp:np,KeyframeTrack:Ml,LOD:vP,LatheGeometry:aT,Layers:cg,LessCompare:tP,LessDepth:EE,LessEqualCompare:$R,LessEqualDepth:Dp,LessEqualStencilFunc:HG,LessStencilFunc:kG,Light:zh,LightProbe:WP,Line:pf,Line3:w5,LineBasicMaterial:ca,LineCurve:dD,LineCurve3:EP,LineDashedMaterial:UP,LineLoop:aD,LineSegments:fc,LinearFilter:yi,LinearInterpolant:_D,LinearMipMapLinearFilter:DC,LinearMipMapNearestFilter:CG,LinearMipmapLinearFilter:ml,LinearMipmapNearestFilter:k0,LinearSRGBColorSpace:cc,LinearToneMapping:GO,LinearTransfer:cx,Loader:Hr,LoaderUtils:Mh,LoadingManager:dT,LoopOnce:qO,LoopPingPong:WO,LoopRepeat:jO,MOUSE:ep,Material:or,MaterialLoader:pT,MathUtils:cP,Matrix2:BD,Matrix3:Pn,Matrix4:yn,MaxEquation:bO,Mesh:As,MeshBasicMaterial:ao,MeshDepthMaterial:vD,MeshDistanceMaterial:yD,MeshLambertMaterial:PP,MeshMatcapMaterial:NP,MeshNormalMaterial:OP,MeshPhongMaterial:IP,MeshPhysicalMaterial:Tl,MeshStandardMaterial:Wx,MeshToonMaterial:BP,MinEquation:EO,MirroredRepeatWrapping:Z0,MixOperation:FO,MultiplyBlending:CC,MultiplyOperation:Nx,NearestFilter:br,NearestMipMapLinearFilter:MG,NearestMipMapNearestFilter:TG,NearestMipmapLinearFilter:lp,NearestMipmapNearestFilter:Ub,NeutralToneMapping:XO,NeverCompare:eP,NeverDepth:SE,NeverStencilFunc:FG,NoBlending:lc,NoColorSpace:sf,NoToneMapping:su,NormalAnimationBlendMode:Xb,NormalBlending:vp,NotEqualCompare:sP,NotEqualDepth:CE,NotEqualStencilFunc:VG,NumberKeyframeTrack:Ip,Object3D:pi,ObjectLoader:ZH,ObjectSpaceNormalMap:ZO,OctahedronGeometry:qx,OneFactor:MO,OneMinusConstantAlphaFactor:UO,OneMinusConstantColorFactor:PO,OneMinusDstAlphaFactor:LO,OneMinusDstColorFactor:IO,OneMinusSrcAlphaFactor:_E,OneMinusSrcColorFactor:RO,OrthographicCamera:_l,PCFShadowMap:Nb,PCFSoftShadowMap:Py,PMREMGenerator:kC,Path:ab,PerspectiveCamera:cs,Plane:tf,PlaneGeometry:Hh,PlaneHelper:V5,PointLight:TD,PointLightHelper:O5,Points:oD,PointsMaterial:Zb,PolarGridHelper:F5,PolyhedronGeometry:Gh,PositionalAudio:a5,PropertyBinding:mi,PropertyMixer:tN,QuadraticBezierCurve:pD,QuadraticBezierCurve3:mD,Quaternion:Tr,QuaternionKeyframeTrack:Bp,QuaternionLinearInterpolant:zP,RED_GREEN_RGTC2_Format:eb,RED_RGTC1_Format:QE,REVISION:Px,RGBADepthPacking:QO,RGBAFormat:Ns,RGBAIntegerFormat:Yb,RGBA_ASTC_10x10_Format:KE,RGBA_ASTC_10x5_Format:VE,RGBA_ASTC_10x6_Format:YE,RGBA_ASTC_10x8_Format:XE,RGBA_ASTC_12x10_Format:qE,RGBA_ASTC_12x12_Format:jE,RGBA_ASTC_4x4_Format:PE,RGBA_ASTC_5x4_Format:NE,RGBA_ASTC_5x5_Format:UE,RGBA_ASTC_6x5_Format:FE,RGBA_ASTC_6x6_Format:kE,RGBA_ASTC_8x5_Format:GE,RGBA_ASTC_8x6_Format:HE,RGBA_ASTC_8x8_Format:zE,RGBA_BPTC_Format:WE,RGBA_ETC2_EAC_Format:OE,RGBA_PVRTC_2BPPV1_Format:wE,RGBA_PVRTC_4BPPV1_Format:LE,RGBA_S3TC_DXT1_Format:Uy,RGBA_S3TC_DXT3_Format:Fy,RGBA_S3TC_DXT5_Format:ky,RGBDepthPacking:DG,RGBFormat:jR,RGBIntegerFormat:RG,RGB_BPTC_SIGNED_Format:JE,RGB_BPTC_UNSIGNED_Format:$E,RGB_ETC1_Format:IE,RGB_ETC2_Format:BE,RGB_PVRTC_2BPPV1_Format:DE,RGB_PVRTC_4BPPV1_Format:RE,RGB_S3TC_DXT1_Format:Ny,RGDepthPacking:LG,RGFormat:zb,RGIntegerFormat:Vb,RawShaderMaterial:wP,Ray:zp,Raycaster:ID,RectAreaLight:qP,RedFormat:Fx,RedIntegerFormat:kx,ReinhardToneMapping:HO,RenderTarget:ZR,RenderTarget3D:_5,RepeatWrapping:Ih,ReplaceStencilOp:IG,ReverseSubtractEquation:AO,RingGeometry:oT,SIGNED_RED_GREEN_RGTC2_Format:tb,SIGNED_RED_RGTC1_Format:ZE,SRGBColorSpace:sr,SRGBTransfer:Bi,Scene:Hx,ShaderChunk:Gn,ShaderLib:sc,ShaderMaterial:za,ShadowMaterial:LP,Shape:xp,ShapeGeometry:lT,ShapePath:K5,ShapeUtils:ac,ShortType:kb,Skeleton:Vx,SkeletonHelper:B5,SkinnedMesh:sD,Source:yh,Sphere:Mr,SphereGeometry:jx,Spherical:UC,SphericalHarmonics3:jP,SplineCurve:gD,SpotLight:bD,SpotLightHelper:I5,Sprite:gP,SpriteMaterial:iD,SrcAlphaFactor:xE,SrcAlphaSaturateFactor:BO,SrcColorFactor:CO,StaticCopyUsage:JG,StaticDrawUsage:ux,StaticReadUsage:qG,StereoCamera:n5,StreamCopyUsage:QG,StreamDrawUsage:KG,StreamReadUsage:WG,StringKeyframeTrack:Xp,SubtractEquation:SO,SubtractiveBlending:MC,TOUCH:tp,TangentSpaceNormalMap:kh,TetrahedronGeometry:cT,Texture:Ti,TextureLoader:Jx,TextureUtils:Q5,Timer:T5,TimestampQuery:e8,TorusGeometry:uT,TorusKnotGeometry:fT,Triangle:ro,TriangleFanDrawMode:nb,TriangleStripDrawMode:JR,TrianglesDrawMode:JO,TubeGeometry:hT,UVMapping:Lh,Uint16BufferAttribute:eD,Uint32BufferAttribute:tD,Uint8BufferAttribute:k8,Uint8ClampedBufferAttribute:G8,Uniform:wD,UniformsGroup:A5,UniformsLib:Gt,UniformsUtils:dP,UnsignedByteType:Ha,UnsignedInt101111Type:KR,UnsignedInt248Type:tg,UnsignedInt5999Type:XR,UnsignedIntType:lu,UnsignedShort4444Type:Gb,UnsignedShort5551Type:Hb,UnsignedShortType:eg,VSMShadowMap:ic,Vector2:at,Vector3:ae,Vector4:vi,VectorKeyframeTrack:Op,VideoFrameTexture:cH,VideoTexture:lD,WebGL3DRenderTarget:C8,WebGLArrayRenderTarget:M8,WebGLCoordinateSystem:No,WebGLCubeRenderTarget:nD,WebGLRenderTarget:Al,WebGLRenderer:OD,WebGLUtils:cN,WebGPUCoordinateSystem:ag,WebXRController:ZA,WireframeGeometry:DP,WrapAroundEnding:lx,ZeroCurvatureEnding:cp,ZeroFactor:TO,ZeroSlopeEnding:up,ZeroStencilOp:wG,createCanvasElement:lP,error:Cn,getConsoleFunction:r8,log:hx,setConsoleFunction:s8,warn:Ht,warnOnce:og},Symbol.toStringTag,{value:"Module"}));var cM={exports:{}},uM={},fM={exports:{}},hM={};var L2;function F7(){if(L2)return hM;L2=1;var r=bg();function e(p,v){return p===v&&(p!==0||1/p===1/v)||p!==p&&v!==v}var t=typeof Object.is=="function"?Object.is:e,n=r.useState,i=r.useEffect,s=r.useLayoutEffect,a=r.useDebugValue;function o(p,v){var y=v(),x=n({inst:{value:y,getSnapshot:v}}),S=x[0].inst,E=x[1];return s(function(){S.value=y,S.getSnapshot=v,c(S)&&E({inst:S})},[p,y,v]),i(function(){return c(S)&&E({inst:S}),p(function(){c(S)&&E({inst:S})})},[p]),a(y),y}function c(p){var v=p.getSnapshot;p=p.value;try{var y=v();return!t(p,y)}catch{return!0}}function u(p,v){return v()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:o;return hM.useSyncExternalStore=r.useSyncExternalStore!==void 0?r.useSyncExternalStore:h,hM}var w2;function k7(){return w2||(w2=1,fM.exports=F7()),fM.exports}var I2;function G7(){if(I2)return uM;I2=1;var r=bg(),e=k7();function t(u,h){return u===h&&(u!==0||1/u===1/h)||u!==u&&h!==h}var n=typeof Object.is=="function"?Object.is:t,i=e.useSyncExternalStore,s=r.useRef,a=r.useEffect,o=r.useMemo,c=r.useDebugValue;return uM.useSyncExternalStoreWithSelector=function(u,h,p,v,y){var x=s(null);if(x.current===null){var S={hasValue:!1,value:null};x.current=S}else S=x.current;x=o(function(){function b(O){if(!T){if(T=!0,R=O,O=v(O),y!==void 0&&S.hasValue){var N=S.value;if(y(N,O))return D=N}return D=O}if(N=D,n(R,O))return N;var U=v(O);return y!==void 0&&y(N,U)?(R=O,N):(R=O,D=U)}var T=!1,R,D,P=p===void 0?null:p;return[function(){return b(h())},P===null?void 0:function(){return b(P())}]},[h,p,v,y]);var E=i(u,x[0],x[1]);return a(function(){S.hasValue=!0,S.value=E},[E]),c(E),E},uM}var B2;function H7(){return B2||(B2=1,cM.exports=G7()),cM.exports}var z7=H7();const V7=Ox(z7),{useSyncExternalStoreWithSelector:Y7}=V7,X7=r=>r;function K7(r,e=X7,t){const n=Y7(r.subscribe,r.getState,r.getInitialState,e,t);return Ey.useDebugValue(n),n}const O2=(r,e)=>{const t=mO(r),n=(i,s=e)=>K7(t,i,s);return Object.assign(n,t),n},uN=((r,e)=>r?O2(r,e):O2),q7=r=>typeof r=="object"&&typeof r.then=="function",dp=[];function fN(r,e,t=(n,i)=>n===i){if(r===e)return!0;if(!r||!e)return!1;const n=r.length;if(e.length!==n)return!1;for(let i=0;i<n;i++)if(!t(r[i],e[i]))return!1;return!0}function hN(r,e=null,t=!1,n={}){e===null&&(e=[r]);for(const s of dp)if(fN(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return n.lifespan&&n.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,n.lifespan)),s.response;if(!t)throw s.promise}const i={keys:e,equal:n.equal,remove:()=>{const s=dp.indexOf(i);s!==-1&&dp.splice(s,1)},promise:(q7(r)?r:r(...e)).then(s=>{i.response=s,n.lifespan&&n.lifespan>0&&(i.timeout=setTimeout(i.remove,n.lifespan))}).catch(s=>i.error=s)};if(dp.push(i),!t)throw i.promise}const dN=(r,e,t)=>hN(r,e,!1,t),j7=(r,e,t)=>void hN(r,e,!0,t),W7=r=>{if(r===void 0||r.length===0)dp.splice(0,dp.length);else{const e=dp.find(t=>fN(r,t.keys,t.equal));e&&e.remove()}};var dM={exports:{}},pM={exports:{}},mM={exports:{}},gM={};var P2;function J7(){return P2||(P2=1,(function(r){function e(k,j){var J=k.length;k.push(j);e:for(;0<J;){var oe=J-1>>>1,K=k[oe];if(0<i(K,j))k[oe]=j,k[J]=K,J=oe;else break e}}function t(k){return k.length===0?null:k[0]}function n(k){if(k.length===0)return null;var j=k[0],J=k.pop();if(J!==j){k[0]=J;e:for(var oe=0,K=k.length,X=K>>>1;oe<X;){var ne=2*(oe+1)-1,xe=k[ne],_e=ne+1,Be=k[_e];if(0>i(xe,J))_e<K&&0>i(Be,xe)?(k[oe]=Be,k[_e]=J,oe=_e):(k[oe]=xe,k[ne]=J,oe=ne);else if(_e<K&&0>i(Be,J))k[oe]=Be,k[_e]=J,oe=_e;else break e}}return j}function i(k,j){var J=k.sortIndex-j.sortIndex;return J!==0?J:k.id-j.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();r.unstable_now=function(){return a.now()-o}}var c=[],u=[],h=1,p=null,v=3,y=!1,x=!1,S=!1,E=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;function R(k){for(var j=t(u);j!==null;){if(j.callback===null)n(u);else if(j.startTime<=k)n(u),j.sortIndex=j.expirationTime,e(c,j);else break;j=t(u)}}function D(k){if(S=!1,R(k),!x)if(t(c)!==null)x=!0,te();else{var j=t(u);j!==null&&re(D,j.startTime-k)}}var P=!1,O=-1,N=5,U=-1;function B(){return!(r.unstable_now()-U<N)}function I(){if(P){var k=r.unstable_now();U=k;var j=!0;try{e:{x=!1,S&&(S=!1,b(O),O=-1),y=!0;var J=v;try{t:{for(R(k),p=t(c);p!==null&&!(p.expirationTime>k&&B());){var oe=p.callback;if(typeof oe=="function"){p.callback=null,v=p.priorityLevel;var K=oe(p.expirationTime<=k);if(k=r.unstable_now(),typeof K=="function"){p.callback=K,R(k),j=!0;break t}p===t(c)&&n(c),R(k)}else n(c);p=t(c)}if(p!==null)j=!0;else{var X=t(u);X!==null&&re(D,X.startTime-k),j=!1}}break e}finally{p=null,v=J,y=!1}j=void 0}}finally{j?z():P=!1}}}var z;if(typeof T=="function")z=function(){T(I)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,Z=W.port2;W.port1.onmessage=I,z=function(){Z.postMessage(null)}}else z=function(){E(I,0)};function te(){P||(P=!0,z())}function re(k,j){O=E(function(){k(r.unstable_now())},j)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(k){k.callback=null},r.unstable_continueExecution=function(){x||y||(x=!0,te())},r.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<k?Math.floor(1e3/k):5},r.unstable_getCurrentPriorityLevel=function(){return v},r.unstable_getFirstCallbackNode=function(){return t(c)},r.unstable_next=function(k){switch(v){case 1:case 2:case 3:var j=3;break;default:j=v}var J=v;v=j;try{return k()}finally{v=J}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(k,j){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var J=v;v=k;try{return j()}finally{v=J}},r.unstable_scheduleCallback=function(k,j,J){var oe=r.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?oe+J:oe):J=oe,k){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=J+K,k={id:h++,callback:j,priorityLevel:k,startTime:J,expirationTime:K,sortIndex:-1},J>oe?(k.sortIndex=J,e(u,k),t(c)===null&&k===t(u)&&(S?(b(O),O=-1):S=!0,re(D,J-oe))):(k.sortIndex=K,e(c,k),x||y||(x=!0,te())),k},r.unstable_shouldYield=B,r.unstable_wrapCallback=function(k){var j=v;return function(){var J=v;v=j;try{return k.apply(this,arguments)}finally{v=J}}}})(gM)),gM}var N2;function $7(){return N2||(N2=1,mM.exports=J7()),mM.exports}var U2;function Q7(){return U2||(U2=1,(function(r){r.exports=function(e){function t(d,m,A,C){return new nv(d,m,A,C)}function n(){}function i(d){var m="https://react.dev/errors/"+d;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var A=2;A<arguments.length;A++)m+="&args[]="+encodeURIComponent(arguments[A])}return"Minified React error #"+d+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(d){return d===null||typeof d!="object"?null:(d=cv&&d[cv]||d["@@iterator"],typeof d=="function"?d:null)}function a(d){if(d==null)return null;if(typeof d=="function")return d.$$typeof===Mu?null:d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case Of:return"Fragment";case yo:return"Portal";case lv:return"Profiler";case ov:return"StrictMode";case xm:return"Suspense";case wc:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case $o:return(d.displayName||"Context")+".Provider";case Lc:return(d._context.displayName||"Context")+".Consumer";case Pf:var m=d.render;return d=d.displayName,d||(d=m.displayName||m.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case fd:return m=d.displayName||null,m!==null?m:a(d.type)||"Memo";case xo:m=d._payload,d=d._init;try{return a(d(m))}catch{}}return null}function o(d){if(_m===void 0)try{throw Error()}catch(A){var m=A.stack.trim().match(/\n( *(at )?)/);_m=m&&m[1]||"",uv=-1<A.stack.indexOf(`
    at`)?" (<anonymous>)":-1<A.stack.indexOf("@")?"@unknown:0:0":""}return`
`+_m+d+uv}function c(d,m){if(!d||Ic)return"";Ic=!0;var A=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var C={DetermineComponentFrameRoot:function(){try{if(m){var kt=function(){throw Error()};if(Object.defineProperty(kt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(kt,[])}catch(Tn){var Xt=Tn}Reflect.construct(d,[],kt)}else{try{kt.call()}catch(Tn){Xt=Tn}d.call(kt.prototype)}}else{try{throw Error()}catch(Tn){Xt=Tn}(kt=d())&&typeof kt.catch=="function"&&kt.catch(function(){})}}catch(Tn){if(Tn&&Xt&&typeof Tn.stack=="string")return[Tn.stack,Xt.stack]}return[null,null]}};C.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var w=Object.getOwnPropertyDescriptor(C.DetermineComponentFrameRoot,"name");w&&w.configurable&&Object.defineProperty(C.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var F=C.DetermineComponentFrameRoot(),ee=F[0],ge=F[1];if(ee&&ge){var Le=ee.split(`
`),ot=ge.split(`
`);for(w=C=0;C<Le.length&&!Le[C].includes("DetermineComponentFrameRoot");)C++;for(;w<ot.length&&!ot[w].includes("DetermineComponentFrameRoot");)w++;if(C===Le.length||w===ot.length)for(C=Le.length-1,w=ot.length-1;1<=C&&0<=w&&Le[C]!==ot[w];)w--;for(;1<=C&&0<=w;C--,w--)if(Le[C]!==ot[w]){if(C!==1||w!==1)do if(C--,w--,0>w||Le[C]!==ot[w]){var Ct=`
`+Le[C].replace(" at new "," at ");return d.displayName&&Ct.includes("<anonymous>")&&(Ct=Ct.replace("<anonymous>",d.displayName)),Ct}while(1<=C&&0<=w);break}}}finally{Ic=!1,Error.prepareStackTrace=A}return(A=d?d.displayName||d.name:"")?o(A):""}function u(d){switch(d.tag){case 26:case 27:case 5:return o(d.type);case 16:return o("Lazy");case 13:return o("Suspense");case 19:return o("SuspenseList");case 0:case 15:return d=c(d.type,!1),d;case 11:return d=c(d.type.render,!1),d;case 1:return d=c(d.type,!0),d;default:return""}}function h(d){try{var m="";do m+=u(d),d=d.return;while(d);return m}catch(A){return`
Error generating stack: `+A.message+`
`+A.stack}}function p(d){var m=d,A=d;if(d.alternate)for(;m.return;)m=m.return;else{d=m;do m=d,(m.flags&4098)!==0&&(A=m.return),d=m.return;while(d)}return m.tag===3?A:null}function v(d){if(p(d)!==d)throw Error(i(188))}function y(d){var m=d.alternate;if(!m){if(m=p(d),m===null)throw Error(i(188));return m!==d?null:d}for(var A=d,C=m;;){var w=A.return;if(w===null)break;var F=w.alternate;if(F===null){if(C=w.return,C!==null){A=C;continue}break}if(w.child===F.child){for(F=w.child;F;){if(F===A)return v(w),d;if(F===C)return v(w),m;F=F.sibling}throw Error(i(188))}if(A.return!==C.return)A=w,C=F;else{for(var ee=!1,ge=w.child;ge;){if(ge===A){ee=!0,A=w,C=F;break}if(ge===C){ee=!0,C=w,A=F;break}ge=ge.sibling}if(!ee){for(ge=F.child;ge;){if(ge===A){ee=!0,A=F,C=w;break}if(ge===C){ee=!0,C=F,A=w;break}ge=ge.sibling}if(!ee)throw Error(i(189))}}if(A.alternate!==C)throw Error(i(190))}if(A.tag!==3)throw Error(i(188));return A.stateNode.current===A?d:m}function x(d){var m=d.tag;if(m===5||m===26||m===27||m===6)return d;for(d=d.child;d!==null;){if(m=x(d),m!==null)return m;d=d.sibling}return null}function S(d){var m=d.tag;if(m===5||m===26||m===27||m===6)return d;for(d=d.child;d!==null;){if(d.tag!==4&&(m=S(d),m!==null))return m;d=d.sibling}return null}function E(d){return{current:d}}function b(d){0>Hl||(d.current=_d[Hl],_d[Hl]=null,Hl--)}function T(d,m){Hl++,_d[Hl]=d.current,d.current=m}function R(d){return d>>>=0,d===0?32:31-(Sd(d)/W_|0)|0}function D(d){var m=d&42;if(m!==0)return m;switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return d&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return d}}function P(d,m){var A=d.pendingLanes;if(A===0)return 0;var C=0,w=d.suspendedLanes,F=d.pingedLanes,ee=d.warmLanes;d=d.finishedLanes!==0;var ge=A&134217727;return ge!==0?(A=ge&~w,A!==0?C=D(A):(F&=ge,F!==0?C=D(F):d||(ee=ge&~ee,ee!==0&&(C=D(ee))))):(ge=A&~w,ge!==0?C=D(ge):F!==0?C=D(F):d||(ee=A&~ee,ee!==0&&(C=D(ee)))),C===0?0:m!==0&&m!==C&&(m&w)===0&&(w=C&-C,ee=m&-m,w>=ee||w===32&&(ee&4194176)!==0)?m:C}function O(d,m){return(d.pendingLanes&~(d.suspendedLanes&~d.pingedLanes)&m)===0}function N(d,m){switch(d){case 1:case 2:case 4:case 8:return m+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function U(){var d=kf;return kf<<=1,(kf&4194176)===0&&(kf=128),d}function B(){var d=Ad;return Ad<<=1,(Ad&62914560)===0&&(Ad=4194304),d}function I(d){for(var m=[],A=0;31>A;A++)m.push(d);return m}function z(d,m){d.pendingLanes|=m,m!==268435456&&(d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0)}function W(d,m,A,C,w,F){var ee=d.pendingLanes;d.pendingLanes=A,d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0,d.expiredLanes&=A,d.entangledLanes&=A,d.errorRecoveryDisabledLanes&=A,d.shellSuspendCounter=0;var ge=d.entanglements,Le=d.expirationTimes,ot=d.hiddenUpdates;for(A=ee&~A;0<A;){var Ct=31-Kr(A),kt=1<<Ct;ge[Ct]=0,Le[Ct]=-1;var Xt=ot[Ct];if(Xt!==null)for(ot[Ct]=null,Ct=0;Ct<Xt.length;Ct++){var Tn=Xt[Ct];Tn!==null&&(Tn.lane&=-536870913)}A&=~kt}C!==0&&Z(d,C,0),F!==0&&w===0&&d.tag!==0&&(d.suspendedLanes|=F&~(ee&~m))}function Z(d,m,A){d.pendingLanes|=m,d.suspendedLanes&=~m;var C=31-Kr(m);d.entangledLanes|=m,d.entanglements[C]=d.entanglements[C]|1073741824|A&4194218}function te(d,m){var A=d.entangledLanes|=m;for(d=d.entanglements;A;){var C=31-Kr(A),w=1<<C;w&m|d[C]&m&&(d[C]|=m),A&=~w}}function re(d){return d&=-d,2<d?8<d?(d&134217727)!==0?32:268435456:8:2}function k(d){if(qr&&typeof qr.onCommitFiberRoot=="function")try{qr.onCommitFiberRoot(Hf,d,void 0,(d.current.flags&128)===128)}catch{}}function j(d){if(typeof Z_=="function"&&Hv(d),qr&&typeof qr.setStrictMode=="function")try{qr.setStrictMode(Hf,d)}catch{}}function J(d,m){return d===m&&(d!==0||1/d===1/m)||d!==d&&m!==m}function oe(d,m){if(typeof d=="object"&&d!==null){var A=Um.get(d);return A!==void 0?A:(m={value:d,source:m,stack:h(m)},Um.set(d,m),m)}return{value:d,source:m,stack:h(m)}}function K(d,m){Vi[is++]=Td,Vi[is++]=bd,bd=d,Td=m}function X(d,m,A){va[ya++]=nl,va[ya++]=Ka,va[ya++]=_o,_o=d;var C=nl;d=Ka;var w=32-Kr(C)-1;C&=~(1<<w),A+=1;var F=32-Kr(m)+w;if(30<F){var ee=w-w%5;F=(C&(1<<ee)-1).toString(32),C>>=ee,w-=ee,nl=1<<32-Kr(m)+w|A<<w|C,Ka=F+d}else nl=1<<F|A<<w|C,Ka=d}function ne(d){d.return!==null&&(K(d,1),X(d,1,0))}function xe(d){for(;d===bd;)bd=Vi[--is],Vi[is]=null,Td=Vi[--is],Vi[is]=null;for(;d===_o;)_o=va[--ya],va[ya]=null,Ka=va[--ya],va[ya]=null,nl=va[--ya],va[ya]=null}function _e(d,m){T(So,m),T(Md,d),T(zs,null),d=Cu(m),b(zs),T(zs,d)}function Be(){b(zs),b(Md),b(So)}function pe(d){d.memoizedState!==null&&T(zf,d);var m=zs.current,A=R_(m,d.type);m!==A&&(T(Md,d),T(zs,A))}function be(d){Md.current===d&&(b(zs),b(Md)),zf.current===d&&(b(zf),Zo?_n._currentValue=Xr:_n._currentValue2=Xr)}function je(d){var m=Error(i(418,""));throw vt(oe(m,d)),Cd}function gt(d,m){if(!wr)throw Error(i(175));NT(d.stateNode,d.type,d.memoizedProps,m,d)||je(d)}function St(d){for(mr=d.return;mr;)switch(mr.tag){case 3:case 27:qa=!0;return;case 5:case 13:qa=!1;return;default:mr=mr.return}}function At(d){if(!wr||d!==mr)return!1;if(!li)return St(d),li=!0,!1;var m=!1;if($s?d.tag!==3&&d.tag!==27&&(d.tag!==5||Y_(d.type)&&!Pc(d.type,d.memoizedProps))&&(m=!0):d.tag!==3&&(d.tag!==5||Y_(d.type)&&!Pc(d.type,d.memoizedProps))&&(m=!0),m&&Zs&&je(d),St(d),d.tag===13){if(!wr)throw Error(i(316));if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(i(317));Zs=z_(d)}else Zs=mr?Rv(d.stateNode):null;return!0}function jt(){wr&&(Zs=mr=null,li=!1)}function vt(d){xa===null?xa=[d]:xa.push(d)}function ze(){for(var d=Uc,m=Vf=Uc=0;m<d;){var A=_a[m];_a[m++]=null;var C=_a[m];_a[m++]=null;var w=_a[m];_a[m++]=null;var F=_a[m];if(_a[m++]=null,C!==null&&w!==null){var ee=C.pending;ee===null?w.next=w:(w.next=ee.next,ee.next=w),C.pending=w}F!==0&&st(A,w,F)}}function ie(d,m,A,C){_a[Uc++]=d,_a[Uc++]=m,_a[Uc++]=A,_a[Uc++]=C,Vf|=C,d.lanes|=C,d=d.alternate,d!==null&&(d.lanes|=C)}function Oe(d,m,A,C){return ie(d,m,A,C),$e(d)}function ue(d,m){return ie(d,null,null,m),$e(d)}function st(d,m,A){d.lanes|=A;var C=d.alternate;C!==null&&(C.lanes|=A);for(var w=!1,F=d.return;F!==null;)F.childLanes|=A,C=F.alternate,C!==null&&(C.childLanes|=A),F.tag===22&&(d=F.stateNode,d===null||d._visibility&1||(w=!0)),d=F,F=F.return;w&&m!==null&&d.tag===3&&(F=d.stateNode,w=31-Kr(A),F=F.hiddenUpdates,d=F[w],d===null?F[w]=[m]:d.push(m),m.lane=A|536870912)}function $e(d){if(50<Fu)throw Fu=0,Or=null,Error(i(185));for(var m=d.return;m!==null;)d=m,m=d.return;return d.tag===3?d.stateNode:null}function _t(d){d!==wu&&d.next===null&&(wu===null?Yf=wu=d:wu=wu.next=d),Dd=!0,Rd||(Rd=!0,Ge(Tt))}function it(d,m){if(!Ao&&Dd){Ao=!0;do for(var A=!1,C=Yf;C!==null;){if(d!==0){var w=C.pendingLanes;if(w===0)var F=0;else{var ee=C.suspendedLanes,ge=C.pingedLanes;F=(1<<31-Kr(42|d)+1)-1,F&=w&~(ee&~ge),F=F&201326677?F&201326677|1:F?F|2:0}F!==0&&(A=!0,Ee(C,F))}else F=Fn,F=P(C,C===Hn?F:0),(F&3)===0||O(C,F)||(A=!0,Ee(C,F));C=C.next}while(A);Ao=!1}}function Tt(){Dd=Rd=!1;var d=0;Fc!==0&&(Nc()&&(d=Fc),Fc=0);for(var m=Qs(),A=null,C=Yf;C!==null;){var w=C.next,F=se(C,m);F===0?(C.next=null,A===null?Yf=w:A.next=w,w===null&&(wu=A)):(A=C,(d!==0||(F&3)!==0)&&(Dd=!0)),C=w}it(d)}function se(d,m){for(var A=d.suspendedLanes,C=d.pingedLanes,w=d.expirationTimes,F=d.pendingLanes&-62914561;0<F;){var ee=31-Kr(F),ge=1<<ee,Le=w[ee];Le===-1?((ge&A)===0||(ge&C)!==0)&&(w[ee]=N(ge,m)):Le<=m&&(d.expiredLanes|=ge),F&=~ge}if(m=Hn,A=Fn,A=P(d,d===m?A:0),C=d.callbackNode,A===0||d===m&&Li===2||d.cancelPendingCommit!==null)return C!==null&&C!==null&&Ed(C),d.callbackNode=null,d.callbackPriority=0;if((A&3)===0||O(d,A)){if(m=A&-A,m===d.callbackPriority)return m;switch(C!==null&&Ed(C),re(A)){case 2:case 8:A=Q_;break;case 32:A=Pm;break;case 268435456:A=Nm;break;default:A=Pm}return C=q.bind(null,d),A=Gf(A,C),d.callbackPriority=m,d.callbackNode=A,m}return C!==null&&C!==null&&Ed(C),d.callbackPriority=2,d.callbackNode=null,2}function q(d,m){var A=d.callbackNode;if(Gs()&&d.callbackNode!==A)return null;var C=Fn;return C=P(d,d===Hn?C:0),C===0?null:(ad(d,C,m),se(d,Qs()),d.callbackNode!=null&&d.callbackNode===A?q.bind(null,d):null)}function Ee(d,m){if(Gs())return null;ad(d,m,!0)}function Ge(d){Es?bm(function(){(un&6)!==0?Gf(Gv,d):d()}):Gf(Gv,d)}function Ve(){return Fc===0&&(Fc=U()),Fc}function Pe(d,m){if(Ld===null){var A=Ld=[];Fm=0,jr=Ve(),kc={status:"pending",value:void 0,then:function(C){A.push(C)}}}return Fm++,m.then(wt,wt),m}function wt(){if(--Fm===0&&Ld!==null){kc!==null&&(kc.status="fulfilled");var d=Ld;Ld=null,jr=0,kc=null;for(var m=0;m<d.length;m++)(0,d[m])()}}function bt(d,m){var A=[],C={status:"pending",value:null,reason:null,then:function(w){A.push(w)}};return d.then(function(){C.status="fulfilled",C.value=m;for(var w=0;w<A.length;w++)(0,A[w])(m)},function(w){for(C.status="rejected",C.reason=w,w=0;w<A.length;w++)(0,A[w])(void 0)}),C}function Ft(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Mt(d,m){d=d.updateQueue,m.updateQueue===d&&(m.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,callbacks:null})}function Ze(d){return{lane:d,tag:0,payload:null,callback:null,next:null}}function Je(d,m,A){var C=d.updateQueue;if(C===null)return null;if(C=C.shared,(un&2)!==0){var w=C.pending;return w===null?m.next=m:(m.next=w.next,w.next=m),C.pending=m,m=$e(d),st(d,null,A),m}return ie(d,C,m,A),$e(d)}function Nt(d,m,A){if(m=m.updateQueue,m!==null&&(m=m.shared,(A&4194176)!==0)){var C=m.lanes;C&=d.pendingLanes,A|=C,m.lanes=A,te(d,A)}}function he(d,m){var A=d.updateQueue,C=d.alternate;if(C!==null&&(C=C.updateQueue,A===C)){var w=null,F=null;if(A=A.firstBaseUpdate,A!==null){do{var ee={lane:A.lane,tag:A.tag,payload:A.payload,callback:null,next:null};F===null?w=F=ee:F=F.next=ee,A=A.next}while(A!==null);F===null?w=F=m:F=F.next=m}else w=F=m;A={baseState:C.baseState,firstBaseUpdate:w,lastBaseUpdate:F,shared:C.shared,callbacks:C.callbacks},d.updateQueue=A;return}d=A.lastBaseUpdate,d===null?A.firstBaseUpdate=m:d.next=m,A.lastBaseUpdate=m}function Ce(){if(Xf){var d=kc;if(d!==null)throw d}}function tt(d,m,A,C){Xf=!1;var w=d.updateQueue;zl=!1;var F=w.firstBaseUpdate,ee=w.lastBaseUpdate,ge=w.shared.pending;if(ge!==null){w.shared.pending=null;var Le=ge,ot=Le.next;Le.next=null,ee===null?F=ot:ee.next=ot,ee=Le;var Ct=d.alternate;Ct!==null&&(Ct=Ct.updateQueue,ge=Ct.lastBaseUpdate,ge!==ee&&(ge===null?Ct.firstBaseUpdate=ot:ge.next=ot,Ct.lastBaseUpdate=Le))}if(F!==null){var kt=w.baseState;ee=0,Ct=ot=Le=null,ge=F;do{var Xt=ge.lane&-536870913,Tn=Xt!==ge.lane;if(Tn?(Fn&Xt)===Xt:(C&Xt)===Xt){Xt!==0&&Xt===jr&&(Xf=!0),Ct!==null&&(Ct=Ct.next={lane:0,tag:ge.tag,payload:ge.payload,callback:null,next:null});e:{var Qr=d,Od=ge;Xt=m;var ku=A;switch(Od.tag){case 1:if(Qr=Od.payload,typeof Qr=="function"){kt=Qr.call(ku,kt,Xt);break e}kt=Qr;break e;case 3:Qr.flags=Qr.flags&-65537|128;case 0:if(Qr=Od.payload,Xt=typeof Qr=="function"?Qr.call(ku,kt,Xt):Qr,Xt==null)break e;kt=Tu({},kt,Xt);break e;case 2:zl=!0}}Xt=ge.callback,Xt!==null&&(d.flags|=64,Tn&&(d.flags|=8192),Tn=w.callbacks,Tn===null?w.callbacks=[Xt]:Tn.push(Xt))}else Tn={lane:Xt,tag:ge.tag,payload:ge.payload,callback:ge.callback,next:null},Ct===null?(ot=Ct=Tn,Le=kt):Ct=Ct.next=Tn,ee|=Xt;if(ge=ge.next,ge===null){if(ge=w.shared.pending,ge===null)break;Tn=ge,ge=Tn.next,Tn.next=null,w.lastBaseUpdate=Tn,w.shared.pending=null}}while(!0);Ct===null&&(Le=kt),w.baseState=Le,w.firstBaseUpdate=ot,w.lastBaseUpdate=Ct,F===null&&(w.shared.lanes=0),ba|=ee,d.lanes=ee,d.memoizedState=kt}}function le(d,m){if(typeof d!="function")throw Error(i(191,d));d.call(m)}function Re(d,m){var A=d.callbacks;if(A!==null)for(d.callbacks=null,d=0;d<A.length;d++)le(A[d],m)}function ht(d,m){if(ga(d,m))return!0;if(typeof d!="object"||d===null||typeof m!="object"||m===null)return!1;var A=Object.keys(d),C=Object.keys(m);if(A.length!==C.length)return!1;for(C=0;C<A.length;C++){var w=A[C];if(!wd.call(m,w)||!ga(d[w],m[w]))return!1}return!0}function yt(d){return d=d.status,d==="fulfilled"||d==="rejected"}function ut(){}function Qe(d,m,A){switch(A=d[A],A===void 0?d.push(m):A!==m&&(m.then(ut,ut),m=A),m.status){case"fulfilled":return m.value;case"rejected":throw d=m.reason,d===Mi?Error(i(483)):d;default:if(typeof m.status=="string")m.then(ut,ut);else{if(d=Hn,d!==null&&100<d.shellSuspendCounter)throw Error(i(482));d=m,d.status="pending",d.then(function(C){if(m.status==="pending"){var w=m;w.status="fulfilled",w.value=C}},function(C){if(m.status==="pending"){var w=m;w.status="rejected",w.reason=C}})}switch(m.status){case"fulfilled":return m.value;case"rejected":throw d=m.reason,d===Mi?Error(i(483)):d}throw Iu=m,Mi}}function Rt(){if(Iu===null)throw Error(i(459));var d=Iu;return Iu=null,d}function Vt(d){var m=ja;return ja+=1,il===null&&(il=[]),Qe(il,d,m)}function En(d,m){m=m.props.ref,d.ref=m!==void 0?m:null}function Dt(d,m){throw m.$$typeof===av?Error(i(525)):(d=Object.prototype.toString.call(m),Error(i(31,d==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":d)))}function Ut(d){var m=d._init;return m(d._payload)}function dn(d){function m(ke,Te){if(d){var qe=ke.deletions;qe===null?(ke.deletions=[Te],ke.flags|=16):qe.push(Te)}}function A(ke,Te){if(!d)return null;for(;Te!==null;)m(ke,Te),Te=Te.sibling;return null}function C(ke){for(var Te=new Map;ke!==null;)ke.key!==null?Te.set(ke.key,ke):Te.set(ke.index,ke),ke=ke.sibling;return Te}function w(ke,Te){return ke=dr(ke,Te),ke.index=0,ke.sibling=null,ke}function F(ke,Te,qe){return ke.index=qe,d?(qe=ke.alternate,qe!==null?(qe=qe.index,qe<Te?(ke.flags|=33554434,Te):qe):(ke.flags|=33554434,Te)):(ke.flags|=1048576,Te)}function ee(ke){return d&&ke.alternate===null&&(ke.flags|=33554434),ke}function ge(ke,Te,qe,Et){return Te===null||Te.tag!==6?(Te=Dc(qe,ke.mode,Et),Te.return=ke,Te):(Te=w(Te,qe),Te.return=ke,Te)}function Le(ke,Te,qe,Et){var on=qe.type;return on===Of?Ct(ke,Te,qe.props.children,Et,qe.key):Te!==null&&(Te.elementType===on||typeof on=="object"&&on!==null&&on.$$typeof===xo&&Ut(on)===Te.type)?(Te=w(Te,qe.props),En(Te,qe),Te.return=ke,Te):(Te=Ya(qe.type,qe.key,qe.props,null,ke.mode,Et),En(Te,qe),Te.return=ke,Te)}function ot(ke,Te,qe,Et){return Te===null||Te.tag!==4||Te.stateNode.containerInfo!==qe.containerInfo||Te.stateNode.implementation!==qe.implementation?(Te=Bf(qe,ke.mode,Et),Te.return=ke,Te):(Te=w(Te,qe.children||[]),Te.return=ke,Te)}function Ct(ke,Te,qe,Et,on){return Te===null||Te.tag!==7?(Te=Nl(qe,ke.mode,Et,on),Te.return=ke,Te):(Te=w(Te,qe),Te.return=ke,Te)}function kt(ke,Te,qe){if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return Te=Dc(""+Te,ke.mode,qe),Te.return=ke,Te;if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case Ul:return qe=Ya(Te.type,Te.key,Te.props,null,ke.mode,qe),En(qe,Te),qe.return=ke,qe;case yo:return Te=Bf(Te,ke.mode,qe),Te.return=ke,Te;case xo:var Et=Te._init;return Te=Et(Te._payload),kt(ke,Te,qe)}if(Bc(Te)||s(Te))return Te=Nl(Te,ke.mode,qe,null),Te.return=ke,Te;if(typeof Te.then=="function")return kt(ke,Vt(Te),qe);if(Te.$$typeof===$o)return kt(ke,td(ke,Te),qe);Dt(ke,Te)}return null}function Xt(ke,Te,qe,Et){var on=Te!==null?Te.key:null;if(typeof qe=="string"&&qe!==""||typeof qe=="number"||typeof qe=="bigint")return on!==null?null:ge(ke,Te,""+qe,Et);if(typeof qe=="object"&&qe!==null){switch(qe.$$typeof){case Ul:return qe.key===on?Le(ke,Te,qe,Et):null;case yo:return qe.key===on?ot(ke,Te,qe,Et):null;case xo:return on=qe._init,qe=on(qe._payload),Xt(ke,Te,qe,Et)}if(Bc(qe)||s(qe))return on!==null?null:Ct(ke,Te,qe,Et,null);if(typeof qe.then=="function")return Xt(ke,Te,Vt(qe),Et);if(qe.$$typeof===$o)return Xt(ke,Te,td(ke,qe),Et);Dt(ke,qe)}return null}function Tn(ke,Te,qe,Et,on){if(typeof Et=="string"&&Et!==""||typeof Et=="number"||typeof Et=="bigint")return ke=ke.get(qe)||null,ge(Te,ke,""+Et,on);if(typeof Et=="object"&&Et!==null){switch(Et.$$typeof){case Ul:return ke=ke.get(Et.key===null?qe:Et.key)||null,Le(Te,ke,Et,on);case yo:return ke=ke.get(Et.key===null?qe:Et.key)||null,ot(Te,ke,Et,on);case xo:var Ui=Et._init;return Et=Ui(Et._payload),Tn(ke,Te,qe,Et,on)}if(Bc(Et)||s(Et))return ke=ke.get(qe)||null,Ct(Te,ke,Et,on,null);if(typeof Et.then=="function")return Tn(ke,Te,qe,Vt(Et),on);if(Et.$$typeof===$o)return Tn(ke,Te,qe,td(Te,Et),on);Dt(Te,Et)}return null}function Qr(ke,Te,qe,Et){for(var on=null,Ui=null,Sn=Te,ui=Te=0,Is=null;Sn!==null&&ui<qe.length;ui++){Sn.index>ui?(Is=Sn,Sn=null):Is=Sn.sibling;var fi=Xt(ke,Sn,qe[ui],Et);if(fi===null){Sn===null&&(Sn=Is);break}d&&Sn&&fi.alternate===null&&m(ke,Sn),Te=F(fi,Te,ui),Ui===null?on=fi:Ui.sibling=fi,Ui=fi,Sn=Is}if(ui===qe.length)return A(ke,Sn),li&&K(ke,ui),on;if(Sn===null){for(;ui<qe.length;ui++)Sn=kt(ke,qe[ui],Et),Sn!==null&&(Te=F(Sn,Te,ui),Ui===null?on=Sn:Ui.sibling=Sn,Ui=Sn);return li&&K(ke,ui),on}for(Sn=C(Sn);ui<qe.length;ui++)Is=Tn(Sn,ke,ui,qe[ui],Et),Is!==null&&(d&&Is.alternate!==null&&Sn.delete(Is.key===null?ui:Is.key),Te=F(Is,Te,ui),Ui===null?on=Is:Ui.sibling=Is,Ui=Is);return d&&Sn.forEach(function(Wl){return m(ke,Wl)}),li&&K(ke,ui),on}function Od(ke,Te,qe,Et){if(qe==null)throw Error(i(151));for(var on=null,Ui=null,Sn=Te,ui=Te=0,Is=null,fi=qe.next();Sn!==null&&!fi.done;ui++,fi=qe.next()){Sn.index>ui?(Is=Sn,Sn=null):Is=Sn.sibling;var Wl=Xt(ke,Sn,fi.value,Et);if(Wl===null){Sn===null&&(Sn=Is);break}d&&Sn&&Wl.alternate===null&&m(ke,Sn),Te=F(Wl,Te,ui),Ui===null?on=Wl:Ui.sibling=Wl,Ui=Wl,Sn=Is}if(fi.done)return A(ke,Sn),li&&K(ke,ui),on;if(Sn===null){for(;!fi.done;ui++,fi=qe.next())fi=kt(ke,fi.value,Et),fi!==null&&(Te=F(fi,Te,ui),Ui===null?on=fi:Ui.sibling=fi,Ui=fi);return li&&K(ke,ui),on}for(Sn=C(Sn);!fi.done;ui++,fi=qe.next())fi=Tn(Sn,ke,ui,fi.value,Et),fi!==null&&(d&&fi.alternate!==null&&Sn.delete(fi.key===null?ui:fi.key),Te=F(fi,Te,ui),Ui===null?on=fi:Ui.sibling=fi,Ui=fi);return d&&Sn.forEach(function(qm){return m(ke,qm)}),li&&K(ke,ui),on}function ku(ke,Te,qe,Et){if(typeof qe=="object"&&qe!==null&&qe.type===Of&&qe.key===null&&(qe=qe.props.children),typeof qe=="object"&&qe!==null){switch(qe.$$typeof){case Ul:e:{for(var on=qe.key;Te!==null;){if(Te.key===on){if(on=qe.type,on===Of){if(Te.tag===7){A(ke,Te.sibling),Et=w(Te,qe.props.children),Et.return=ke,ke=Et;break e}}else if(Te.elementType===on||typeof on=="object"&&on!==null&&on.$$typeof===xo&&Ut(on)===Te.type){A(ke,Te.sibling),Et=w(Te,qe.props),En(Et,qe),Et.return=ke,ke=Et;break e}A(ke,Te);break}else m(ke,Te);Te=Te.sibling}qe.type===Of?(Et=Nl(qe.props.children,ke.mode,Et,qe.key),Et.return=ke,ke=Et):(Et=Ya(qe.type,qe.key,qe.props,null,ke.mode,Et),En(Et,qe),Et.return=ke,ke=Et)}return ee(ke);case yo:e:{for(on=qe.key;Te!==null;){if(Te.key===on)if(Te.tag===4&&Te.stateNode.containerInfo===qe.containerInfo&&Te.stateNode.implementation===qe.implementation){A(ke,Te.sibling),Et=w(Te,qe.children||[]),Et.return=ke,ke=Et;break e}else{A(ke,Te);break}else m(ke,Te);Te=Te.sibling}Et=Bf(qe,ke.mode,Et),Et.return=ke,ke=Et}return ee(ke);case xo:return on=qe._init,qe=on(qe._payload),ku(ke,Te,qe,Et)}if(Bc(qe))return Qr(ke,Te,qe,Et);if(s(qe)){if(on=s(qe),typeof on!="function")throw Error(i(150));return qe=on.call(qe),Od(ke,Te,qe,Et)}if(typeof qe.then=="function")return ku(ke,Te,Vt(qe),Et);if(qe.$$typeof===$o)return ku(ke,Te,td(ke,qe),Et);Dt(ke,qe)}return typeof qe=="string"&&qe!==""||typeof qe=="number"||typeof qe=="bigint"?(qe=""+qe,Te!==null&&Te.tag===6?(A(ke,Te.sibling),Et=w(Te,qe),Et.return=ke,ke=Et):(A(ke,Te),Et=Dc(qe,ke.mode,Et),Et.return=ke,ke=Et),ee(ke)):A(ke,Te)}return function(ke,Te,qe,Et){try{ja=0;var on=ku(ke,Te,qe,Et);return il=null,on}catch(Sn){if(Sn===Mi)throw Sn;var Ui=t(29,Sn,null,ke.mode);return Ui.lanes=Et,Ui.return=ke,Ui}finally{}}}function It(d,m){d=Eo,T(Sa,d),T(sl,m),Eo=d|m.baseLanes}function pn(){T(Sa,Eo),T(sl,sl.current)}function Wt(){Eo=Sa.current,b(sl),b(Sa)}function $t(d){var m=d.alternate;T(bs,bs.current&1),T(Aa,d),Wa===null&&(m===null||sl.current!==null||m.memoizedState!==null)&&(Wa=d)}function ai(d){if(d.tag===22){if(T(bs,bs.current),T(Aa,d),Wa===null){var m=d.alternate;m!==null&&m.memoizedState!==null&&(Wa=d)}}else hn()}function hn(){T(bs,bs.current),T(Aa,Aa.current)}function Yt(d){b(Aa),Wa===d&&(Wa=null),b(bs)}function Xn(d){for(var m=d;m!==null;){if(m.tag===13){var A=m.memoizedState;if(A!==null&&(A=A.dehydrated,A===null||Dm(A)||xd(A)))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===d)break;for(;m.sibling===null;){if(m.return===null||m.return===d)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}function Jt(){throw Error(i(321))}function V(d,m){if(m===null)return!1;for(var A=0;A<m.length&&A<d.length;A++)if(!ga(d[A],m[A]))return!1;return!0}function $(d,m,A,C,w,F){return rl=F,Bn=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,gn.H=d===null||d.memoizedState===null?Ts:gr,Vl=!1,F=A(C,w),Vl=!1,Yi&&(F=De(m,A,C,w)),me(d),F}function me(d){gn.H=ci;var m=gi!==null&&gi.next!==null;if(rl=0,ds=gi=Bn=null,Ja=!1,ss=0,Kf=null,m)throw Error(i(300));d===null||ps||(d=d.dependencies,d!==null&&yc(d)&&(ps=!0))}function De(d,m,A,C){Bn=d;var w=0;do{if(Yi&&(Kf=null),ss=0,Yi=!1,25<=w)throw Error(i(301));if(w+=1,ds=gi=null,d.updateQueue!=null){var F=d.updateQueue;F.lastEffect=null,F.events=null,F.stores=null,F.memoCache!=null&&(F.memoCache.index=0)}gn.H=Hc,F=m(A,C)}while(Yi);return F}function Ye(){var d=gn.H,m=d.useState()[0];return m=typeof m.then=="function"?ce(m):m,d=d.useState()[0],(gi!==null?gi.memoizedState:null)!==d&&(Bn.flags|=1024),m}function Xe(){var d=Id!==0;return Id=0,d}function dt(d,m,A){m.updateQueue=d.updateQueue,m.flags&=-2053,d.lanes&=~A}function rt(d){if(Ja){for(d=d.memoizedState;d!==null;){var m=d.queue;m!==null&&(m.pending=null),d=d.next}Ja=!1}rl=0,ds=gi=Bn=null,Yi=!1,ss=Id=0,Kf=null}function ct(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ds===null?Bn.memoizedState=ds=d:ds=ds.next=d,ds}function Y(){if(gi===null){var d=Bn.alternate;d=d!==null?d.memoizedState:null}else d=gi.next;var m=ds===null?Bn.memoizedState:ds.next;if(m!==null)ds=m,gi=d;else{if(d===null)throw Bn.alternate===null?Error(i(467)):Error(i(310));gi=d,d={memoizedState:gi.memoizedState,baseState:gi.baseState,baseQueue:gi.baseQueue,queue:gi.queue,next:null},ds===null?Bn.memoizedState=ds=d:ds=ds.next=d}return ds}function ce(d){var m=ss;return ss+=1,Kf===null&&(Kf=[]),d=Qe(Kf,d,m),m=Bn,(ds===null?m.memoizedState:ds.next)===null&&(m=m.alternate,gn.H=m===null||m.memoizedState===null?Ts:gr),d}function fe(d){if(d!==null&&typeof d=="object"){if(typeof d.then=="function")return ce(d);if(d.$$typeof===$o)return js(d)}throw Error(i(438,String(d)))}function Se(d){var m=null,A=Bn.updateQueue;if(A!==null&&(m=A.memoCache),m==null){var C=Bn.alternate;C!==null&&(C=C.updateQueue,C!==null&&(C=C.memoCache,C!=null&&(m={data:C.data.map(function(w){return w.slice()}),index:0})))}if(m==null&&(m={data:[],index:0}),A===null&&(A=Gm(),Bn.updateQueue=A),A.memoCache=m,A=m.data[m.index],A===void 0)for(A=m.data[m.index]=Array(d),C=0;C<d;C++)A[C]=C_;return m.index++,A}function de(d,m){return typeof m=="function"?m(d):m}function Ke(d){var m=Y();return et(m,gi,d)}function et(d,m,A){var C=d.queue;if(C===null)throw Error(i(311));C.lastRenderedReducer=A;var w=d.baseQueue,F=C.pending;if(F!==null){if(w!==null){var ee=w.next;w.next=F.next,F.next=ee}m.baseQueue=w=F,C.pending=null}if(F=d.baseState,w===null)d.memoizedState=F;else{m=w.next;var ge=ee=null,Le=null,ot=m,Ct=!1;do{var kt=ot.lane&-536870913;if(kt!==ot.lane?(Fn&kt)===kt:(rl&kt)===kt){var Xt=ot.revertLane;if(Xt===0)Le!==null&&(Le=Le.next={lane:0,revertLane:0,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null}),kt===jr&&(Ct=!0);else if((rl&Xt)===Xt){ot=ot.next,Xt===jr&&(Ct=!0);continue}else kt={lane:0,revertLane:ot.revertLane,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null},Le===null?(ge=Le=kt,ee=F):Le=Le.next=kt,Bn.lanes|=Xt,ba|=Xt;kt=ot.action,Vl&&A(F,kt),F=ot.hasEagerState?ot.eagerState:A(F,kt)}else Xt={lane:kt,revertLane:ot.revertLane,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null},Le===null?(ge=Le=Xt,ee=F):Le=Le.next=Xt,Bn.lanes|=kt,ba|=kt;ot=ot.next}while(ot!==null&&ot!==m);if(Le===null?ee=F:Le.next=ge,!ga(F,d.memoizedState)&&(ps=!0,Ct&&(A=kc,A!==null)))throw A;d.memoizedState=F,d.baseState=ee,d.baseQueue=Le,C.lastRenderedState=F}return w===null&&(C.lanes=0),[d.memoizedState,C.dispatch]}function pt(d){var m=Y(),A=m.queue;if(A===null)throw Error(i(311));A.lastRenderedReducer=d;var C=A.dispatch,w=A.pending,F=m.memoizedState;if(w!==null){A.pending=null;var ee=w=w.next;do F=d(F,ee.action),ee=ee.next;while(ee!==w);ga(F,m.memoizedState)||(ps=!0),m.memoizedState=F,m.baseQueue===null&&(m.baseState=F),A.lastRenderedState=F}return[F,C]}function xt(d,m,A){var C=Bn,w=Y(),F=li;if(F){if(A===void 0)throw Error(i(407));A=A()}else A=m();var ee=!ga((gi||w).memoizedState,A);if(ee&&(w.memoizedState=A,ps=!0),w=w.queue,Xh(Bt.bind(null,C,w,d),[d]),w.getSnapshot!==m||ee||ds!==null&&ds.memoizedState.tag&1){if(C.flags|=2048,es(9,Pt.bind(null,C,w,A,m),{destroy:void 0},null),Hn===null)throw Error(i(349));F||(rl&60)!==0||Lt(C,m,A)}return A}function Lt(d,m,A){d.flags|=16384,d={getSnapshot:m,value:A},m=Bn.updateQueue,m===null?(m=Gm(),Bn.updateQueue=m,m.stores=[d]):(A=m.stores,A===null?m.stores=[d]:A.push(d))}function Pt(d,m,A,C){m.value=A,m.getSnapshot=C,Kt(m)&&bn(d)}function Bt(d,m,A){return A(function(){Kt(m)&&bn(d)})}function Kt(d){var m=d.getSnapshot;d=d.value;try{var A=m();return!ga(d,A)}catch{return!0}}function bn(d){var m=ue(d,2);m!==null&&hr(m,d,2)}function nn(d){var m=ct();if(typeof d=="function"){var A=d;if(d=A(),Vl){j(!0);try{A()}finally{j(!1)}}}return m.memoizedState=m.baseState=d,m.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:de,lastRenderedState:d},m}function fn(d,m,A,C){return d.baseState=A,et(d,gi,typeof C=="function"?C:de)}function Nn(d,m,A,C,w){if(mu(d))throw Error(i(485));if(d=m.action,d!==null){var F={payload:w,action:d,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ee){F.listeners.push(ee)}};gn.T!==null?A(!0):F.isTransition=!1,C(F),A=m.pending,A===null?(F.next=m.pending=F,sn(m,F)):(F.next=A.next,m.pending=A.next=F)}}function sn(d,m){var A=m.action,C=m.payload,w=d.state;if(m.isTransition){var F=gn.T,ee={};gn.T=ee;try{var ge=A(w,C),Le=gn.S;Le!==null&&Le(ee,ge),In(d,m,ge)}catch(ot){zn(d,m,ot)}finally{gn.T=F}}else try{F=A(w,C),In(d,m,F)}catch(ot){zn(d,m,ot)}}function In(d,m,A){A!==null&&typeof A=="object"&&typeof A.then=="function"?A.then(function(C){Qt(d,m,C)},function(C){return zn(d,m,C)}):Qt(d,m,A)}function Qt(d,m,A){m.status="fulfilled",m.value=A,ni(m),d.state=A,m=d.pending,m!==null&&(A=m.next,A===m?d.pending=null:(A=A.next,m.next=A,sn(d,A)))}function zn(d,m,A){var C=d.pending;if(d.pending=null,C!==null){C=C.next;do m.status="rejected",m.reason=A,ni(m),m=m.next;while(m!==C)}d.action=null}function ni(d){d=d.listeners;for(var m=0;m<d.length;m++)(0,d[m])()}function ln(d,m){return m}function Ji(d,m){if(li){var A=Hn.formState;if(A!==null){e:{var C=Bn;if(li){if(Zs){var w=O_(Zs,qa);if(w){Zs=Rv(w),C=P_(w);break e}}je(C)}C=!1}C&&(m=A[0])}}A=ct(),A.memoizedState=A.baseState=m,C={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ln,lastRenderedState:m},A.queue=C,A=$p.bind(null,Bn,C),C.dispatch=A,C=nn(!1);var F=Qp.bind(null,Bn,!1,C.queue);return C=ct(),w={state:m,dispatch:null,action:d,pending:null},C.queue=w,A=Nn.bind(null,Bn,w,F,A),w.dispatch=A,C.memoizedState=d,[m,A,!1]}function $n(d){var m=Y();return oi(m,gi,d)}function oi(d,m,A){m=et(d,m,ln)[0],d=Ke(de)[0],m=typeof m=="object"&&m!==null&&typeof m.then=="function"?ce(m):m;var C=Y(),w=C.queue,F=w.dispatch;return A!==C.memoizedState&&(Bn.flags|=2048,es(9,Ri.bind(null,w,A),{destroy:void 0},null)),[m,F,d]}function Ri(d,m){d.action=m}function Ds(d){var m=Y(),A=gi;if(A!==null)return oi(m,A,d);Y(),m=m.memoizedState,A=Y();var C=A.queue.dispatch;return A.memoizedState=d,[m,C,!1]}function es(d,m,A,C){return d={tag:d,create:m,inst:A,deps:C,next:null},m=Bn.updateQueue,m===null&&(m=Gm(),Bn.updateQueue=m),A=m.lastEffect,A===null?m.lastEffect=d.next=d:(C=A.next,A.next=d,d.next=C,m.lastEffect=d),d}function po(){return Y().memoizedState}function Va(d,m,A,C){var w=ct();Bn.flags|=d,w.memoizedState=es(1|m,A,{destroy:void 0},C===void 0?null:C)}function Yh(d,m,A,C){var w=Y();C=C===void 0?null:C;var F=w.memoizedState.inst;gi!==null&&C!==null&&V(C,gi.memoizedState.deps)?w.memoizedState=es(m,A,F,C):(Bn.flags|=d,w.memoizedState=es(1|m,A,F,C))}function wg(d,m){Va(8390656,8,d,m)}function Xh(d,m){Yh(2048,8,d,m)}function n_(d,m){return Yh(4,2,d,m)}function i_(d,m){return Yh(4,4,d,m)}function Kh(d,m){if(typeof m=="function"){d=d();var A=m(d);return function(){typeof A=="function"?A():m(null)}}if(m!=null)return d=d(),m.current=d,function(){m.current=null}}function Yo(d,m,A){A=A!=null?A.concat([d]):null,Yh(4,4,Kh.bind(null,m,d),A)}function qh(){}function jp(d,m){var A=Y();m=m===void 0?null:m;var C=A.memoizedState;return m!==null&&V(m,C[1])?C[0]:(A.memoizedState=[d,m],d)}function du(d,m){var A=Y();m=m===void 0?null:m;var C=A.memoizedState;if(m!==null&&V(m,C[1]))return C[0];if(C=d(),Vl){j(!0);try{d()}finally{j(!1)}}return A.memoizedState=[C,m],C}function dc(d,m,A){return A===void 0||(rl&1073741824)!==0?d.memoizedState=m:(d.memoizedState=A,d=qo(),Bn.lanes|=d,ba|=d,A)}function Ig(d,m,A,C){return ga(A,m)?A:sl.current!==null?(d=dc(d,A,C),ga(d,m)||(ps=!0),d):(rl&42)===0?(ps=!0,d.memoizedState=A):(d=qo(),Bn.lanes|=d,ba|=d,m)}function Wp(d,m,A,C,w){var F=Ls();pr(F!==0&&8>F?F:8);var ee=gn.T,ge={};gn.T=ge,Qp(d,!1,m,A);try{var Le=w(),ot=gn.S;if(ot!==null&&ot(ge,Le),Le!==null&&typeof Le=="object"&&typeof Le.then=="function"){var Ct=bt(Le,C);mc(d,m,Ct,Lr(d))}else mc(d,m,C,Lr(d))}catch(kt){mc(d,m,{then:function(){},status:"rejected",reason:kt},Lr())}finally{pr(F),gn.T=ee}}function Bg(d){var m=d.memoizedState;if(m!==null)return m;m={memoizedState:Xr,baseState:Xr,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:de,lastRenderedState:Xr},next:null};var A={};return m.next={memoizedState:A,baseState:A,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:de,lastRenderedState:A},next:null},d.memoizedState=m,d=d.alternate,d!==null&&(d.memoizedState=m),m}function pu(){return js(_n)}function Xo(){return Y().memoizedState}function Jp(){return Y().memoizedState}function jh(d){for(var m=d.return;m!==null;){switch(m.tag){case 24:case 3:var A=Lr();d=Ze(A);var C=Je(m,d,A);C!==null&&(hr(C,m,A),Nt(C,m,A)),m={cache:im()},d.payload=m;return}m=m.return}}function pc(d,m,A){var C=Lr();A={lane:C,revertLane:0,action:A,hasEagerState:!1,eagerState:null,next:null},mu(d)?Wh(m,A):(A=Oe(d,m,A,C),A!==null&&(hr(A,d,C),Og(A,m,C)))}function $p(d,m,A){var C=Lr();mc(d,m,A,C)}function mc(d,m,A,C){var w={lane:C,revertLane:0,action:A,hasEagerState:!1,eagerState:null,next:null};if(mu(d))Wh(m,w);else{var F=d.alternate;if(d.lanes===0&&(F===null||F.lanes===0)&&(F=m.lastRenderedReducer,F!==null))try{var ee=m.lastRenderedState,ge=F(ee,A);if(w.hasEagerState=!0,w.eagerState=ge,ga(ge,ee))return ie(d,m,w,0),Hn===null&&ze(),!1}catch{}finally{}if(A=Oe(d,m,w,C),A!==null)return hr(A,d,C),Og(A,m,C),!0}return!1}function Qp(d,m,A,C){if(C={lane:2,revertLane:Ve(),action:C,hasEagerState:!1,eagerState:null,next:null},mu(d)){if(m)throw Error(i(479))}else m=Oe(d,A,C,2),m!==null&&hr(m,d,2)}function mu(d){var m=d.alternate;return d===Bn||m!==null&&m===Bn}function Wh(d,m){Yi=Ja=!0;var A=d.pending;A===null?m.next=m:(m.next=A.next,A.next=m),d.pending=m}function Og(d,m,A){if((A&4194176)!==0){var C=m.lanes;C&=d.pendingLanes,A|=C,m.lanes=A,te(d,A)}}function ur(d,m,A,C){m=d.memoizedState,A=A(C,m),A=A==null?m:Tu({},m,A),d.memoizedState=A,d.lanes===0&&(d.updateQueue.baseState=A)}function gc(d,m,A,C,w,F,ee){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(C,F,ee):m.prototype&&m.prototype.isPureReactComponent?!ht(A,C)||!ht(w,F):!0}function Jh(d,m,A,C){d=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(A,C),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(A,C),m.state!==d&&Hm.enqueueReplaceState(m,m.state,null)}function mo(d,m){var A=m;if("ref"in m){A={};for(var C in m)C!=="ref"&&(A[C]=m[C])}if(d=d.defaultProps){A===m&&(A=Tu({},A));for(var w in d)A[w]===void 0&&(A[w]=d[w])}return A}function Zp(d,m){try{var A=d.onUncaughtError;A(m.value,{componentStack:m.stack})}catch(C){setTimeout(function(){throw C})}}function em(d,m,A){try{var C=d.onCaughtError;C(A.value,{componentStack:A.stack,errorBoundary:m.tag===1?m.stateNode:null})}catch(w){setTimeout(function(){throw w})}}function $h(d,m,A){return A=Ze(A),A.tag=3,A.payload={element:null},A.callback=function(){Zp(d,m)},A}function xf(d){return d=Ze(d),d.tag=3,d}function Qh(d,m,A,C){var w=A.type.getDerivedStateFromError;if(typeof w=="function"){var F=C.value;d.payload=function(){return w(F)},d.callback=function(){em(m,A,C)}}var ee=A.stateNode;ee!==null&&typeof ee.componentDidCatch=="function"&&(d.callback=function(){em(m,A,C),typeof w!="function"&&(Ma===null?Ma=new Set([this]):Ma.add(this));var ge=C.stack;this.componentDidCatch(C.value,{componentStack:ge!==null?ge:""})})}function s_(d,m,A,C,w){if(A.flags|=32768,C!==null&&typeof C=="object"&&typeof C.then=="function"){if(m=A.alternate,m!==null&&gu(m,A,w,!0),A=Aa.current,A!==null){switch(A.tag){case 13:return Wa===null?Yr():A.alternate===null&&si===0&&(si=3),A.flags&=-257,A.flags|=65536,A.lanes=w,C===km?A.flags|=16384:(m=A.updateQueue,m===null?A.updateQueue=new Set([C]):m.add(C),vm(d,C,w)),!1;case 22:return A.flags|=65536,C===km?A.flags|=16384:(m=A.updateQueue,m===null?(m={transitions:null,markerInstances:null,retryQueue:new Set([C])},A.updateQueue=m):(A=m.retryQueue,A===null?m.retryQueue=new Set([C]):A.add(C)),vm(d,C,w)),!1}throw Error(i(435,A.tag))}return vm(d,C,w),Yr(),!1}if(li)return m=Aa.current,m!==null?((m.flags&65536)===0&&(m.flags|=256),m.flags|=65536,m.lanes=w,C!==Cd&&(d=Error(i(422),{cause:C}),vt(oe(d,A)))):(C!==Cd&&(m=Error(i(423),{cause:C}),vt(oe(m,A))),d=d.current.alternate,d.flags|=65536,w&=-w,d.lanes|=w,C=oe(C,A),w=$h(d.stateNode,C,w),he(d,w),si!==4&&(si=2)),!1;var F=Error(i(520),{cause:C});if(F=oe(F,A),jf===null?jf=[F]:jf.push(F),si!==4&&(si=2),m===null)return!0;C=oe(C,A),A=m;do{switch(A.tag){case 3:return A.flags|=65536,d=w&-w,A.lanes|=d,d=$h(A.stateNode,C,d),he(A,d),!1;case 1:if(m=A.type,F=A.stateNode,(A.flags&128)===0&&(typeof m.getDerivedStateFromError=="function"||F!==null&&typeof F.componentDidCatch=="function"&&(Ma===null||!Ma.has(F))))return A.flags|=65536,w&=-w,A.lanes|=w,w=xf(w),Qh(w,d,A,C),he(A,w),!1}A=A.return}while(A!==null);return!1}function qs(d,m,A,C){m.child=d===null?Vv(m,null,A,C):Gc(m,d.child,A,C)}function r_(d,m,A,C,w){A=A.render;var F=m.ref;if("ref"in C){var ee={};for(var ge in C)ge!=="ref"&&(ee[ge]=C[ge])}else ee=C;return vu(m),C=$(d,m,A,ee,F,w),ge=Xe(),d!==null&&!ps?(dt(d,m,w),Rl(d,m,w)):(li&&ge&&ne(m),m.flags|=1,qs(d,m,C,w),m.child)}function a_(d,m,A,C,w){if(d===null){var F=A.type;return typeof F=="function"&&!Ol(F)&&F.defaultProps===void 0&&A.compare===null?(m.tag=15,m.type=F,tm(d,m,F,C,w)):(d=Ya(A.type,null,C,m,m.mode,w),d.ref=m.ref,d.return=m,m.child=d)}if(F=d.child,!Hg(d,w)){var ee=F.memoizedProps;if(A=A.compare,A=A!==null?A:ht,A(ee,C)&&d.ref===m.ref)return Rl(d,m,w)}return m.flags|=1,d=dr(F,C),d.ref=m.ref,d.return=m,m.child=d}function tm(d,m,A,C,w){if(d!==null){var F=d.memoizedProps;if(ht(F,C)&&d.ref===m.ref)if(ps=!1,m.pendingProps=C=F,Hg(d,w))(d.flags&131072)!==0&&(ps=!0);else return m.lanes=d.lanes,Rl(d,m,w)}return Pg(d,m,A,C,w)}function o_(d,m,A){var C=m.pendingProps,w=C.children,F=(m.stateNode._pendingVisibility&2)!==0,ee=d!==null?d.memoizedState:null;if(Zh(d,m),C.mode==="hidden"||F){if((m.flags&128)!==0){if(C=ee!==null?ee.baseLanes|A:A,d!==null){for(w=m.child=d.child,F=0;w!==null;)F=F|w.lanes|w.childLanes,w=w.sibling;m.childLanes=F&~C}else m.childLanes=0,m.child=null;return l_(d,m,C,A)}if((A&536870912)!==0)m.memoizedState={baseLanes:0,cachePool:null},d!==null&&sm(m,ee!==null?ee.cachePool:null),ee!==null?It(m,ee):pn(),ai(m);else return m.lanes=m.childLanes=536870912,l_(d,m,ee!==null?ee.baseLanes|A:A,A)}else ee!==null?(sm(m,ee.cachePool),It(m,ee),hn(),m.memoizedState=null):(d!==null&&sm(m,null),pn(),hn());return qs(d,m,w,A),m.child}function l_(d,m,A,C){var w=xc();return w=w===null?null:{parent:Zo?_i._currentValue:_i._currentValue2,pool:w},m.memoizedState={baseLanes:A,cachePool:w},d!==null&&sm(m,null),pn(),ai(m),d!==null&&gu(d,m,C,!0),null}function Zh(d,m){var A=m.ref;if(A===null)d!==null&&d.ref!==null&&(m.flags|=2097664);else{if(typeof A!="function"&&typeof A!="object")throw Error(i(284));(d===null||d.ref!==A)&&(m.flags|=2097664)}}function Pg(d,m,A,C,w){return vu(m),A=$(d,m,A,C,void 0,w),C=Xe(),d!==null&&!ps?(dt(d,m,w),Rl(d,m,w)):(li&&C&&ne(m),m.flags|=1,qs(d,m,A,w),m.child)}function c_(d,m,A,C,w,F){return vu(m),m.updateQueue=null,A=De(m,C,A,w),me(d),C=Xe(),d!==null&&!ps?(dt(d,m,F),Rl(d,m,F)):(li&&C&&ne(m),m.flags|=1,qs(d,m,A,F),m.child)}function Ng(d,m,A,C,w){if(vu(m),m.stateNode===null){var F=Lu,ee=A.contextType;typeof ee=="object"&&ee!==null&&(F=js(ee)),F=new A(C,F),m.memoizedState=F.state!==null&&F.state!==void 0?F.state:null,F.updater=Hm,m.stateNode=F,F._reactInternals=m,F=m.stateNode,F.props=C,F.state=m.memoizedState,F.refs={},Ft(m),ee=A.contextType,F.context=typeof ee=="object"&&ee!==null?js(ee):Lu,F.state=m.memoizedState,ee=A.getDerivedStateFromProps,typeof ee=="function"&&(ur(m,A,ee,C),F.state=m.memoizedState),typeof A.getDerivedStateFromProps=="function"||typeof F.getSnapshotBeforeUpdate=="function"||typeof F.UNSAFE_componentWillMount!="function"&&typeof F.componentWillMount!="function"||(ee=F.state,typeof F.componentWillMount=="function"&&F.componentWillMount(),typeof F.UNSAFE_componentWillMount=="function"&&F.UNSAFE_componentWillMount(),ee!==F.state&&Hm.enqueueReplaceState(F,F.state,null),tt(m,C,F,w),Ce(),F.state=m.memoizedState),typeof F.componentDidMount=="function"&&(m.flags|=4194308),C=!0}else if(d===null){F=m.stateNode;var ge=m.memoizedProps,Le=mo(A,ge);F.props=Le;var ot=F.context,Ct=A.contextType;ee=Lu,typeof Ct=="object"&&Ct!==null&&(ee=js(Ct));var kt=A.getDerivedStateFromProps;Ct=typeof kt=="function"||typeof F.getSnapshotBeforeUpdate=="function",ge=m.pendingProps!==ge,Ct||typeof F.UNSAFE_componentWillReceiveProps!="function"&&typeof F.componentWillReceiveProps!="function"||(ge||ot!==ee)&&Jh(m,F,C,ee),zl=!1;var Xt=m.memoizedState;F.state=Xt,tt(m,C,F,w),Ce(),ot=m.memoizedState,ge||Xt!==ot||zl?(typeof kt=="function"&&(ur(m,A,kt,C),ot=m.memoizedState),(Le=zl||gc(m,A,Le,C,Xt,ot,ee))?(Ct||typeof F.UNSAFE_componentWillMount!="function"&&typeof F.componentWillMount!="function"||(typeof F.componentWillMount=="function"&&F.componentWillMount(),typeof F.UNSAFE_componentWillMount=="function"&&F.UNSAFE_componentWillMount()),typeof F.componentDidMount=="function"&&(m.flags|=4194308)):(typeof F.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=C,m.memoizedState=ot),F.props=C,F.state=ot,F.context=ee,C=Le):(typeof F.componentDidMount=="function"&&(m.flags|=4194308),C=!1)}else{F=m.stateNode,Mt(d,m),ee=m.memoizedProps,Ct=mo(A,ee),F.props=Ct,kt=m.pendingProps,Xt=F.context,ot=A.contextType,Le=Lu,typeof ot=="object"&&ot!==null&&(Le=js(ot)),ge=A.getDerivedStateFromProps,(ot=typeof ge=="function"||typeof F.getSnapshotBeforeUpdate=="function")||typeof F.UNSAFE_componentWillReceiveProps!="function"&&typeof F.componentWillReceiveProps!="function"||(ee!==kt||Xt!==Le)&&Jh(m,F,C,Le),zl=!1,Xt=m.memoizedState,F.state=Xt,tt(m,C,F,w),Ce();var Tn=m.memoizedState;ee!==kt||Xt!==Tn||zl||d!==null&&d.dependencies!==null&&yc(d.dependencies)?(typeof ge=="function"&&(ur(m,A,ge,C),Tn=m.memoizedState),(Ct=zl||gc(m,A,Ct,C,Xt,Tn,Le)||d!==null&&d.dependencies!==null&&yc(d.dependencies))?(ot||typeof F.UNSAFE_componentWillUpdate!="function"&&typeof F.componentWillUpdate!="function"||(typeof F.componentWillUpdate=="function"&&F.componentWillUpdate(C,Tn,Le),typeof F.UNSAFE_componentWillUpdate=="function"&&F.UNSAFE_componentWillUpdate(C,Tn,Le)),typeof F.componentDidUpdate=="function"&&(m.flags|=4),typeof F.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof F.componentDidUpdate!="function"||ee===d.memoizedProps&&Xt===d.memoizedState||(m.flags|=4),typeof F.getSnapshotBeforeUpdate!="function"||ee===d.memoizedProps&&Xt===d.memoizedState||(m.flags|=1024),m.memoizedProps=C,m.memoizedState=Tn),F.props=C,F.state=Tn,F.context=Le,C=Ct):(typeof F.componentDidUpdate!="function"||ee===d.memoizedProps&&Xt===d.memoizedState||(m.flags|=4),typeof F.getSnapshotBeforeUpdate!="function"||ee===d.memoizedProps&&Xt===d.memoizedState||(m.flags|=1024),C=!1)}return F=C,Zh(d,m),C=(m.flags&128)!==0,F||C?(F=m.stateNode,A=C&&typeof A.getDerivedStateFromError!="function"?null:F.render(),m.flags|=1,d!==null&&C?(m.child=Gc(m,d.child,null,w),m.child=Gc(m,null,A,w)):qs(d,m,A,w),m.memoizedState=F.state,d=m.child):d=Rl(d,m,w),d}function u_(d,m,A,C){return jt(),m.flags|=256,qs(d,m,A,C),m.child}function Ug(d){return{baseLanes:d,cachePool:m_()}}function Fg(d,m,A){return d=d!==null?d.childLanes&~A:0,m&&(d|=$r),d}function f_(d,m,A){var C=m.pendingProps,w=!1,F=(m.flags&128)!==0,ee;if((ee=F)||(ee=d!==null&&d.memoizedState===null?!1:(bs.current&2)!==0),ee&&(w=!0,m.flags&=-129),ee=(m.flags&32)!==0,m.flags&=-33,d===null){if(li){if(w?$t(m):hn(),li){var ge=Zs,Le;(Le=ge)&&(ge=G_(ge,qa),ge!==null?(m.memoizedState={dehydrated:ge,treeContext:_o!==null?{id:nl,overflow:Ka}:null,retryLane:536870912},Le=t(18,null,null,0),Le.stateNode=ge,Le.return=m,m.child=Le,mr=m,Zs=null,Le=!0):Le=!1),Le||je(m)}if(ge=m.memoizedState,ge!==null&&(ge=ge.dehydrated,ge!==null))return xd(ge)?m.lanes=16:m.lanes=536870912,null;Yt(m)}return ge=C.children,C=C.fallback,w?(hn(),w=m.mode,ge=kg({mode:"hidden",children:ge},w),C=Nl(C,w,A,null),ge.return=m,C.return=m,ge.sibling=C,m.child=ge,w=m.child,w.memoizedState=Ug(A),w.childLanes=Fg(d,ee,A),m.memoizedState=vr,C):($t(m),ed(m,ge))}if(Le=d.memoizedState,Le!==null&&(ge=Le.dehydrated,ge!==null)){if(F)m.flags&256?($t(m),m.flags&=-257,m=Gg(d,m,A)):m.memoizedState!==null?(hn(),m.child=d.child,m.flags|=128,m=null):(hn(),w=C.fallback,ge=m.mode,C=kg({mode:"visible",children:C.children},ge),w=Nl(w,ge,A,null),w.flags|=2,C.return=m,w.return=m,C.sibling=w,m.child=C,Gc(m,d.child,null,A),C=m.child,C.memoizedState=Ug(A),C.childLanes=Fg(d,ee,A),m.memoizedState=vr,m=w);else if($t(m),xd(ge))ee=B_(ge).digest,C=Error(i(419)),C.stack="",C.digest=ee,vt({value:C,source:null,stack:null}),m=Gg(d,m,A);else if(ps||gu(d,m,A,!1),ee=(A&d.childLanes)!==0,ps||ee){if(ee=Hn,ee!==null){if(C=A&-A,(C&42)!==0)C=1;else switch(C){case 2:C=1;break;case 8:C=4;break;case 32:C=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:C=64;break;case 268435456:C=134217728;break;default:C=0}if(C=(C&(ee.suspendedLanes|A))!==0?0:C,C!==0&&C!==Le.retryLane)throw Le.retryLane=C,ue(d,C),hr(ee,d,C),tS}Dm(ge)||Yr(),m=Gg(d,m,A)}else Dm(ge)?(m.flags|=128,m.child=d.child,m=Eu.bind(null,d),PT(ge,m),m=null):(d=Le.treeContext,wr&&(Zs=U_(ge),mr=m,li=!0,xa=null,qa=!1,d!==null&&(va[ya++]=nl,va[ya++]=Ka,va[ya++]=_o,nl=d.id,Ka=d.overflow,_o=m)),m=ed(m,C.children),m.flags|=4096);return m}return w?(hn(),w=C.fallback,ge=m.mode,Le=d.child,F=Le.sibling,C=dr(Le,{mode:"hidden",children:C.children}),C.subtreeFlags=Le.subtreeFlags&31457280,F!==null?w=dr(F,w):(w=Nl(w,ge,A,null),w.flags|=2),w.return=m,C.return=m,C.sibling=w,m.child=C,C=w,w=m.child,ge=d.child.memoizedState,ge===null?ge=Ug(A):(Le=ge.cachePool,Le!==null?(F=Zo?_i._currentValue:_i._currentValue2,Le=Le.parent!==F?{parent:F,pool:F}:Le):Le=m_(),ge={baseLanes:ge.baseLanes|A,cachePool:Le}),w.memoizedState=ge,w.childLanes=Fg(d,ee,A),m.memoizedState=vr,C):($t(m),A=d.child,d=A.sibling,A=dr(A,{mode:"visible",children:C.children}),A.return=m,A.sibling=null,d!==null&&(ee=m.deletions,ee===null?(m.deletions=[d],m.flags|=16):ee.push(d)),m.child=A,m.memoizedState=null,A)}function ed(d,m){return m=kg({mode:"visible",children:m},d.mode),m.return=d,d.child=m}function kg(d,m){return ym(d,m,0,null)}function Gg(d,m,A){return Gc(m,d.child,null,A),d=ed(m,m.pendingProps.children),d.flags|=2,m.memoizedState=null,d}function h_(d,m,A){d.lanes|=m;var C=d.alternate;C!==null&&(C.lanes|=m),zg(d.return,m,A)}function nm(d,m,A,C,w){var F=d.memoizedState;F===null?d.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:C,tail:A,tailMode:w}:(F.isBackwards=m,F.rendering=null,F.renderingStartTime=0,F.last=C,F.tail=A,F.tailMode=w)}function d_(d,m,A){var C=m.pendingProps,w=C.revealOrder,F=C.tail;if(qs(d,m,C.children,A),C=bs.current,(C&2)!==0)C=C&1|2,m.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=m.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&h_(d,A,m);else if(d.tag===19)h_(d,A,m);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===m)break e;for(;d.sibling===null;){if(d.return===null||d.return===m)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}C&=1}switch(T(bs,C),w){case"forwards":for(A=m.child,w=null;A!==null;)d=A.alternate,d!==null&&Xn(d)===null&&(w=A),A=A.sibling;A=w,A===null?(w=m.child,m.child=null):(w=A.sibling,A.sibling=null),nm(m,!1,w,A,F);break;case"backwards":for(A=null,w=m.child,m.child=null;w!==null;){if(d=w.alternate,d!==null&&Xn(d)===null){m.child=w;break}d=w.sibling,w.sibling=A,A=w,w=d}nm(m,!0,A,null,F);break;case"together":nm(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function Rl(d,m,A){if(d!==null&&(m.dependencies=d.dependencies),ba|=m.lanes,(A&m.childLanes)===0)if(d!==null){if(gu(d,m,A,!1),(A&m.childLanes)===0)return null}else return null;if(d!==null&&m.child!==d.child)throw Error(i(153));if(m.child!==null){for(d=m.child,A=dr(d,d.pendingProps),m.child=A,A.return=m;d.sibling!==null;)d=d.sibling,A=A.sibling=dr(d,d.pendingProps),A.return=m;A.sibling=null}return m.child}function Hg(d,m){return(d.lanes&m)!==0?!0:(d=d.dependencies,!!(d!==null&&yc(d)))}function IT(d,m,A){switch(m.tag){case 3:_e(m,m.stateNode.containerInfo),vc(m,_i,d.memoizedState.cache),jt();break;case 27:case 5:pe(m);break;case 4:_e(m,m.stateNode.containerInfo);break;case 10:vc(m,m.type,m.memoizedProps.value);break;case 13:var C=m.memoizedState;if(C!==null)return C.dehydrated!==null?($t(m),m.flags|=128,null):(A&m.child.childLanes)!==0?f_(d,m,A):($t(m),d=Rl(d,m,A),d!==null?d.sibling:null);$t(m);break;case 19:var w=(d.flags&128)!==0;if(C=(A&m.childLanes)!==0,C||(gu(d,m,A,!1),C=(A&m.childLanes)!==0),w){if(C)return d_(d,m,A);m.flags|=128}if(w=m.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),T(bs,bs.current),C)break;return null;case 22:case 23:return m.lanes=0,o_(d,m,A);case 24:vc(m,_i,d.memoizedState.cache)}return Rl(d,m,A)}function p_(d,m,A){if(d!==null)if(d.memoizedProps!==m.pendingProps)ps=!0;else{if(!Hg(d,A)&&(m.flags&128)===0)return ps=!1,IT(d,m,A);ps=(d.flags&131072)!==0}else ps=!1,li&&(m.flags&1048576)!==0&&X(m,Td,m.index);switch(m.lanes=0,m.tag){case 16:e:{d=m.pendingProps;var C=m.elementType,w=C._init;if(C=w(C._payload),m.type=C,typeof C=="function")Ol(C)?(d=mo(C,d),m.tag=1,m=Ng(null,m,C,d,A)):(m.tag=0,m=Pg(null,m,C,d,A));else{if(C!=null){if(w=C.$$typeof,w===Pf){m.tag=11,m=r_(null,m,C,d,A);break e}else if(w===fd){m.tag=14,m=a_(null,m,C,d,A);break e}}throw m=a(C)||C,Error(i(306,m,""))}}return m;case 0:return Pg(d,m,m.type,m.pendingProps,A);case 1:return C=m.type,w=mo(C,m.pendingProps),Ng(d,m,C,w,A);case 3:e:{if(_e(m,m.stateNode.containerInfo),d===null)throw Error(i(387));var F=m.pendingProps;w=m.memoizedState,C=w.element,Mt(d,m),tt(m,F,null,A);var ee=m.memoizedState;if(F=ee.cache,vc(m,_i,F),F!==w.cache&&Vg(m,[_i],A,!0),Ce(),F=ee.element,wr&&w.isDehydrated)if(w={element:F,isDehydrated:!1,cache:ee.cache},m.updateQueue.baseState=w,m.memoizedState=w,m.flags&256){m=u_(d,m,F,A);break e}else if(F!==C){C=oe(Error(i(424)),m),vt(C),m=u_(d,m,F,A);break e}else for(wr&&(Zs=N_(m.stateNode.containerInfo),mr=m,li=!0,xa=null,qa=!0),A=Vv(m,null,F,A),m.child=A;A;)A.flags=A.flags&-3|4096,A=A.sibling;else{if(jt(),F===C){m=Rl(d,m,A);break e}qs(d,m,F,A)}m=m.child}return m;case 26:if(ma)return Zh(d,m),d===null?(A=Om(m.type,null,m.pendingProps,null))?m.memoizedState=A:li||(m.stateNode=UT(m.type,m.pendingProps,So.current,m)):m.memoizedState=Om(m.type,d.memoizedProps,m.pendingProps,d.memoizedState),null;case 27:if($s)return pe(m),d===null&&$s&&li&&(C=m.stateNode=kv(m.type,m.pendingProps,So.current,zs.current,!1),mr=m,qa=!0,Zs=Lm(C)),C=m.pendingProps.children,d!==null||li?qs(d,m,C,A):m.child=Gc(m,null,C,A),Zh(d,m),m.child;case 5:return d===null&&li&&(X_(m.type,m.pendingProps,zs.current),(w=C=Zs)&&(C=F_(C,m.type,m.pendingProps,qa),C!==null?(m.stateNode=C,mr=m,Zs=Lm(C),qa=!1,w=!0):w=!1),w||je(m)),pe(m),w=m.type,F=m.pendingProps,ee=d!==null?d.memoizedProps:null,C=F.children,Pc(w,F)?C=null:ee!==null&&Pc(w,ee)&&(m.flags|=32),m.memoizedState!==null&&(w=$(d,m,Ye,null,null,A),Zo?_n._currentValue=w:_n._currentValue2=w),Zh(d,m),qs(d,m,C,A),m.child;case 6:return d===null&&li&&(K_(m.pendingProps,zs.current),(d=A=Zs)&&(A=k_(A,m.pendingProps,qa),A!==null?(m.stateNode=A,mr=m,Zs=null,d=!0):d=!1),d||je(m)),null;case 13:return f_(d,m,A);case 4:return _e(m,m.stateNode.containerInfo),C=m.pendingProps,d===null?m.child=Gc(m,null,C,A):qs(d,m,C,A),m.child;case 11:return r_(d,m,m.type,m.pendingProps,A);case 7:return qs(d,m,m.pendingProps,A),m.child;case 8:return qs(d,m,m.pendingProps.children,A),m.child;case 12:return qs(d,m,m.pendingProps.children,A),m.child;case 10:return C=m.pendingProps,vc(m,m.type,C.value),qs(d,m,C.children,A),m.child;case 9:return w=m.type._context,C=m.pendingProps.children,vu(m),w=js(w),C=C(w),m.flags|=1,qs(d,m,C,A),m.child;case 14:return a_(d,m,m.type,m.pendingProps,A);case 15:return tm(d,m,m.type,m.pendingProps,A);case 19:return d_(d,m,A);case 22:return o_(d,m,A);case 24:return vu(m),C=js(_i),d===null?(w=xc(),w===null&&(w=Hn,F=im(),w.pooledCache=F,F.refCount++,F!==null&&(w.pooledCacheLanes|=A),w=F),m.memoizedState={parent:C,cache:w},Ft(m),vc(m,_i,w)):((d.lanes&A)!==0&&(Mt(d,m),tt(m,null,null,A),Ce()),w=d.memoizedState,F=m.memoizedState,w.parent!==C?(w={parent:C,cache:C},m.memoizedState=w,m.lanes===0&&(m.memoizedState=m.updateQueue.baseState=w),vc(m,_i,C)):(C=F.cache,vc(m,_i,C),C!==w.cache&&Vg(m,[_i],A,!0))),qs(d,m,m.pendingProps.children,A),m.child;case 29:throw m.pendingProps}throw Error(i(156,m.tag))}function vc(d,m,A){Zo?(T(Wr,m._currentValue),m._currentValue=A):(T(Wr,m._currentValue2),m._currentValue2=A)}function Dl(d){var m=Wr.current;Zo?d._currentValue=m:d._currentValue2=m,b(Wr)}function zg(d,m,A){for(;d!==null;){var C=d.alternate;if((d.childLanes&m)!==m?(d.childLanes|=m,C!==null&&(C.childLanes|=m)):C!==null&&(C.childLanes&m)!==m&&(C.childLanes|=m),d===A)break;d=d.return}}function Vg(d,m,A,C){var w=d.child;for(w!==null&&(w.return=d);w!==null;){var F=w.dependencies;if(F!==null){var ee=w.child;F=F.firstContext;e:for(;F!==null;){var ge=F;F=w;for(var Le=0;Le<m.length;Le++)if(ge.context===m[Le]){F.lanes|=A,ge=F.alternate,ge!==null&&(ge.lanes|=A),zg(F.return,A,d),C||(ee=null);break e}F=ge.next}}else if(w.tag===18){if(ee=w.return,ee===null)throw Error(i(341));ee.lanes|=A,F=ee.alternate,F!==null&&(F.lanes|=A),zg(ee,A,d),ee=null}else ee=w.child;if(ee!==null)ee.return=w;else for(ee=w;ee!==null;){if(ee===d){ee=null;break}if(w=ee.sibling,w!==null){w.return=ee.return,ee=w;break}ee=ee.return}w=ee}}function gu(d,m,A,C){d=null;for(var w=m,F=!1;w!==null;){if(!F){if((w.flags&524288)!==0)F=!0;else if((w.flags&262144)!==0)break}if(w.tag===10){var ee=w.alternate;if(ee===null)throw Error(i(387));if(ee=ee.memoizedProps,ee!==null){var ge=w.type;ga(w.pendingProps.value,ee.value)||(d!==null?d.push(ge):d=[ge])}}else if(w===zf.current){if(ee=w.alternate,ee===null)throw Error(i(387));ee.memoizedState.memoizedState!==w.memoizedState.memoizedState&&(d!==null?d.push(_n):d=[_n])}w=w.return}d!==null&&Vg(m,d,A,C),m.flags|=262144}function yc(d){for(d=d.firstContext;d!==null;){var m=d.context;if(!ga(Zo?m._currentValue:m._currentValue2,d.memoizedValue))return!0;d=d.next}return!1}function vu(d){zc=d,rs=null,d=d.dependencies,d!==null&&(d.firstContext=null)}function js(d){return Yg(zc,d)}function td(d,m){return zc===null&&vu(d),Yg(d,m)}function Yg(d,m){var A=Zo?m._currentValue:m._currentValue2;if(m={context:m,memoizedValue:A,next:null},rs===null){if(d===null)throw Error(i(308));rs=m,d.dependencies={lanes:0,firstContext:m},d.flags|=524288}else rs=rs.next=m;return A}function im(){return{controller:new nS,data:new Map,refCount:0}}function _f(d){d.refCount--,d.refCount===0&&Yl(Bu,function(){d.controller.abort()})}function xc(){var d=Xl.current;return d!==null?d:Hn.pooledCache}function sm(d,m){m===null?T(Xl,Xl.current):T(Xl,m.pool)}function m_(){var d=xc();return d===null?null:{parent:Zo?_i._currentValue:_i._currentValue2,pool:d}}function ua(d){d.flags|=4}function Xg(d,m){if(d!==null&&d.child===m.child)return!1;if((m.flags&16)!==0)return!0;for(d=m.child;d!==null;){if((d.flags&13878)!==0||(d.subtreeFlags&13878)!==0)return!0;d=d.sibling}return!1}function rm(d,m,A,C){if(Js)for(A=m.child;A!==null;){if(A.tag===5||A.tag===6)Qo(d,A.stateNode);else if(!(A.tag===4||$s&&A.tag===27)&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===m)break;for(;A.sibling===null;){if(A.return===null||A.return===m)return;A=A.return}A.sibling.return=A.return,A=A.sibling}else if(da)for(var w=m.child;w!==null;){if(w.tag===5){var F=w.stateNode;A&&C&&(F=Mv(F,w.type,w.memoizedProps)),Qo(d,F)}else if(w.tag===6)F=w.stateNode,A&&C&&(F=Cv(F,w.memoizedProps)),Qo(d,F);else if(w.tag!==4){if(w.tag===22&&w.memoizedState!==null)F=w.child,F!==null&&(F.return=w),rm(d,w,!0,!0);else if(w.child!==null){w.child.return=w,w=w.child;continue}}if(w===m)break;for(;w.sibling===null;){if(w.return===null||w.return===m)return;w=w.return}w.sibling.return=w.return,w=w.sibling}}function Sf(d,m,A,C){if(da)for(var w=m.child;w!==null;){if(w.tag===5){var F=w.stateNode;A&&C&&(F=Mv(F,w.type,w.memoizedProps)),bv(d,F)}else if(w.tag===6)F=w.stateNode,A&&C&&(F=Cv(F,w.memoizedProps)),bv(d,F);else if(w.tag!==4){if(w.tag===22&&w.memoizedState!==null)F=w.child,F!==null&&(F.return=w),Sf(d,w,!(w.memoizedProps!==null&&w.memoizedProps.mode==="manual"),!0);else if(w.child!==null){w.child.return=w,w=w.child;continue}}if(w===m)break;for(;w.sibling===null;){if(w.return===null||w.return===m)return;w=w.return}w.sibling.return=w.return,w=w.sibling}}function Af(d,m){if(da&&Xg(d,m)){d=m.stateNode;var A=d.containerInfo,C=Rm();Sf(C,m,!1,!1),d.pendingChildren=C,ua(m),I_(A,C)}}function Kg(d,m,A,C){if(Js)d.memoizedProps!==C&&ua(m);else if(da){var w=d.stateNode,F=d.memoizedProps;if((d=Xg(d,m))||F!==C){var ee=zs.current;F=Ev(w,A,F,C,!d,null),F===w?m.stateNode=w:(Fl(F,A,C,ee)&&ua(m),m.stateNode=F,d?rm(F,m,!1,!1):ua(m))}else m.stateNode=w}}function Ef(d,m,A){if(D_(m,A)){if(d.flags|=16777216,!kl(m,A))if(od())d.flags|=8192;else throw Iu=km,zv}else d.flags&=-16777217}function qg(d,m){if(q_(m)){if(d.flags|=16777216,!Uv(m))if(od())d.flags|=8192;else throw Iu=km,zv}else d.flags&=-16777217}function nd(d,m){m!==null&&(d.flags|=4),d.flags&16384&&(m=d.tag!==22?B():536870912,d.lanes|=m,ql|=m)}function yu(d,m){if(!li)switch(d.tailMode){case"hidden":m=d.tail;for(var A=null;m!==null;)m.alternate!==null&&(A=m),m=m.sibling;A===null?d.tail=null:A.sibling=null;break;case"collapsed":A=d.tail;for(var C=null;A!==null;)A.alternate!==null&&(C=A),A=A.sibling;C===null?m||d.tail===null?d.tail=null:d.tail.sibling=null:C.sibling=null}}function Hi(d){var m=d.alternate!==null&&d.alternate.child===d.child,A=0,C=0;if(m)for(var w=d.child;w!==null;)A|=w.lanes|w.childLanes,C|=w.subtreeFlags&31457280,C|=w.flags&31457280,w.return=d,w=w.sibling;else for(w=d.child;w!==null;)A|=w.lanes|w.childLanes,C|=w.subtreeFlags,C|=w.flags,w.return=d,w=w.sibling;return d.subtreeFlags|=C,d.childLanes=A,m}function g_(d,m,A){var C=m.pendingProps;switch(xe(m),m.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hi(m),null;case 1:return Hi(m),null;case 3:return A=m.stateNode,C=null,d!==null&&(C=d.memoizedState.cache),m.memoizedState.cache!==C&&(m.flags|=2048),Dl(_i),Be(),A.pendingContext&&(A.context=A.pendingContext,A.pendingContext=null),(d===null||d.child===null)&&(At(m)?ua(m):d===null||d.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,xa!==null&&(wl(xa),xa=null))),Af(d,m),Hi(m),null;case 26:if(ma){A=m.type;var w=m.memoizedState;return d===null?(ua(m),w!==null?(Hi(m),qg(m,w)):(Hi(m),Ef(m,A,C))):w?w!==d.memoizedState?(ua(m),Hi(m),qg(m,w)):(Hi(m),m.flags&=-16777217):(Js?d.memoizedProps!==C&&ua(m):Kg(d,m,A,C),Hi(m),Ef(m,A,C)),null}case 27:if($s){if(be(m),A=So.current,w=m.type,d!==null&&m.stateNode!=null)Js?d.memoizedProps!==C&&ua(m):Kg(d,m,w,C);else{if(!C){if(m.stateNode===null)throw Error(i(166));return Hi(m),null}d=zs.current,At(m)?gt(m,d):(d=kv(w,C,A,d,!0),m.stateNode=d,ua(m))}return Hi(m),null}case 5:if(be(m),A=m.type,d!==null&&m.stateNode!=null)Kg(d,m,A,C);else{if(!C){if(m.stateNode===null)throw Error(i(166));return Hi(m),null}d=zs.current,At(m)?gt(m,d):(w=hv(A,C,So.current,d,m),rm(w,m,!1,!1),m.stateNode=w,Fl(w,A,C,d)&&ua(m))}return Hi(m),Ef(m,m.type,m.pendingProps),null;case 6:if(d&&m.stateNode!=null)A=d.memoizedProps,Js?A!==C&&ua(m):da&&(A!==C?(m.stateNode=Am(C,So.current,zs.current,m),ua(m)):m.stateNode=d.stateNode);else{if(typeof C!="string"&&m.stateNode===null)throw Error(i(166));if(d=So.current,A=zs.current,At(m)){if(!wr)throw Error(i(176));if(d=m.stateNode,A=m.memoizedProps,C=null,w=mr,w!==null)switch(w.tag){case 27:case 5:C=w.memoizedProps}H_(d,A,m,C)||je(m)}else m.stateNode=Am(C,d,A,m)}return Hi(m),null;case 13:if(C=m.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(w=At(m),C!==null&&C.dehydrated!==null){if(d===null){if(!w)throw Error(i(318));if(!wr)throw Error(i(344));if(w=m.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(i(317));Uf(w,m)}else jt(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;Hi(m),w=!1}else xa!==null&&(wl(xa),xa=null),w=!0;if(!w)return m.flags&256?(Yt(m),m):(Yt(m),null)}if(Yt(m),(m.flags&128)!==0)return m.lanes=A,m;if(A=C!==null,d=d!==null&&d.memoizedState!==null,A){C=m.child,w=null,C.alternate!==null&&C.alternate.memoizedState!==null&&C.alternate.memoizedState.cachePool!==null&&(w=C.alternate.memoizedState.cachePool.pool);var F=null;C.memoizedState!==null&&C.memoizedState.cachePool!==null&&(F=C.memoizedState.cachePool.pool),F!==w&&(C.flags|=2048)}return A!==d&&A&&(m.child.flags|=8192),nd(m,m.updateQueue),Hi(m),null;case 4:return Be(),Af(d,m),d===null&&mv(m.stateNode.containerInfo),Hi(m),null;case 10:return Dl(m.type),Hi(m),null;case 19:if(b(bs),w=m.memoizedState,w===null)return Hi(m),null;if(C=(m.flags&128)!==0,F=w.rendering,F===null)if(C)yu(w,!1);else{if(si!==0||d!==null&&(d.flags&128)!==0)for(d=m.child;d!==null;){if(F=Xn(d),F!==null){for(m.flags|=128,yu(w,!1),d=F.updateQueue,m.updateQueue=d,nd(m,d),m.subtreeFlags=0,d=A,A=m.child;A!==null;)Pl(A,d),A=A.sibling;return T(bs,bs.current&1|2),m.child}d=d.sibling}w.tail!==null&&Qs()>Qi&&(m.flags|=128,C=!0,yu(w,!1),m.lanes=4194304)}else{if(!C)if(d=Xn(F),d!==null){if(m.flags|=128,C=!0,d=d.updateQueue,m.updateQueue=d,nd(m,d),yu(w,!0),w.tail===null&&w.tailMode==="hidden"&&!F.alternate&&!li)return Hi(m),null}else 2*Qs()-w.renderingStartTime>Qi&&A!==536870912&&(m.flags|=128,C=!0,yu(w,!1),m.lanes=4194304);w.isBackwards?(F.sibling=m.child,m.child=F):(d=w.last,d!==null?d.sibling=F:m.child=F,w.last=F)}return w.tail!==null?(m=w.tail,w.rendering=m,w.tail=m.sibling,w.renderingStartTime=Qs(),m.sibling=null,d=bs.current,T(bs,C?d&1|2:d&1),m):(Hi(m),null);case 22:case 23:return Yt(m),Wt(),C=m.memoizedState!==null,d!==null?d.memoizedState!==null!==C&&(m.flags|=8192):C&&(m.flags|=8192),C?(A&536870912)!==0&&(m.flags&128)===0&&(Hi(m),m.subtreeFlags&6&&(m.flags|=8192)):Hi(m),A=m.updateQueue,A!==null&&nd(m,A.retryQueue),A=null,d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(A=d.memoizedState.cachePool.pool),C=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(C=m.memoizedState.cachePool.pool),C!==A&&(m.flags|=2048),d!==null&&b(Xl),null;case 24:return A=null,d!==null&&(A=d.memoizedState.cache),m.memoizedState.cache!==A&&(m.flags|=2048),Dl(_i),Hi(m),null;case 25:return null}throw Error(i(156,m.tag))}function v_(d,m){switch(xe(m),m.tag){case 1:return d=m.flags,d&65536?(m.flags=d&-65537|128,m):null;case 3:return Dl(_i),Be(),d=m.flags,(d&65536)!==0&&(d&128)===0?(m.flags=d&-65537|128,m):null;case 26:case 27:case 5:return be(m),null;case 13:if(Yt(m),d=m.memoizedState,d!==null&&d.dehydrated!==null){if(m.alternate===null)throw Error(i(340));jt()}return d=m.flags,d&65536?(m.flags=d&-65537|128,m):null;case 19:return b(bs),null;case 4:return Be(),null;case 10:return Dl(m.type),null;case 22:case 23:return Yt(m),Wt(),d!==null&&b(Xl),d=m.flags,d&65536?(m.flags=d&-65537|128,m):null;case 24:return Dl(_i),null;case 25:return null;default:return null}}function jg(d,m){switch(xe(m),m.tag){case 3:Dl(_i),Be();break;case 26:case 27:case 5:be(m);break;case 4:Be();break;case 13:Yt(m);break;case 19:b(bs);break;case 10:Dl(m.type);break;case 22:case 23:Yt(m),Wt(),d!==null&&b(Xl);break;case 24:Dl(_i)}}function id(d,m){try{var A=m.updateQueue,C=A!==null?A.lastEffect:null;if(C!==null){var w=C.next;A=w;do{if((A.tag&d)===d){C=void 0;var F=A.create,ee=A.inst;C=F(),ee.destroy=C}A=A.next}while(A!==w)}}catch(ge){Kn(m,m.return,ge)}}function _c(d,m,A){try{var C=m.updateQueue,w=C!==null?C.lastEffect:null;if(w!==null){var F=w.next;C=F;do{if((C.tag&d)===d){var ee=C.inst,ge=ee.destroy;if(ge!==void 0){ee.destroy=void 0,w=m;var Le=A;try{ge()}catch(ot){Kn(w,Le,ot)}}}C=C.next}while(C!==F)}}catch(ot){Kn(m,m.return,ot)}}function y_(d){var m=d.updateQueue;if(m!==null){var A=d.stateNode;try{Re(m,A)}catch(C){Kn(d,d.return,C)}}}function x_(d,m,A){A.props=mo(d.type,d.memoizedProps),A.state=d.memoizedState;try{A.componentWillUnmount()}catch(C){Kn(d,m,C)}}function xu(d,m){try{var A=d.ref;if(A!==null){var C=d.stateNode;switch(d.tag){case 26:case 27:case 5:var w=Nf(C);break;default:w=C}typeof A=="function"?d.refCleanup=A(w):A.current=w}}catch(F){Kn(d,m,F)}}function zi(d,m){var A=d.ref,C=d.refCleanup;if(A!==null)if(typeof C=="function")try{C()}catch(w){Kn(d,m,w)}finally{d.refCleanup=null,d=d.alternate,d!=null&&(d.refCleanup=null)}else if(typeof A=="function")try{A(null)}catch(w){Kn(d,m,w)}else A.current=null}function bf(d){var m=d.type,A=d.memoizedProps,C=d.stateNode;try{OT(C,m,A,d)}catch(w){Kn(d,d.return,w)}}function Wg(d,m,A){try{xv(d.stateNode,d.type,A,m,d)}catch(C){Kn(d,d.return,C)}}function Jg(d){return d.tag===5||d.tag===3||(ma?d.tag===26:!1)||($s?d.tag===27:!1)||d.tag===4}function am(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||Jg(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&(!$s||d.tag!==27)&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function om(d,m,A){var C=d.tag;if(C===5||C===6)d=d.stateNode,m?Sv(A,d,m):L_(A,d);else if(!(C===4||$s&&C===27)&&(d=d.child,d!==null))for(om(d,m,A),d=d.sibling;d!==null;)om(d,m,A),d=d.sibling}function Tf(d,m,A){var C=d.tag;if(C===5||C===6)d=d.stateNode,m?_v(A,d,m):yv(A,d);else if(!(C===4||$s&&C===27)&&(d=d.child,d!==null))for(Tf(d,m,A),d=d.sibling;d!==null;)Tf(d,m,A),d=d.sibling}function __(d,m,A){d=d.containerInfo;try{Tv(d,A)}catch(C){Kn(m,m.return,C)}}function Mf(d,m){for(Oc(d.containerInfo),as=m;as!==null;)if(d=as,m=d.child,(d.subtreeFlags&1028)!==0&&m!==null)m.return=d,as=m;else for(;as!==null;){d=as;var A=d.alternate;switch(m=d.flags,d.tag){case 0:break;case 11:case 15:break;case 1:if((m&1024)!==0&&A!==null){m=void 0;var C=d,w=A.memoizedProps;A=A.memoizedState;var F=C.stateNode;try{var ee=mo(C.type,w,C.elementType===C.type);m=F.getSnapshotBeforeUpdate(ee,A),F.__reactInternalSnapshotBeforeUpdate=m}catch(ge){Kn(C,C.return,ge)}}break;case 3:(m&1024)!==0&&Js&&Cm(d.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((m&1024)!==0)throw Error(i(163))}if(m=d.sibling,m!==null){m.return=d.return,as=m;break}as=d.return}return ee=Ou,Ou=!1,ee}function lm(d,m,A){var C=A.flags;switch(A.tag){case 0:case 11:case 15:Ko(d,A),C&4&&id(5,A);break;case 1:if(Ko(d,A),C&4)if(d=A.stateNode,m===null)try{d.componentDidMount()}catch(ge){Kn(A,A.return,ge)}else{var w=mo(A.type,m.memoizedProps);m=m.memoizedState;try{d.componentDidUpdate(w,m,d.__reactInternalSnapshotBeforeUpdate)}catch(ge){Kn(A,A.return,ge)}}C&64&&y_(A),C&512&&xu(A,A.return);break;case 3:if(Ko(d,A),C&64&&(C=A.updateQueue,C!==null)){if(d=null,A.child!==null)switch(A.child.tag){case 27:case 5:d=Nf(A.child.stateNode);break;case 1:d=A.child.stateNode}try{Re(C,d)}catch(ge){Kn(A,A.return,ge)}}break;case 26:if(ma){Ko(d,A),C&512&&xu(A,A.return);break}case 27:case 5:Ko(d,A),m===null&&C&4&&bf(A),C&512&&xu(A,A.return);break;case 12:Ko(d,A);break;case 13:Ko(d,A),C&4&&Sc(d,A);break;case 22:if(w=A.memoizedState!==null||ws,!w){m=m!==null&&m.memoizedState!==null||$i;var F=ws,ee=$i;ws=w,($i=m)&&!ee?Ec(d,A,(A.subtreeFlags&8772)!==0):Ko(d,A),ws=F,$i=ee}C&512&&(A.memoizedProps.mode==="manual"?xu(A,A.return):zi(A,A.return));break;default:Ko(d,A)}}function Cf(d){var m=d.alternate;m!==null&&(d.alternate=null,Cf(m)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(m=d.stateNode,m!==null&&gv(m)),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function fa(d,m,A){for(A=A.child;A!==null;)cm(d,m,A),A=A.sibling}function cm(d,m,A){if(qr&&typeof qr.onCommitFiberUnmount=="function")try{qr.onCommitFiberUnmount(Hf,A)}catch{}switch(A.tag){case 26:if(ma){$i||zi(A,m),fa(d,m,A),A.memoizedState?Iv(A.memoizedState):A.stateNode&&Pv(A.stateNode);break}case 27:if($s){$i||zi(A,m);var C=ms,w=Jr;ms=A.stateNode,fa(d,m,A),j_(A.stateNode),ms=C,Jr=w;break}case 5:$i||zi(A,m);case 6:if(Js){if(C=ms,w=Jr,ms=null,fa(d,m,A),ms=C,Jr=w,ms!==null)if(Jr)try{hs(ms,A.stateNode)}catch(F){Kn(A,m,F)}else try{Ir(ms,A.stateNode)}catch(F){Kn(A,m,F)}}else fa(d,m,A);break;case 18:Js&&ms!==null&&(Jr?Dv(ms,A.stateNode):V_(ms,A.stateNode));break;case 4:Js?(C=ms,w=Jr,ms=A.stateNode.containerInfo,Jr=!0,fa(d,m,A),ms=C,Jr=w):(da&&__(A.stateNode,A,Rm()),fa(d,m,A));break;case 0:case 11:case 14:case 15:$i||_c(2,A,m),$i||_c(4,A,m),fa(d,m,A);break;case 1:$i||(zi(A,m),C=A.stateNode,typeof C.componentWillUnmount=="function"&&x_(A,m,C)),fa(d,m,A);break;case 21:fa(d,m,A);break;case 22:$i||zi(A,m),$i=(C=$i)||A.memoizedState!==null,fa(d,m,A),$i=C;break;default:fa(d,m,A)}}function Sc(d,m){if(wr&&m.memoizedState===null&&(d=m.alternate,d!==null&&(d=d.memoizedState,d!==null&&(d=d.dehydrated,d!==null))))try{Im(d)}catch(A){Kn(m,m.return,A)}}function Rf(d){switch(d.tag){case 13:case 19:var m=d.stateNode;return m===null&&(m=d.stateNode=new qf),m;case 22:return d=d.stateNode,m=d._retryCache,m===null&&(m=d._retryCache=new qf),m;default:throw Error(i(435,d.tag))}}function sd(d,m){var A=Rf(d);m.forEach(function(C){var w=tv.bind(null,d,C);A.has(C)||(A.add(C),C.then(w,w))})}function Rr(d,m){var A=m.deletions;if(A!==null)for(var C=0;C<A.length;C++){var w=A[C],F=d,ee=m;if(Js){var ge=ee;e:for(;ge!==null;){switch(ge.tag){case 27:case 5:ms=ge.stateNode,Jr=!1;break e;case 3:ms=ge.stateNode.containerInfo,Jr=!0;break e;case 4:ms=ge.stateNode.containerInfo,Jr=!0;break e}ge=ge.return}if(ms===null)throw Error(i(160));cm(F,ee,w),ms=null,Jr=!1}else cm(F,ee,w);F=w.alternate,F!==null&&(F.return=null),w.return=null}if(m.subtreeFlags&13878)for(m=m.child;m!==null;)Ac(m,d),m=m.sibling}function Ac(d,m){var A=d.alternate,C=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:Rr(m,d),zr(d),C&4&&(_c(3,d,d.return),id(3,d),_c(5,d,d.return));break;case 1:Rr(m,d),zr(d),C&512&&($i||A===null||zi(A,A.return)),C&64&&ws&&(d=d.updateQueue,d!==null&&(C=d.callbacks,C!==null&&(A=d.shared.hiddenCallbacks,d.shared.hiddenCallbacks=A===null?C:A.concat(C))));break;case 26:if(ma){var w=Br;Rr(m,d),zr(d),C&512&&($i||A===null||zi(A,A.return)),C&4&&(C=A!==null?A.memoizedState:null,m=d.memoizedState,A===null?m===null?d.stateNode===null?d.stateNode=Bv(w,d.type,d.memoizedProps,d):Ov(w,d.type,d.stateNode):d.stateNode=wv(w,m,d.memoizedProps):C!==m?(C===null?A.stateNode!==null&&Pv(A.stateNode):Iv(C),m===null?Ov(w,d.type,d.stateNode):wv(w,m,d.memoizedProps)):m===null&&d.stateNode!==null&&Wg(d,d.memoizedProps,A.memoizedProps));break}case 27:if($s&&C&4&&d.alternate===null){w=d.stateNode;var F=d.memoizedProps;try{FT(w),kT(d.type,F,w,d)}catch(Ct){Kn(d,d.return,Ct)}}case 5:if(Rr(m,d),zr(d),C&512&&($i||A===null||zi(A,A.return)),Js){if(d.flags&32){m=d.stateNode;try{vd(m)}catch(Ct){Kn(d,d.return,Ct)}}C&4&&d.stateNode!=null&&(m=d.memoizedProps,Wg(d,m,A!==null?A.memoizedProps:m)),C&1024&&(Vc=!0)}break;case 6:if(Rr(m,d),zr(d),C&4&&Js){if(d.stateNode===null)throw Error(i(162));C=d.memoizedProps,A=A!==null?A.memoizedProps:C,m=d.stateNode;try{w_(m,A,C)}catch(Ct){Kn(d,d.return,Ct)}}break;case 3:if(ma?(Nv(),w=Br,Br=Bm(m.containerInfo),Rr(m,d),Br=w):Rr(m,d),zr(d),C&4){if(Js&&wr&&A!==null&&A.memoizedState.isDehydrated)try{wm(m.containerInfo)}catch(Ct){Kn(d,d.return,Ct)}if(da){C=m.containerInfo,A=m.pendingChildren;try{Tv(C,A)}catch(Ct){Kn(d,d.return,Ct)}}}Vc&&(Vc=!1,$g(d));break;case 4:ma?(A=Br,Br=Bm(d.stateNode.containerInfo),Rr(m,d),zr(d),Br=A):(Rr(m,d),zr(d)),C&4&&da&&__(d.stateNode,d,d.stateNode.pendingChildren);break;case 12:Rr(m,d),zr(d);break;case 13:Rr(m,d),zr(d),d.child.flags&8192&&d.memoizedState!==null!=(A!==null&&A.memoizedState!==null)&&(al=Qs()),C&4&&(C=d.updateQueue,C!==null&&(d.updateQueue=null,sd(d,C)));break;case 22:C&512&&($i||A===null||zi(A,A.return)),w=d.memoizedState!==null;var ee=A!==null&&A.memoizedState!==null,ge=ws,Le=$i;if(ws=ge||w,$i=Le||ee,Rr(m,d),$i=Le,ws=ge,zr(d),m=d.stateNode,m._current=d,m._visibility&=-3,m._visibility|=m._pendingVisibility&2,C&8192&&(m._visibility=w?m._visibility&-2:m._visibility|1,w&&(m=ws||$i,A===null||ee||m||Df(d)),Js&&(d.memoizedProps===null||d.memoizedProps.mode!=="manual"))){e:if(A=null,Js)for(m=d;;){if(m.tag===5||ma&&m.tag===26||$s&&m.tag===27){if(A===null){ee=A=m;try{F=ee.stateNode,w?yd(F):Av(ee.stateNode,ee.memoizedProps)}catch(Ct){Kn(ee,ee.return,Ct)}}}else if(m.tag===6){if(A===null){ee=m;try{var ot=ee.stateNode;w?Mm(ot):Gl(ot,ee.memoizedProps)}catch(Ct){Kn(ee,ee.return,Ct)}}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===d)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===d)break e;for(;m.sibling===null;){if(m.return===null||m.return===d)break e;A===m&&(A=null),m=m.return}A===m&&(A=null),m.sibling.return=m.return,m=m.sibling}}C&4&&(C=d.updateQueue,C!==null&&(A=C.retryQueue,A!==null&&(C.retryQueue=null,sd(d,A))));break;case 19:Rr(m,d),zr(d),C&4&&(C=d.updateQueue,C!==null&&(d.updateQueue=null,sd(d,C)));break;case 21:break;default:Rr(m,d),zr(d)}}function zr(d){var m=d.flags;if(m&2){try{if(Js&&(!$s||d.tag!==27)){e:{for(var A=d.return;A!==null;){if(Jg(A)){var C=A;break e}A=A.return}throw Error(i(160))}switch(C.tag){case 27:if($s){var w=C.stateNode,F=am(d);Tf(d,F,w);break}case 5:var ee=C.stateNode;C.flags&32&&(vd(ee),C.flags&=-33);var ge=am(d);Tf(d,ge,ee);break;case 3:case 4:var Le=C.stateNode.containerInfo,ot=am(d);om(d,ot,Le);break;default:throw Error(i(161))}}}catch(Ct){Kn(d,d.return,Ct)}d.flags&=-3}m&4096&&(d.flags&=-4097)}function $g(d){if(d.subtreeFlags&1024)for(d=d.child;d!==null;){var m=d;$g(m),m.tag===5&&m.flags&1024&&Di(m.stateNode),d=d.sibling}}function Ko(d,m){if(m.subtreeFlags&8772)for(m=m.child;m!==null;)lm(d,m.alternate,m),m=m.sibling}function Df(d){for(d=d.child;d!==null;){var m=d;switch(m.tag){case 0:case 11:case 14:case 15:_c(4,m,m.return),Df(m);break;case 1:zi(m,m.return);var A=m.stateNode;typeof A.componentWillUnmount=="function"&&x_(m,m.return,A),Df(m);break;case 26:case 27:case 5:zi(m,m.return),Df(m);break;case 22:zi(m,m.return),m.memoizedState===null&&Df(m);break;default:Df(m)}d=d.sibling}}function Ec(d,m,A){for(A=A&&(m.subtreeFlags&8772)!==0,m=m.child;m!==null;){var C=m.alternate,w=d,F=m,ee=F.flags;switch(F.tag){case 0:case 11:case 15:Ec(w,F,A),id(4,F);break;case 1:if(Ec(w,F,A),C=F,w=C.stateNode,typeof w.componentDidMount=="function")try{w.componentDidMount()}catch(ot){Kn(C,C.return,ot)}if(C=F,w=C.updateQueue,w!==null){var ge=C.stateNode;try{var Le=w.shared.hiddenCallbacks;if(Le!==null)for(w.shared.hiddenCallbacks=null,w=0;w<Le.length;w++)le(Le[w],ge)}catch(ot){Kn(C,C.return,ot)}}A&&ee&64&&y_(F),xu(F,F.return);break;case 26:case 27:case 5:Ec(w,F,A),A&&C===null&&ee&4&&bf(F),xu(F,F.return);break;case 12:Ec(w,F,A);break;case 13:Ec(w,F,A),A&&ee&4&&Sc(w,F);break;case 22:F.memoizedState===null&&Ec(w,F,A),xu(F,F.return);break;default:Ec(w,F,A)}m=m.sibling}}function Qg(d,m){var A=null;d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(A=d.memoizedState.cachePool.pool),d=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(d=m.memoizedState.cachePool.pool),d!==A&&(d!=null&&d.refCount++,A!=null&&_f(A))}function um(d,m){d=null,m.alternate!==null&&(d=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==d&&(m.refCount++,d!=null&&_f(d))}function Ll(d,m,A,C){if(m.subtreeFlags&10256)for(m=m.child;m!==null;)fm(d,m,A,C),m=m.sibling}function fm(d,m,A,C){var w=m.flags;switch(m.tag){case 0:case 11:case 15:Ll(d,m,A,C),w&2048&&id(9,m);break;case 3:Ll(d,m,A,C),w&2048&&(d=null,m.alternate!==null&&(d=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==d&&(m.refCount++,d!=null&&_f(d)));break;case 12:if(w&2048){Ll(d,m,A,C),d=m.stateNode;try{var F=m.memoizedProps,ee=F.id,ge=F.onPostCommit;typeof ge=="function"&&ge(ee,m.alternate===null?"mount":"update",d.passiveEffectDuration,-0)}catch(Le){Kn(m,m.return,Le)}}else Ll(d,m,A,C);break;case 23:break;case 22:F=m.stateNode,m.memoizedState!==null?F._visibility&4?Ll(d,m,A,C):bc(d,m):F._visibility&4?Ll(d,m,A,C):(F._visibility|=4,fr(d,m,A,C,(m.subtreeFlags&10256)!==0)),w&2048&&Qg(m.alternate,m);break;case 24:Ll(d,m,A,C),w&2048&&um(m.alternate,m);break;default:Ll(d,m,A,C)}}function fr(d,m,A,C,w){for(w=w&&(m.subtreeFlags&10256)!==0,m=m.child;m!==null;){var F=d,ee=m,ge=A,Le=C,ot=ee.flags;switch(ee.tag){case 0:case 11:case 15:fr(F,ee,ge,Le,w),id(8,ee);break;case 23:break;case 22:var Ct=ee.stateNode;ee.memoizedState!==null?Ct._visibility&4?fr(F,ee,ge,Le,w):bc(F,ee):(Ct._visibility|=4,fr(F,ee,ge,Le,w)),w&&ot&2048&&Qg(ee.alternate,ee);break;case 24:fr(F,ee,ge,Le,w),w&&ot&2048&&um(ee.alternate,ee);break;default:fr(F,ee,ge,Le,w)}m=m.sibling}}function bc(d,m){if(m.subtreeFlags&10256)for(m=m.child;m!==null;){var A=d,C=m,w=C.flags;switch(C.tag){case 22:bc(A,C),w&2048&&Qg(C.alternate,C);break;case 24:bc(A,C),w&2048&&um(C.alternate,C);break;default:bc(A,C)}m=m.sibling}}function Fs(d){if(d.subtreeFlags&Pu)for(d=d.child;d!==null;)_u(d),d=d.sibling}function _u(d){switch(d.tag){case 26:Fs(d),d.flags&Pu&&(d.memoizedState!==null?Fv(Br,d.memoizedState,d.memoizedProps):ts(d.type,d.memoizedProps));break;case 5:Fs(d),d.flags&Pu&&ts(d.type,d.memoizedProps);break;case 3:case 4:if(ma){var m=Br;Br=Bm(d.stateNode.containerInfo),Fs(d),Br=m}else Fs(d);break;case 22:d.memoizedState===null&&(m=d.alternate,m!==null&&m.memoizedState!==null?(m=Pu,Pu=16777216,Fs(d),Pu=m):Fs(d));break;default:Fs(d)}}function hm(d){var m=d.alternate;if(m!==null&&(d=m.child,d!==null)){m.child=null;do m=d.sibling,d.sibling=null,d=m;while(d!==null)}}function Tc(d){var m=d.deletions;if((d.flags&16)!==0){if(m!==null)for(var A=0;A<m.length;A++){var C=m[A];as=C,Mc(C,d)}hm(d)}if(d.subtreeFlags&10256)for(d=d.child;d!==null;)rd(d),d=d.sibling}function rd(d){switch(d.tag){case 0:case 11:case 15:Tc(d),d.flags&2048&&_c(9,d,d.return);break;case 3:Tc(d);break;case 12:Tc(d);break;case 22:var m=d.stateNode;d.memoizedState!==null&&m._visibility&4&&(d.return===null||d.return.tag!==13)?(m._visibility&=-5,Lf(d)):Tc(d);break;default:Tc(d)}}function Lf(d){var m=d.deletions;if((d.flags&16)!==0){if(m!==null)for(var A=0;A<m.length;A++){var C=m[A];as=C,Mc(C,d)}hm(d)}for(d=d.child;d!==null;){switch(m=d,m.tag){case 0:case 11:case 15:_c(8,m,m.return),Lf(m);break;case 22:A=m.stateNode,A._visibility&4&&(A._visibility&=-5,Lf(m));break;default:Lf(m)}d=d.sibling}}function Mc(d,m){for(;as!==null;){var A=as;switch(A.tag){case 0:case 11:case 15:_c(8,A,m);break;case 23:case 22:if(A.memoizedState!==null&&A.memoizedState.cachePool!==null){var C=A.memoizedState.cachePool.pool;C!=null&&C.refCount++}break;case 24:_f(A.memoizedState.cache)}if(C=A.child,C!==null)C.return=A,as=C;else e:for(A=d;as!==null;){C=as;var w=C.sibling,F=C.return;if(Cf(C),C===A){as=null;break e}if(w!==null){w.return=F,as=w;break e}as=F}}}function dm(d){var m=pv(d);if(m!=null){if(typeof m.memoizedProps["data-testname"]!="string")throw Error(i(364));return m}if(d=Du(d),d===null)throw Error(i(362));return d.stateNode.current}function wf(d,m){var A=d.tag;switch(m.$$typeof){case Bd:if(d.type===m.value)return!0;break;case Ym:e:{for(m=m.value,d=[d,0],A=0;A<d.length;){var C=d[A++],w=C.tag,F=d[A++],ee=m[F];if(w!==5&&w!==26&&w!==27||!tl(C)){for(;ee!=null&&wf(C,ee);)F++,ee=m[F];if(F===m.length){m=!0;break e}else for(C=C.child;C!==null;)d.push(C,F),C=C.sibling}}m=!1}return m;case Xm:if((A===5||A===26||A===27)&&BT(d.stateNode,m.value))return!0;break;case Si:if((A===5||A===6||A===26||A===27)&&(d=gd(d),d!==null&&0<=d.indexOf(m.value)))return!0;break;case ii:if((A===5||A===26||A===27)&&(d=d.memoizedProps["data-testname"],typeof d=="string"&&d.toLowerCase()===m.value.toLowerCase()))return!0;break;default:throw Error(i(365))}return!1}function Cc(d){switch(d.$$typeof){case Bd:return"<"+(a(d.value)||"Unknown")+">";case Ym:return":has("+(Cc(d)||"")+")";case Xm:return'[role="'+d.value+'"]';case Si:return'"'+d.value+'"';case ii:return'[data-testname="'+d.value+'"]';default:throw Error(i(365))}}function S_(d,m){var A=[];d=[d,0];for(var C=0;C<d.length;){var w=d[C++],F=w.tag,ee=d[C++],ge=m[ee];if(F!==5&&F!==26&&F!==27||!tl(w)){for(;ge!=null&&wf(w,ge);)ee++,ge=m[ee];if(ee===m.length)A.push(w);else for(w=w.child;w!==null;)d.push(w,ee),w=w.sibling}}return A}function Dr(d,m){if(!el)throw Error(i(363));d=dm(d),d=S_(d,m),m=[],d=Array.from(d);for(var A=0;A<d.length;){var C=d[A++],w=C.tag;if(w===5||w===26||w===27)tl(C)||m.push(C.stateNode);else for(C=C.child;C!==null;)d.push(C),C=C.sibling}return m}function Lr(){if((un&2)!==0&&Fn!==0)return Fn&-Fn;if(gn.T!==null){var d=jr;return d!==0?d:Ve()}return Xa()}function qo(){$r===0&&($r=(Fn&536870912)===0||li?U():536870912);var d=Aa.current;return d!==null&&(d.flags|=32),$r}function hr(d,m,A){(d===Hn&&Li===2||d.cancelPendingCommit!==null)&&(vo(d,0),go(d,Fn,$r,!1)),z(d,A),((un&2)===0||d!==Hn)&&(d===Hn&&((un&2)===0&&(bo|=A),si===4&&go(d,Fn,$r,!1)),_t(d))}function ad(d,m,A){if((un&6)!==0)throw Error(i(327));var C=!A&&(m&60)===0&&(m&d.expiredLanes)===0||O(d,m),w=C?Jo(d,m):jo(d,m,!0),F=C;do{if(w===0){Ea&&!C&&go(d,m,0,!1);break}else if(w===6)go(d,m,0,!Ai);else{if(A=d.current.alternate,F&&!A_(A)){w=jo(d,m,!1),F=!1;continue}if(w===2){if(F=m,d.errorRecoveryDisabledLanes&F)var ee=0;else ee=d.pendingLanes&-536870913,ee=ee!==0?ee:ee&536870912?536870912:0;if(ee!==0){m=ee;e:{var ge=d;w=jf;var Le=wr&&ge.current.memoizedState.isDehydrated;if(Le&&(vo(ge,ee).flags|=256),ee=jo(ge,ee,!1),ee!==2){if(Kl&&!Le){ge.errorRecoveryDisabledLanes|=F,bo|=F,w=4;break e}F=Ta,Ta=w,F!==null&&wl(F)}w=ee}if(F=!1,w!==2)continue}}if(w===1){vo(d,0),go(d,m,0,!0);break}e:{switch(C=d,w){case 0:case 1:throw Error(i(345));case 4:if((m&4194176)===m){go(C,m,$r,!Ai);break e}break;case 2:Ta=null;break;case 3:case 5:break;default:throw Error(i(329))}if(C.finishedWork=A,C.finishedLanes=m,(m&62914560)===m&&(F=al+300-Qs(),10<F)){if(go(C,m,$r,!Ai),P(C,0)!==0)break e;C.timeoutHandle=dv(pm.bind(null,C,A,Ta,To,Wf,m,$r,bo,ql,Ai,2,-0,0),F);break e}pm(C,A,Ta,To,Wf,m,$r,bo,ql,Ai,0,-0,0)}}break}while(!0);_t(d)}function wl(d){Ta===null?Ta=d:Ta.push.apply(Ta,d)}function pm(d,m,A,C,w,F,ee,ge,Le,ot,Ct,kt,Xt){var Tn=m.subtreeFlags;if((Tn&8192||(Tn&16785408)===16785408)&&(pa(),_u(m),m=Em(),m!==null)){d.cancelPendingCommit=m(Ni.bind(null,d,A,C,w,ee,ge,Le,1,kt,Xt)),go(d,F,ee,!ot);return}Ni(d,A,C,w,ee,ge,Le,Ct,kt,Xt)}function A_(d){for(var m=d;;){var A=m.tag;if((A===0||A===11||A===15)&&m.flags&16384&&(A=m.updateQueue,A!==null&&(A=A.stores,A!==null)))for(var C=0;C<A.length;C++){var w=A[C],F=w.getSnapshot;w=w.value;try{if(!ga(F(),w))return!1}catch{return!1}}if(A=m.child,m.subtreeFlags&16384&&A!==null)A.return=m,m=A;else{if(m===d)break;for(;m.sibling===null;){if(m.return===null||m.return===d)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function go(d,m,A,C){m&=~yr,m&=~bo,d.suspendedLanes|=m,d.pingedLanes&=~m,C&&(d.warmLanes|=m),C=d.expirationTimes;for(var w=m;0<w;){var F=31-Kr(w),ee=1<<F;C[F]=-1,w&=~ee}A!==0&&Z(d,A,m)}function Zg(){return(un&6)===0?(it(0),!1):!0}function Vr(){if(Rn!==null){if(Li===0)var d=Rn.return;else d=Rn,rs=zc=null,rt(d),il=null,ja=0,d=Rn;for(;d!==null;)jg(d.alternate,d),d=d.return;Rn=null}}function vo(d,m){d.finishedWork=null,d.finishedLanes=0;var A=d.timeoutHandle;A!==Ru&&(d.timeoutHandle=Ru,md(A)),A=d.cancelPendingCommit,A!==null&&(d.cancelPendingCommit=null,A()),Vr(),Hn=d,Rn=A=dr(d.current,null),Fn=m,Li=0,gs=null,Ai=!1,Ea=O(d,m),Kl=!1,ql=$r=yr=bo=ba=si=0,Ta=jf=null,Wf=!1,(m&8)!==0&&(m|=m&32);var C=d.entangledLanes;if(C!==0)for(d=d.entanglements,C&=m;0<C;){var w=31-Kr(C),F=1<<w;m|=d[w],C&=~F}return Eo=m,ze(),A}function Su(d,m){Bn=null,gn.H=ci,m===Mi?(m=Rt(),Li=3):m===zv?(m=Rt(),Li=4):Li=m===tS?8:m!==null&&typeof m=="object"&&typeof m.then=="function"?6:1,gs=m,Rn===null&&(si=1,Zp(d,oe(m,d.current)))}function od(){var d=Aa.current;return d===null?!0:(Fn&4194176)===Fn?Wa===null:(Fn&62914560)===Fn||(Fn&536870912)!==0?d===Wa:!1}function If(){var d=gn.H;return gn.H=ci,d===null?ci:d}function ha(){var d=gn.A;return gn.A=Vm,d}function Yr(){si=4,Ai||(Fn&4194176)!==Fn&&Aa.current!==null||(Ea=!0),(ba&134217727)===0&&(bo&134217727)===0||Hn===null||go(Hn,Fn,$r,!1)}function jo(d,m,A){var C=un;un|=2;var w=If(),F=ha();(Hn!==d||Fn!==m)&&(To=null,vo(d,m)),m=!1;var ee=si;e:do try{if(Li!==0&&Rn!==null){var ge=Rn,Le=gs;switch(Li){case 8:Vr(),ee=6;break e;case 3:case 2:case 6:Aa.current===null&&(m=!0);var ot=Li;if(Li=0,gs=null,Rc(d,ge,Le,ot),A&&Ea){ee=0;break e}break;default:ot=Li,Li=0,gs=null,Rc(d,ge,Le,ot)}}Wo(),ee=si;break}catch(Ct){Su(d,Ct)}while(!0);return m&&d.shellSuspendCounter++,rs=zc=null,un=C,gn.H=w,gn.A=F,Rn===null&&(Hn=null,Fn=0,ze()),ee}function Wo(){for(;Rn!==null;)ev(Rn)}function Jo(d,m){var A=un;un|=2;var C=If(),w=ha();Hn!==d||Fn!==m?(To=null,Qi=Qs()+500,vo(d,m)):Ea=O(d,m);e:do try{if(Li!==0&&Rn!==null){m=Rn;var F=gs;t:switch(Li){case 1:Li=0,gs=null,Rc(d,m,F,1);break;case 2:if(yt(F)){Li=0,gs=null,mm(m);break}m=function(){Li===2&&Hn===d&&(Li=7),_t(d)},F.then(m,m);break e;case 3:Li=7;break e;case 4:Li=5;break e;case 7:yt(F)?(Li=0,gs=null,mm(m)):(Li=0,gs=null,Rc(d,m,F,7));break;case 5:var ee=null;switch(Rn.tag){case 26:ee=Rn.memoizedState;case 5:case 27:var ge=Rn,Le=ge.type,ot=ge.pendingProps;if(ee?Uv(ee):kl(Le,ot)){Li=0,gs=null;var Ct=ge.sibling;if(Ct!==null)Rn=Ct;else{var kt=ge.return;kt!==null?(Rn=kt,ld(kt)):Rn=null}break t}}Li=0,gs=null,Rc(d,m,F,5);break;case 6:Li=0,gs=null,Rc(d,m,F,6);break;case 8:Vr(),si=6;break e;default:throw Error(i(462))}}Il();break}catch(Xt){Su(d,Xt)}while(!0);return rs=zc=null,gn.H=C,gn.A=w,un=A,Rn!==null?0:(Hn=null,Fn=0,ze(),si)}function Il(){for(;Rn!==null&&!J_();)ev(Rn)}function ev(d){var m=p_(d.alternate,d,Eo);d.memoizedProps=d.pendingProps,m===null?ld(d):Rn=m}function mm(d){var m=d,A=m.alternate;switch(m.tag){case 15:case 0:m=c_(A,m,m.pendingProps,m.type,void 0,Fn);break;case 11:m=c_(A,m,m.pendingProps,m.type.render,m.ref,Fn);break;case 5:rt(m);default:jg(A,m),m=Rn=Pl(m,Eo),m=p_(A,m,Eo)}d.memoizedProps=d.pendingProps,m===null?ld(d):Rn=m}function Rc(d,m,A,C){rs=zc=null,rt(m),il=null,ja=0;var w=m.return;try{if(s_(d,w,m,A,Fn)){si=1,Zp(d,oe(A,d.current)),Rn=null;return}}catch(F){if(w!==null)throw Rn=w,F;si=1,Zp(d,oe(A,d.current)),Rn=null;return}m.flags&32768?(li||C===1?d=!0:Ea||(Fn&536870912)!==0?d=!1:(Ai=d=!0,(C===2||C===3||C===6)&&(C=Aa.current,C!==null&&C.tag===13&&(C.flags|=16384))),ks(m,d)):ld(m)}function ld(d){var m=d;do{if((m.flags&32768)!==0){ks(m,Ai);return}d=m.return;var A=g_(m.alternate,m,Eo);if(A!==null){Rn=A;return}if(m=m.sibling,m!==null){Rn=m;return}Rn=m=d}while(m!==null);si===0&&(si=5)}function ks(d,m){do{var A=v_(d.alternate,d);if(A!==null){A.flags&=32767,Rn=A;return}if(A=d.return,A!==null&&(A.flags|=32768,A.subtreeFlags=0,A.deletions=null),!m&&(d=d.sibling,d!==null)){Rn=d;return}Rn=d=A}while(d!==null);si=6,Rn=null}function Ni(d,m,A,C,w,F,ee,ge,Le,ot){var Ct=gn.T,kt=Ls();try{pr(2),gn.T=null,Qn(d,m,A,C,kt,w,F,ee,ge,Le,ot)}finally{gn.T=Ct,pr(kt)}}function Qn(d,m,A,C,w,F,ee,ge){do Gs();while(jl!==null);if((un&6)!==0)throw Error(i(327));var Le=d.finishedWork;if(C=d.finishedLanes,Le===null)return null;if(d.finishedWork=null,d.finishedLanes=0,Le===d.current)throw Error(i(177));d.callbackNode=null,d.callbackPriority=0,d.cancelPendingCommit=null;var ot=Le.lanes|Le.childLanes;if(ot|=Vf,W(d,C,ot,F,ee,ge),d===Hn&&(Rn=Hn=null,Fn=0),(Le.subtreeFlags&10256)===0&&(Le.flags&10256)===0||$a||($a=!0,Km=ot,Uu=A,cd(Pm,function(){return Gs(),null})),A=(Le.flags&15990)!==0,(Le.subtreeFlags&15990)!==0||A?(A=gn.T,gn.T=null,F=Ls(),pr(2),ee=un,un|=4,Mf(d,Le),Ac(Le,d),fv(d.containerInfo),d.current=Le,lm(d,Le.alternate,Le),$_(),un=ee,pr(F),gn.T=A):d.current=Le,$a?($a=!1,jl=d,Nu=C):Bl(d,ot),ot=d.pendingLanes,ot===0&&(Ma=null),k(Le.stateNode),_t(d),m!==null)for(w=d.onRecoverableError,Le=0;Le<m.length;Le++)ot=m[Le],w(ot.value,{componentStack:ot.stack});return(Nu&3)!==0&&Gs(),ot=d.pendingLanes,(C&4194218)!==0&&(ot&42)!==0?d===Or?Fu++:(Fu=0,Or=d):Fu=0,it(0),null}function Bl(d,m){(d.pooledCacheLanes&=m)===0&&(m=d.pooledCache,m!=null&&(d.pooledCache=null,_f(m)))}function Gs(){if(jl!==null){var d=jl,m=Km;Km=0;var A=re(Nu),C=32>A?32:A;A=gn.T;var w=Ls();try{if(pr(C),gn.T=null,jl===null)var F=!1;else{C=Uu,Uu=null;var ee=jl,ge=Nu;if(jl=null,Nu=0,(un&6)!==0)throw Error(i(331));var Le=un;if(un|=4,rd(ee.current),fm(ee,ee.current,ge,C),un=Le,it(0,!1),qr&&typeof qr.onPostCommitFiberRoot=="function")try{qr.onPostCommitFiberRoot(Hf,ee)}catch{}F=!0}return F}finally{pr(w),gn.T=A,Bl(d,m)}}return!1}function gm(d,m,A){m=oe(A,m),m=$h(d.stateNode,m,2),d=Je(d,m,2),d!==null&&(z(d,2),_t(d))}function Kn(d,m,A){if(d.tag===3)gm(d,d,A);else for(;m!==null;){if(m.tag===3){gm(m,d,A);break}else if(m.tag===1){var C=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof C.componentDidCatch=="function"&&(Ma===null||!Ma.has(C))){d=oe(A,d),A=xf(2),C=Je(m,A,2),C!==null&&(Qh(A,C,m,d),z(C,2),_t(C));break}}m=m.return}}function vm(d,m,A){var C=d.pingCache;if(C===null){C=d.pingCache=new qn;var w=new Set;C.set(m,w)}else w=C.get(m),w===void 0&&(w=new Set,C.set(m,w));w.has(A)||(Kl=!0,w.add(A),d=E_.bind(null,d,m,A),m.then(d,d))}function E_(d,m,A){var C=d.pingCache;C!==null&&C.delete(m),d.pingedLanes|=d.suspendedLanes&A,d.warmLanes&=~A,Hn===d&&(Fn&A)===A&&(si===4||si===3&&(Fn&62914560)===Fn&&300>Qs()-al?(un&2)===0&&vo(d,0):yr|=A,ql===Fn&&(ql=0)),_t(d)}function Au(d,m){m===0&&(m=B()),d=ue(d,m),d!==null&&(z(d,m),_t(d))}function Eu(d){var m=d.memoizedState,A=0;m!==null&&(A=m.retryLane),Au(d,A)}function tv(d,m){var A=0;switch(d.tag){case 13:var C=d.stateNode,w=d.memoizedState;w!==null&&(A=w.retryLane);break;case 19:C=d.stateNode;break;case 22:C=d.stateNode._retryCache;break;default:throw Error(i(314))}C!==null&&C.delete(m),Au(d,A)}function cd(d,m){return Gf(d,m)}function nv(d,m,A,C){this.tag=d,this.key=A,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=C,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ol(d){return d=d.prototype,!(!d||!d.isReactComponent)}function dr(d,m){var A=d.alternate;return A===null?(A=t(d.tag,m,d.key,d.mode),A.elementType=d.elementType,A.type=d.type,A.stateNode=d.stateNode,A.alternate=d,d.alternate=A):(A.pendingProps=m,A.type=d.type,A.flags=0,A.subtreeFlags=0,A.deletions=null),A.flags=d.flags&31457280,A.childLanes=d.childLanes,A.lanes=d.lanes,A.child=d.child,A.memoizedProps=d.memoizedProps,A.memoizedState=d.memoizedState,A.updateQueue=d.updateQueue,m=d.dependencies,A.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},A.sibling=d.sibling,A.index=d.index,A.ref=d.ref,A.refCleanup=d.refCleanup,A}function Pl(d,m){d.flags&=31457282;var A=d.alternate;return A===null?(d.childLanes=0,d.lanes=m,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=A.childLanes,d.lanes=A.lanes,d.child=A.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=A.memoizedProps,d.memoizedState=A.memoizedState,d.updateQueue=A.updateQueue,d.type=A.type,m=A.dependencies,d.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext}),d}function Ya(d,m,A,C,w,F){var ee=0;if(C=d,typeof d=="function")Ol(d)&&(ee=1);else if(typeof d=="string")ee=ma&&$s?Lv(d,A,zs.current)?26:Ff(d)?27:5:ma?Lv(d,A,zs.current)?26:5:$s&&Ff(d)?27:5;else e:switch(d){case Of:return Nl(A.children,w,F,m);case ov:ee=8,w|=24;break;case lv:return d=t(12,A,m,w|2),d.elementType=lv,d.lanes=F,d;case xm:return d=t(13,A,m,w),d.elementType=xm,d.lanes=F,d;case wc:return d=t(19,A,m,w),d.elementType=wc,d.lanes=F,d;case hd:return ym(A,w,F,m);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case M_:case $o:ee=10;break e;case Lc:ee=9;break e;case Pf:ee=11;break e;case fd:ee=14;break e;case xo:ee=16,C=null;break e}ee=29,A=Error(i(130,d===null?"null":typeof d,"")),C=null}return m=t(ee,A,m,w),m.elementType=d,m.type=C,m.lanes=F,m}function Nl(d,m,A,C){return d=t(7,d,C,m),d.lanes=A,d}function ym(d,m,A,C){d=t(22,d,C,m),d.elementType=hd,d.lanes=A;var w={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var F=w._current;if(F===null)throw Error(i(456));if((w._pendingVisibility&2)===0){var ee=ue(F,2);ee!==null&&(w._pendingVisibility|=2,hr(ee,F,2))}},attach:function(){var F=w._current;if(F===null)throw Error(i(456));if((w._pendingVisibility&2)!==0){var ee=ue(F,2);ee!==null&&(w._pendingVisibility&=-3,hr(ee,F,2))}}};return d.stateNode=w,d}function Dc(d,m,A){return d=t(6,d,null,m),d.lanes=A,d}function Bf(d,m,A){return m=t(4,d.children!==null?d.children:[],d.key,m),m.lanes=A,m.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},m}function bu(d,m,A,C,w,F,ee,ge){this.tag=1,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Ru,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=I(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=I(0),this.hiddenUpdates=I(null),this.identifierPrefix=C,this.onUncaughtError=w,this.onCaughtError=F,this.onRecoverableError=ee,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ge,this.incompleteTransitions=new Map}function Hs(d,m,A,C,w,F,ee,ge,Le,ot,Ct,kt){return d=new bu(d,m,A,ee,ge,Le,ot,kt),m=1,F===!0&&(m|=24),F=t(3,null,null,m),d.current=F,F.stateNode=d,m=im(),m.refCount++,d.pooledCache=m,m.refCount++,F.memoizedState={element:C,isDehydrated:A,cache:m},Ft(F),d}function ud(d){return d?(d=Lu,d):Lu}function iv(d){var m=d._reactInternals;if(m===void 0)throw typeof d.render=="function"?Error(i(188)):(d=Object.keys(d).join(","),Error(i(268,d)));return d=y(m),d=d!==null?x(d):null,d===null?null:Nf(d.stateNode)}function b_(d,m,A,C,w,F){w=ud(w),C.context===null?C.context=w:C.pendingContext=w,C=Ze(m),C.payload={element:A},F=F===void 0?null:F,F!==null&&(C.callback=F),A=Je(d,C,m),A!==null&&(hr(A,d,m),Nt(A,d,m))}function T_(d,m){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var A=d.retryLane;d.retryLane=A!==0&&A<m?A:m}}function sv(d,m){T_(d,m),(d=d.alternate)&&T_(d,m)}var cn={},rv=bg(),Ws=$7(),Tu=Object.assign,av=Symbol.for("react.element"),Ul=Symbol.for("react.transitional.element"),yo=Symbol.for("react.portal"),Of=Symbol.for("react.fragment"),ov=Symbol.for("react.strict_mode"),lv=Symbol.for("react.profiler"),M_=Symbol.for("react.provider"),Lc=Symbol.for("react.consumer"),$o=Symbol.for("react.context"),Pf=Symbol.for("react.forward_ref"),xm=Symbol.for("react.suspense"),wc=Symbol.for("react.suspense_list"),fd=Symbol.for("react.memo"),xo=Symbol.for("react.lazy"),hd=Symbol.for("react.offscreen"),C_=Symbol.for("react.memo_cache_sentinel"),cv=Symbol.iterator,Mu=Symbol.for("react.client.reference"),gn=rv.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,_m,uv,Ic=!1,Bc=Array.isArray,Sm=e.rendererVersion,dd=e.rendererPackageName,pd=e.extraDevToolsConfig,Nf=e.getPublicInstance,Cu=e.getRootHostContext,R_=e.getChildHostContext,Oc=e.prepareForCommit,fv=e.resetAfterCommit,hv=e.createInstance,Qo=e.appendInitialChild,Fl=e.finalizeInitialChildren,Pc=e.shouldSetTextContent,Am=e.createTextInstance,dv=e.scheduleTimeout,md=e.cancelTimeout,Ru=e.noTimeout,Zo=e.isPrimaryRenderer;e.warnsIfNotActing;var Js=e.supportsMutation,da=e.supportsPersistence,wr=e.supportsHydration,pv=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var mv=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var pr=e.setCurrentUpdatePriority,Ls=e.getCurrentUpdatePriority,Xa=e.resolveUpdatePriority;e.resolveEventType,e.resolveEventTimeStamp;var Nc=e.shouldAttemptEagerTransition,gv=e.detachDeletedInstance;e.requestPostPaintCallback;var D_=e.maySuspendCommit,kl=e.preloadInstance,pa=e.startSuspendingCommit,ts=e.suspendInstance,Em=e.waitForCommitToBeReady,Xr=e.NotPendingTransition,_n=e.HostTransitionContext,Di=e.resetFormInstance;e.bindToConsole;var Es=e.supportsMicrotasks,bm=e.scheduleMicrotask,el=e.supportsTestSelectors,Du=e.findFiberRoot,Tm=e.getBoundingRect,gd=e.getTextContent,tl=e.isHiddenSubtree,BT=e.matchAccessibilityRole,ns=e.setFocusIfFocusable,vv=e.setupIntersectionObserver,yv=e.appendChild,L_=e.appendChildToContainer,w_=e.commitTextUpdate,OT=e.commitMount,xv=e.commitUpdate,_v=e.insertBefore,Sv=e.insertInContainerBefore,Ir=e.removeChild,hs=e.removeChildFromContainer,vd=e.resetTextContent,yd=e.hideInstance,Mm=e.hideTextInstance,Av=e.unhideInstance,Gl=e.unhideTextInstance,Cm=e.clearContainer,Ev=e.cloneInstance,Rm=e.createContainerChildSet,bv=e.appendChildToContainerChildSet,I_=e.finalizeContainerChildren,Tv=e.replaceContainerChildren,Mv=e.cloneHiddenInstance,Cv=e.cloneHiddenTextInstance,Dm=e.isSuspenseInstancePending,xd=e.isSuspenseInstanceFallback,B_=e.getSuspenseInstanceFallbackErrorDetails,PT=e.registerSuspenseInstanceRetry,O_=e.canHydrateFormStateMarker,P_=e.isFormStateMarkerMatching,Rv=e.getNextHydratableSibling,Lm=e.getFirstHydratableChild,N_=e.getFirstHydratableChildWithinContainer,U_=e.getFirstHydratableChildWithinSuspenseInstance,F_=e.canHydrateInstance,k_=e.canHydrateTextInstance,G_=e.canHydrateSuspenseInstance,NT=e.hydrateInstance,H_=e.hydrateTextInstance,Uf=e.hydrateSuspenseInstance,z_=e.getNextHydratableInstanceAfterSuspenseInstance,wm=e.commitHydratedContainer,Im=e.commitHydratedSuspenseInstance,V_=e.clearSuspenseBoundary,Dv=e.clearSuspenseBoundaryFromContainer,Y_=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var X_=e.validateHydratableInstance,K_=e.validateHydratableTextInstance,ma=e.supportsResources,Lv=e.isHostHoistableType,Bm=e.getHoistableRoot,Om=e.getResource,wv=e.acquireResource,Iv=e.releaseResource,Bv=e.hydrateHoistable,Ov=e.mountHoistable,Pv=e.unmountHoistable,UT=e.createHoistableInstance,Nv=e.prepareToCommitHoistables,q_=e.mayResourceSuspendCommit,Uv=e.preloadResource,Fv=e.suspendResource,$s=e.supportsSingletons,kv=e.resolveSingletonInstance,FT=e.clearSingleton,kT=e.acquireSingletonInstance,j_=e.releaseSingletonInstance,Ff=e.isHostSingletonType,_d=[],Hl=-1,Lu={},Kr=Math.clz32?Math.clz32:R,Sd=Math.log,W_=Math.LN2,kf=128,Ad=4194304,Gf=Ws.unstable_scheduleCallback,Ed=Ws.unstable_cancelCallback,J_=Ws.unstable_shouldYield,$_=Ws.unstable_requestPaint,Qs=Ws.unstable_now,Gv=Ws.unstable_ImmediatePriority,Q_=Ws.unstable_UserBlockingPriority,Pm=Ws.unstable_NormalPriority,Nm=Ws.unstable_IdlePriority,Z_=Ws.log,Hv=Ws.unstable_setDisableYieldValue,Hf=null,qr=null,ga=typeof Object.is=="function"?Object.is:J,Um=new WeakMap,Vi=[],is=0,bd=null,Td=0,va=[],ya=0,_o=null,nl=1,Ka="",zs=E(null),Md=E(null),So=E(null),zf=E(null),mr=null,Zs=null,li=!1,xa=null,qa=!1,Cd=Error(i(519)),_a=[],Uc=0,Vf=0,Yf=null,wu=null,Rd=!1,Dd=!1,Ao=!1,Fc=0,Ld=null,Fm=0,jr=0,kc=null,zl=!1,Xf=!1,wd=Object.prototype.hasOwnProperty,Mi=Error(i(460)),zv=Error(i(474)),km={then:function(){}},Iu=null,il=null,ja=0,Gc=dn(!0),Vv=dn(!1),sl=E(null),Sa=E(0),Aa=E(null),Wa=null,bs=E(0),rl=0,Bn=null,gi=null,ds=null,Ja=!1,Yi=!1,Vl=!1,Id=0,ss=0,Kf=null,eS=0,Gm=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},ci={readContext:js,use:fe,useCallback:Jt,useContext:Jt,useEffect:Jt,useImperativeHandle:Jt,useLayoutEffect:Jt,useInsertionEffect:Jt,useMemo:Jt,useReducer:Jt,useRef:Jt,useState:Jt,useDebugValue:Jt,useDeferredValue:Jt,useTransition:Jt,useSyncExternalStore:Jt,useId:Jt};ci.useCacheRefresh=Jt,ci.useMemoCache=Jt,ci.useHostTransitionStatus=Jt,ci.useFormState=Jt,ci.useActionState=Jt,ci.useOptimistic=Jt;var Ts={readContext:js,use:fe,useCallback:function(d,m){return ct().memoizedState=[d,m===void 0?null:m],d},useContext:js,useEffect:wg,useImperativeHandle:function(d,m,A){A=A!=null?A.concat([d]):null,Va(4194308,4,Kh.bind(null,m,d),A)},useLayoutEffect:function(d,m){return Va(4194308,4,d,m)},useInsertionEffect:function(d,m){Va(4,2,d,m)},useMemo:function(d,m){var A=ct();m=m===void 0?null:m;var C=d();if(Vl){j(!0);try{d()}finally{j(!1)}}return A.memoizedState=[C,m],C},useReducer:function(d,m,A){var C=ct();if(A!==void 0){var w=A(m);if(Vl){j(!0);try{A(m)}finally{j(!1)}}}else w=m;return C.memoizedState=C.baseState=w,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:w},C.queue=d,d=d.dispatch=pc.bind(null,Bn,d),[C.memoizedState,d]},useRef:function(d){var m=ct();return d={current:d},m.memoizedState=d},useState:function(d){d=nn(d);var m=d.queue,A=$p.bind(null,Bn,m);return m.dispatch=A,[d.memoizedState,A]},useDebugValue:qh,useDeferredValue:function(d,m){var A=ct();return dc(A,d,m)},useTransition:function(){var d=nn(!1);return d=Wp.bind(null,Bn,d.queue,!0,!1),ct().memoizedState=d,[!1,d]},useSyncExternalStore:function(d,m,A){var C=Bn,w=ct();if(li){if(A===void 0)throw Error(i(407));A=A()}else{if(A=m(),Hn===null)throw Error(i(349));(Fn&60)!==0||Lt(C,m,A)}w.memoizedState=A;var F={value:A,getSnapshot:m};return w.queue=F,wg(Bt.bind(null,C,F,d),[d]),C.flags|=2048,es(9,Pt.bind(null,C,F,A,m),{destroy:void 0},null),A},useId:function(){var d=ct(),m=Hn.identifierPrefix;if(li){var A=Ka,C=nl;A=(C&~(1<<32-Kr(C)-1)).toString(32)+A,m=":"+m+"R"+A,A=Id++,0<A&&(m+="H"+A.toString(32)),m+=":"}else A=eS++,m=":"+m+"r"+A.toString(32)+":";return d.memoizedState=m},useCacheRefresh:function(){return ct().memoizedState=jh.bind(null,Bn)}};Ts.useMemoCache=Se,Ts.useHostTransitionStatus=pu,Ts.useFormState=Ji,Ts.useActionState=Ji,Ts.useOptimistic=function(d){var m=ct();m.memoizedState=m.baseState=d;var A={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return m.queue=A,m=Qp.bind(null,Bn,!0,A),A.dispatch=m,[d,m]};var gr={readContext:js,use:fe,useCallback:jp,useContext:js,useEffect:Xh,useImperativeHandle:Yo,useInsertionEffect:n_,useLayoutEffect:i_,useMemo:du,useReducer:Ke,useRef:po,useState:function(){return Ke(de)},useDebugValue:qh,useDeferredValue:function(d,m){var A=Y();return Ig(A,gi.memoizedState,d,m)},useTransition:function(){var d=Ke(de)[0],m=Y().memoizedState;return[typeof d=="boolean"?d:ce(d),m]},useSyncExternalStore:xt,useId:Xo};gr.useCacheRefresh=Jp,gr.useMemoCache=Se,gr.useHostTransitionStatus=pu,gr.useFormState=$n,gr.useActionState=$n,gr.useOptimistic=function(d,m){var A=Y();return fn(A,gi,d,m)};var Hc={readContext:js,use:fe,useCallback:jp,useContext:js,useEffect:Xh,useImperativeHandle:Yo,useInsertionEffect:n_,useLayoutEffect:i_,useMemo:du,useReducer:pt,useRef:po,useState:function(){return pt(de)},useDebugValue:qh,useDeferredValue:function(d,m){var A=Y();return gi===null?dc(A,d,m):Ig(A,gi.memoizedState,d,m)},useTransition:function(){var d=pt(de)[0],m=Y().memoizedState;return[typeof d=="boolean"?d:ce(d),m]},useSyncExternalStore:xt,useId:Xo};Hc.useCacheRefresh=Jp,Hc.useMemoCache=Se,Hc.useHostTransitionStatus=pu,Hc.useFormState=Ds,Hc.useActionState=Ds,Hc.useOptimistic=function(d,m){var A=Y();return gi!==null?fn(A,gi,d,m):(A.baseState=d,[d,A.queue.dispatch])};var Hm={isMounted:function(d){return(d=d._reactInternals)?p(d)===d:!1},enqueueSetState:function(d,m,A){d=d._reactInternals;var C=Lr(),w=Ze(C);w.payload=m,A!=null&&(w.callback=A),m=Je(d,w,C),m!==null&&(hr(m,d,C),Nt(m,d,C))},enqueueReplaceState:function(d,m,A){d=d._reactInternals;var C=Lr(),w=Ze(C);w.tag=1,w.payload=m,A!=null&&(w.callback=A),m=Je(d,w,C),m!==null&&(hr(m,d,C),Nt(m,d,C))},enqueueForceUpdate:function(d,m){d=d._reactInternals;var A=Lr(),C=Ze(A);C.tag=2,m!=null&&(C.callback=m),m=Je(d,C,A),m!==null&&(hr(m,d,A),Nt(m,d,A))}},Yv=typeof reportError=="function"?reportError:function(d){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var m=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof d=="object"&&d!==null&&typeof d.message=="string"?String(d.message):String(d),error:d});if(!window.dispatchEvent(m))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",d);return}console.error(d)},tS=Error(i(461)),ps=!1,vr={dehydrated:null,treeContext:null,retryLane:0},Wr=E(null),zc=null,rs=null,nS=typeof AbortController<"u"?AbortController:function(){var d=[],m=this.signal={aborted:!1,addEventListener:function(A,C){d.push(C)}};this.abort=function(){m.aborted=!0,d.forEach(function(A){return A()})}},Yl=Ws.unstable_scheduleCallback,Bu=Ws.unstable_NormalPriority,_i={$$typeof:$o,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},zm=gn.S;gn.S=function(d,m){typeof m=="object"&&m!==null&&typeof m.then=="function"&&Pe(d,m),zm!==null&&zm(d,m)};var Xl=E(null),ws=!1,$i=!1,Vc=!1,qf=typeof WeakSet=="function"?WeakSet:Set,as=null,Ou=!1,ms=null,Jr=!1,Br=null,Pu=8192,Vm={getCacheForType:function(d){var m=js(_i),A=m.data.get(d);return A===void 0&&(A=d(),m.data.set(d,A)),A}},Bd=0,Ym=1,Xm=2,ii=3,Si=4;if(typeof Symbol=="function"&&Symbol.for){var On=Symbol.for;Bd=On("selector.component"),Ym=On("selector.has_pseudo_class"),Xm=On("selector.role"),ii=On("selector.test_id"),Si=On("selector.text")}var qn=typeof WeakMap=="function"?WeakMap:Map,un=0,Hn=null,Rn=null,Fn=0,Li=0,gs=null,Ai=!1,Ea=!1,Kl=!1,Eo=0,si=0,ba=0,bo=0,yr=0,$r=0,ql=0,jf=null,Ta=null,Wf=!1,al=0,Qi=1/0,To=null,Ma=null,$a=!1,jl=null,Nu=0,Km=0,Uu=null,Fu=0,Or=null;return cn.attemptContinuousHydration=function(d){if(d.tag===13){var m=ue(d,67108864);m!==null&&hr(m,d,67108864),sv(d,67108864)}},cn.attemptHydrationAtCurrentPriority=function(d){if(d.tag===13){var m=Lr(),A=ue(d,m);A!==null&&hr(A,d,m),sv(d,m)}},cn.attemptSynchronousHydration=function(d){switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var m=D(d.pendingLanes);if(m!==0){for(d.pendingLanes|=2,d.entangledLanes|=2;m;){var A=1<<31-Kr(m);d.entanglements[1]|=A,m&=~A}_t(d),(un&6)===0&&(Qi=Qs()+500,it(0))}}break;case 13:m=ue(d,2),m!==null&&hr(m,d,2),Zg(),sv(d,2)}},cn.batchedUpdates=function(d,m){return d(m)},cn.createComponentSelector=function(d){return{$$typeof:Bd,value:d}},cn.createContainer=function(d,m,A,C,w,F,ee,ge,Le,ot){return Hs(d,m,!1,null,A,C,F,ee,ge,Le,ot,null)},cn.createHasPseudoClassSelector=function(d){return{$$typeof:Ym,value:d}},cn.createHydrationContainer=function(d,m,A,C,w,F,ee,ge,Le,ot,Ct,kt,Xt){return d=Hs(A,C,!0,d,w,F,ge,Le,ot,Ct,kt,Xt),d.context=ud(null),A=d.current,C=Lr(),w=Ze(C),w.callback=m??null,Je(A,w,C),d.current.lanes=C,z(d,C),_t(d),d},cn.createPortal=function(d,m,A){var C=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:yo,key:C==null?null:""+C,children:d,containerInfo:m,implementation:A}},cn.createRoleSelector=function(d){return{$$typeof:Xm,value:d}},cn.createTestNameSelector=function(d){return{$$typeof:ii,value:d}},cn.createTextSelector=function(d){return{$$typeof:Si,value:d}},cn.defaultOnCaughtError=function(d){console.error(d)},cn.defaultOnRecoverableError=function(d){Yv(d)},cn.defaultOnUncaughtError=function(d){Yv(d)},cn.deferredUpdates=function(d){var m=gn.T,A=Ls();try{return pr(32),gn.T=null,d()}finally{pr(A),gn.T=m}},cn.discreteUpdates=function(d,m,A,C,w){var F=gn.T,ee=Ls();try{return pr(2),gn.T=null,d(m,A,C,w)}finally{pr(ee),gn.T=F,un===0&&(Qi=Qs()+500)}},cn.findAllNodes=Dr,cn.findBoundingRects=function(d,m){if(!el)throw Error(i(363));m=Dr(d,m),d=[];for(var A=0;A<m.length;A++)d.push(Tm(m[A]));for(m=d.length-1;0<m;m--){A=d[m];for(var C=A.x,w=C+A.width,F=A.y,ee=F+A.height,ge=m-1;0<=ge;ge--)if(m!==ge){var Le=d[ge],ot=Le.x,Ct=ot+Le.width,kt=Le.y,Xt=kt+Le.height;if(C>=ot&&F>=kt&&w<=Ct&&ee<=Xt){d.splice(m,1);break}else if(C!==ot||A.width!==Le.width||Xt<F||kt>ee){if(!(F!==kt||A.height!==Le.height||Ct<C||ot>w)){ot>C&&(Le.width+=ot-C,Le.x=C),Ct<w&&(Le.width=w-ot),d.splice(m,1);break}}else{kt>F&&(Le.height+=kt-F,Le.y=F),Xt<ee&&(Le.height=ee-kt),d.splice(m,1);break}}}return d},cn.findHostInstance=iv,cn.findHostInstanceWithNoPortals=function(d){return d=y(d),d=d!==null?S(d):null,d===null?null:Nf(d.stateNode)},cn.findHostInstanceWithWarning=function(d){return iv(d)},cn.flushPassiveEffects=Gs,cn.flushSyncFromReconciler=function(d){var m=un;un|=1;var A=gn.T,C=Ls();try{if(pr(2),gn.T=null,d)return d()}finally{pr(C),gn.T=A,un=m,(un&6)===0&&it(0)}},cn.flushSyncWork=Zg,cn.focusWithin=function(d,m){if(!el)throw Error(i(363));for(d=dm(d),m=S_(d,m),m=Array.from(m),d=0;d<m.length;){var A=m[d++],C=A.tag;if(!tl(A)){if((C===5||C===26||C===27)&&ns(A.stateNode))return!0;for(A=A.child;A!==null;)m.push(A),A=A.sibling}}return!1},cn.getFindAllNodesFailureDescription=function(d,m){if(!el)throw Error(i(363));var A=0,C=[];d=[dm(d),0];for(var w=0;w<d.length;){var F=d[w++],ee=F.tag,ge=d[w++],Le=m[ge];if((ee!==5&&ee!==26&&ee!==27||!tl(F))&&(wf(F,Le)&&(C.push(Cc(Le)),ge++,ge>A&&(A=ge)),ge<m.length))for(F=F.child;F!==null;)d.push(F,ge),F=F.sibling}if(A<m.length){for(d=[];A<m.length;A++)d.push(Cc(m[A]));return`findAllNodes was able to match part of the selector:
  `+(C.join(" > ")+`

No matching component was found for:
  `)+d.join(" > ")}return null},cn.getPublicRootInstance=function(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 27:case 5:return Nf(d.child.stateNode);default:return d.child.stateNode}},cn.injectIntoDevTools=function(){var d={bundleType:0,version:Sm,rendererPackageName:dd,currentDispatcherRef:gn,findFiberByHostInstance:pv,reconcilerVersion:"19.0.0"};if(pd!==null&&(d.rendererConfig=pd),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")d=!1;else{var m=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(m.isDisabled||!m.supportsFiber)d=!0;else{try{Hf=m.inject(d),qr=m}catch{}d=!!m.checkDCE}}return d},cn.isAlreadyRendering=function(){return!1},cn.observeVisibleRects=function(d,m,A,C){if(!el)throw Error(i(363));d=Dr(d,m);var w=vv(d,A,C).disconnect;return{disconnect:function(){w()}}},cn.shouldError=function(){return null},cn.shouldSuspend=function(){return!1},cn.startHostTransition=function(d,m,A,C){if(d.tag!==5)throw Error(i(476));var w=Bg(d).queue;Wp(d,w,m,Xr,A===null?n:function(){var F=Bg(d).next.queue;return mc(d,F,{},Lr()),A(C)})},cn.updateContainer=function(d,m,A,C){var w=m.current,F=Lr();return b_(w,F,d,m,A,C),F},cn.updateContainerSync=function(d,m,A,C){return m.tag===0&&Gs(),b_(m.current,2,d,m,A,C),2},cn},r.exports.default=r.exports,Object.defineProperty(r.exports,"__esModule",{value:!0})})(pM)),pM.exports}var F2;function Z7(){return F2||(F2=1,dM.exports=Q7()),dM.exports}var eY=Z7();const tY=Ox(eY);var vM={exports:{}},yM={};var k2;function nY(){return k2||(k2=1,(function(r){function e(k,j){var J=k.length;k.push(j);e:for(;0<J;){var oe=J-1>>>1,K=k[oe];if(0<i(K,j))k[oe]=j,k[J]=K,J=oe;else break e}}function t(k){return k.length===0?null:k[0]}function n(k){if(k.length===0)return null;var j=k[0],J=k.pop();if(J!==j){k[0]=J;e:for(var oe=0,K=k.length,X=K>>>1;oe<X;){var ne=2*(oe+1)-1,xe=k[ne],_e=ne+1,Be=k[_e];if(0>i(xe,J))_e<K&&0>i(Be,xe)?(k[oe]=Be,k[_e]=J,oe=_e):(k[oe]=xe,k[ne]=J,oe=ne);else if(_e<K&&0>i(Be,J))k[oe]=Be,k[_e]=J,oe=_e;else break e}}return j}function i(k,j){var J=k.sortIndex-j.sortIndex;return J!==0?J:k.id-j.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();r.unstable_now=function(){return a.now()-o}}var c=[],u=[],h=1,p=null,v=3,y=!1,x=!1,S=!1,E=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;function R(k){for(var j=t(u);j!==null;){if(j.callback===null)n(u);else if(j.startTime<=k)n(u),j.sortIndex=j.expirationTime,e(c,j);else break;j=t(u)}}function D(k){if(S=!1,R(k),!x)if(t(c)!==null)x=!0,te();else{var j=t(u);j!==null&&re(D,j.startTime-k)}}var P=!1,O=-1,N=5,U=-1;function B(){return!(r.unstable_now()-U<N)}function I(){if(P){var k=r.unstable_now();U=k;var j=!0;try{e:{x=!1,S&&(S=!1,b(O),O=-1),y=!0;var J=v;try{t:{for(R(k),p=t(c);p!==null&&!(p.expirationTime>k&&B());){var oe=p.callback;if(typeof oe=="function"){p.callback=null,v=p.priorityLevel;var K=oe(p.expirationTime<=k);if(k=r.unstable_now(),typeof K=="function"){p.callback=K,R(k),j=!0;break t}p===t(c)&&n(c),R(k)}else n(c);p=t(c)}if(p!==null)j=!0;else{var X=t(u);X!==null&&re(D,X.startTime-k),j=!1}}break e}finally{p=null,v=J,y=!1}j=void 0}}finally{j?z():P=!1}}}var z;if(typeof T=="function")z=function(){T(I)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,Z=W.port2;W.port1.onmessage=I,z=function(){Z.postMessage(null)}}else z=function(){E(I,0)};function te(){P||(P=!0,z())}function re(k,j){O=E(function(){k(r.unstable_now())},j)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(k){k.callback=null},r.unstable_continueExecution=function(){x||y||(x=!0,te())},r.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<k?Math.floor(1e3/k):5},r.unstable_getCurrentPriorityLevel=function(){return v},r.unstable_getFirstCallbackNode=function(){return t(c)},r.unstable_next=function(k){switch(v){case 1:case 2:case 3:var j=3;break;default:j=v}var J=v;v=j;try{return k()}finally{v=J}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(k,j){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var J=v;v=k;try{return j()}finally{v=J}},r.unstable_scheduleCallback=function(k,j,J){var oe=r.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?oe+J:oe):J=oe,k){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=J+K,k={id:h++,callback:j,priorityLevel:k,startTime:J,expirationTime:K,sortIndex:-1},J>oe?(k.sortIndex=J,e(u,k),t(c)===null&&k===t(u)&&(S?(b(O),O=-1):S=!0,re(D,J-oe))):(k.sortIndex=K,e(c,k),x||y||(x=!0,te())),k},r.unstable_shouldYield=B,r.unstable_wrapCallback=function(k){var j=v;return function(){var J=v;v=j;try{return k.apply(this,arguments)}finally{v=J}}}})(yM)),yM}var G2;function iY(){return G2||(G2=1,vM.exports=nY()),vM.exports}var H2=iY();function PD(r,e,t){if(!r)return;if(t(r)===!0)return r;let n=e?r.return:r.child;for(;n;){const i=PD(n,e,t);if(i)return i;n=e?null:n.sibling}}function pN(r){try{return Object.defineProperties(r,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return r}}const ND=pN(Fe.createContext(null));class mN extends Fe.Component{render(){return Fe.createElement(ND.Provider,{value:this._reactInternals},this.props.children)}}function gN(){const r=Fe.useContext(ND);if(r===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=Fe.useId();return Fe.useMemo(()=>{for(const t of[r,r?.alternate]){if(!t)continue;const n=PD(t,!1,i=>{let s=i.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}});if(n)return n}},[r,e])}const sY=Symbol.for("react.context"),rY=r=>r!==null&&typeof r=="object"&&"$$typeof"in r&&r.$$typeof===sY;function aY(){const r=gN(),[e]=Fe.useState(()=>new Map);e.clear();let t=r;for(;t;){const n=t.type;rY(n)&&n!==ND&&!e.has(n)&&e.set(n,Fe.use(pN(n))),t=t.return}return e}function oY(){const r=aY();return Fe.useMemo(()=>Array.from(r.keys()).reduce((e,t)=>n=>Fe.createElement(e,null,Fe.createElement(t.Provider,{...n,value:r.get(t)})),e=>Fe.createElement(mN,{...e})),[r])}function vN(r){let e=r.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const yN=r=>r&&r.isOrthographicCamera,lY=r=>r&&r.hasOwnProperty("current"),cY=r=>r!=null&&(typeof r=="string"||typeof r=="number"||r.isColor),$x=((r,e)=>typeof window<"u"&&(((r=window.document)==null?void 0:r.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?Fe.useLayoutEffect:Fe.useEffect;function UD(r){const e=Fe.useRef(r);return $x(()=>void(e.current=r),[r]),e}function uY(){const r=gN(),e=oY();return Fe.useMemo(()=>({children:t})=>{const i=!!PD(r,!0,s=>s.type===Fe.StrictMode)?Fe.StrictMode:Fe.Fragment;return ye.jsx(i,{children:ye.jsx(e,{children:t})})},[r,e])}function fY({set:r}){return $x(()=>(r(new Promise(()=>null)),()=>r(!1)),[r]),null}const hY=(r=>(r=class extends Fe.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}},r.getDerivedStateFromError=()=>({error:!0}),r))();function xN(r){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(r)?Math.min(Math.max(r[0],t),r[1]):r}function _0(r){var e;return(e=r.__r3f)==null?void 0:e.root.getState()}const ls={obj:r=>r===Object(r)&&!ls.arr(r)&&typeof r!="function",fun:r=>typeof r=="function",str:r=>typeof r=="string",num:r=>typeof r=="number",boo:r=>typeof r=="boolean",und:r=>r===void 0,nul:r=>r===null,arr:r=>Array.isArray(r),equ(r,e,{arrays:t="shallow",objects:n="reference",strict:i=!0}={}){if(typeof r!=typeof e||!!r!=!!e)return!1;if(ls.str(r)||ls.num(r)||ls.boo(r))return r===e;const s=ls.obj(r);if(s&&n==="reference")return r===e;const a=ls.arr(r);if(a&&t==="reference")return r===e;if((a||s)&&r===e)return!0;let o;for(o in r)if(!(o in e))return!1;if(s&&t==="shallow"&&n==="shallow"){for(o in i?e:r)if(!ls.equ(r[o],e[o],{strict:i,objects:"reference"}))return!1}else for(o in i?e:r)if(r[o]!==e[o])return!1;if(ls.und(o)){if(a&&r.length===0&&e.length===0||s&&Object.keys(r).length===0&&Object.keys(e).length===0)return!0;if(r!==e)return!1}return!0}};function dY(r){const e={nodes:{},materials:{},meshes:{}};return r&&r.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material),t.isMesh&&!e.meshes[t.name]&&(e.meshes[t.name]=t)}),e}function pY(r){r.type!=="Scene"&&(r.dispose==null||r.dispose());for(const e in r){const t=r[e];t?.type!=="Scene"&&(t==null||t.dispose==null||t.dispose())}}const _N=["children","key","ref"];function mY(r){const e={};for(const t in r)_N.includes(t)||(e[t]=r[t]);return e}function ob(r,e,t,n){const i=r;let s=i?.__r3f;return s||(s={root:e,type:t,parent:null,children:[],props:mY(n),object:i,eventCount:0,handlers:{},isHidden:!1},i&&(i.__r3f=s)),s}function vx(r,e){if(!e.includes("-"))return{root:r,key:e,target:r[e]};if(e in r)return{root:r,key:e,target:r[e]};let t=r;const n=e.split("-");for(const i of n){if(typeof t!="object"||t===null){if(t!==void 0){const s=n.slice(n.indexOf(i)).join("-");return{root:t,key:s,target:void 0}}return{root:r,key:e,target:void 0}}e=i,r=t,t=t[e]}return{root:r,key:e,target:t}}const z2=/-\d+$/;function lb(r,e){if(ls.str(e.props.attach)){if(z2.test(e.props.attach)){const i=e.props.attach.replace(z2,""),{root:s,key:a}=vx(r.object,i);Array.isArray(s[a])||(s[a]=[])}const{root:t,key:n}=vx(r.object,e.props.attach);e.previousAttach=t[n],t[n]=e.object}else ls.fun(e.props.attach)&&(e.previousAttach=e.props.attach(r.object,e.object))}function cb(r,e){if(ls.str(e.props.attach)){const{root:t,key:n}=vx(r.object,e.props.attach),i=e.previousAttach;i===void 0?delete t[n]:t[n]=i}else e.previousAttach==null||e.previousAttach(r.object,e.object);delete e.previousAttach}const HC=[..._N,"args","dispose","attach","object","onUpdate","dispose"],V2=new Map;function gY(r){let e=V2.get(r.constructor);try{e||(e=new r.constructor,V2.set(r.constructor,e))}catch{}return e}function vY(r,e){const t={};for(const n in e)if(!HC.includes(n)&&!ls.equ(e[n],r.props[n])){t[n]=e[n];for(const i in e)i.startsWith(`${n}-`)&&(t[i]=e[i])}for(const n in r.props){if(HC.includes(n)||e.hasOwnProperty(n))continue;const{root:i,key:s}=vx(r.object,n);if(i.constructor&&i.constructor.length===0){const a=gY(i);ls.und(a)||(t[s]=a[s])}else t[s]=0}return t}const yY=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],xY=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function rc(r,e){var t;const n=r.__r3f,i=n&&vN(n).getState(),s=n?.eventCount;for(const o in e){let c=e[o];if(HC.includes(o))continue;if(n&&xY.test(o)){typeof c=="function"?n.handlers[o]=c:delete n.handlers[o],n.eventCount=Object.keys(n.handlers).length;continue}if(c===void 0)continue;let{root:u,key:h,target:p}=vx(r,o);if(p===void 0&&(typeof u!="object"||u===null))throw Error(`R3F: Cannot set "${o}". Ensure it is an object before setting "${h}".`);if(p instanceof cg&&c instanceof cg)p.mask=c.mask;else if(p instanceof Ot&&cY(c))p.set(c);else if(p!==null&&typeof p=="object"&&typeof p.set=="function"&&typeof p.copy=="function"&&c!=null&&c.constructor&&p.constructor===c.constructor)p.copy(c);else if(p!==null&&typeof p=="object"&&typeof p.set=="function"&&Array.isArray(c))typeof p.fromArray=="function"?p.fromArray(c):p.set(...c);else if(p!==null&&typeof p=="object"&&typeof p.set=="function"&&typeof c=="number")typeof p.setScalar=="function"?p.setScalar(c):p.set(c);else{var a;u[h]=c,i&&!i.linear&&yY.includes(h)&&(a=u[h])!=null&&a.isTexture&&u[h].format===Ns&&u[h].type===Ha&&(u[h].colorSpace=sr)}}if(n!=null&&n.parent&&i!=null&&i.internal&&(t=n.object)!=null&&t.isObject3D&&s!==n.eventCount){const o=n.object,c=i.internal.interaction.indexOf(o);c>-1&&i.internal.interaction.splice(c,1),n.eventCount&&o.raycast!==null&&i.internal.interaction.push(o)}return n&&n.props.attach===void 0&&(n.object.isBufferGeometry?n.props.attach="geometry":n.object.isMaterial&&(n.props.attach="material")),n&&Lg(n),r}function Lg(r){var e;if(!r.parent)return;r.props.onUpdate==null||r.props.onUpdate(r.object);const t=(e=r.root)==null||e.getState==null?void 0:e.getState();t&&t.internal.frames===0&&t.invalidate()}function SN(r,e){r.manual||(yN(r)?(r.left=e.width/-2,r.right=e.width/2,r.top=e.height/2,r.bottom=e.height/-2):r.aspect=e.width/e.height,r.updateProjectionMatrix())}const Pa=r=>r?.isObject3D;function fA(r){return(r.eventObject||r.object).uuid+"/"+r.index+r.instanceId}function AN(r,e,t,n){const i=t.get(e);i&&(t.delete(e),t.size===0&&(r.delete(n),i.target.releasePointerCapture(n)))}function _Y(r,e){const{internal:t}=r.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,i)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(i)}),t.capturedMap.forEach((n,i)=>{AN(t.capturedMap,e,n,i)})}function SY(r){function e(c){const{internal:u}=r.getState(),h=c.offsetX-u.initialClick[0],p=c.offsetY-u.initialClick[1];return Math.round(Math.sqrt(h*h+p*p))}function t(c){return c.filter(u=>["Move","Over","Enter","Out","Leave"].some(h=>{var p;return(p=u.__r3f)==null?void 0:p.handlers["onPointer"+h]}))}function n(c,u){const h=r.getState(),p=new Set,v=[],y=u?u(h.internal.interaction):h.internal.interaction;for(let b=0;b<y.length;b++){const T=_0(y[b]);T&&(T.raycaster.camera=void 0)}h.previousRoot||h.events.compute==null||h.events.compute(c,h);function x(b){const T=_0(b);if(!T||!T.events.enabled||T.raycaster.camera===null)return[];if(T.raycaster.camera===void 0){var R;T.events.compute==null||T.events.compute(c,T,(R=T.previousRoot)==null?void 0:R.getState()),T.raycaster.camera===void 0&&(T.raycaster.camera=null)}return T.raycaster.camera?T.raycaster.intersectObject(b,!0):[]}let S=y.flatMap(x).sort((b,T)=>{const R=_0(b.object),D=_0(T.object);return!R||!D?b.distance-T.distance:D.events.priority-R.events.priority||b.distance-T.distance}).filter(b=>{const T=fA(b);return p.has(T)?!1:(p.add(T),!0)});h.events.filter&&(S=h.events.filter(S,h));for(const b of S){let T=b.object;for(;T;){var E;(E=T.__r3f)!=null&&E.eventCount&&v.push({...b,eventObject:T}),T=T.parent}}if("pointerId"in c&&h.internal.capturedMap.has(c.pointerId))for(let b of h.internal.capturedMap.get(c.pointerId).values())p.has(fA(b.intersection))||v.push(b.intersection);return v}function i(c,u,h,p){if(c.length){const v={stopped:!1};for(const y of c){let x=_0(y.object);if(x||y.object.traverseAncestors(S=>{const E=_0(S);if(E)return x=E,!1}),x){const{raycaster:S,pointer:E,camera:b,internal:T}=x,R=new ae(E.x,E.y,0).unproject(b),D=B=>{var I,z;return(I=(z=T.capturedMap.get(B))==null?void 0:z.has(y.eventObject))!=null?I:!1},P=B=>{const I={intersection:y,target:u.target};T.capturedMap.has(B)?T.capturedMap.get(B).set(y.eventObject,I):T.capturedMap.set(B,new Map([[y.eventObject,I]])),u.target.setPointerCapture(B)},O=B=>{const I=T.capturedMap.get(B);I&&AN(T.capturedMap,y.eventObject,I,B)};let N={};for(let B in u){let I=u[B];typeof I!="function"&&(N[B]=I)}let U={...y,...N,pointer:E,intersections:c,stopped:v.stopped,delta:h,unprojectedPoint:R,ray:S.ray,camera:b,stopPropagation(){const B="pointerId"in u&&T.capturedMap.get(u.pointerId);if((!B||B.has(y.eventObject))&&(U.stopped=v.stopped=!0,T.hovered.size&&Array.from(T.hovered.values()).find(I=>I.eventObject===y.eventObject))){const I=c.slice(0,c.indexOf(y));s([...I,y])}},target:{hasPointerCapture:D,setPointerCapture:P,releasePointerCapture:O},currentTarget:{hasPointerCapture:D,setPointerCapture:P,releasePointerCapture:O},nativeEvent:u};if(p(U),v.stopped===!0)break}}}return c}function s(c){const{internal:u}=r.getState();for(const h of u.hovered.values())if(!c.length||!c.find(p=>p.object===h.object&&p.index===h.index&&p.instanceId===h.instanceId)){const v=h.eventObject.__r3f;if(u.hovered.delete(fA(h)),v!=null&&v.eventCount){const y=v.handlers,x={...h,intersections:c};y.onPointerOut==null||y.onPointerOut(x),y.onPointerLeave==null||y.onPointerLeave(x)}}}function a(c,u){for(let h=0;h<u.length;h++){const p=u[h].__r3f;p==null||p.handlers.onPointerMissed==null||p.handlers.onPointerMissed(c)}}function o(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return u=>{const{internal:h}=r.getState();"pointerId"in u&&h.capturedMap.has(u.pointerId)&&requestAnimationFrame(()=>{h.capturedMap.has(u.pointerId)&&(h.capturedMap.delete(u.pointerId),s([]))})}}return function(h){const{onPointerMissed:p,internal:v}=r.getState();v.lastEvent.current=h;const y=c==="onPointerMove",x=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",E=n(h,y?t:void 0),b=x?e(h):0;c==="onPointerDown"&&(v.initialClick=[h.offsetX,h.offsetY],v.initialHits=E.map(R=>R.eventObject)),x&&!E.length&&b<=2&&(a(h,v.interaction),p&&p(h)),y&&s(E);function T(R){const D=R.eventObject,P=D.__r3f;if(!(P!=null&&P.eventCount))return;const O=P.handlers;if(y){if(O.onPointerOver||O.onPointerEnter||O.onPointerOut||O.onPointerLeave){const N=fA(R),U=v.hovered.get(N);U?U.stopped&&R.stopPropagation():(v.hovered.set(N,R),O.onPointerOver==null||O.onPointerOver(R),O.onPointerEnter==null||O.onPointerEnter(R))}O.onPointerMove==null||O.onPointerMove(R)}else{const N=O[c];N?(!x||v.initialHits.includes(D))&&(a(h,v.interaction.filter(U=>!v.initialHits.includes(U))),N(R)):x&&v.initialHits.includes(D)&&a(h,v.interaction.filter(U=>!v.initialHits.includes(U)))}}i(E,h,b,T)}}return{handlePointer:o}}const Y2=r=>!!(r!=null&&r.render),FD=Fe.createContext(null),AY=(r,e)=>{const t=uN((o,c)=>{const u=new ae,h=new ae,p=new ae;function v(b=c().camera,T=h,R=c().size){const{width:D,height:P,top:O,left:N}=R,U=D/P;T.isVector3?p.copy(T):p.set(...T);const B=b.getWorldPosition(u).distanceTo(p);if(yN(b))return{width:D/b.zoom,height:P/b.zoom,top:O,left:N,factor:1,distance:B,aspect:U};{const I=b.fov*Math.PI/180,z=2*Math.tan(I/2)*B,W=z*(D/P);return{width:W,height:z,top:O,left:N,factor:D/W,distance:B,aspect:U}}}let y;const x=b=>o(T=>({performance:{...T.performance,current:b}})),S=new at;return{set:o,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(b=1)=>r(c(),b),advance:(b,T)=>e(b,T,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new RD,pointer:S,mouse:S,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const b=c();y&&clearTimeout(y),b.performance.current!==b.performance.min&&x(b.performance.min),y=setTimeout(()=>x(c().performance.max),b.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:v},setEvents:b=>o(T=>({...T,events:{...T.events,...b}})),setSize:(b,T,R=0,D=0)=>{const P=c().camera,O={width:b,height:T,top:R,left:D};o(N=>({size:O,viewport:{...N.viewport,...v(P,h,O)}}))},setDpr:b=>o(T=>{const R=xN(b);return{viewport:{...T.viewport,dpr:R,initialDpr:T.viewport.initialDpr||R}}}),setFrameloop:(b="always")=>{const T=c().clock;T.stop(),T.elapsedTime=0,b!=="never"&&(T.start(),T.elapsedTime=0),o(()=>({frameloop:b}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:Fe.createRef(),active:!1,frames:0,priority:0,subscribe:(b,T,R)=>{const D=c().internal;return D.priority=D.priority+(T>0?1:0),D.subscribers.push({ref:b,priority:T,store:R}),D.subscribers=D.subscribers.sort((P,O)=>P.priority-O.priority),()=>{const P=c().internal;P!=null&&P.subscribers&&(P.priority=P.priority-(T>0?1:0),P.subscribers=P.subscribers.filter(O=>O.ref!==b))}}}}}),n=t.getState();let i=n.size,s=n.viewport.dpr,a=n.camera;return t.subscribe(()=>{const{camera:o,size:c,viewport:u,gl:h,set:p}=t.getState();if(c.width!==i.width||c.height!==i.height||u.dpr!==s){i=c,s=u.dpr,SN(o,c),u.dpr>0&&h.setPixelRatio(u.dpr);const v=typeof HTMLCanvasElement<"u"&&h.domElement instanceof HTMLCanvasElement;h.setSize(c.width,c.height,v)}o!==a&&(a=o,p(v=>({viewport:{...v.viewport,...v.viewport.getCurrentViewport(o)}})))}),t.subscribe(o=>r(o)),t};function kD(){const r=Fe.useContext(FD);if(!r)throw new Error("R3F: Hooks can only be used within the Canvas component!");return r}function sa(r=t=>t,e){return kD()(r,e)}function GD(r,e=0){const t=kD(),n=t.getState().internal.subscribe,i=UD(r);return $x(()=>n(i,e,t),[e,n,t]),null}const X2=new WeakMap,EY=r=>{var e;return typeof r=="function"&&(r==null||(e=r.prototype)==null?void 0:e.constructor)===r};function EN(r,e){return function(t,...n){let i;return EY(t)?(i=X2.get(t),i||(i=new t,X2.set(t,i))):i=t,r&&r(i),Promise.all(n.map(s=>new Promise((a,o)=>i.load(s,c=>{Pa(c?.scene)&&Object.assign(c,dY(c.scene)),a(c)},e,c=>o(new Error(`Could not load ${s}: ${c?.message}`))))))}}function El(r,e,t,n){const i=Array.isArray(e)?e:[e],s=dN(EN(t,n),[r,...i],{equal:ls.equ});return Array.isArray(e)?s:s[0]}El.preload=function(r,e,t){const n=Array.isArray(e)?e:[e];return j7(EN(t),[r,...n])};El.clear=function(r,e){const t=Array.isArray(e)?e:[e];return W7([r,...t])};var bY={version:"9.4.2"};function TY(r){const e=tY(r);return e.injectIntoDevTools(),e}const bN=0,dg={},MY=/^three(?=[A-Z])/,vT=r=>`${r[0].toUpperCase()}${r.slice(1)}`;let CY=0;const RY=r=>typeof r=="function";function TN(r){if(RY(r)){const e=`${CY++}`;return dg[e]=r,e}else Object.assign(dg,r)}function MN(r,e){const t=vT(r),n=dg[t];if(r!=="primitive"&&!n)throw new Error(`R3F: ${t} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(r==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function DY(r,e,t){var n;return r=vT(r)in dg?r:r.replace(MY,""),MN(r,e),r==="primitive"&&(n=e.object)!=null&&n.__r3f&&delete e.object.__r3f,ob(e.object,t,r,e)}function LY(r){if(!r.isHidden){var e;r.props.attach&&(e=r.parent)!=null&&e.object?cb(r.parent,r):Pa(r.object)&&(r.object.visible=!1),r.isHidden=!0,Lg(r)}}function CN(r){if(r.isHidden){var e;r.props.attach&&(e=r.parent)!=null&&e.object?lb(r.parent,r):Pa(r.object)&&r.props.visible!==!1&&(r.object.visible=!0),r.isHidden=!1,Lg(r)}}function HD(r,e,t){const n=e.root.getState();if(!(!r.parent&&r.object!==n.scene)){if(!e.object){var i,s;const a=dg[vT(e.type)];e.object=(i=e.props.object)!=null?i:new a(...(s=e.props.args)!=null?s:[]),e.object.__r3f=e}if(rc(e.object,e.props),e.props.attach)lb(r,e);else if(Pa(e.object)&&Pa(r.object)){const a=r.object.children.indexOf(t?.object);if(t&&a!==-1){const o=r.object.children.indexOf(e.object);if(o!==-1){r.object.children.splice(o,1);const c=o<a?a-1:a;r.object.children.splice(c,0,e.object)}else e.object.parent=r.object,r.object.children.splice(a,0,e.object),e.object.dispatchEvent({type:"added"}),r.object.dispatchEvent({type:"childadded",child:e.object})}else r.object.add(e.object)}for(const a of e.children)HD(e,a);Lg(e)}}function xM(r,e){e&&(e.parent=r,r.children.push(e),HD(r,e))}function K2(r,e,t){if(!e||!t)return;e.parent=r;const n=r.children.indexOf(t);n!==-1?r.children.splice(n,0,e):r.children.push(e),HD(r,e,t)}function RN(r){if(typeof r.dispose=="function"){const e=()=>{try{r.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():H2.unstable_scheduleCallback(H2.unstable_IdlePriority,e)}}function zC(r,e,t){if(!e)return;e.parent=null;const n=r.children.indexOf(e);n!==-1&&r.children.splice(n,1),e.props.attach?cb(r,e):Pa(e.object)&&Pa(r.object)&&(r.object.remove(e.object),_Y(vN(e),e.object));const i=e.props.dispose!==null&&t!==!1;for(let s=e.children.length-1;s>=0;s--){const a=e.children[s];zC(e,a,i)}e.children.length=0,delete e.object.__r3f,i&&e.type!=="primitive"&&e.object.type!=="Scene"&&RN(e.object),t===void 0&&Lg(e)}function wY(r,e){for(const t of[r,r.alternate])if(t!==null)if(typeof t.ref=="function"){t.refCleanup==null||t.refCleanup();const n=t.ref(e);typeof n=="function"&&(t.refCleanup=n)}else t.ref&&(t.ref.current=e)}const tE=[];function IY(){for(const[t]of tE){const n=t.parent;if(n){t.props.attach?cb(n,t):Pa(t.object)&&Pa(n.object)&&n.object.remove(t.object);for(const i of t.children)i.props.attach?cb(t,i):Pa(i.object)&&Pa(t.object)&&t.object.remove(i.object)}t.isHidden&&CN(t),t.object.__r3f&&delete t.object.__r3f,t.type!=="primitive"&&RN(t.object)}for(const[t,n,i]of tE){t.props=n;const s=t.parent;if(s){var r,e;const a=dg[vT(t.type)];t.object=(r=t.props.object)!=null?r:new a(...(e=t.props.args)!=null?e:[]),t.object.__r3f=t,wY(i,t.object),rc(t.object,t.props),t.props.attach?lb(s,t):Pa(t.object)&&Pa(s.object)&&s.object.add(t.object);for(const o of t.children)o.props.attach?lb(t,o):Pa(o.object)&&Pa(t.object)&&t.object.add(o.object);Lg(t)}}tE.length=0}const _M=()=>{},q2={};let hA=bN;const BY=0,OY=4,ub=TY({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:DY,removeChild:zC,appendChild:xM,appendInitialChild:xM,insertBefore:K2,appendChildToContainer(r,e){const t=r.getState().scene.__r3f;!e||!t||xM(t,e)},removeChildFromContainer(r,e){const t=r.getState().scene.__r3f;!e||!t||zC(t,e)},insertInContainerBefore(r,e,t){const n=r.getState().scene.__r3f;!e||!t||!n||K2(n,e,t)},getRootHostContext:()=>q2,getChildHostContext:()=>q2,commitUpdate(r,e,t,n,i){var s,a,o;MN(e,n);let c=!1;if((r.type==="primitive"&&t.object!==n.object||((s=n.args)==null?void 0:s.length)!==((a=t.args)==null?void 0:a.length)||(o=n.args)!=null&&o.some((h,p)=>{var v;return h!==((v=t.args)==null?void 0:v[p])}))&&(c=!0),c)tE.push([r,{...n},i]);else{const h=vY(r,n);Object.keys(h).length&&(Object.assign(r.props,h),rc(r.object,h))}(i.sibling===null||(i.flags&OY)===BY)&&IY()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:r=>r?.object,prepareForCommit:()=>null,preparePortalMount:r=>ob(r.getState().scene,r,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:LY,unhideInstance:CN,createTextInstance:_M,hideTextInstance:_M,unhideTextInstance:_M,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:Fe.createContext(null),setCurrentUpdatePriority(r){hA=r},getCurrentUpdatePriority(){return hA},resolveUpdatePriority(){var r;if(hA!==bN)return hA;switch(typeof window<"u"&&((r=window.event)==null?void 0:r.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return $A.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return $A.ContinuousEventPriority;default:return $A.DefaultEventPriority}},resetFormInstance(){},rendererPackageName:"@react-three/fiber",rendererVersion:bY.version}),Pp=new Map,S0={objects:"shallow",strict:!1};function PY(r,e){if(!e&&typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement&&r.parentElement){const{width:t,height:n,top:i,left:s}=r.parentElement.getBoundingClientRect();return{width:t,height:n,top:i,left:s}}else if(!e&&typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas)return{width:r.width,height:r.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function NY(r){const e=Pp.get(r),t=e?.fiber,n=e?.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,s=n||AY(XC,W2),a=t||ub.createContainer(s,$A.ConcurrentRoot,null,!1,null,"",i,i,i,null);e||Pp.set(r,{fiber:a,store:s});let o,c,u=!1,h=null;return{async configure(p={}){let v;h=new Promise(X=>v=X);let{gl:y,size:x,scene:S,events:E,onCreated:b,shadows:T=!1,linear:R=!1,flat:D=!1,legacy:P=!1,orthographic:O=!1,frameloop:N="always",dpr:U=[1,2],performance:B,raycaster:I,camera:z,onPointerMissed:W}=p,Z=s.getState(),te=Z.gl;if(!Z.gl){const X={canvas:r,powerPreference:"high-performance",antialias:!0,alpha:!0},ne=typeof y=="function"?await y(X):y;Y2(ne)?te=ne:te=new OD({...X,...y}),Z.set({gl:te})}let re=Z.raycaster;re||Z.set({raycaster:re=new ID});const{params:k,...j}=I||{};if(ls.equ(j,re,S0)||rc(re,{...j}),ls.equ(k,re.params,S0)||rc(re,{params:{...re.params,...k}}),!Z.camera||Z.camera===c&&!ls.equ(c,z,S0)){c=z;const X=z?.isCamera,ne=X?z:O?new _l(0,0,0,0,.1,1e3):new cs(75,0,.1,1e3);X||(ne.position.z=5,z&&(rc(ne,z),ne.manual||("aspect"in z||"left"in z||"right"in z||"bottom"in z||"top"in z)&&(ne.manual=!0,ne.updateProjectionMatrix())),!Z.camera&&!(z!=null&&z.rotation)&&ne.lookAt(0,0,0)),Z.set({camera:ne}),re.camera=ne}if(!Z.scene){let X;S!=null&&S.isScene?(X=S,ob(X,s,"",{})):(X=new Hx,ob(X,s,"",{}),S&&rc(X,S)),Z.set({scene:X})}E&&!Z.events.handlers&&Z.set({events:E(s)});const J=PY(r,x);if(ls.equ(J,Z.size,S0)||Z.setSize(J.width,J.height,J.top,J.left),U&&Z.viewport.dpr!==xN(U)&&Z.setDpr(U),Z.frameloop!==N&&Z.setFrameloop(N),Z.onPointerMissed||Z.set({onPointerMissed:W}),B&&!ls.equ(B,Z.performance,S0)&&Z.set(X=>({performance:{...X.performance,...B}})),!Z.xr){var oe;const X=(_e,Be)=>{const pe=s.getState();pe.frameloop!=="never"&&W2(_e,!0,pe,Be)},ne=()=>{const _e=s.getState();_e.gl.xr.enabled=_e.gl.xr.isPresenting,_e.gl.xr.setAnimationLoop(_e.gl.xr.isPresenting?X:null),_e.gl.xr.isPresenting||XC(_e)},xe={connect(){const _e=s.getState().gl;_e.xr.addEventListener("sessionstart",ne),_e.xr.addEventListener("sessionend",ne)},disconnect(){const _e=s.getState().gl;_e.xr.removeEventListener("sessionstart",ne),_e.xr.removeEventListener("sessionend",ne)}};typeof((oe=te.xr)==null?void 0:oe.addEventListener)=="function"&&xe.connect(),Z.set({xr:xe})}if(te.shadowMap){const X=te.shadowMap.enabled,ne=te.shadowMap.type;if(te.shadowMap.enabled=!!T,ls.boo(T))te.shadowMap.type=Py;else if(ls.str(T)){var K;const xe={basic:xO,percentage:Nb,soft:Py,variance:ic};te.shadowMap.type=(K=xe[T])!=null?K:Py}else ls.obj(T)&&Object.assign(te.shadowMap,T);(X!==te.shadowMap.enabled||ne!==te.shadowMap.type)&&(te.shadowMap.needsUpdate=!0)}return hi.enabled=!P,u||(te.outputColorSpace=R?cc:sr,te.toneMapping=D?su:YR),Z.legacy!==P&&Z.set(()=>({legacy:P})),Z.linear!==R&&Z.set(()=>({linear:R})),Z.flat!==D&&Z.set(()=>({flat:D})),y&&!ls.fun(y)&&!Y2(y)&&!ls.equ(y,te,S0)&&rc(te,y),o=b,u=!0,v(),this},render(p){return!u&&!h&&this.configure(),h.then(()=>{ub.updateContainer(ye.jsx(UY,{store:s,children:p,onCreated:o,rootElement:r}),a,null,()=>{})}),s},unmount(){DN(r)}}}function UY({store:r,children:e,onCreated:t,rootElement:n}){return $x(()=>{const i=r.getState();i.set(s=>({internal:{...s.internal,active:!0}})),t&&t(i),r.getState().events.connected||i.events.connect==null||i.events.connect(n)},[]),ye.jsx(FD.Provider,{value:r,children:e})}function DN(r,e){const t=Pp.get(r),n=t?.fiber;if(n){const i=t?.store.getState();i&&(i.internal.active=!1),ub.updateContainer(null,n,null,()=>{i&&setTimeout(()=>{try{var s,a,o,c;i.events.disconnect==null||i.events.disconnect(),(s=i.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(o=i.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(c=i.gl)!=null&&c.xr&&i.xr.disconnect(),pY(i.scene),Pp.delete(r)}catch{}},500)})}}function FY(r,e,t){return ye.jsx(kY,{children:r,container:e,state:t})}function kY({state:r={},children:e,container:t}){const{events:n,size:i,...s}=r,a=kD(),[o]=Fe.useState(()=>new ID),[c]=Fe.useState(()=>new at),u=UD((p,v)=>{let y;if(v.camera&&i){const x=v.camera;y=p.viewport.getCurrentViewport(x,new ae,i),x!==p.camera&&SN(x,i)}return{...p,...v,scene:t,raycaster:o,pointer:c,mouse:c,previousRoot:a,events:{...p.events,...v.events,...n},size:{...p.size,...i},viewport:{...p.viewport,...y},setEvents:x=>v.set(S=>({...S,events:{...S.events,...x}}))}}),h=Fe.useMemo(()=>{const p=uN((y,x)=>({...s,set:y,get:x})),v=y=>p.setState(x=>u.current(y,x));return v(a.getState()),a.subscribe(v),p},[a,t]);return ye.jsx(ye.Fragment,{children:ub.createPortal(ye.jsx(FD.Provider,{value:h,children:e}),h,null)})}const GY=new Set,HY=new Set,zY=new Set;function SM(r,e){if(r.size)for(const{callback:t}of r.values())t(e)}function Vy(r,e){switch(r){case"before":return SM(GY,e);case"after":return SM(HY,e);case"tail":return SM(zY,e)}}let AM,EM;function VC(r,e,t){let n=e.clock.getDelta();e.frameloop==="never"&&typeof r=="number"&&(n=r-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=r),AM=e.internal.subscribers;for(let i=0;i<AM.length;i++)EM=AM[i],EM.ref.current(EM.store.getState(),n,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let fb=!1,YC=!1,bM,j2,A0;function LN(r){j2=requestAnimationFrame(LN),fb=!0,bM=0,Vy("before",r),YC=!0;for(const t of Pp.values()){var e;A0=t.store.getState(),A0.internal.active&&(A0.frameloop==="always"||A0.internal.frames>0)&&!((e=A0.gl.xr)!=null&&e.isPresenting)&&(bM+=VC(r,A0))}if(YC=!1,Vy("after",r),bM===0)return Vy("tail",r),fb=!1,cancelAnimationFrame(j2)}function XC(r,e=1){var t;if(!r)return Pp.forEach(n=>XC(n.store.getState(),e));(t=r.gl.xr)!=null&&t.isPresenting||!r.internal.active||r.frameloop==="never"||(e>1?r.internal.frames=Math.min(60,r.internal.frames+e):YC?r.internal.frames=2:r.internal.frames=1,fb||(fb=!0,requestAnimationFrame(LN)))}function W2(r,e=!0,t,n){if(e&&Vy("before",r),t)VC(r,t,n);else for(const i of Pp.values())VC(r,i.store.getState());e&&Vy("after",r)}const TM={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function VY(r){const{handlePointer:e}=SY(r);return{priority:1,enabled:!0,compute(t,n,i){n.pointer.set(t.offsetX/n.size.width*2-1,-(t.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(TM).reduce((t,n)=>({...t,[n]:e(n)}),{}),update:()=>{var t;const{events:n,internal:i}=r.getState();(t=i.lastEvent)!=null&&t.current&&n.handlers&&n.handlers.onPointerMove(i.lastEvent.current)},connect:t=>{const{set:n,events:i}=r.getState();if(i.disconnect==null||i.disconnect(),n(s=>({events:{...s.events,connected:t}})),i.handlers)for(const s in i.handlers){const a=i.handlers[s],[o,c]=TM[s];t.addEventListener(o,a,{passive:c})}},disconnect:()=>{const{set:t,events:n}=r.getState();if(n.connected){if(n.handlers)for(const i in n.handlers){const s=n.handlers[i],[a]=TM[i];n.connected.removeEventListener(a,s)}t(i=>({events:{...i.events,connected:void 0}}))}}}}function J2(r,e){let t;return(...n)=>{window.clearTimeout(t),t=window.setTimeout(()=>r(...n),e)}}function YY({debounce:r,scroll:e,polyfill:t,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){const i=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,a]=Fe.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=Fe.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),c=r?typeof r=="number"?r:r.scroll:null,u=r?typeof r=="number"?r:r.resize:null,h=Fe.useRef(!1);Fe.useEffect(()=>(h.current=!0,()=>void(h.current=!1)));const[p,v,y]=Fe.useMemo(()=>{const b=()=>{if(!o.current.element)return;const{left:T,top:R,width:D,height:P,bottom:O,right:N,x:U,y:B}=o.current.element.getBoundingClientRect(),I={left:T,top:R,width:D,height:P,bottom:O,right:N,x:U,y:B};o.current.element instanceof HTMLElement&&n&&(I.height=o.current.element.offsetHeight,I.width=o.current.element.offsetWidth),Object.freeze(I),h.current&&!jY(o.current.lastBounds,I)&&a(o.current.lastBounds=I)};return[b,u?J2(b,u):b,c?J2(b,c):b]},[a,n,c,u]);function x(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(b=>b.removeEventListener("scroll",y,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function S(){o.current.element&&(o.current.resizeObserver=new i(y),o.current.resizeObserver.observe(o.current.element),e&&o.current.scrollContainers&&o.current.scrollContainers.forEach(b=>b.addEventListener("scroll",y,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{y()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const E=b=>{!b||b===o.current.element||(x(),o.current.element=b,o.current.scrollContainers=wN(b),S())};return KY(y,!!e),XY(v),Fe.useEffect(()=>{x(),S()},[e,y,v]),Fe.useEffect(()=>x,[]),[E,s,p]}function XY(r){Fe.useEffect(()=>{const e=r;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[r])}function KY(r,e){Fe.useEffect(()=>{if(e){const t=r;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[r,e])}function wN(r){const e=[];if(!r||r===document.body)return e;const{overflow:t,overflowX:n,overflowY:i}=window.getComputedStyle(r);return[t,n,i].some(s=>s==="auto"||s==="scroll")&&e.push(r),[...e,...wN(r.parentElement)]}const qY=["x","y","top","bottom","left","right","width","height"],jY=(r,e)=>qY.every(t=>r[t]===e[t]);function WY({ref:r,children:e,fallback:t,resize:n,style:i,gl:s,events:a=VY,eventSource:o,eventPrefix:c,shadows:u,linear:h,flat:p,legacy:v,orthographic:y,frameloop:x,dpr:S,performance:E,raycaster:b,camera:T,scene:R,onPointerMissed:D,onCreated:P,...O}){Fe.useMemo(()=>TN(U7),[]);const N=uY(),[U,B]=YY({scroll:!0,debounce:{scroll:50,resize:0},...n}),I=Fe.useRef(null),z=Fe.useRef(null);Fe.useImperativeHandle(r,()=>I.current);const W=UD(D),[Z,te]=Fe.useState(!1),[re,k]=Fe.useState(!1);if(Z)throw Z;if(re)throw re;const j=Fe.useRef(null);$x(()=>{const oe=I.current;if(B.width>0&&B.height>0&&oe){j.current||(j.current=NY(oe));async function K(){await j.current.configure({gl:s,scene:R,events:a,shadows:u,linear:h,flat:p,legacy:v,orthographic:y,frameloop:x,dpr:S,performance:E,raycaster:b,camera:T,size:B,onPointerMissed:(...X)=>W.current==null?void 0:W.current(...X),onCreated:X=>{X.events.connect==null||X.events.connect(o?lY(o)?o.current:o:z.current),c&&X.setEvents({compute:(ne,xe)=>{const _e=ne[c+"X"],Be=ne[c+"Y"];xe.pointer.set(_e/xe.size.width*2-1,-(Be/xe.size.height)*2+1),xe.raycaster.setFromCamera(xe.pointer,xe.camera)}}),P?.(X)}}),j.current.render(ye.jsx(N,{children:ye.jsx(hY,{set:k,children:ye.jsx(Fe.Suspense,{fallback:ye.jsx(fY,{set:te}),children:e??null})})}))}K()}}),Fe.useEffect(()=>{const oe=I.current;if(oe)return()=>DN(oe)},[]);const J=o?"none":"auto";return ye.jsx("div",{ref:z,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:J,...i},...O,children:ye.jsx("div",{ref:U,style:{width:"100%",height:"100%"},children:ye.jsx("canvas",{ref:I,style:{display:"block"},children:t})})})}function IN(r){return ye.jsx(mN,{children:ye.jsx(WY,{...r})})}function Np(){return Np=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Np.apply(null,arguments)}const Qx=new ae,zD=new ae,JY=new ae,$2=new at;function $Y(r,e,t){const n=Qx.setFromMatrixPosition(r.matrixWorld);n.project(e);const i=t.width/2,s=t.height/2;return[n.x*i+i,-(n.y*s)+s]}function QY(r,e){const t=Qx.setFromMatrixPosition(r.matrixWorld),n=zD.setFromMatrixPosition(e.matrixWorld),i=t.sub(n),s=e.getWorldDirection(JY);return i.angleTo(s)>Math.PI/2}function ZY(r,e,t,n){const i=Qx.setFromMatrixPosition(r.matrixWorld),s=i.clone();s.project(e),$2.set(s.x,s.y),t.setFromCamera($2,e);const a=t.intersectObjects(n,!0);if(a.length){const o=a[0].distance;return i.distanceTo(t.ray.origin)<o}return!0}function eX(r,e){if(e instanceof _l)return e.zoom;if(e instanceof cs){const t=Qx.setFromMatrixPosition(r.matrixWorld),n=zD.setFromMatrixPosition(e.matrixWorld),i=e.fov*Math.PI/180,s=t.distanceTo(n);return 1/(2*Math.tan(i/2)*s)}else return 1}function tX(r,e,t){if(e instanceof cs||e instanceof _l){const n=Qx.setFromMatrixPosition(r.matrixWorld),i=zD.setFromMatrixPosition(e.matrixWorld),s=n.distanceTo(i),a=(t[1]-t[0])/(e.far-e.near),o=t[1]-a*e.far;return Math.round(a*s+o)}}const KC=r=>Math.abs(r)<1e-10?0:r;function BN(r,e,t=""){let n="matrix3d(";for(let i=0;i!==16;i++)n+=KC(e[i]*r.elements[i])+(i!==15?",":")");return t+n}const nX=(r=>e=>BN(e,r))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),iX=(r=>(e,t)=>BN(e,r(t),"translate(-50%,-50%)"))(r=>[1/r,1/r,1/r,1,-1/r,-1/r,-1/r,-1,1/r,1/r,1/r,1,1,1,1,1]);function sX(r){return r&&typeof r=="object"&&"current"in r}const rX=Fe.forwardRef(({children:r,eps:e=.001,style:t,className:n,prepend:i,center:s,fullscreen:a,portal:o,distanceFactor:c,sprite:u=!1,transform:h=!1,occlude:p,onOcclude:v,castShadow:y,receiveShadow:x,material:S,geometry:E,zIndexRange:b=[16777271,0],calculatePosition:T=$Y,as:R="div",wrapperClass:D,pointerEvents:P="auto",...O},N)=>{const{gl:U,camera:B,scene:I,size:z,raycaster:W,events:Z,viewport:te}=sa(),[re]=Fe.useState(()=>document.createElement(R)),k=Fe.useRef(null),j=Fe.useRef(null),J=Fe.useRef(0),oe=Fe.useRef([0,0]),K=Fe.useRef(null),X=Fe.useRef(null),ne=o?.current||Z.connected||U.domElement.parentNode,xe=Fe.useRef(null),_e=Fe.useRef(!1),Be=Fe.useMemo(()=>p&&p!=="blending"||Array.isArray(p)&&p.length&&sX(p[0]),[p]);Fe.useLayoutEffect(()=>{const St=U.domElement;p&&p==="blending"?(St.style.zIndex=`${Math.floor(b[0]/2)}`,St.style.position="absolute",St.style.pointerEvents="none"):(St.style.zIndex=null,St.style.position=null,St.style.pointerEvents=null)},[p]),Fe.useLayoutEffect(()=>{if(j.current){const St=k.current=pO.createRoot(re);if(I.updateMatrixWorld(),h)re.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const At=T(j.current,B,z);re.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${At[0]}px,${At[1]}px,0);transform-origin:0 0;`}return ne&&(i?ne.prepend(re):ne.appendChild(re)),()=>{ne&&ne.removeChild(re),St.unmount()}}},[ne,h]),Fe.useLayoutEffect(()=>{D&&(re.className=D)},[D]);const pe=Fe.useMemo(()=>h?{position:"absolute",top:0,left:0,width:z.width,height:z.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...a&&{top:-z.height/2,left:-z.width/2,width:z.width,height:z.height},...t},[t,s,a,z,h]),be=Fe.useMemo(()=>({position:"absolute",pointerEvents:P}),[P]);Fe.useLayoutEffect(()=>{if(_e.current=!1,h){var St;(St=k.current)==null||St.render(Fe.createElement("div",{ref:K,style:pe},Fe.createElement("div",{ref:X,style:be},Fe.createElement("div",{ref:N,className:n,style:t,children:r}))))}else{var At;(At=k.current)==null||At.render(Fe.createElement("div",{ref:N,style:pe,className:n,children:r}))}});const je=Fe.useRef(!0);GD(St=>{if(j.current){B.updateMatrixWorld(),j.current.updateWorldMatrix(!0,!1);const At=h?oe.current:T(j.current,B,z);if(h||Math.abs(J.current-B.zoom)>e||Math.abs(oe.current[0]-At[0])>e||Math.abs(oe.current[1]-At[1])>e){const jt=QY(j.current,B);let vt=!1;Be&&(Array.isArray(p)?vt=p.map(ue=>ue.current):p!=="blending"&&(vt=[I]));const ze=je.current;if(vt){const ue=ZY(j.current,B,W,vt);je.current=ue&&!jt}else je.current=!jt;ze!==je.current&&(v?v(!je.current):re.style.display=je.current?"block":"none");const ie=Math.floor(b[0]/2),Oe=p?Be?[b[0],ie]:[ie-1,0]:b;if(re.style.zIndex=`${tX(j.current,B,Oe)}`,h){const[ue,st]=[z.width/2,z.height/2],$e=B.projectionMatrix.elements[5]*st,{isOrthographicCamera:_t,top:it,left:Tt,bottom:se,right:q}=B,Ee=nX(B.matrixWorldInverse),Ge=_t?`scale(${$e})translate(${KC(-(q+Tt)/2)}px,${KC((it+se)/2)}px)`:`translateZ(${$e}px)`;let Ve=j.current.matrixWorld;u&&(Ve=B.matrixWorldInverse.clone().transpose().copyPosition(Ve).scale(j.current.scale),Ve.elements[3]=Ve.elements[7]=Ve.elements[11]=0,Ve.elements[15]=1),re.style.width=z.width+"px",re.style.height=z.height+"px",re.style.perspective=_t?"":`${$e}px`,K.current&&X.current&&(K.current.style.transform=`${Ge}${Ee}translate(${ue}px,${st}px)`,X.current.style.transform=iX(Ve,1/((c||10)/400)))}else{const ue=c===void 0?1:eX(j.current,B)*c;re.style.transform=`translate3d(${At[0]}px,${At[1]}px,0) scale(${ue})`}oe.current=At,J.current=B.zoom}}if(!Be&&xe.current&&!_e.current)if(h){if(K.current){const At=K.current.children[0];if(At!=null&&At.clientWidth&&At!=null&&At.clientHeight){const{isOrthographicCamera:jt}=B;if(jt||E)O.scale&&(Array.isArray(O.scale)?O.scale instanceof ae?xe.current.scale.copy(O.scale.clone().divideScalar(1)):xe.current.scale.set(1/O.scale[0],1/O.scale[1],1/O.scale[2]):xe.current.scale.setScalar(1/O.scale));else{const vt=(c||10)/400,ze=At.clientWidth*vt,ie=At.clientHeight*vt;xe.current.scale.set(ze,ie,1)}_e.current=!0}}}else{const At=re.children[0];if(At!=null&&At.clientWidth&&At!=null&&At.clientHeight){const jt=1/te.factor,vt=At.clientWidth*jt,ze=At.clientHeight*jt;xe.current.scale.set(vt,ze,1),_e.current=!0}xe.current.lookAt(St.camera.position)}});const gt=Fe.useMemo(()=>({vertexShader:h?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[h]);return Fe.createElement("group",Np({},O,{ref:j}),p&&!Be&&Fe.createElement("mesh",{castShadow:y,receiveShadow:x,ref:xe},E||Fe.createElement("planeGeometry",null),S||Fe.createElement("shaderMaterial",{side:so,vertexShader:gt.vertexShader,fragmentShader:gt.fragmentShader})))}),VD=parseInt(Px.replace(/\D+/g,""));function Q2(r,e){if(e===JO)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),r;if(e===nb||e===JR){let t=r.getIndex();if(t===null){const a=[],o=r.getAttribute("position");if(o!==void 0){for(let c=0;c<o.count;c++)a.push(c);r.setIndex(a),t=r.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),r}const n=t.count-2,i=[];if(t)if(e===nb)for(let a=1;a<=n;a++)i.push(t.getX(0)),i.push(t.getX(a)),i.push(t.getX(a+1));else for(let a=0;a<n;a++)a%2===0?(i.push(t.getX(a)),i.push(t.getX(a+1)),i.push(t.getX(a+2))):(i.push(t.getX(a+2)),i.push(t.getX(a+1)),i.push(t.getX(a)));i.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=r.clone();return s.setIndex(i),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),r}var pl=Uint8Array,_h=Uint16Array,qC=Uint32Array,ON=new pl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),PN=new pl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),aX=new pl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),NN=function(r,e){for(var t=new _h(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new qC(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)i[s]=s-t[n]<<5|n;return[t,i]},UN=NN(ON,2),FN=UN[0],oX=UN[1];FN[28]=258,oX[258]=28;var lX=NN(PN,0),cX=lX[0],jC=new _h(32768);for(var Zi=0;Zi<32768;++Zi){var uh=(Zi&43690)>>>1|(Zi&21845)<<1;uh=(uh&52428)>>>2|(uh&13107)<<2,uh=(uh&61680)>>>4|(uh&3855)<<4,jC[Zi]=((uh&65280)>>>8|(uh&255)<<8)>>>1}var Yy=(function(r,e,t){for(var n=r.length,i=0,s=new _h(e);i<n;++i)++s[r[i]-1];var a=new _h(e);for(i=0;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;var o;if(t){o=new _h(1<<e);var c=15-e;for(i=0;i<n;++i)if(r[i])for(var u=i<<4|r[i],h=e-r[i],p=a[r[i]-1]++<<h,v=p|(1<<h)-1;p<=v;++p)o[jC[p]>>>c]=u}else for(o=new _h(n),i=0;i<n;++i)r[i]&&(o[i]=jC[a[r[i]-1]++]>>>15-r[i]);return o}),Zx=new pl(288);for(var Zi=0;Zi<144;++Zi)Zx[Zi]=8;for(var Zi=144;Zi<256;++Zi)Zx[Zi]=9;for(var Zi=256;Zi<280;++Zi)Zx[Zi]=7;for(var Zi=280;Zi<288;++Zi)Zx[Zi]=8;var kN=new pl(32);for(var Zi=0;Zi<32;++Zi)kN[Zi]=5;var uX=Yy(Zx,9,1),fX=Yy(kN,5,1),MM=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},Zl=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},CM=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},hX=function(r){return(r/8|0)+(r&7&&1)},dX=function(r,e,t){(t==null||t>r.length)&&(t=r.length);var n=new(r instanceof _h?_h:r instanceof qC?qC:pl)(t-e);return n.set(r.subarray(e,t)),n},pX=function(r,e,t){var n=r.length;if(!n||t&&!t.l&&n<5)return e||new pl(0);var i=!e||t,s=!t||t.i;t||(t={}),e||(e=new pl(n*3));var a=function(pe){var be=e.length;if(pe>be){var je=new pl(Math.max(be*2,pe));je.set(e),e=je}},o=t.f||0,c=t.p||0,u=t.b||0,h=t.l,p=t.d,v=t.m,y=t.n,x=n*8;do{if(!h){t.f=o=Zl(r,c,1);var S=Zl(r,c+1,3);if(c+=3,S)if(S==1)h=uX,p=fX,v=9,y=5;else if(S==2){var R=Zl(r,c,31)+257,D=Zl(r,c+10,15)+4,P=R+Zl(r,c+5,31)+1;c+=14;for(var O=new pl(P),N=new pl(19),U=0;U<D;++U)N[aX[U]]=Zl(r,c+U*3,7);c+=D*3;for(var B=MM(N),I=(1<<B)-1,z=Yy(N,B,1),U=0;U<P;){var W=z[Zl(r,c,I)];c+=W&15;var E=W>>>4;if(E<16)O[U++]=E;else{var Z=0,te=0;for(E==16?(te=3+Zl(r,c,3),c+=2,Z=O[U-1]):E==17?(te=3+Zl(r,c,7),c+=3):E==18&&(te=11+Zl(r,c,127),c+=7);te--;)O[U++]=Z}}var re=O.subarray(0,R),k=O.subarray(R);v=MM(re),y=MM(k),h=Yy(re,v,1),p=Yy(k,y,1)}else throw"invalid block type";else{var E=hX(c)+4,b=r[E-4]|r[E-3]<<8,T=E+b;if(T>n){if(s)throw"unexpected EOF";break}i&&a(u+b),e.set(r.subarray(E,T),u),t.b=u+=b,t.p=c=T*8;continue}if(c>x){if(s)throw"unexpected EOF";break}}i&&a(u+131072);for(var j=(1<<v)-1,J=(1<<y)-1,oe=c;;oe=c){var Z=h[CM(r,c)&j],K=Z>>>4;if(c+=Z&15,c>x){if(s)throw"unexpected EOF";break}if(!Z)throw"invalid length/literal";if(K<256)e[u++]=K;else if(K==256){oe=c,h=null;break}else{var X=K-254;if(K>264){var U=K-257,ne=ON[U];X=Zl(r,c,(1<<ne)-1)+FN[U],c+=ne}var xe=p[CM(r,c)&J],_e=xe>>>4;if(!xe)throw"invalid distance";c+=xe&15;var k=cX[_e];if(_e>3){var ne=PN[_e];k+=CM(r,c)&(1<<ne)-1,c+=ne}if(c>x){if(s)throw"unexpected EOF";break}i&&a(u+131072);for(var Be=u+X;u<Be;u+=4)e[u]=e[u-k],e[u+1]=e[u+1-k],e[u+2]=e[u+2-k],e[u+3]=e[u+3-k];u=Be}}t.l=h,t.p=oe,t.b=u,h&&(o=1,t.m=v,t.d=p,t.n=y)}while(!o);return u==e.length?e:dX(e,0,u)},mX=new pl(0),gX=function(r){if((r[0]&15)!=8||r[0]>>>4>7||(r[0]<<8|r[1])%31)throw"invalid zlib data";if(r[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function dA(r,e){return pX((gX(r),r.subarray(2,-4)),e)}var vX=typeof TextDecoder<"u"&&new TextDecoder,yX=0;try{vX.decode(mX,{stream:!0}),yX=1}catch{}const xX=r=>r&&r.isCubeTexture;class _X extends As{constructor(e,t){var n,i;const s=xX(e),o=((i=s?(n=e.image[0])==null?void 0:n.width:e.image.width)!=null?i:1024)/4,c=Math.floor(Math.log2(o)),u=Math.pow(2,c),h=3*Math.max(u,112),p=4*u,v=[s?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/h}`,`#define CUBEUV_TEXEL_HEIGHT ${1/p}`,`#define CUBEUV_MAX_MIP ${c}.0`],y=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,x=v.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${VD>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,S={map:{value:e},height:{value:t?.height||15},radius:{value:t?.radius||100}},E=new Kx(1,16),b=new za({uniforms:S,fragmentShader:x,vertexShader:y,side:so});super(E,b)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}var SX=Object.defineProperty,AX=(r,e,t)=>e in r?SX(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,EX=(r,e,t)=>(AX(r,e+"",t),t);class bX{constructor(){EX(this,"_listeners")}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let s=0,a=i.length;s<a;s++)i[s].call(this,e);e.target=null}}}var TX=Object.defineProperty,MX=(r,e,t)=>e in r?TX(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,vn=(r,e,t)=>(MX(r,typeof e!="symbol"?e+"":e,t),t);const pA=new zp,Z2=new tf,CX=Math.cos(70*(Math.PI/180)),e3=(r,e)=>(r%e+e)%e;let RX=class extends bX{constructor(e,t){super(),vn(this,"object"),vn(this,"domElement"),vn(this,"enabled",!0),vn(this,"target",new ae),vn(this,"minDistance",0),vn(this,"maxDistance",1/0),vn(this,"minZoom",0),vn(this,"maxZoom",1/0),vn(this,"minPolarAngle",0),vn(this,"maxPolarAngle",Math.PI),vn(this,"minAzimuthAngle",-1/0),vn(this,"maxAzimuthAngle",1/0),vn(this,"enableDamping",!1),vn(this,"dampingFactor",.05),vn(this,"enableZoom",!0),vn(this,"zoomSpeed",1),vn(this,"enableRotate",!0),vn(this,"rotateSpeed",1),vn(this,"enablePan",!0),vn(this,"panSpeed",1),vn(this,"screenSpacePanning",!0),vn(this,"keyPanSpeed",7),vn(this,"zoomToCursor",!1),vn(this,"autoRotate",!1),vn(this,"autoRotateSpeed",2),vn(this,"reverseOrbit",!1),vn(this,"reverseHorizontalOrbit",!1),vn(this,"reverseVerticalOrbit",!1),vn(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),vn(this,"mouseButtons",{LEFT:ep.ROTATE,MIDDLE:ep.DOLLY,RIGHT:ep.PAN}),vn(this,"touches",{ONE:tp.ROTATE,TWO:tp.DOLLY_PAN}),vn(this,"target0"),vn(this,"position0"),vn(this,"zoom0"),vn(this,"_domElementKeyEvents",null),vn(this,"getPolarAngle"),vn(this,"getAzimuthalAngle"),vn(this,"setPolarAngle"),vn(this,"setAzimuthalAngle"),vn(this,"getDistance"),vn(this,"getZoomScale"),vn(this,"listenToKeyEvents"),vn(this,"stopListenToKeyEvents"),vn(this,"saveState"),vn(this,"reset"),vn(this,"update"),vn(this,"connect"),vn(this,"dispose"),vn(this,"dollyIn"),vn(this,"dollyOut"),vn(this,"getScale"),vn(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>h.phi,this.getAzimuthalAngle=()=>h.theta,this.setPolarAngle=he=>{let Ce=e3(he,2*Math.PI),tt=h.phi;tt<0&&(tt+=2*Math.PI),Ce<0&&(Ce+=2*Math.PI);let le=Math.abs(Ce-tt);2*Math.PI-le<le&&(Ce<tt?Ce+=2*Math.PI:tt+=2*Math.PI),p.phi=Ce-tt,n.update()},this.setAzimuthalAngle=he=>{let Ce=e3(he,2*Math.PI),tt=h.theta;tt<0&&(tt+=2*Math.PI),Ce<0&&(Ce+=2*Math.PI);let le=Math.abs(Ce-tt);2*Math.PI-le<le&&(Ce<tt?Ce+=2*Math.PI:tt+=2*Math.PI),p.theta=Ce-tt,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=he=>{he.addEventListener("keydown",Pe),this._domElementKeyEvents=he},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Pe),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(i),n.update(),c=o.NONE},this.update=(()=>{const he=new ae,Ce=new ae(0,1,0),tt=new Tr().setFromUnitVectors(e.up,Ce),le=tt.clone().invert(),Re=new ae,ht=new Tr,yt=2*Math.PI;return function(){const Qe=n.object.position;tt.setFromUnitVectors(e.up,Ce),le.copy(tt).invert(),he.copy(Qe).sub(n.target),he.applyQuaternion(tt),h.setFromVector3(he),n.autoRotate&&c===o.NONE&&te(W()),n.enableDamping?(h.theta+=p.theta*n.dampingFactor,h.phi+=p.phi*n.dampingFactor):(h.theta+=p.theta,h.phi+=p.phi);let Rt=n.minAzimuthAngle,Vt=n.maxAzimuthAngle;isFinite(Rt)&&isFinite(Vt)&&(Rt<-Math.PI?Rt+=yt:Rt>Math.PI&&(Rt-=yt),Vt<-Math.PI?Vt+=yt:Vt>Math.PI&&(Vt-=yt),Rt<=Vt?h.theta=Math.max(Rt,Math.min(Vt,h.theta)):h.theta=h.theta>(Rt+Vt)/2?Math.max(Rt,h.theta):Math.min(Vt,h.theta)),h.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,h.phi)),h.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(y,n.dampingFactor):n.target.add(y),n.zoomToCursor&&B||n.object.isOrthographicCamera?h.radius=xe(h.radius):h.radius=xe(h.radius*v),he.setFromSpherical(h),he.applyQuaternion(le),Qe.copy(n.target).add(he),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),n.enableDamping===!0?(p.theta*=1-n.dampingFactor,p.phi*=1-n.dampingFactor,y.multiplyScalar(1-n.dampingFactor)):(p.set(0,0,0),y.set(0,0,0));let En=!1;if(n.zoomToCursor&&B){let Dt=null;if(n.object instanceof cs&&n.object.isPerspectiveCamera){const Ut=he.length();Dt=xe(Ut*v);const dn=Ut-Dt;n.object.position.addScaledVector(N,dn),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const Ut=new ae(U.x,U.y,0);Ut.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/v)),n.object.updateProjectionMatrix(),En=!0;const dn=new ae(U.x,U.y,0);dn.unproject(n.object),n.object.position.sub(dn).add(Ut),n.object.updateMatrixWorld(),Dt=he.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;Dt!==null&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(Dt).add(n.object.position):(pA.origin.copy(n.object.position),pA.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(pA.direction))<CX?e.lookAt(n.target):(Z2.setFromNormalAndCoplanarPoint(n.object.up,n.target),pA.intersectPlane(Z2,n.target))))}else n.object instanceof _l&&n.object.isOrthographicCamera&&(En=v!==1,En&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/v)),n.object.updateProjectionMatrix()));return v=1,B=!1,En||Re.distanceToSquared(n.object.position)>u||8*(1-ht.dot(n.object.quaternion))>u?(n.dispatchEvent(i),Re.copy(n.object.position),ht.copy(n.object.quaternion),En=!1,!0):!1}})(),this.connect=he=>{n.domElement=he,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",Ft),n.domElement.addEventListener("pointerdown",Tt),n.domElement.addEventListener("pointercancel",q),n.domElement.addEventListener("wheel",Ve)},this.dispose=()=>{var he,Ce,tt,le,Re,ht;n.domElement&&(n.domElement.style.touchAction="auto"),(he=n.domElement)==null||he.removeEventListener("contextmenu",Ft),(Ce=n.domElement)==null||Ce.removeEventListener("pointerdown",Tt),(tt=n.domElement)==null||tt.removeEventListener("pointercancel",q),(le=n.domElement)==null||le.removeEventListener("wheel",Ve),(Re=n.domElement)==null||Re.ownerDocument.removeEventListener("pointermove",se),(ht=n.domElement)==null||ht.ownerDocument.removeEventListener("pointerup",q),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",Pe)};const n=this,i={type:"change"},s={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=o.NONE;const u=1e-6,h=new UC,p=new UC;let v=1;const y=new ae,x=new at,S=new at,E=new at,b=new at,T=new at,R=new at,D=new at,P=new at,O=new at,N=new ae,U=new at;let B=!1;const I=[],z={};function W(){return 2*Math.PI/60/60*n.autoRotateSpeed}function Z(){return Math.pow(.95,n.zoomSpeed)}function te(he){n.reverseOrbit||n.reverseHorizontalOrbit?p.theta+=he:p.theta-=he}function re(he){n.reverseOrbit||n.reverseVerticalOrbit?p.phi+=he:p.phi-=he}const k=(()=>{const he=new ae;return function(tt,le){he.setFromMatrixColumn(le,0),he.multiplyScalar(-tt),y.add(he)}})(),j=(()=>{const he=new ae;return function(tt,le){n.screenSpacePanning===!0?he.setFromMatrixColumn(le,1):(he.setFromMatrixColumn(le,0),he.crossVectors(n.object.up,he)),he.multiplyScalar(tt),y.add(he)}})(),J=(()=>{const he=new ae;return function(tt,le){const Re=n.domElement;if(Re&&n.object instanceof cs&&n.object.isPerspectiveCamera){const ht=n.object.position;he.copy(ht).sub(n.target);let yt=he.length();yt*=Math.tan(n.object.fov/2*Math.PI/180),k(2*tt*yt/Re.clientHeight,n.object.matrix),j(2*le*yt/Re.clientHeight,n.object.matrix)}else Re&&n.object instanceof _l&&n.object.isOrthographicCamera?(k(tt*(n.object.right-n.object.left)/n.object.zoom/Re.clientWidth,n.object.matrix),j(le*(n.object.top-n.object.bottom)/n.object.zoom/Re.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function oe(he){n.object instanceof cs&&n.object.isPerspectiveCamera||n.object instanceof _l&&n.object.isOrthographicCamera?v=he:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function K(he){oe(v/he)}function X(he){oe(v*he)}function ne(he){if(!n.zoomToCursor||!n.domElement)return;B=!0;const Ce=n.domElement.getBoundingClientRect(),tt=he.clientX-Ce.left,le=he.clientY-Ce.top,Re=Ce.width,ht=Ce.height;U.x=tt/Re*2-1,U.y=-(le/ht)*2+1,N.set(U.x,U.y,1).unproject(n.object).sub(n.object.position).normalize()}function xe(he){return Math.max(n.minDistance,Math.min(n.maxDistance,he))}function _e(he){x.set(he.clientX,he.clientY)}function Be(he){ne(he),D.set(he.clientX,he.clientY)}function pe(he){b.set(he.clientX,he.clientY)}function be(he){S.set(he.clientX,he.clientY),E.subVectors(S,x).multiplyScalar(n.rotateSpeed);const Ce=n.domElement;Ce&&(te(2*Math.PI*E.x/Ce.clientHeight),re(2*Math.PI*E.y/Ce.clientHeight)),x.copy(S),n.update()}function je(he){P.set(he.clientX,he.clientY),O.subVectors(P,D),O.y>0?K(Z()):O.y<0&&X(Z()),D.copy(P),n.update()}function gt(he){T.set(he.clientX,he.clientY),R.subVectors(T,b).multiplyScalar(n.panSpeed),J(R.x,R.y),b.copy(T),n.update()}function St(he){ne(he),he.deltaY<0?X(Z()):he.deltaY>0&&K(Z()),n.update()}function At(he){let Ce=!1;switch(he.code){case n.keys.UP:J(0,n.keyPanSpeed),Ce=!0;break;case n.keys.BOTTOM:J(0,-n.keyPanSpeed),Ce=!0;break;case n.keys.LEFT:J(n.keyPanSpeed,0),Ce=!0;break;case n.keys.RIGHT:J(-n.keyPanSpeed,0),Ce=!0;break}Ce&&(he.preventDefault(),n.update())}function jt(){if(I.length==1)x.set(I[0].pageX,I[0].pageY);else{const he=.5*(I[0].pageX+I[1].pageX),Ce=.5*(I[0].pageY+I[1].pageY);x.set(he,Ce)}}function vt(){if(I.length==1)b.set(I[0].pageX,I[0].pageY);else{const he=.5*(I[0].pageX+I[1].pageX),Ce=.5*(I[0].pageY+I[1].pageY);b.set(he,Ce)}}function ze(){const he=I[0].pageX-I[1].pageX,Ce=I[0].pageY-I[1].pageY,tt=Math.sqrt(he*he+Ce*Ce);D.set(0,tt)}function ie(){n.enableZoom&&ze(),n.enablePan&&vt()}function Oe(){n.enableZoom&&ze(),n.enableRotate&&jt()}function ue(he){if(I.length==1)S.set(he.pageX,he.pageY);else{const tt=Nt(he),le=.5*(he.pageX+tt.x),Re=.5*(he.pageY+tt.y);S.set(le,Re)}E.subVectors(S,x).multiplyScalar(n.rotateSpeed);const Ce=n.domElement;Ce&&(te(2*Math.PI*E.x/Ce.clientHeight),re(2*Math.PI*E.y/Ce.clientHeight)),x.copy(S)}function st(he){if(I.length==1)T.set(he.pageX,he.pageY);else{const Ce=Nt(he),tt=.5*(he.pageX+Ce.x),le=.5*(he.pageY+Ce.y);T.set(tt,le)}R.subVectors(T,b).multiplyScalar(n.panSpeed),J(R.x,R.y),b.copy(T)}function $e(he){const Ce=Nt(he),tt=he.pageX-Ce.x,le=he.pageY-Ce.y,Re=Math.sqrt(tt*tt+le*le);P.set(0,Re),O.set(0,Math.pow(P.y/D.y,n.zoomSpeed)),K(O.y),D.copy(P)}function _t(he){n.enableZoom&&$e(he),n.enablePan&&st(he)}function it(he){n.enableZoom&&$e(he),n.enableRotate&&ue(he)}function Tt(he){var Ce,tt;n.enabled!==!1&&(I.length===0&&((Ce=n.domElement)==null||Ce.ownerDocument.addEventListener("pointermove",se),(tt=n.domElement)==null||tt.ownerDocument.addEventListener("pointerup",q)),Mt(he),he.pointerType==="touch"?wt(he):Ee(he))}function se(he){n.enabled!==!1&&(he.pointerType==="touch"?bt(he):Ge(he))}function q(he){var Ce,tt,le;Ze(he),I.length===0&&((Ce=n.domElement)==null||Ce.releasePointerCapture(he.pointerId),(tt=n.domElement)==null||tt.ownerDocument.removeEventListener("pointermove",se),(le=n.domElement)==null||le.ownerDocument.removeEventListener("pointerup",q)),n.dispatchEvent(a),c=o.NONE}function Ee(he){let Ce;switch(he.button){case 0:Ce=n.mouseButtons.LEFT;break;case 1:Ce=n.mouseButtons.MIDDLE;break;case 2:Ce=n.mouseButtons.RIGHT;break;default:Ce=-1}switch(Ce){case ep.DOLLY:if(n.enableZoom===!1)return;Be(he),c=o.DOLLY;break;case ep.ROTATE:if(he.ctrlKey||he.metaKey||he.shiftKey){if(n.enablePan===!1)return;pe(he),c=o.PAN}else{if(n.enableRotate===!1)return;_e(he),c=o.ROTATE}break;case ep.PAN:if(he.ctrlKey||he.metaKey||he.shiftKey){if(n.enableRotate===!1)return;_e(he),c=o.ROTATE}else{if(n.enablePan===!1)return;pe(he),c=o.PAN}break;default:c=o.NONE}c!==o.NONE&&n.dispatchEvent(s)}function Ge(he){if(n.enabled!==!1)switch(c){case o.ROTATE:if(n.enableRotate===!1)return;be(he);break;case o.DOLLY:if(n.enableZoom===!1)return;je(he);break;case o.PAN:if(n.enablePan===!1)return;gt(he);break}}function Ve(he){n.enabled===!1||n.enableZoom===!1||c!==o.NONE&&c!==o.ROTATE||(he.preventDefault(),n.dispatchEvent(s),St(he),n.dispatchEvent(a))}function Pe(he){n.enabled===!1||n.enablePan===!1||At(he)}function wt(he){switch(Je(he),I.length){case 1:switch(n.touches.ONE){case tp.ROTATE:if(n.enableRotate===!1)return;jt(),c=o.TOUCH_ROTATE;break;case tp.PAN:if(n.enablePan===!1)return;vt(),c=o.TOUCH_PAN;break;default:c=o.NONE}break;case 2:switch(n.touches.TWO){case tp.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;ie(),c=o.TOUCH_DOLLY_PAN;break;case tp.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Oe(),c=o.TOUCH_DOLLY_ROTATE;break;default:c=o.NONE}break;default:c=o.NONE}c!==o.NONE&&n.dispatchEvent(s)}function bt(he){switch(Je(he),c){case o.TOUCH_ROTATE:if(n.enableRotate===!1)return;ue(he),n.update();break;case o.TOUCH_PAN:if(n.enablePan===!1)return;st(he),n.update();break;case o.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;_t(he),n.update();break;case o.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;it(he),n.update();break;default:c=o.NONE}}function Ft(he){n.enabled!==!1&&he.preventDefault()}function Mt(he){I.push(he)}function Ze(he){delete z[he.pointerId];for(let Ce=0;Ce<I.length;Ce++)if(I[Ce].pointerId==he.pointerId){I.splice(Ce,1);return}}function Je(he){let Ce=z[he.pointerId];Ce===void 0&&(Ce=new at,z[he.pointerId]=Ce),Ce.set(he.pageX,he.pageY)}function Nt(he){const Ce=he.pointerId===I[0].pointerId?I[1]:I[0];return z[Ce.pointerId]}this.dollyIn=(he=Z())=>{X(he),n.update()},this.dollyOut=(he=Z())=>{K(he),n.update()},this.getScale=()=>v,this.setScale=he=>{oe(he),n.update()},this.getZoomScale=()=>Z(),t!==void 0&&this.connect(t),this.update()}};function hb(r){if(typeof TextDecoder<"u")return new TextDecoder().decode(r);let e="";for(let t=0,n=r.length;t<n;t++)e+=String.fromCharCode(r[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const pp="srgb",ff="srgb-linear",t3=3001,DX=3e3;class YD extends Hr{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new OX(t)}),this.register(function(t){return new PX(t)}),this.register(function(t){return new YX(t)}),this.register(function(t){return new XX(t)}),this.register(function(t){return new KX(t)}),this.register(function(t){return new UX(t)}),this.register(function(t){return new FX(t)}),this.register(function(t){return new kX(t)}),this.register(function(t){return new GX(t)}),this.register(function(t){return new BX(t)}),this.register(function(t){return new HX(t)}),this.register(function(t){return new NX(t)}),this.register(function(t){return new VX(t)}),this.register(function(t){return new zX(t)}),this.register(function(t){return new wX(t)}),this.register(function(t){return new qX(t)}),this.register(function(t){return new jX(t)})}load(e,t,n,i){const s=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const u=Mh.extractUrlBase(e);a=Mh.resolveURL(u,this.path)}else a=Mh.extractUrlBase(e);this.manager.itemStart(e);const o=function(u){i?i(u):console.error(u),s.manager.itemError(e),s.manager.itemEnd(e)},c=new kr(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(u){try{s.parse(u,a,function(h){t(h),s.manager.itemEnd(e)},o)}catch(h){o(h)}},n,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let s;const a={},o={};if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(hb(new Uint8Array(e.slice(0,4)))===GN){try{a[ei.KHR_BINARY_GLTF]=new WX(e)}catch(h){i&&i(h);return}s=JSON.parse(a[ei.KHR_BINARY_GLTF].content)}else s=JSON.parse(hb(new Uint8Array(e)));else s=e;if(s.asset===void 0||s.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new lK(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const h=this.pluginCallbacks[u](c);h.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[h.name]=h,a[h.name]=!0}if(s.extensionsUsed)for(let u=0;u<s.extensionsUsed.length;++u){const h=s.extensionsUsed[u],p=s.extensionsRequired||[];switch(h){case ei.KHR_MATERIALS_UNLIT:a[h]=new IX;break;case ei.KHR_DRACO_MESH_COMPRESSION:a[h]=new JX(s,this.dracoLoader);break;case ei.KHR_TEXTURE_TRANSFORM:a[h]=new $X;break;case ei.KHR_MESH_QUANTIZATION:a[h]=new QX;break;default:p.indexOf(h)>=0&&o[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}c.setExtensions(a),c.setPlugins(o),c.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,s){n.parse(e,t,i,s)})}}function LX(){let r={};return{get:function(e){return r[e]},add:function(e,t){r[e]=t},remove:function(e){delete r[e]},removeAll:function(){r={}}}}const ei={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class wX{constructor(e){this.parser=e,this.name=ei.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const s=t[n];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const s=t.json,c=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let u;const h=new Ot(16777215);c.color!==void 0&&h.setRGB(c.color[0],c.color[1],c.color[2],ff);const p=c.range!==void 0?c.range:0;switch(c.type){case"directional":u=new MD(h),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new TD(h),u.distance=p;break;case"spot":u=new bD(h),u.distance=p,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,u.angle=c.spot.outerConeAngle,u.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return u.position.set(0,0,0),u.decay=2,$u(u,c),c.intensity!==void 0&&(u.intensity=c.intensity),u.name=t.createUniqueName(c.name||"light_"+e),i=Promise.resolve(u),t.cache.add(n,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,s=n.json.nodes[e],o=(s.extensions&&s.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(c){return n._getNodeRef(t.cache,o,c)})}}class IX{constructor(){this.name=ei.KHR_MATERIALS_UNLIT}getMaterialType(){return ao}extendParams(e,t,n){const i=[];e.color=new Ot(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const a=s.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],ff),e.opacity=a[3]}s.baseColorTexture!==void 0&&i.push(n.assignTexture(e,"map",s.baseColorTexture,pp))}return Promise.all(i)}}class BX{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class OX{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(s.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new at(o,o)}return Promise.all(s)}}class PX{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class NX{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(s)}}class UX{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new Ot(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=i.extensions[this.name];if(a.sheenColorFactor!==void 0){const o=a.sheenColorFactor;t.sheenColor.setRGB(o[0],o[1],o[2],ff)}return a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&s.push(n.assignTexture(t,"sheenColorMap",a.sheenColorTexture,pp)),a.sheenRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(s)}}class FX{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&s.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(s)}}class kX{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&s.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const o=a.attenuationColor||[1,1,1];return t.attenuationColor=new Ot().setRGB(o[0],o[1],o[2],ff),Promise.all(s)}}class GX{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class HX{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&s.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return t.specularColor=new Ot().setRGB(o[0],o[1],o[2],ff),a.specularColorTexture!==void 0&&s.push(n.assignTexture(t,"specularColorMap",a.specularColorTexture,pp)),Promise.all(s)}}class zX{constructor(e){this.parser=e,this.name=ei.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return t.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&s.push(n.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(s)}}class VX{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Tl}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return a.anisotropyStrength!==void 0&&(t.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(t.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&s.push(n.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(s)}}class YX{constructor(e){this.parser=e,this.name=ei.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,a)}}class XX{constructor(e){this.parser=e,this.name=ei.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],o=i.images[a.source];let c=n.textureLoader;if(o.uri){const u=n.options.manager.getHandler(o.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(e,a.source,c);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class KX{constructor(e){this.parser=e,this.name=ei.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],o=i.images[a.source];let c=n.textureLoader;if(o.uri){const u=n.options.manager.getHandler(o.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(e,a.source,c);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class qX{constructor(e){this.name=ei.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const i=n.extensions[this.name],s=this.parser.getDependency("buffer",i.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(o){const c=i.byteOffset||0,u=i.byteLength||0,h=i.count,p=i.byteStride,v=new Uint8Array(o,c,u);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(h,p,v,i.mode,i.filter).then(function(y){return y.buffer}):a.ready.then(function(){const y=new ArrayBuffer(h*p);return a.decodeGltfBuffer(new Uint8Array(y),h,p,v,i.mode,i.filter),y})})}else return null}}class jX{constructor(e){this.name=ei.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const i=t.meshes[n.mesh];for(const u of i.primitives)if(u.mode!==fl.TRIANGLES&&u.mode!==fl.TRIANGLE_STRIP&&u.mode!==fl.TRIANGLE_FAN&&u.mode!==void 0)return null;const a=n.extensions[this.name].attributes,o=[],c={};for(const u in a)o.push(this.parser.getDependency("accessor",a[u]).then(h=>(c[u]=h,c[u])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(u=>{const h=u.pop(),p=h.isGroup?h.children:[h],v=u[0].count,y=[];for(const x of p){const S=new yn,E=new ae,b=new Tr,T=new ae(1,1,1),R=new rD(x.geometry,x.material,v);for(let D=0;D<v;D++)c.TRANSLATION&&E.fromBufferAttribute(c.TRANSLATION,D),c.ROTATION&&b.fromBufferAttribute(c.ROTATION,D),c.SCALE&&T.fromBufferAttribute(c.SCALE,D),R.setMatrixAt(D,S.compose(E,b,T));for(const D in c)if(D==="_COLOR_0"){const P=c[D];R.instanceColor=new Lp(P.array,P.itemSize,P.normalized)}else D!=="TRANSLATION"&&D!=="ROTATION"&&D!=="SCALE"&&x.geometry.setAttribute(D,c[D]);pi.prototype.copy.call(R,x),this.parser.assignFinalMaterial(R),y.push(R)}return h.isGroup?(h.clear(),h.add(...y),h):y[0]}))}}const GN="glTF",gy=12,n3={JSON:1313821514,BIN:5130562};class WX{constructor(e){this.name=ei.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,gy);if(this.header={magic:hb(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==GN)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-gy,i=new DataView(e,gy);let s=0;for(;s<n;){const a=i.getUint32(s,!0);s+=4;const o=i.getUint32(s,!0);if(s+=4,o===n3.JSON){const c=new Uint8Array(e,gy+s,a);this.content=hb(c)}else if(o===n3.BIN){const c=gy+s;this.body=e.slice(c,c+a)}s+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class JX{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ei.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,s=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},c={},u={};for(const h in a){const p=WC[h]||h.toLowerCase();o[p]=a[h]}for(const h in e.attributes){const p=WC[h]||h.toLowerCase();if(a[h]!==void 0){const v=n.accessors[e.attributes[h]],y=H0[v.componentType];u[p]=y.name,c[p]=v.normalized===!0}}return t.getDependency("bufferView",s).then(function(h){return new Promise(function(p,v){i.decodeDracoFile(h,function(y){for(const x in y.attributes){const S=y.attributes[x],E=c[x];E!==void 0&&(S.normalized=E)}p(y)},o,u,ff,v)})})}}class $X{constructor(){this.name=ei.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class QX{constructor(){this.name=ei.KHR_MESH_QUANTIZATION}}class HN extends Rg{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i*3+i;for(let a=0;a!==i;a++)t[a]=n[s+a];return t}interpolate_(e,t,n,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,c=o*2,u=o*3,h=i-t,p=(n-t)/h,v=p*p,y=v*p,x=e*u,S=x-u,E=-2*y+3*v,b=y-v,T=1-E,R=b-v+p;for(let D=0;D!==o;D++){const P=a[S+D+o],O=a[S+D+c]*h,N=a[x+D+o],U=a[x+D]*h;s[D]=T*P+R*O+E*N+b*U}return s}}const ZX=new Tr;class eK extends HN{interpolate_(e,t,n,i){const s=super.interpolate_(e,t,n,i);return ZX.fromArray(s).normalize().toArray(s),s}}const fl={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},H0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},i3={9728:br,9729:yi,9984:Ub,9985:k0,9986:lp,9987:ml},s3={33071:_s,33648:Z0,10497:Ih},RM={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},WC={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...VD>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},fh={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},tK={CUBICSPLINE:void 0,LINEAR:rg,STEP:sg},DM={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function nK(r){return r.DefaultMaterial===void 0&&(r.DefaultMaterial=new Wx({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:au})),r.DefaultMaterial}function Wd(r,e,t){for(const n in t.extensions)r[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function $u(r,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(r.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function iK(r,e,t){let n=!1,i=!1,s=!1;for(let u=0,h=e.length;u<h;u++){const p=e[u];if(p.POSITION!==void 0&&(n=!0),p.NORMAL!==void 0&&(i=!0),p.COLOR_0!==void 0&&(s=!0),n&&i&&s)break}if(!n&&!i&&!s)return Promise.resolve(r);const a=[],o=[],c=[];for(let u=0,h=e.length;u<h;u++){const p=e[u];if(n){const v=p.POSITION!==void 0?t.getDependency("accessor",p.POSITION):r.attributes.position;a.push(v)}if(i){const v=p.NORMAL!==void 0?t.getDependency("accessor",p.NORMAL):r.attributes.normal;o.push(v)}if(s){const v=p.COLOR_0!==void 0?t.getDependency("accessor",p.COLOR_0):r.attributes.color;c.push(v)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(c)]).then(function(u){const h=u[0],p=u[1],v=u[2];return n&&(r.morphAttributes.position=h),i&&(r.morphAttributes.normal=p),s&&(r.morphAttributes.color=v),r.morphTargetsRelative=!0,r})}function sK(r,e){if(r.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)r.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(r.morphTargetInfluences.length===t.length){r.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++)r.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function rK(r){let e;const t=r.extensions&&r.extensions[ei.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+LM(t.attributes):e=r.indices+":"+LM(r.attributes)+":"+r.mode,r.targets!==void 0)for(let n=0,i=r.targets.length;n<i;n++)e+=":"+LM(r.targets[n]);return e}function LM(r){let e="";const t=Object.keys(r).sort();for(let n=0,i=t.length;n<i;n++)e+=t[n]+":"+r[t[n]]+";";return e}function JC(r){switch(r){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function aK(r){return r.search(/\.jpe?g($|\?)/i)>0||r.search(/^data\:image\/jpeg/)===0?"image/jpeg":r.search(/\.webp($|\?)/i)>0||r.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const oK=new yn;class lK{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new LX,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,s=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||i&&s<98?this.textureLoader=new Jx(this.options.manager):this.textureLoader=new QP(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new kr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(a){const o={scene:a[0][i.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:i.asset,parser:n,userData:{}};return Wd(s,o,i),$u(o,i),Promise.all(n._invokeAll(function(c){return c.afterRoot&&c.afterRoot(o)})).then(function(){for(const c of o.scenes)c.updateMatrixWorld();e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,s=t.length;i<s;i++){const a=t[i].joints;for(let o=0,c=a.length;o<c;o++)e[a[o]].isBone=!0}for(let i=0,s=e.length;i<s;i++){const a=e[i];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(n[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),s=(a,o)=>{const c=this.associations.get(a);c!=null&&this.associations.set(o,c);for(const[u,h]of a.children.entries())s(h,o.children[u])};return s(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const s=e(t[i]);s&&n.push(s)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":i=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(s,a){return n.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[ei.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(s,a){n.load(Mh.resolveURL(t.uri,i.path),s,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const i=t.byteLength||0,s=t.byteOffset||0;return n.slice(s,s+i)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const a=RM[i.type],o=H0[i.componentType],c=i.normalized===!0,u=new o(i.count*a);return Promise.resolve(new xi(u,a,c))}const s=[];return i.bufferView!==void 0?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),i.sparse!==void 0&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then(function(a){const o=a[0],c=RM[i.type],u=H0[i.componentType],h=u.BYTES_PER_ELEMENT,p=h*c,v=i.byteOffset||0,y=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,x=i.normalized===!0;let S,E;if(y&&y!==p){const b=Math.floor(v/y),T="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+b+":"+i.count;let R=t.cache.get(T);R||(S=new u(o,b*y,i.count*y/h),R=new zx(S,y/h),t.cache.add(T,R)),E=new Oh(R,c,v%y/h,x)}else o===null?S=new u(i.count*c):S=new u(o,v,i.count*c),E=new xi(S,c,x);if(i.sparse!==void 0){const b=RM.SCALAR,T=H0[i.sparse.indices.componentType],R=i.sparse.indices.byteOffset||0,D=i.sparse.values.byteOffset||0,P=new T(a[1],R,i.sparse.count*b),O=new u(a[2],D,i.sparse.count*c);o!==null&&(E=new xi(E.array.slice(),E.itemSize,E.normalized));for(let N=0,U=P.length;N<U;N++){const B=P[N];if(E.setX(B,O[N*c]),c>=2&&E.setY(B,O[N*c+1]),c>=3&&E.setZ(B,O[N*c+2]),c>=4&&E.setW(B,O[N*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return E})}loadTexture(e){const t=this.json,n=this.options,s=t.textures[e].source,a=t.images[s];let o=this.textureLoader;if(a.uri){const c=n.manager.getHandler(a.uri);c!==null&&(o=c)}return this.loadTextureImage(e,s,o)}loadTextureImage(e,t,n){const i=this,s=this.json,a=s.textures[e],o=s.images[t],c=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[c])return this.textureCache[c];const u=this.loadImageSource(t,n).then(function(h){h.flipY=!1,h.name=a.name||o.name||"",h.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(h.name=o.uri);const v=(s.samplers||{})[a.sampler]||{};return h.magFilter=i3[v.magFilter]||yi,h.minFilter=i3[v.minFilter]||ml,h.wrapS=s3[v.wrapS]||Ih,h.wrapT=s3[v.wrapT]||Ih,i.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[c]=u,u}loadImageSource(e,t){const n=this,i=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(p=>p.clone());const a=i.images[e],o=self.URL||self.webkitURL;let c=a.uri||"",u=!1;if(a.bufferView!==void 0)c=n.getDependency("bufferView",a.bufferView).then(function(p){u=!0;const v=new Blob([p],{type:a.mimeType});return c=o.createObjectURL(v),c});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(c).then(function(p){return new Promise(function(v,y){let x=v;t.isImageBitmapLoader===!0&&(x=function(S){const E=new Ti(S);E.needsUpdate=!0,v(E)}),t.load(Mh.resolveURL(p,s.path),x,void 0,y)})}).then(function(p){return u===!0&&o.revokeObjectURL(c),$u(p,a),p.userData.mimeType=a.mimeType||aK(a.uri),p}).catch(function(p){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),p});return this.sourceCache[e]=h,h}assignTexture(e,t,n,i){const s=this;return this.getDependency("texture",n.index).then(function(a){if(!a)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(a=a.clone(),a.channel=n.texCoord),s.extensions[ei.KHR_TEXTURE_TRANSFORM]){const o=n.extensions!==void 0?n.extensions[ei.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const c=s.associations.get(a);a=s.extensions[ei.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),s.associations.set(a,c)}}return i!==void 0&&(typeof i=="number"&&(i=i===t3?pp:ff),"colorSpace"in a?a.colorSpace=i:a.encoding=i===pp?t3:DX),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+n.uuid;let c=this.cache.get(o);c||(c=new Zb,or.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(o,c)),n=c}else if(e.isLine){const o="LineBasicMaterial:"+n.uuid;let c=this.cache.get(o);c||(c=new ca,or.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,this.cache.add(o,c)),n=c}if(i||s||a){let o="ClonedMaterial:"+n.uuid+":";i&&(o+="derivative-tangents:"),s&&(o+="vertex-colors:"),a&&(o+="flat-shading:");let c=this.cache.get(o);c||(c=n.clone(),s&&(c.vertexColors=!0),a&&(c.flatShading=!0),i&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(o,c),this.associations.set(c,this.associations.get(n))),n=c}e.material=n}getMaterialType(){return Wx}loadMaterial(e){const t=this,n=this.json,i=this.extensions,s=n.materials[e];let a;const o={},c=s.extensions||{},u=[];if(c[ei.KHR_MATERIALS_UNLIT]){const p=i[ei.KHR_MATERIALS_UNLIT];a=p.getMaterialType(),u.push(p.extendParams(o,s,t))}else{const p=s.pbrMetallicRoughness||{};if(o.color=new Ot(1,1,1),o.opacity=1,Array.isArray(p.baseColorFactor)){const v=p.baseColorFactor;o.color.setRGB(v[0],v[1],v[2],ff),o.opacity=v[3]}p.baseColorTexture!==void 0&&u.push(t.assignTexture(o,"map",p.baseColorTexture,pp)),o.metalness=p.metallicFactor!==void 0?p.metallicFactor:1,o.roughness=p.roughnessFactor!==void 0?p.roughnessFactor:1,p.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(o,"metalnessMap",p.metallicRoughnessTexture)),u.push(t.assignTexture(o,"roughnessMap",p.metallicRoughnessTexture))),a=this._invokeOne(function(v){return v.getMaterialType&&v.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(v){return v.extendMaterialParams&&v.extendMaterialParams(e,o)})))}s.doubleSided===!0&&(o.side=so);const h=s.alphaMode||DM.OPAQUE;if(h===DM.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,h===DM.MASK&&(o.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&a!==ao&&(u.push(t.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new at(1,1),s.normalTexture.scale!==void 0)){const p=s.normalTexture.scale;o.normalScale.set(p,p)}if(s.occlusionTexture!==void 0&&a!==ao&&(u.push(t.assignTexture(o,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&a!==ao){const p=s.emissiveFactor;o.emissive=new Ot().setRGB(p[0],p[1],p[2],ff)}return s.emissiveTexture!==void 0&&a!==ao&&u.push(t.assignTexture(o,"emissiveMap",s.emissiveTexture,pp)),Promise.all(u).then(function(){const p=new a(o);return s.name&&(p.name=s.name),$u(p,s),t.associations.set(p,{materials:e}),s.extensions&&Wd(i,p,s),p})}createUniqueName(e){const t=mi.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function s(o){return n[ei.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(c){return r3(c,o,t)})}const a=[];for(let o=0,c=e.length;o<c;o++){const u=e[o],h=rK(u),p=i[h];if(p)a.push(p.promise);else{let v;u.extensions&&u.extensions[ei.KHR_DRACO_MESH_COMPRESSION]?v=s(u):v=r3(new Ln,u,t),i[h]={primitive:u,promise:v},a.push(v)}}return Promise.all(a)}loadMesh(e){const t=this,n=this.json,i=this.extensions,s=n.meshes[e],a=s.primitives,o=[];for(let c=0,u=a.length;c<u;c++){const h=a[c].material===void 0?nK(this.cache):this.getDependency("material",a[c].material);o.push(h)}return o.push(t.loadGeometries(a)),Promise.all(o).then(function(c){const u=c.slice(0,c.length-1),h=c[c.length-1],p=[];for(let y=0,x=h.length;y<x;y++){const S=h[y],E=a[y];let b;const T=u[y];if(E.mode===fl.TRIANGLES||E.mode===fl.TRIANGLE_STRIP||E.mode===fl.TRIANGLE_FAN||E.mode===void 0)b=s.isSkinnedMesh===!0?new sD(S,T):new As(S,T),b.isSkinnedMesh===!0&&b.normalizeSkinWeights(),E.mode===fl.TRIANGLE_STRIP?b.geometry=Q2(b.geometry,JR):E.mode===fl.TRIANGLE_FAN&&(b.geometry=Q2(b.geometry,nb));else if(E.mode===fl.LINES)b=new fc(S,T);else if(E.mode===fl.LINE_STRIP)b=new pf(S,T);else if(E.mode===fl.LINE_LOOP)b=new aD(S,T);else if(E.mode===fl.POINTS)b=new oD(S,T);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+E.mode);Object.keys(b.geometry.morphAttributes).length>0&&sK(b,s),b.name=t.createUniqueName(s.name||"mesh_"+e),$u(b,s),E.extensions&&Wd(i,b,E),t.assignFinalMaterial(b),p.push(b)}for(let y=0,x=p.length;y<x;y++)t.associations.set(p[y],{meshes:e,primitives:y});if(p.length===1)return s.extensions&&Wd(i,p[0],s),p[0];const v=new lf;s.extensions&&Wd(i,v,s),t.associations.set(v,{meshes:e});for(let y=0,x=p.length;y<x;y++)v.add(p[y]);return v})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new cs(cP.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(t=new _l(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),$u(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let i=0,s=t.joints.length;i<s;i++)n.push(this._loadNodeShallow(t.joints[i]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(i){const s=i.pop(),a=i,o=[],c=[];for(let u=0,h=a.length;u<h;u++){const p=a[u];if(p){o.push(p);const v=new yn;s!==null&&v.fromArray(s.array,u*16),c.push(v)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[u])}return new Vx(o,c)})}loadAnimation(e){const t=this.json,n=this,i=t.animations[e],s=i.name?i.name:"animation_"+e,a=[],o=[],c=[],u=[],h=[];for(let p=0,v=i.channels.length;p<v;p++){const y=i.channels[p],x=i.samplers[y.sampler],S=y.target,E=S.node,b=i.parameters!==void 0?i.parameters[x.input]:x.input,T=i.parameters!==void 0?i.parameters[x.output]:x.output;S.node!==void 0&&(a.push(this.getDependency("node",E)),o.push(this.getDependency("accessor",b)),c.push(this.getDependency("accessor",T)),u.push(x),h.push(S))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(c),Promise.all(u),Promise.all(h)]).then(function(p){const v=p[0],y=p[1],x=p[2],S=p[3],E=p[4],b=[];for(let T=0,R=v.length;T<R;T++){const D=v[T],P=y[T],O=x[T],N=S[T],U=E[T];if(D===void 0)continue;D.updateMatrix&&D.updateMatrix();const B=n._createAnimationTracks(D,P,O,N,U);if(B)for(let I=0;I<B.length;I++)b.push(B[I])}return new hg(s,void 0,b)})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(s){const a=n._getNodeRef(n.meshCache,i.mesh,s);return i.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let c=0,u=i.weights.length;c<u;c++)o.morphTargetInfluences[c]=i.weights[c]}),a})}loadNode(e){const t=this.json,n=this,i=t.nodes[e],s=n._loadNodeShallow(e),a=[],o=i.children||[];for(let u=0,h=o.length;u<h;u++)a.push(n.getDependency("node",o[u]));const c=i.skin===void 0?Promise.resolve(null):n.getDependency("skin",i.skin);return Promise.all([s,Promise.all(a),c]).then(function(u){const h=u[0],p=u[1],v=u[2];v!==null&&h.traverse(function(y){y.isSkinnedMesh&&y.bind(v,oK)});for(let y=0,x=p.length;y<x;y++)h.add(p[y]);return h})}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],a=s.name?i.createUniqueName(s.name):"",o=[],c=i._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return c&&o.push(c),s.camera!==void 0&&o.push(i.getDependency("camera",s.camera).then(function(u){return i._getNodeRef(i.cameraCache,s.camera,u)})),i._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){o.push(u)}),this.nodeCache[e]=Promise.all(o).then(function(u){let h;if(s.isBone===!0?h=new $b:u.length>1?h=new lf:u.length===1?h=u[0]:h=new pi,h!==u[0])for(let p=0,v=u.length;p<v;p++)h.add(u[p]);if(s.name&&(h.userData.name=s.name,h.name=a),$u(h,s),s.extensions&&Wd(n,h,s),s.matrix!==void 0){const p=new yn;p.fromArray(s.matrix),h.applyMatrix4(p)}else s.translation!==void 0&&h.position.fromArray(s.translation),s.rotation!==void 0&&h.quaternion.fromArray(s.rotation),s.scale!==void 0&&h.scale.fromArray(s.scale);return i.associations.has(h)||i.associations.set(h,{}),i.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,s=new lf;n.name&&(s.name=i.createUniqueName(n.name)),$u(s,n),n.extensions&&Wd(t,s,n);const a=n.nodes||[],o=[];for(let c=0,u=a.length;c<u;c++)o.push(i.getDependency("node",a[c]));return Promise.all(o).then(function(c){for(let h=0,p=c.length;h<p;h++)s.add(c[h]);const u=h=>{const p=new Map;for(const[v,y]of i.associations)(v instanceof or||v instanceof Ti)&&p.set(v,y);return h.traverse(v=>{const y=i.associations.get(v);y!=null&&p.set(v,y)}),p};return i.associations=u(s),s})}_createAnimationTracks(e,t,n,i,s){const a=[],o=e.name?e.name:e.uuid,c=[];fh[s.path]===fh.weights?e.traverse(function(v){v.morphTargetInfluences&&c.push(v.name?v.name:v.uuid)}):c.push(o);let u;switch(fh[s.path]){case fh.weights:u=Ip;break;case fh.rotation:u=Bp;break;case fh.position:case fh.scale:u=Op;break;default:switch(n.itemSize){case 1:u=Ip;break;case 2:case 3:default:u=Op;break}break}const h=i.interpolation!==void 0?tK[i.interpolation]:rg,p=this._getArrayFromAccessor(n);for(let v=0,y=c.length;v<y;v++){const x=new u(c[v]+"."+fh[s.path],t.array,p,h);i.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(x),a.push(x)}return a}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=JC(t.constructor),i=new Float32Array(t.length);for(let s=0,a=t.length;s<a;s++)i[s]=t[s]*n;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const i=this instanceof Bp?eK:HN;return new i(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function cK(r,e,t){const n=e.attributes,i=new Fr;if(n.POSITION!==void 0){const o=t.json.accessors[n.POSITION],c=o.min,u=o.max;if(c!==void 0&&u!==void 0){if(i.set(new ae(c[0],c[1],c[2]),new ae(u[0],u[1],u[2])),o.normalized){const h=JC(H0[o.componentType]);i.min.multiplyScalar(h),i.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const o=new ae,c=new ae;for(let u=0,h=s.length;u<h;u++){const p=s[u];if(p.POSITION!==void 0){const v=t.json.accessors[p.POSITION],y=v.min,x=v.max;if(y!==void 0&&x!==void 0){if(c.setX(Math.max(Math.abs(y[0]),Math.abs(x[0]))),c.setY(Math.max(Math.abs(y[1]),Math.abs(x[1]))),c.setZ(Math.max(Math.abs(y[2]),Math.abs(x[2]))),v.normalized){const S=JC(H0[v.componentType]);c.multiplyScalar(S)}o.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(o)}r.boundingBox=i;const a=new Mr;i.getCenter(a.center),a.radius=i.min.distanceTo(i.max)/2,r.boundingSphere=a}function r3(r,e,t){const n=e.attributes,i=[];function s(a,o){return t.getDependency("accessor",a).then(function(c){r.setAttribute(o,c)})}for(const a in n){const o=WC[a]||a.toLowerCase();o in r.attributes||i.push(s(n[a],o))}if(e.indices!==void 0&&!r.index){const a=t.getDependency("accessor",e.indices).then(function(o){r.setIndex(o)});i.push(a)}return $u(r,e),cK(r,e,t),Promise.all(i).then(function(){return e.targets!==void 0?iK(r,e.targets,t):r})}class uK extends AD{constructor(e){super(e),this.type=ar}parse(e){const a=function(U,B){switch(U){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(B||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(B||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(B||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(B||""))}},p=function(U,B,I){B=B||1024;let W=U.pos,Z=-1,te=0,re="",k=String.fromCharCode.apply(null,new Uint16Array(U.subarray(W,W+128)));for(;0>(Z=k.indexOf(`
`))&&te<B&&W<U.byteLength;)re+=k,te+=k.length,W+=128,k+=String.fromCharCode.apply(null,new Uint16Array(U.subarray(W,W+128)));return-1<Z?(U.pos+=te+Z+1,re+k.slice(0,Z)):!1},v=function(U){const B=/^#\?(\S+)/,I=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,z=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,W=/^\s*FORMAT=(\S+)\s*$/,Z=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,te={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let re,k;for((U.pos>=U.byteLength||!(re=p(U)))&&a(1,"no header found"),(k=re.match(B))||a(3,"bad initial token"),te.valid|=1,te.programtype=k[1],te.string+=re+`
`;re=p(U),re!==!1;){if(te.string+=re+`
`,re.charAt(0)==="#"){te.comments+=re+`
`;continue}if((k=re.match(I))&&(te.gamma=parseFloat(k[1])),(k=re.match(z))&&(te.exposure=parseFloat(k[1])),(k=re.match(W))&&(te.valid|=2,te.format=k[1]),(k=re.match(Z))&&(te.valid|=4,te.height=parseInt(k[1],10),te.width=parseInt(k[2],10)),te.valid&2&&te.valid&4)break}return te.valid&2||a(3,"missing format specifier"),te.valid&4||a(3,"missing image size specifier"),te},y=function(U,B,I){const z=B;if(z<8||z>32767||U[0]!==2||U[1]!==2||U[2]&128)return new Uint8Array(U);z!==(U[2]<<8|U[3])&&a(3,"wrong scanline width");const W=new Uint8Array(4*B*I);W.length||a(4,"unable to allocate buffer space");let Z=0,te=0;const re=4*z,k=new Uint8Array(4),j=new Uint8Array(re);let J=I;for(;J>0&&te<U.byteLength;){te+4>U.byteLength&&a(1),k[0]=U[te++],k[1]=U[te++],k[2]=U[te++],k[3]=U[te++],(k[0]!=2||k[1]!=2||(k[2]<<8|k[3])!=z)&&a(3,"bad rgbe scanline format");let oe=0,K;for(;oe<re&&te<U.byteLength;){K=U[te++];const ne=K>128;if(ne&&(K-=128),(K===0||oe+K>re)&&a(3,"bad scanline data"),ne){const xe=U[te++];for(let _e=0;_e<K;_e++)j[oe++]=xe}else j.set(U.subarray(te,te+K),oe),oe+=K,te+=K}const X=z;for(let ne=0;ne<X;ne++){let xe=0;W[Z]=j[ne+xe],xe+=z,W[Z+1]=j[ne+xe],xe+=z,W[Z+2]=j[ne+xe],xe+=z,W[Z+3]=j[ne+xe],Z+=4}J--}return W},x=function(U,B,I,z){const W=U[B+3],Z=Math.pow(2,W-128)/255;I[z+0]=U[B+0]*Z,I[z+1]=U[B+1]*Z,I[z+2]=U[B+2]*Z,I[z+3]=1},S=function(U,B,I,z){const W=U[B+3],Z=Math.pow(2,W-128)/255;I[z+0]=fp.toHalfFloat(Math.min(U[B+0]*Z,65504)),I[z+1]=fp.toHalfFloat(Math.min(U[B+1]*Z,65504)),I[z+2]=fp.toHalfFloat(Math.min(U[B+2]*Z,65504)),I[z+3]=fp.toHalfFloat(1)},E=new Uint8Array(e);E.pos=0;const b=v(E),T=b.width,R=b.height,D=y(E.subarray(E.pos),T,R);let P,O,N;switch(this.type){case Ss:N=D.length/4;const U=new Float32Array(N*4);for(let I=0;I<N;I++)x(D,I*4,U,I*4);P=U,O=Ss;break;case ar:N=D.length/4;const B=new Uint16Array(N*4);for(let I=0;I<N;I++)S(D,I*4,B,I*4);P=B,O=ar;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:T,height:R,data:P,header:b.string,gamma:b.gamma,exposure:b.exposure,type:O}}setDataType(e){return this.type=e,this}load(e,t,n,i){function s(a,o){switch(a.type){case Ss:case ar:"colorSpace"in a?a.colorSpace="srgb-linear":a.encoding=3e3,a.minFilter=yi,a.magFilter=yi,a.generateMipmaps=!1,a.flipY=!0;break}t&&t(a,o)}return super.load(e,s,n,i)}}const vy=VD>=152;class fK extends AD{constructor(e){super(e),this.type=ar}parse(e){const B=Math.pow(2.7182818,2.2);function I(V,$){for(var me=0,De=0;De<65536;++De)(De==0||V[De>>3]&1<<(De&7))&&($[me++]=De);for(var Ye=me-1;me<65536;)$[me++]=0;return Ye}function z(V){for(var $=0;$<16384;$++)V[$]={},V[$].len=0,V[$].lit=0,V[$].p=null}const W={l:0,c:0,lc:0};function Z(V,$,me,De,Ye){for(;me<V;)$=$<<8|Nt(De,Ye),me+=8;me-=V,W.l=$>>me&(1<<V)-1,W.c=$,W.lc=me}const te=new Array(59);function re(V){for(var $=0;$<=58;++$)te[$]=0;for(var $=0;$<65537;++$)te[V[$]]+=1;for(var me=0,$=58;$>0;--$){var De=me+te[$]>>1;te[$]=me,me=De}for(var $=0;$<65537;++$){var Ye=V[$];Ye>0&&(V[$]=Ye|te[Ye]++<<6)}}function k(V,$,me,De,Ye,Xe,dt){for(var rt=me,ct=0,Y=0;Ye<=Xe;Ye++){if(rt.value-me.value>De)return!1;Z(6,ct,Y,V,rt);var ce=W.l;if(ct=W.c,Y=W.lc,dt[Ye]=ce,ce==63){if(rt.value-me.value>De)throw"Something wrong with hufUnpackEncTable";Z(8,ct,Y,V,rt);var fe=W.l+6;if(ct=W.c,Y=W.lc,Ye+fe>Xe+1)throw"Something wrong with hufUnpackEncTable";for(;fe--;)dt[Ye++]=0;Ye--}else if(ce>=59){var fe=ce-59+2;if(Ye+fe>Xe+1)throw"Something wrong with hufUnpackEncTable";for(;fe--;)dt[Ye++]=0;Ye--}}re(dt)}function j(V){return V&63}function J(V){return V>>6}function oe(V,$,me,De){for(;$<=me;$++){var Ye=J(V[$]),Xe=j(V[$]);if(Ye>>Xe)throw"Invalid table entry";if(Xe>14){var dt=De[Ye>>Xe-14];if(dt.len)throw"Invalid table entry";if(dt.lit++,dt.p){var rt=dt.p;dt.p=new Array(dt.lit);for(var ct=0;ct<dt.lit-1;++ct)dt.p[ct]=rt[ct]}else dt.p=new Array(1);dt.p[dt.lit-1]=$}else if(Xe)for(var Y=0,ct=1<<14-Xe;ct>0;ct--){var dt=De[(Ye<<14-Xe)+Y];if(dt.len||dt.p)throw"Invalid table entry";dt.len=Xe,dt.lit=$,Y++}}return!0}const K={c:0,lc:0};function X(V,$,me,De){V=V<<8|Nt(me,De),$+=8,K.c=V,K.lc=$}const ne={c:0,lc:0};function xe(V,$,me,De,Ye,Xe,dt,rt,ct,Y){if(V==$){De<8&&(X(me,De,Ye,dt),me=K.c,De=K.lc),De-=8;var ce=me>>De,ce=new Uint8Array([ce])[0];if(ct.value+ce>Y)return!1;for(var fe=rt[ct.value-1];ce-- >0;)rt[ct.value++]=fe}else if(ct.value<Y)rt[ct.value++]=V;else return!1;ne.c=me,ne.lc=De}function _e(V){return V&65535}function Be(V){var $=_e(V);return $>32767?$-65536:$}const pe={a:0,b:0};function be(V,$){var me=Be(V),De=Be($),Ye=De,Xe=me+(Ye&1)+(Ye>>1),dt=Xe,rt=Xe-Ye;pe.a=dt,pe.b=rt}function je(V,$){var me=_e(V),De=_e($),Ye=me-(De>>1)&65535,Xe=De+Ye-32768&65535;pe.a=Xe,pe.b=Ye}function gt(V,$,me,De,Ye,Xe,dt){for(var rt=dt<16384,ct=me>Ye?Ye:me,Y=1,ce;Y<=ct;)Y<<=1;for(Y>>=1,ce=Y,Y>>=1;Y>=1;){for(var fe=0,Se=fe+Xe*(Ye-ce),de=Xe*Y,Ke=Xe*ce,et=De*Y,pt=De*ce,xt,Lt,Pt,Bt;fe<=Se;fe+=Ke){for(var Kt=fe,bn=fe+De*(me-ce);Kt<=bn;Kt+=pt){var nn=Kt+et,fn=Kt+de,Nn=fn+et;rt?(be(V[Kt+$],V[fn+$]),xt=pe.a,Pt=pe.b,be(V[nn+$],V[Nn+$]),Lt=pe.a,Bt=pe.b,be(xt,Lt),V[Kt+$]=pe.a,V[nn+$]=pe.b,be(Pt,Bt),V[fn+$]=pe.a,V[Nn+$]=pe.b):(je(V[Kt+$],V[fn+$]),xt=pe.a,Pt=pe.b,je(V[nn+$],V[Nn+$]),Lt=pe.a,Bt=pe.b,je(xt,Lt),V[Kt+$]=pe.a,V[nn+$]=pe.b,je(Pt,Bt),V[fn+$]=pe.a,V[Nn+$]=pe.b)}if(me&Y){var fn=Kt+de;rt?be(V[Kt+$],V[fn+$]):je(V[Kt+$],V[fn+$]),xt=pe.a,V[fn+$]=pe.b,V[Kt+$]=xt}}if(Ye&Y)for(var Kt=fe,bn=fe+De*(me-ce);Kt<=bn;Kt+=pt){var nn=Kt+et;rt?be(V[Kt+$],V[nn+$]):je(V[Kt+$],V[nn+$]),xt=pe.a,V[nn+$]=pe.b,V[Kt+$]=xt}ce=Y,Y>>=1}return fe}function St(V,$,me,De,Ye,Xe,dt,rt,ct,Y){for(var ce=0,fe=0,Se=rt,de=Math.trunc(Ye.value+(Xe+7)/8);Ye.value<de;)for(X(ce,fe,me,Ye),ce=K.c,fe=K.lc;fe>=14;){var Ke=ce>>fe-14&16383,et=$[Ke];if(et.len)fe-=et.len,xe(et.lit,dt,ce,fe,me,De,Ye,ct,Y,Se),ce=ne.c,fe=ne.lc;else{if(!et.p)throw"hufDecode issues";var pt;for(pt=0;pt<et.lit;pt++){for(var xt=j(V[et.p[pt]]);fe<xt&&Ye.value<de;)X(ce,fe,me,Ye),ce=K.c,fe=K.lc;if(fe>=xt&&J(V[et.p[pt]])==(ce>>fe-xt&(1<<xt)-1)){fe-=xt,xe(et.p[pt],dt,ce,fe,me,De,Ye,ct,Y,Se),ce=ne.c,fe=ne.lc;break}}if(pt==et.lit)throw"hufDecode issues"}}var Lt=8-Xe&7;for(ce>>=Lt,fe-=Lt;fe>0;){var et=$[ce<<14-fe&16383];if(et.len)fe-=et.len,xe(et.lit,dt,ce,fe,me,De,Ye,ct,Y,Se),ce=ne.c,fe=ne.lc;else throw"hufDecode issues"}return!0}function At(V,$,me,De,Ye,Xe){var dt={value:0},rt=me.value,ct=Je($,me),Y=Je($,me);me.value+=4;var ce=Je($,me);if(me.value+=4,ct<0||ct>=65537||Y<0||Y>=65537)throw"Something wrong with HUF_ENCSIZE";var fe=new Array(65537),Se=new Array(16384);z(Se);var de=De-(me.value-rt);if(k(V,$,me,de,ct,Y,fe),ce>8*(De-(me.value-rt)))throw"Something wrong with hufUncompress";oe(fe,ct,Y,Se),St(fe,Se,V,$,me,ce,Y,Xe,Ye,dt)}function jt(V,$,me){for(var De=0;De<me;++De)$[De]=V[$[De]]}function vt(V){for(var $=1;$<V.length;$++){var me=V[$-1]+V[$]-128;V[$]=me}}function ze(V,$){for(var me=0,De=Math.floor((V.length+1)/2),Ye=0,Xe=V.length-1;!(Ye>Xe||($[Ye++]=V[me++],Ye>Xe));)$[Ye++]=V[De++]}function ie(V){for(var $=V.byteLength,me=new Array,De=0,Ye=new DataView(V);$>0;){var Xe=Ye.getInt8(De++);if(Xe<0){var dt=-Xe;$-=dt+1;for(var rt=0;rt<dt;rt++)me.push(Ye.getUint8(De++))}else{var dt=Xe;$-=2;for(var ct=Ye.getUint8(De++),rt=0;rt<dt+1;rt++)me.push(ct)}}return me}function Oe(V,$,me,De,Ye,Xe){var nn=new DataView(Xe.buffer),dt=me[V.idx[0]].width,rt=me[V.idx[0]].height,ct=3,Y=Math.floor(dt/8),ce=Math.ceil(dt/8),fe=Math.ceil(rt/8),Se=dt-(ce-1)*8,de=rt-(fe-1)*8,Ke={value:0},et=new Array(ct),pt=new Array(ct),xt=new Array(ct),Lt=new Array(ct),Pt=new Array(ct);for(let Qt=0;Qt<ct;++Qt)Pt[Qt]=$[V.idx[Qt]],et[Qt]=Qt<1?0:et[Qt-1]+ce*fe,pt[Qt]=new Float32Array(64),xt[Qt]=new Uint16Array(64),Lt[Qt]=new Uint16Array(ce*64);for(let Qt=0;Qt<fe;++Qt){var Bt=8;Qt==fe-1&&(Bt=de);var Kt=8;for(let ni=0;ni<ce;++ni){ni==ce-1&&(Kt=Se);for(let ln=0;ln<ct;++ln)xt[ln].fill(0),xt[ln][0]=Ye[et[ln]++],ue(Ke,De,xt[ln]),st(xt[ln],pt[ln]),$e(pt[ln]);_t(pt);for(let ln=0;ln<ct;++ln)it(pt[ln],Lt[ln],ni*64)}let zn=0;for(let ni=0;ni<ct;++ni){const ln=me[V.idx[ni]].type;for(let Ji=8*Qt;Ji<8*Qt+Bt;++Ji){zn=Pt[ni][Ji];for(let $n=0;$n<Y;++$n){const oi=$n*64+(Ji&7)*8;nn.setUint16(zn+0*ln,Lt[ni][oi+0],!0),nn.setUint16(zn+2*ln,Lt[ni][oi+1],!0),nn.setUint16(zn+4*ln,Lt[ni][oi+2],!0),nn.setUint16(zn+6*ln,Lt[ni][oi+3],!0),nn.setUint16(zn+8*ln,Lt[ni][oi+4],!0),nn.setUint16(zn+10*ln,Lt[ni][oi+5],!0),nn.setUint16(zn+12*ln,Lt[ni][oi+6],!0),nn.setUint16(zn+14*ln,Lt[ni][oi+7],!0),zn+=16*ln}}if(Y!=ce)for(let Ji=8*Qt;Ji<8*Qt+Bt;++Ji){const $n=Pt[ni][Ji]+8*Y*2*ln,oi=Y*64+(Ji&7)*8;for(let Ri=0;Ri<Kt;++Ri)nn.setUint16($n+Ri*2*ln,Lt[ni][oi+Ri],!0)}}}for(var bn=new Uint16Array(dt),nn=new DataView(Xe.buffer),fn=0;fn<ct;++fn){me[V.idx[fn]].decoded=!0;var Nn=me[V.idx[fn]].type;if(me[fn].type==2)for(var sn=0;sn<rt;++sn){const Qt=Pt[fn][sn];for(var In=0;In<dt;++In)bn[In]=nn.getUint16(Qt+In*2*Nn,!0);for(var In=0;In<dt;++In)nn.setFloat32(Qt+In*2*Nn,Re(bn[In]),!0)}}}function ue(V,$,me){for(var De,Ye=1;Ye<64;)De=$[V.value],De==65280?Ye=64:De>>8==255?Ye+=De&255:(me[Ye]=De,Ye++),V.value++}function st(V,$){$[0]=Re(V[0]),$[1]=Re(V[1]),$[2]=Re(V[5]),$[3]=Re(V[6]),$[4]=Re(V[14]),$[5]=Re(V[15]),$[6]=Re(V[27]),$[7]=Re(V[28]),$[8]=Re(V[2]),$[9]=Re(V[4]),$[10]=Re(V[7]),$[11]=Re(V[13]),$[12]=Re(V[16]),$[13]=Re(V[26]),$[14]=Re(V[29]),$[15]=Re(V[42]),$[16]=Re(V[3]),$[17]=Re(V[8]),$[18]=Re(V[12]),$[19]=Re(V[17]),$[20]=Re(V[25]),$[21]=Re(V[30]),$[22]=Re(V[41]),$[23]=Re(V[43]),$[24]=Re(V[9]),$[25]=Re(V[11]),$[26]=Re(V[18]),$[27]=Re(V[24]),$[28]=Re(V[31]),$[29]=Re(V[40]),$[30]=Re(V[44]),$[31]=Re(V[53]),$[32]=Re(V[10]),$[33]=Re(V[19]),$[34]=Re(V[23]),$[35]=Re(V[32]),$[36]=Re(V[39]),$[37]=Re(V[45]),$[38]=Re(V[52]),$[39]=Re(V[54]),$[40]=Re(V[20]),$[41]=Re(V[22]),$[42]=Re(V[33]),$[43]=Re(V[38]),$[44]=Re(V[46]),$[45]=Re(V[51]),$[46]=Re(V[55]),$[47]=Re(V[60]),$[48]=Re(V[21]),$[49]=Re(V[34]),$[50]=Re(V[37]),$[51]=Re(V[47]),$[52]=Re(V[50]),$[53]=Re(V[56]),$[54]=Re(V[59]),$[55]=Re(V[61]),$[56]=Re(V[35]),$[57]=Re(V[36]),$[58]=Re(V[48]),$[59]=Re(V[49]),$[60]=Re(V[57]),$[61]=Re(V[58]),$[62]=Re(V[62]),$[63]=Re(V[63])}function $e(V){const $=.5*Math.cos(.7853975),me=.5*Math.cos(3.14159/16),De=.5*Math.cos(3.14159/8),Ye=.5*Math.cos(3*3.14159/16),Xe=.5*Math.cos(5*3.14159/16),dt=.5*Math.cos(3*3.14159/8),rt=.5*Math.cos(7*3.14159/16);for(var ct=new Array(4),Y=new Array(4),ce=new Array(4),fe=new Array(4),Se=0;Se<8;++Se){var de=Se*8;ct[0]=De*V[de+2],ct[1]=dt*V[de+2],ct[2]=De*V[de+6],ct[3]=dt*V[de+6],Y[0]=me*V[de+1]+Ye*V[de+3]+Xe*V[de+5]+rt*V[de+7],Y[1]=Ye*V[de+1]-rt*V[de+3]-me*V[de+5]-Xe*V[de+7],Y[2]=Xe*V[de+1]-me*V[de+3]+rt*V[de+5]+Ye*V[de+7],Y[3]=rt*V[de+1]-Xe*V[de+3]+Ye*V[de+5]-me*V[de+7],ce[0]=$*(V[de+0]+V[de+4]),ce[3]=$*(V[de+0]-V[de+4]),ce[1]=ct[0]+ct[3],ce[2]=ct[1]-ct[2],fe[0]=ce[0]+ce[1],fe[1]=ce[3]+ce[2],fe[2]=ce[3]-ce[2],fe[3]=ce[0]-ce[1],V[de+0]=fe[0]+Y[0],V[de+1]=fe[1]+Y[1],V[de+2]=fe[2]+Y[2],V[de+3]=fe[3]+Y[3],V[de+4]=fe[3]-Y[3],V[de+5]=fe[2]-Y[2],V[de+6]=fe[1]-Y[1],V[de+7]=fe[0]-Y[0]}for(var Ke=0;Ke<8;++Ke)ct[0]=De*V[16+Ke],ct[1]=dt*V[16+Ke],ct[2]=De*V[48+Ke],ct[3]=dt*V[48+Ke],Y[0]=me*V[8+Ke]+Ye*V[24+Ke]+Xe*V[40+Ke]+rt*V[56+Ke],Y[1]=Ye*V[8+Ke]-rt*V[24+Ke]-me*V[40+Ke]-Xe*V[56+Ke],Y[2]=Xe*V[8+Ke]-me*V[24+Ke]+rt*V[40+Ke]+Ye*V[56+Ke],Y[3]=rt*V[8+Ke]-Xe*V[24+Ke]+Ye*V[40+Ke]-me*V[56+Ke],ce[0]=$*(V[Ke]+V[32+Ke]),ce[3]=$*(V[Ke]-V[32+Ke]),ce[1]=ct[0]+ct[3],ce[2]=ct[1]-ct[2],fe[0]=ce[0]+ce[1],fe[1]=ce[3]+ce[2],fe[2]=ce[3]-ce[2],fe[3]=ce[0]-ce[1],V[0+Ke]=fe[0]+Y[0],V[8+Ke]=fe[1]+Y[1],V[16+Ke]=fe[2]+Y[2],V[24+Ke]=fe[3]+Y[3],V[32+Ke]=fe[3]-Y[3],V[40+Ke]=fe[2]-Y[2],V[48+Ke]=fe[1]-Y[1],V[56+Ke]=fe[0]-Y[0]}function _t(V){for(var $=0;$<64;++$){var me=V[0][$],De=V[1][$],Ye=V[2][$];V[0][$]=me+1.5747*Ye,V[1][$]=me-.1873*De-.4682*Ye,V[2][$]=me+1.8556*De}}function it(V,$,me){for(var De=0;De<64;++De)$[me+De]=fp.toHalfFloat(Tt(V[De]))}function Tt(V){return V<=1?Math.sign(V)*Math.pow(Math.abs(V),2.2):Math.sign(V)*Math.pow(B,Math.abs(V)-1)}function se(V){return new DataView(V.array.buffer,V.offset.value,V.size)}function q(V){var $=V.viewer.buffer.slice(V.offset.value,V.offset.value+V.size),me=new Uint8Array(ie($)),De=new Uint8Array(me.length);return vt(me),ze(me,De),new DataView(De.buffer)}function Ee(V){var $=V.array.slice(V.offset.value,V.offset.value+V.size),me=dA($),De=new Uint8Array(me.length);return vt(me),ze(me,De),new DataView(De.buffer)}function Ge(V){for(var $=V.viewer,me={value:V.offset.value},De=new Uint16Array(V.width*V.scanlineBlockSize*(V.channels*V.type)),Ye=new Uint8Array(8192),Xe=0,dt=new Array(V.channels),rt=0;rt<V.channels;rt++)dt[rt]={},dt[rt].start=Xe,dt[rt].end=dt[rt].start,dt[rt].nx=V.width,dt[rt].ny=V.lines,dt[rt].size=V.type,Xe+=dt[rt].nx*dt[rt].ny*dt[rt].size;var ct=ht($,me),Y=ht($,me);if(Y>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(ct<=Y)for(var rt=0;rt<Y-ct+1;rt++)Ye[rt+ct]=he($,me);var ce=new Uint16Array(65536),fe=I(Ye,ce),Se=Je($,me);At(V.array,$,me,Se,De,Xe);for(var rt=0;rt<V.channels;++rt)for(var de=dt[rt],Ke=0;Ke<dt[rt].size;++Ke)gt(De,de.start+Ke,de.nx,de.size,de.ny,de.nx*de.size,fe);jt(ce,De,Xe);for(var et=0,pt=new Uint8Array(De.buffer.byteLength),xt=0;xt<V.lines;xt++)for(var Lt=0;Lt<V.channels;Lt++){var de=dt[Lt],Pt=de.nx*de.size,Bt=new Uint8Array(De.buffer,de.end*2,Pt*2);pt.set(Bt,et),et+=Pt*2,de.end+=Pt}return new DataView(pt.buffer)}function Ve(V){var $=V.array.slice(V.offset.value,V.offset.value+V.size),me=dA($);const De=V.lines*V.channels*V.width,Ye=V.type==1?new Uint16Array(De):new Uint32Array(De);let Xe=0,dt=0;const rt=new Array(4);for(let ct=0;ct<V.lines;ct++)for(let Y=0;Y<V.channels;Y++){let ce=0;switch(V.type){case 1:rt[0]=Xe,rt[1]=rt[0]+V.width,Xe=rt[1]+V.width;for(let fe=0;fe<V.width;++fe){const Se=me[rt[0]++]<<8|me[rt[1]++];ce+=Se,Ye[dt]=ce,dt++}break;case 2:rt[0]=Xe,rt[1]=rt[0]+V.width,rt[2]=rt[1]+V.width,Xe=rt[2]+V.width;for(let fe=0;fe<V.width;++fe){const Se=me[rt[0]++]<<24|me[rt[1]++]<<16|me[rt[2]++]<<8;ce+=Se,Ye[dt]=ce,dt++}break}}return new DataView(Ye.buffer)}function Pe(V){var $=V.viewer,me={value:V.offset.value},De=new Uint8Array(V.width*V.lines*(V.channels*V.type*2)),Ye={version:Ce($,me),unknownUncompressedSize:Ce($,me),unknownCompressedSize:Ce($,me),acCompressedSize:Ce($,me),dcCompressedSize:Ce($,me),rleCompressedSize:Ce($,me),rleUncompressedSize:Ce($,me),rleRawSize:Ce($,me),totalAcUncompressedCount:Ce($,me),totalDcUncompressedCount:Ce($,me),acCompression:Ce($,me)};if(Ye.version<2)throw"EXRLoader.parse: "+hn.compression+" version "+Ye.version+" is unsupported";for(var Xe=new Array,dt=ht($,me)-2;dt>0;){var rt=wt($.buffer,me),ct=he($,me),Y=ct>>2&3,ce=(ct>>4)-1,fe=new Int8Array([ce])[0],Se=he($,me);Xe.push({name:rt,index:fe,type:Se,compression:Y}),dt-=rt.length+3}for(var de=hn.channels,Ke=new Array(V.channels),et=0;et<V.channels;++et){var pt=Ke[et]={},xt=de[et];pt.name=xt.name,pt.compression=0,pt.decoded=!1,pt.type=xt.pixelType,pt.pLinear=xt.pLinear,pt.width=V.width,pt.height=V.lines}for(var Lt={idx:new Array(3)},Pt=0;Pt<V.channels;++Pt)for(var pt=Ke[Pt],et=0;et<Xe.length;++et){var Bt=Xe[et];pt.name==Bt.name&&(pt.compression=Bt.compression,Bt.index>=0&&(Lt.idx[Bt.index]=Pt),pt.offset=Pt)}if(Ye.acCompressedSize>0)switch(Ye.acCompression){case 0:var nn=new Uint16Array(Ye.totalAcUncompressedCount);At(V.array,$,me,Ye.acCompressedSize,nn,Ye.totalAcUncompressedCount);break;case 1:var Kt=V.array.slice(me.value,me.value+Ye.totalAcUncompressedCount),bn=dA(Kt),nn=new Uint16Array(bn.buffer);me.value+=Ye.totalAcUncompressedCount;break}if(Ye.dcCompressedSize>0){var fn={array:V.array,offset:me,size:Ye.dcCompressedSize},Nn=new Uint16Array(Ee(fn).buffer);me.value+=Ye.dcCompressedSize}if(Ye.rleRawSize>0){var Kt=V.array.slice(me.value,me.value+Ye.rleCompressedSize),bn=dA(Kt),sn=ie(bn.buffer);me.value+=Ye.rleCompressedSize}for(var In=0,Qt=new Array(Ke.length),et=0;et<Qt.length;++et)Qt[et]=new Array;for(var zn=0;zn<V.lines;++zn)for(var ni=0;ni<Ke.length;++ni)Qt[ni].push(In),In+=Ke[ni].width*V.type*2;Oe(Lt,Qt,Ke,nn,Nn,De);for(var et=0;et<Ke.length;++et){var pt=Ke[et];if(!pt.decoded)switch(pt.compression){case 2:for(var ln=0,Ji=0,zn=0;zn<V.lines;++zn){for(var $n=Qt[et][ln],oi=0;oi<pt.width;++oi){for(var Ri=0;Ri<2*pt.type;++Ri)De[$n++]=sn[Ji+Ri*pt.width*pt.height];Ji++}ln++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(De.buffer)}function wt(V,$){for(var me=new Uint8Array(V),De=0;me[$.value+De]!=0;)De+=1;var Ye=new TextDecoder().decode(me.slice($.value,$.value+De));return $.value=$.value+De+1,Ye}function bt(V,$,me){var De=new TextDecoder().decode(new Uint8Array(V).slice($.value,$.value+me));return $.value=$.value+me,De}function Ft(V,$){var me=Ze(V,$),De=Je(V,$);return[me,De]}function Mt(V,$){var me=Je(V,$),De=Je(V,$);return[me,De]}function Ze(V,$){var me=V.getInt32($.value,!0);return $.value=$.value+4,me}function Je(V,$){var me=V.getUint32($.value,!0);return $.value=$.value+4,me}function Nt(V,$){var me=V[$.value];return $.value=$.value+1,me}function he(V,$){var me=V.getUint8($.value);return $.value=$.value+1,me}const Ce=function(V,$){let me;return"getBigInt64"in DataView.prototype?me=Number(V.getBigInt64($.value,!0)):me=V.getUint32($.value+4,!0)+Number(V.getUint32($.value,!0)<<32),$.value+=8,me};function tt(V,$){var me=V.getFloat32($.value,!0);return $.value+=4,me}function le(V,$){return fp.toHalfFloat(tt(V,$))}function Re(V){var $=(V&31744)>>10,me=V&1023;return(V>>15?-1:1)*($?$===31?me?NaN:1/0:Math.pow(2,$-15)*(1+me/1024):6103515625e-14*(me/1024))}function ht(V,$){var me=V.getUint16($.value,!0);return $.value+=2,me}function yt(V,$){return Re(ht(V,$))}function ut(V,$,me,De){for(var Ye=me.value,Xe=[];me.value<Ye+De-1;){var dt=wt($,me),rt=Ze(V,me),ct=he(V,me);me.value+=3;var Y=Ze(V,me),ce=Ze(V,me);Xe.push({name:dt,pixelType:rt,pLinear:ct,xSampling:Y,ySampling:ce})}return me.value+=1,Xe}function Qe(V,$){var me=tt(V,$),De=tt(V,$),Ye=tt(V,$),Xe=tt(V,$),dt=tt(V,$),rt=tt(V,$),ct=tt(V,$),Y=tt(V,$);return{redX:me,redY:De,greenX:Ye,greenY:Xe,blueX:dt,blueY:rt,whiteX:ct,whiteY:Y}}function Rt(V,$){var me=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],De=he(V,$);return me[De]}function Vt(V,$){var me=Je(V,$),De=Je(V,$),Ye=Je(V,$),Xe=Je(V,$);return{xMin:me,yMin:De,xMax:Ye,yMax:Xe}}function En(V,$){var me=["INCREASING_Y"],De=he(V,$);return me[De]}function Dt(V,$){var me=tt(V,$),De=tt(V,$);return[me,De]}function Ut(V,$){var me=tt(V,$),De=tt(V,$),Ye=tt(V,$);return[me,De,Ye]}function dn(V,$,me,De,Ye){if(De==="string"||De==="stringvector"||De==="iccProfile")return bt($,me,Ye);if(De==="chlist")return ut(V,$,me,Ye);if(De==="chromaticities")return Qe(V,me);if(De==="compression")return Rt(V,me);if(De==="box2i")return Vt(V,me);if(De==="lineOrder")return En(V,me);if(De==="float")return tt(V,me);if(De==="v2f")return Dt(V,me);if(De==="v3f")return Ut(V,me);if(De==="int")return Ze(V,me);if(De==="rational")return Ft(V,me);if(De==="timecode")return Mt(V,me);if(De==="preview")return me.value+=Ye,"skipped";me.value+=Ye}function It(V,$,me){const De={};if(V.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";De.version=V.getUint8(4);const Ye=V.getUint8(5);De.spec={singleTile:!!(Ye&2),longName:!!(Ye&4),deepFormat:!!(Ye&8),multiPart:!!(Ye&16)},me.value=8;for(var Xe=!0;Xe;){var dt=wt($,me);if(dt==0)Xe=!1;else{var rt=wt($,me),ct=Je(V,me),Y=dn(V,$,me,rt,ct);Y===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${rt}'.`):De[dt]=Y}}if((Ye&-5)!=0)throw console.error("EXRHeader:",De),"THREE.EXRLoader: provided file is currently unsupported.";return De}function pn(V,$,me,De,Ye){const Xe={size:0,viewer:$,array:me,offset:De,width:V.dataWindow.xMax-V.dataWindow.xMin+1,height:V.dataWindow.yMax-V.dataWindow.yMin+1,channels:V.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:V.channels[0].pixelType,uncompress:null,getter:null,format:null,[vy?"colorSpace":"encoding"]:null};switch(V.compression){case"NO_COMPRESSION":Xe.lines=1,Xe.uncompress=se;break;case"RLE_COMPRESSION":Xe.lines=1,Xe.uncompress=q;break;case"ZIPS_COMPRESSION":Xe.lines=1,Xe.uncompress=Ee;break;case"ZIP_COMPRESSION":Xe.lines=16,Xe.uncompress=Ee;break;case"PIZ_COMPRESSION":Xe.lines=32,Xe.uncompress=Ge;break;case"PXR24_COMPRESSION":Xe.lines=16,Xe.uncompress=Ve;break;case"DWAA_COMPRESSION":Xe.lines=32,Xe.uncompress=Pe;break;case"DWAB_COMPRESSION":Xe.lines=256,Xe.uncompress=Pe;break;default:throw"EXRLoader.parse: "+V.compression+" is unsupported"}if(Xe.scanlineBlockSize=Xe.lines,Xe.type==1)switch(Ye){case Ss:Xe.getter=yt,Xe.inputSize=2;break;case ar:Xe.getter=ht,Xe.inputSize=2;break}else if(Xe.type==2)switch(Ye){case Ss:Xe.getter=tt,Xe.inputSize=4;break;case ar:Xe.getter=le,Xe.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+Xe.type+" for "+V.compression+".";Xe.blockCount=(V.dataWindow.yMax+1)/Xe.scanlineBlockSize;for(var dt=0;dt<Xe.blockCount;dt++)Ce($,De);Xe.outputChannels=Xe.channels==3?4:Xe.channels;const rt=Xe.width*Xe.height*Xe.outputChannels;switch(Ye){case Ss:Xe.byteArray=new Float32Array(rt),Xe.channels<Xe.outputChannels&&Xe.byteArray.fill(1,0,rt);break;case ar:Xe.byteArray=new Uint16Array(rt),Xe.channels<Xe.outputChannels&&Xe.byteArray.fill(15360,0,rt);break;default:console.error("THREE.EXRLoader: unsupported type: ",Ye);break}return Xe.bytesPerLine=Xe.width*Xe.inputSize*Xe.channels,Xe.outputChannels==4?Xe.format=Ns:Xe.format=Fx,vy?Xe.colorSpace="srgb-linear":Xe.encoding=3e3,Xe}const Wt=new DataView(e),$t=new Uint8Array(e),ai={value:0},hn=It(Wt,e,ai),Yt=pn(hn,Wt,$t,ai,this.type),Xn={value:0},Jt={R:0,G:1,B:2,A:3,Y:0};for(let V=0;V<Yt.height/Yt.scanlineBlockSize;V++){const $=Je(Wt,ai);Yt.size=Je(Wt,ai),Yt.lines=$+Yt.scanlineBlockSize>Yt.height?Yt.height-$:Yt.scanlineBlockSize;const De=Yt.size<Yt.lines*Yt.bytesPerLine?Yt.uncompress(Yt):se(Yt);ai.value+=Yt.size;for(let Ye=0;Ye<Yt.scanlineBlockSize;Ye++){const Xe=Ye+V*Yt.scanlineBlockSize;if(Xe>=Yt.height)break;for(let dt=0;dt<Yt.channels;dt++){const rt=Jt[hn.channels[dt].name];for(let ct=0;ct<Yt.width;ct++){Xn.value=(Ye*(Yt.channels*Yt.width)+dt*Yt.width+ct)*Yt.inputSize;const Y=(Yt.height-1-Xe)*(Yt.width*Yt.outputChannels)+ct*Yt.outputChannels+rt;Yt.byteArray[Y]=Yt.getter(De,Xn)}}}}return{header:hn,width:Yt.width,height:Yt.height,data:Yt.byteArray,format:Yt.format,[vy?"colorSpace":"encoding"]:Yt[vy?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,i){function s(a,o){vy?a.colorSpace=o.colorSpace:a.encoding=o.encoding,a.minFilter=yi,a.magFilter=yi,a.generateMipmaps=!1,a.flipY=!1,t&&t(a,o)}return super.load(e,s,n,i)}}const wM=new WeakMap;class hK extends Hr{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const s=new kr(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,a=>{const o={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(a,o).then(t).catch(i)},n,i)}decodeDracoFile(e,t,n,i){const s={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,s).then(t)}decodeGeometry(e,t){for(const c in t.attributeTypes){const u=t.attributeTypes[c];u.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[c]=u.name)}const n=JSON.stringify(t);if(wM.has(e)){const c=wM.get(e);if(c.key===n)return c.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const s=this.workerNextTaskID++,a=e.byteLength,o=this._getWorker(s,a).then(c=>(i=c,new Promise((u,h)=>{i._callbacks[s]={resolve:u,reject:h},i.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return o.catch(()=>!0).then(()=>{i&&s&&this._releaseTask(i,s)}),wM.set(e,{key:n,promise:o}),o}_createGeometry(e){const t=new Ln;e.index&&t.setIndex(new xi(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n],s=i.name,a=i.array,o=i.itemSize;t.setAttribute(s,new xi(a,o))}return t}_loadLibrary(e,t){const n=new kr(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((i,s)=>{n.load(e,i,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const i=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const s=dK.toString(),a=["/* draco decoder */",i,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(s){const a=s.data;switch(a.type){case"decode":i._callbacks[a.id].resolve(a);break;case"error":i._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,s){return i._taskLoad>s._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function dK(){let r,e;onmessage=function(a){const o=a.data;switch(o.type){case"init":r=o.decoderConfig,e=new Promise(function(h){r.onModuleLoaded=function(p){h({draco:p})},DracoDecoderModule(r)});break;case"decode":const c=o.buffer,u=o.taskConfig;e.then(h=>{const p=h.draco,v=new p.Decoder,y=new p.DecoderBuffer;y.Init(new Int8Array(c),c.byteLength);try{const x=t(p,v,y,u),S=x.attributes.map(E=>E.array.buffer);x.index&&S.push(x.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:x},S)}catch(x){console.error(x),self.postMessage({type:"error",id:o.id,error:x.message})}finally{p.destroy(y),p.destroy(v)}});break}};function t(a,o,c,u){const h=u.attributeIDs,p=u.attributeTypes;let v,y;const x=o.GetEncodedGeometryType(c);if(x===a.TRIANGULAR_MESH)v=new a.Mesh,y=o.DecodeBufferToMesh(c,v);else if(x===a.POINT_CLOUD)v=new a.PointCloud,y=o.DecodeBufferToPointCloud(c,v);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!y.ok()||v.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+y.error_msg());const S={index:null,attributes:[]};for(const E in h){const b=self[p[E]];let T,R;if(u.useUniqueIDs)R=h[E],T=o.GetAttributeByUniqueId(v,R);else{if(R=o.GetAttributeId(v,a[h[E]]),R===-1)continue;T=o.GetAttribute(v,R)}S.attributes.push(i(a,o,v,E,b,T))}return x===a.TRIANGULAR_MESH&&(S.index=n(a,o,v)),a.destroy(v),S}function n(a,o,c){const h=c.num_faces()*3,p=h*4,v=a._malloc(p);o.GetTrianglesUInt32Array(c,p,v);const y=new Uint32Array(a.HEAPF32.buffer,v,h).slice();return a._free(v),{array:y,itemSize:1}}function i(a,o,c,u,h,p){const v=p.num_components(),x=c.num_points()*v,S=x*h.BYTES_PER_ELEMENT,E=s(a,h),b=a._malloc(S);o.GetAttributeDataArrayForAllPoints(c,p,E,S,b);const T=new h(a.HEAPF32.buffer,b,x).slice();return a._free(b),{name:u,array:T,itemSize:v}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}let mA;const IM=()=>{if(mA)return mA;const r="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let i=r;WebAssembly.validate(t)&&(i=e);let s;const a=WebAssembly.instantiate(o(i),{}).then(p=>{s=p.instance,s.exports.__wasm_call_ctors()});function o(p){const v=new Uint8Array(p.length);for(let x=0;x<p.length;++x){const S=p.charCodeAt(x);v[x]=S>96?S-71:S>64?S-65:S>47?S+4:S>46?63:62}let y=0;for(let x=0;x<p.length;++x)v[y++]=v[x]<60?n[v[x]]:(v[x]-60)*64+v[++x];return v.buffer.slice(0,y)}function c(p,v,y,x,S,E){const b=s.exports.sbrk,T=y+3&-4,R=b(T*x),D=b(S.length),P=new Uint8Array(s.exports.memory.buffer);P.set(S,D);const O=p(R,y,x,D,S.length);if(O===0&&E&&E(R,T,x),v.set(P.subarray(R,R+y*x)),b(R-b(0)),O!==0)throw new Error(`Malformed buffer data: ${O}`)}const u={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return mA={ready:a,supported:!0,decodeVertexBuffer(p,v,y,x,S){c(s.exports.meshopt_decodeVertexBuffer,p,v,y,x,s.exports[u[S]])},decodeIndexBuffer(p,v,y,x){c(s.exports.meshopt_decodeIndexBuffer,p,v,y,x)},decodeIndexSequence(p,v,y,x){c(s.exports.meshopt_decodeIndexSequence,p,v,y,x)},decodeGltfBuffer(p,v,y,x,S,E){c(s.exports[h[S]],p,v,y,x,s.exports[u[E]])}},mA},BM=r=>r===Object(r)&&!Array.isArray(r)&&typeof r!="function";function yT(r,e){const t=sa(s=>s.gl),n=El(Jx,BM(r)?Object.values(r):r);return Fe.useLayoutEffect(()=>{e?.(n)},[e]),Fe.useEffect(()=>{if("initTexture"in t){let s=[];Array.isArray(n)?s=n:n instanceof Ti?s=[n]:BM(n)&&(s=Object.values(n)),s.forEach(a=>{a instanceof Ti&&t.initTexture(a)})}},[t,n]),Fe.useMemo(()=>{if(BM(r)){const s={};let a=0;for(const o in r)s[o]=n[a++];return s}else return n},[r,n])}yT.preload=r=>El.preload(Jx,r);yT.clear=r=>El.clear(Jx,r);let gA=null,zN="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function VN(r=!0,e=!0,t){return n=>{t&&t(n),r&&(gA||(gA=new hK),gA.setDecoderPath(typeof r=="string"?r:zN),n.setDRACOLoader(gA)),e&&n.setMeshoptDecoder(typeof IM=="function"?IM():IM)}}const yf=(r,e,t,n)=>El(YD,r,VN(e,t,n));yf.preload=(r,e,t,n)=>El.preload(YD,r,VN(e,t,n));yf.clear=r=>El.clear(YD,r);yf.setDecoderPath=r=>{zN=r};const pK=Fe.forwardRef(({makeDefault:r,camera:e,regress:t,domElement:n,enableDamping:i=!0,keyEvents:s=!1,onChange:a,onStart:o,onEnd:c,...u},h)=>{const p=sa(O=>O.invalidate),v=sa(O=>O.camera),y=sa(O=>O.gl),x=sa(O=>O.events),S=sa(O=>O.setEvents),E=sa(O=>O.set),b=sa(O=>O.get),T=sa(O=>O.performance),R=e||v,D=n||x.connected||y.domElement,P=Fe.useMemo(()=>new RX(R),[R]);return GD(()=>{P.enabled&&P.update()},-1),Fe.useEffect(()=>(s&&P.connect(s===!0?D:s),P.connect(D),()=>void P.dispose()),[s,D,t,P,p]),Fe.useEffect(()=>{const O=B=>{p(),t&&T.regress(),a&&a(B)},N=B=>{o&&o(B)},U=B=>{c&&c(B)};return P.addEventListener("change",O),P.addEventListener("start",N),P.addEventListener("end",U),()=>{P.removeEventListener("start",N),P.removeEventListener("end",U),P.removeEventListener("change",O)}},[a,o,c,P,p,S]),Fe.useEffect(()=>{if(r){const O=b().controls;return E({controls:P}),()=>E({controls:O})}},[r,P]),Fe.createElement("primitive",Np({ref:h,object:P,enableDamping:i},u))}),mK="modulepreload",gK=function(r,e){return new URL(r,e).href},a3={},vK=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){let u=function(h){return Promise.all(h.map(p=>Promise.resolve(p).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};const a=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),c=o?.nonce||o?.getAttribute("nonce");i=u(t.map(h=>{if(h=gK(h,n),h in a3)return;a3[h]=!0;const p=h.endsWith(".css"),v=p?'[rel="stylesheet"]':"";if(n)for(let x=a.length-1;x>=0;x--){const S=a[x];if(S.href===h&&(!p||S.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${h}"]${v}`))return;const y=document.createElement("link");if(y.rel=p?"stylesheet":mK,p||(y.as="script"),y.crossOrigin="",y.href=h,c&&y.setAttribute("nonce",c),document.head.appendChild(y),p)return new Promise((x,S)=>{y.addEventListener("load",x),y.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${h}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return i.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return e().catch(s)})},zt=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},yK=Number.isSafeInteger||function(r){return typeof r=="number"&&Math.abs(r)<=xK},xK=Number.MAX_SAFE_INTEGER||9007199254740991;let rn=(function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r})({}),Ie=(function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",r.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",r.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.ASSET_LIST_LOAD_ERROR="assetListLoadError",r.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",r.ASSET_LIST_PARSING_ERROR="assetListParsingError",r.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.ATTACH_MEDIA_ERROR="attachMediaError",r.UNKNOWN="unknown",r})({}),H=(function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.MEDIA_ENDED="hlsMediaEnded",r.STALL_RESOLVED="hlsStallResolved",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFERED_TO_END="hlsBufferedToEnd",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",r.ASSET_LIST_LOADING="hlsAssetListLoading",r.ASSET_LIST_LOADED="hlsAssetListLoaded",r.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",r.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",r.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",r.INTERSTITIAL_STARTED="hlsInterstitialStarted",r.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",r.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",r.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",r.INTERSTITIAL_ENDED="hlsInterstitialEnded",r.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",r.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",r.EVENT_CUE_ENTER="hlsEventCueEnter",r})({});var jn={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},qt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class E0{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class _K{constructor(e,t,n,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new E0(e),this.fast_=new E0(t),this.defaultTTFB_=i,this.ttfb_=new E0(e)}update(e,t){const{slow_:n,fast_:i,ttfb_:s}=this;n.halfLife!==e&&(this.slow_=new E0(e,n.getEstimate(),n.getTotalWeight())),i.halfLife!==t&&(this.fast_=new E0(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new E0(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,i=e/1e3,s=n/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function SK(r,e,t){return(e=EK(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Gi(){return Gi=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Gi.apply(null,arguments)}function o3(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Oi(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?o3(Object(t),!0).forEach(function(n){SK(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):o3(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function AK(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function EK(r){var e=AK(r,"string");return typeof e=="symbol"?e:e+""}class Cl{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=mh,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const mh=function(){},bK={trace:mh,debug:mh,log:mh,warn:mh,info:mh,error:mh};function $C(){return Gi({},bK)}function TK(r,e){const t=self.console[r];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${r}] >`):mh}function l3(r,e,t){return e[r]?e[r].bind(e):TK(r,t)}const QC=$C();function MK(r,e,t){const n=$C();if(typeof console=="object"&&r===!0||typeof r=="object"){const i=["debug","log","info","warn","error"];i.forEach(s=>{n[s]=l3(s,r,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return $C()}i.forEach(s=>{QC[s]=l3(s,r)})}else Gi(QC,n);return n}const Pi=QC;function mf(r=!0){return typeof self>"u"?void 0:(r||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function CK(r){return typeof self<"u"&&r===self.ManagedMediaSource}function YN(r,e){const t=Object.keys(r),n=Object.keys(e),i=t.length,s=n.length;return!i||!s||i===s&&!t.some(a=>n.indexOf(a)===-1)}function ko(r,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(r);if(e){const h=u.indexOf("\0");return h!==-1?u.substring(0,h):u}return u.replace(/\0/g,"")}const t=r.length;let n,i,s,a="",o=0;for(;o<t;){if(n=r[o++],n===0&&e)return a;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(n);break;case 12:case 13:i=r[o++],a+=String.fromCharCode((n&31)<<6|i&63);break;case 14:i=r[o++],s=r[o++],a+=String.fromCharCode((n&15)<<12|(i&63)<<6|(s&63)<<0);break}}return a}function Nr(r){let e="";for(let t=0;t<r.length;t++){let n=r[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function XN(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function RK(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var OM={exports:{}},c3;function DK(){return c3||(c3=1,(function(r,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(c,u,h){if(h=h||{},c=c.trim(),u=u.trim(),!u){if(!h.alwaysNormalize)return c;var p=o.parseURL(c);if(!p)throw new Error("Error trying to parse base URL.");return p.path=o.normalizePath(p.path),o.buildURLFromParts(p)}var v=o.parseURL(u);if(!v)throw new Error("Error trying to parse relative URL.");if(v.scheme)return h.alwaysNormalize?(v.path=o.normalizePath(v.path),o.buildURLFromParts(v)):u;var y=o.parseURL(c);if(!y)throw new Error("Error trying to parse base URL.");if(!y.netLoc&&y.path&&y.path[0]!=="/"){var x=i.exec(y.path);y.netLoc=x[1],y.path=x[2]}y.netLoc&&!y.path&&(y.path="/");var S={scheme:y.scheme,netLoc:v.netLoc,path:null,params:v.params,query:v.query,fragment:v.fragment};if(!v.netLoc&&(S.netLoc=y.netLoc,v.path[0]!=="/"))if(!v.path)S.path=y.path,v.params||(S.params=y.params,v.query||(S.query=y.query));else{var E=y.path,b=E.substring(0,E.lastIndexOf("/")+1)+v.path;S.path=o.normalizePath(b)}return S.path===null&&(S.path=h.alwaysNormalize?o.normalizePath(v.path):v.path),o.buildURLFromParts(S)},parseURL:function(c){var u=n.exec(c);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(c){for(c=c.split("").reverse().join("").replace(s,"");c.length!==(c=c.replace(a,"")).length;);return c.split("").reverse().join("")},buildURLFromParts:function(c){return c.scheme+c.netLoc+c.path+c.params+c.query+c.fragment}};r.exports=o})()})(OM)),OM.exports}var XD=DK();class xT{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var qi={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class KD{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,LK(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let i;n.length===1?i=t?.byteRangeEndOffset||0:i=parseInt(n[1]),this._byteRange=[i,parseInt(n[0])+i]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[qi.AUDIO]:null,[qi.VIDEO]:null,[qi.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new xT),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=XD.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[qi.AUDIO]=null,e[qi.VIDEO]=null,e[qi.AUDIOVIDEO]=null}}function Ps(r){return r.sn!=="initSegment"}class nE extends KD{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(zt(e)&&zt(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const n=Object.keys(t);if(n.length===1){const i=this._decryptdata=t[n[0]]||null;i&&(this._decryptdata=i.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=zt(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const n=Object.keys(this.levelkeys),i=n.length;if(i>1||i===1&&(t=this.levelkeys[n[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!zt(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Ps(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const i=t[e];i&&!((n=this._decryptdata)!=null&&n.keyId)&&(this._decryptdata=i.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,i,s,a=!1){const{elementaryStreams:o}=this,c=o[e];if(!c){o[e]={startPTS:t,endPTS:n,startDTS:i,endDTS:s,partial:a};return}c.startPTS=Math.min(c.startPTS,t),c.endPTS=Math.max(c.endPTS,n),c.startDTS=Math.min(c.startDTS,i),c.endDTS=Math.max(c.endDTS,s)}}class KN extends KD{constructor(e,t,n,i,s){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function qN(r,e){const t=Object.getPrototypeOf(r);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||qN(t,e)}}function LK(r,e){const t=qN(r,e);t&&(t.enumerable=!0,Object.defineProperty(r,e,t))}const u3=Math.pow(2,32)-1,wK=[].push,jN={video:1,audio:2,id3:3,text:4};function tr(r){return String.fromCharCode.apply(null,r)}function WN(r,e){const t=r[e]<<8|r[e+1];return t<0?65536+t:t}function Mn(r,e){const t=JN(r,e);return t<0?4294967296+t:t}function f3(r,e){let t=Mn(r,e);return t*=Math.pow(2,32),t+=Mn(r,e+4),t}function JN(r,e){return r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}function IK(r){const e=r.byteLength;for(let t=0;t<e;){const n=Mn(r,t);if(n>8&&r[t+4]===109&&r[t+5]===111&&r[t+6]===111&&r[t+7]===102)return!0;t=n>1?t+n:e}return!1}function Yn(r,e){const t=[];if(!e.length)return t;const n=r.byteLength;for(let i=0;i<n;){const s=Mn(r,i),a=tr(r.subarray(i+4,i+8)),o=s>1?i+s:n;if(a===e[0])if(e.length===1)t.push(r.subarray(i+8,o));else{const c=Yn(r.subarray(i+8,o),e.slice(1));c.length&&wK.apply(t,c)}i=o}return t}function BK(r){const e=[],t=r[0];let n=8;const i=Mn(r,n);n+=4;let s=0,a=0;t===0?(s=Mn(r,n),a=Mn(r,n+4),n+=8):(s=f3(r,n),a=f3(r,n+8),n+=16),n+=2;let o=r.length+a;const c=WN(r,n);n+=2;for(let u=0;u<c;u++){let h=n;const p=Mn(r,h);h+=4;const v=p&2147483647;if((p&2147483648)>>>31===1)return Pi.warn("SIDX has hierarchical references (not supported)"),null;const x=Mn(r,h);h+=4,e.push({referenceSize:v,subsegmentDuration:x,info:{duration:x/i,start:o,end:o+v-1}}),o+=v,h+=4,n=h}return{earliestPresentationTime:s,timescale:i,version:t,referencesCount:c,references:e}}function $N(r){const e=[],t=Yn(r,["moov","trak"]);for(let i=0;i<t.length;i++){const s=t[i],a=Yn(s,["tkhd"])[0];if(a){let o=a[0];const c=Mn(a,o===0?12:20),u=Yn(s,["mdia","mdhd"])[0];if(u){o=u[0];const h=Mn(u,o===0?12:20),p=Yn(s,["mdia","hdlr"])[0];if(p){const v=tr(p.subarray(8,12)),y={soun:qi.AUDIO,vide:qi.VIDEO}[v],x=Yn(s,["mdia","minf","stbl","stsd"])[0],S=OK(x);y?(e[c]={timescale:h,type:y,stsd:S},e[y]=Oi({timescale:h,id:c},S)):e[c]={timescale:h,type:v,stsd:S}}}}}return Yn(r,["moov","mvex","trex"]).forEach(i=>{const s=Mn(i,4),a=e[s];a&&(a.default={duration:Mn(i,12),flags:Mn(i,20)})}),e}function OK(r){const e=r.subarray(8),t=e.subarray(86),n=tr(e.subarray(4,8));let i=n,s;const a=n==="enca"||n==="encv";if(a){const u=Yn(e,[n])[0].subarray(n==="enca"?28:78);Yn(u,["sinf"]).forEach(p=>{const v=Yn(p,["schm"])[0];if(v){const y=tr(v.subarray(4,8));if(y==="cbcs"||y==="cenc"){const x=Yn(p,["frma"])[0];x&&(i=tr(x))}}})}const o=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const c=Yn(t,["avcC"])[0];c&&c.length>3&&(i+="."+yA(c[1])+yA(c[2])+yA(c[3]),s=vA(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const c=Yn(e,[n])[0],u=Yn(c.subarray(28),["esds"])[0];if(u&&u.length>7){let h=4;if(u[h++]!==3)break;h=PM(u,h),h+=2;const p=u[h++];if(p&128&&(h+=2),p&64&&(h+=u[h++]),u[h++]!==4)break;h=PM(u,h);const v=u[h++];if(v===64)i+="."+yA(v);else break;if(h+=12,u[h++]!==5)break;h=PM(u,h);const y=u[h++];let x=(y&248)>>3;x===31&&(x+=1+((y&7)<<3)+((u[h]&224)>>5)),i+="."+x}break}case"hvc1":case"hev1":{const c=Yn(t,["hvcC"])[0];if(c&&c.length>12){const u=c[1],h=["","A","B","C"][u>>6],p=u&31,v=Mn(c,2),y=(u&32)>>5?"H":"L",x=c[12],S=c.subarray(6,12);i+="."+h+p,i+="."+PK(v).toString(16).toUpperCase(),i+="."+y+x;let E="";for(let b=S.length;b--;){const T=S[b];(T||E)&&(E="."+T.toString(16).toUpperCase()+E)}i+=E}s=vA(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{i=vA(i,t)||i;break}case"vp09":{const c=Yn(t,["vpcC"])[0];if(c&&c.length>6){const u=c[4],h=c[5],p=c[6]>>4&15;i+="."+Wc(u)+"."+Wc(h)+"."+Wc(p)}break}case"av01":{const c=Yn(t,["av1C"])[0];if(c&&c.length>2){const u=c[1]>>>5,h=c[1]&31,p=c[2]>>>7?"H":"M",v=(c[2]&64)>>6,y=(c[2]&32)>>5,x=u===2&&v?y?12:10:v?10:8,S=(c[2]&16)>>4,E=(c[2]&8)>>3,b=(c[2]&4)>>2,T=c[2]&3;i+="."+u+"."+Wc(h)+p+"."+Wc(x)+"."+S+"."+E+b+T+"."+Wc(1)+"."+Wc(1)+"."+Wc(1)+"."+0,s=vA("dav1",t)}break}}return{codec:i,encrypted:a,supplemental:s}}function vA(r,e){const t=Yn(e,["dvvC"]),n=t.length?t[0]:Yn(e,["dvcC"])[0];if(n){const i=n[2]>>1&127,s=n[2]<<5&32|n[3]>>3&31;return r+"."+Wc(i)+"."+Wc(s)}}function PK(r){let e=0;for(let t=0;t<32;t++)e|=(r>>t&1)<<31-t;return e>>>0}function PM(r,e){const t=e+5;for(;r[e++]&128&&e<t;);return e}function yA(r){return("0"+r.toString(16).toUpperCase()).slice(-2)}function Wc(r){return(r<10?"0":"")+r}function NK(r,e){if(!r||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&QN(r,(n,i)=>{const s=n.subarray(8,24);s.some(a=>a!==0)||(Pi.log(`[eme] Patching keyId in 'enc${i?"a":"v"}>sinf>>tenc' box: ${Nr(s)} -> ${Nr(t)}`),n.set(t,8))})}function UK(r){const e=[];return QN(r,t=>e.push(t.subarray(8,24))),e}function QN(r,e){Yn(r,["moov","trak"]).forEach(n=>{const i=Yn(n,["mdia","minf","stbl","stsd"])[0];if(!i)return;const s=i.subarray(8);let a=Yn(s,["enca"]);const o=a.length>0;o||(a=Yn(s,["encv"])),a.forEach(c=>{const u=o?c.subarray(28):c.subarray(78);Yn(u,["sinf"]).forEach(p=>{const v=ZN(p);v&&e(v,o)})})})}function ZN(r){const e=Yn(r,["schm"])[0];if(e){const t=tr(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const n=Yn(r,["schi","tenc"])[0];if(n)return n}}}function FK(r,e,t){const n={},i=Yn(r,["moof","traf"]);for(let s=0;s<i.length;s++){const a=i[s],o=Yn(a,["tfhd"])[0],c=Mn(o,4),u=e[c];if(!u)continue;n[c]||(n[c]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});const h=n[c],p=Yn(a,["tfdt"])[0];if(p){const R=p[0];let D=Mn(p,4);R===1&&(D===u3?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(D*=u3+1,D+=Mn(p,8))),zt(D)&&(!zt(h.start)||D<h.start)&&(h.start=D)}const v=u.default,y=Mn(o,0)|v?.flags;let x=v?.duration||0;y&8&&(y&2?x=Mn(o,12):x=Mn(o,8));const S=Yn(a,["trun"]);let E=h.start||0,b=0,T=x;for(let R=0;R<S.length;R++){const D=S[R],P=Mn(D,4),O=h.sampleCount;h.sampleCount+=P;const N=D[3]&1,U=D[3]&4,B=D[2]&1,I=D[2]&2,z=D[2]&4,W=D[2]&8;let Z=8,te=P;for(N&&(Z+=4),U&&P&&(!(D[Z+1]&1)&&h.keyFrameIndex===void 0&&(h.keyFrameIndex=O),Z+=4,B?(T=Mn(D,Z),Z+=4):T=x,I&&(Z+=4),W&&(Z+=4),E+=T,b+=T,te--);te--;)B?(T=Mn(D,Z),Z+=4):T=x,I&&(Z+=4),z&&(D[Z+1]&1||h.keyFrameIndex===void 0&&(h.keyFrameIndex=h.sampleCount-(te+1),h.keyFrameStart=E),Z+=4),W&&(Z+=4),E+=T,b+=T;!b&&x&&(b+=x*P)}h.duration+=b}if(!Object.keys(n).some(s=>n[s].duration)){let s=1/0,a=0;const o=Yn(r,["sidx"]);for(let c=0;c<o.length;c++){const u=BK(o[c]);if(u!=null&&u.references){s=Math.min(s,u.earliestPresentationTime/u.timescale);const h=u.references.reduce((p,v)=>p+v.info.duration||0,0);a=Math.max(a,h+u.earliestPresentationTime/u.timescale)}}a&&zt(a)&&Object.keys(n).forEach(c=>{n[c].duration||(n[c].duration=a*n[c].timescale-n[c].start)})}return n}function kK(r){const e={valid:null,remainder:null},t=Yn(r,["moof"]);if(t.length<2)return e.remainder=r,e;const n=t[t.length-1];return e.valid=r.slice(0,n.byteOffset-8),e.remainder=r.slice(n.byteOffset-8),e}function bl(r,e){const t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function h3(r,e){const t=[],n=e.samples,i=e.timescale,s=e.id;let a=!1;return Yn(n,["moof"]).map(c=>{const u=c.byteOffset-8;Yn(c,["traf"]).map(p=>{const v=Yn(p,["tfdt"]).map(y=>{const x=y[0];let S=Mn(y,4);return x===1&&(S*=Math.pow(2,32),S+=Mn(y,8)),S/i})[0];return v!==void 0&&(r=v),Yn(p,["tfhd"]).map(y=>{const x=Mn(y,4),S=Mn(y,0)&16777215,E=(S&1)!==0,b=(S&2)!==0,T=(S&8)!==0;let R=0;const D=(S&16)!==0;let P=0;const O=(S&32)!==0;let N=8;x===s&&(E&&(N+=8),b&&(N+=4),T&&(R=Mn(y,N),N+=4),D&&(P=Mn(y,N),N+=4),O&&(N+=4),e.type==="video"&&(a=_T(e.codec)),Yn(p,["trun"]).map(U=>{const B=U[0],I=Mn(U,0)&16777215,z=(I&1)!==0;let W=0;const Z=(I&4)!==0,te=(I&256)!==0;let re=0;const k=(I&512)!==0;let j=0;const J=(I&1024)!==0,oe=(I&2048)!==0;let K=0;const X=Mn(U,4);let ne=8;z&&(W=Mn(U,ne),ne+=4),Z&&(ne+=4);let xe=W+u;for(let _e=0;_e<X;_e++){if(te?(re=Mn(U,ne),ne+=4):re=R,k?(j=Mn(U,ne),ne+=4):j=P,J&&(ne+=4),oe&&(B===0?K=Mn(U,ne):K=JN(U,ne),ne+=4),e.type===qi.VIDEO){let Be=0;for(;Be<j;){const pe=Mn(n,xe);if(xe+=4,GK(a,n[xe])){const be=n.subarray(xe,xe+pe);qD(be,a?2:1,r+K/i,t)}xe+=pe,Be+=pe+4}}r+=re/i}}))})})}),t}function _T(r){if(!r)return!1;const e=r.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function GK(r,e){if(r){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function qD(r,e,t,n){const i=eU(r);let s=0;s+=e;let a=0,o=0,c=0;for(;s<i.length;){a=0;do{if(s>=i.length)break;c=i[s++],a+=c}while(c===255);o=0;do{if(s>=i.length)break;c=i[s++],o+=c}while(c===255);const u=i.length-s;let h=s;if(o<u)s+=o;else if(o>u){Pi.error(`Malformed SEI payload. ${o} is too small, only ${u} bytes left to parse.`);break}if(a===4){if(i[h++]===181){const v=WN(i,h);if(h+=2,v===49){const y=Mn(i,h);if(h+=4,y===1195456820){const x=i[h++];if(x===3){const S=i[h++],E=31&S,b=64&S,T=b?2+E*3:0,R=new Uint8Array(T);if(b){R[0]=S;for(let D=1;D<T;D++)R[D]=i[h++]}n.push({type:x,payloadType:a,pts:t,bytes:R})}}}}}else if(a===5&&o>16){const p=[];for(let x=0;x<16;x++){const S=i[h++].toString(16);p.push(S.length==1?"0"+S:S),(x===3||x===5||x===7||x===9)&&p.push("-")}const v=o-16,y=new Uint8Array(v);for(let x=0;x<v;x++)y[x]=i[h++];n.push({payloadType:a,pts:t,uuid:p.join(""),userData:ko(y),userDataBytes:y})}}}function eU(r){const e=r.byteLength,t=[];let n=1;for(;n<e-2;)r[n]===0&&r[n+1]===0&&r[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return r;const i=e-t.length,s=new Uint8Array(i);let a=0;for(n=0;n<i;a++,n++)a===t[0]&&(a++,t.shift()),s[n]=r[a];return s}function HK(r){const e=r[0];let t="",n="",i=0,s=0,a=0,o=0,c=0,u=0;if(e===0){for(;tr(r.subarray(u,u+1))!=="\0";)t+=tr(r.subarray(u,u+1)),u+=1;for(t+=tr(r.subarray(u,u+1)),u+=1;tr(r.subarray(u,u+1))!=="\0";)n+=tr(r.subarray(u,u+1)),u+=1;n+=tr(r.subarray(u,u+1)),u+=1,i=Mn(r,12),s=Mn(r,16),o=Mn(r,20),c=Mn(r,24),u=28}else if(e===1){u+=4,i=Mn(r,u),u+=4;const p=Mn(r,u);u+=4;const v=Mn(r,u);for(u+=4,a=2**32*p+v,yK(a)||(a=Number.MAX_SAFE_INTEGER,Pi.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=Mn(r,u),u+=4,c=Mn(r,u),u+=4;tr(r.subarray(u,u+1))!=="\0";)t+=tr(r.subarray(u,u+1)),u+=1;for(t+=tr(r.subarray(u,u+1)),u+=1;tr(r.subarray(u,u+1))!=="\0";)n+=tr(r.subarray(u,u+1)),u+=1;n+=tr(r.subarray(u,u+1)),u+=1}const h=r.subarray(u,r.byteLength);return{schemeIdUri:t,value:n,timeScale:i,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:c,payload:h}}function zK(r,...e){const t=e.length;let n=8,i=t;for(;i--;)n+=e[i].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=n&255,s.set(r,4),i=0,n=8;i<t;i++)s.set(e[i],n),n+=e[i].byteLength;return s}function VK(r,e,t){if(r.byteLength!==16)throw new RangeError("Invalid system id");let n,i;n=0,i=new Uint8Array;let s;n>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),zK([112,115,115,104],new Uint8Array([n,0,0,0]),r,s,i,a,t)}function YK(r){const e=[];if(r instanceof ArrayBuffer){const t=r.byteLength;let n=0;for(;n+32<t;){const i=new DataView(r,n),s=XK(i);e.push(s),n+=s.size}}return e}function XK(r){const e=r.getUint32(0),t=r.byteOffset,n=r.byteLength;if(n<e)return{offset:t,size:n};if(r.getUint32(4)!==1886614376)return{offset:t,size:e};const s=r.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const a=r.buffer,o=Nr(new Uint8Array(a,t+12,16));let c=null,u=null,h=0;if(s===0)h=28;else{const v=r.getUint32(28);if(!v||n<32+v*16)return{offset:t,size:e};c=[];for(let y=0;y<v;y++)c.push(new Uint8Array(a,t+32+y*16,16));h=32+v*16}if(!h)return{offset:t,size:e};const p=r.getUint32(h);return e-32<p?{offset:t,size:e}:(u=new Uint8Array(a,t+h+4,p),{version:s,systemId:o,kids:c,data:u,offset:t,size:e})}const tU=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),pg={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function jD(r,e){const t=pg[e];return!!t&&!!t[r.slice(0,4)]}function yx(r,e,t=!0){return!r.split(",").some(n=>!WD(n,e,t))}function WD(r,e,t=!0){var n;const i=mf(t);return(n=i?.isTypeSupported(xx(r,e)))!=null?n:!1}function xx(r,e){return`${e}/mp4;codecs=${r}`}function d3(r){if(r){const e=r.substring(0,4);return pg.video[e]}return 2}function db(r){const e=tU();return r.split(",").reduce((t,n)=>{const s=e&&_T(n)?9:pg.video[n];return s?(s*2+t)/(t?3:2):(pg.audio[n]+t)/(t?2:1)},0)}const NM={};function KK(r,e=!0){if(NM[r])return NM[r];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[r];for(let i=0;i<t.length;i++){var n;if(WD(t[i],"audio",e))return NM[r]=t[i],t[i];if(t[i]==="mp3"&&(n=mf(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return r}const qK=/flac|opus|mp4a\.40\.34/i;function pb(r,e=!0){return r.replace(qK,t=>KK(t.toLowerCase(),e))}function jK(r,e){const t=[];if(r){const n=r.split(",");for(let i=0;i<n.length;i++)jD(n[i],"video")||t.push(n[i])}return e&&t.push(e),t.join(",")}function iE(r,e){if(r&&(r.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(r)!==-1)&&(p3(r,"audio")||p3(r,"video")))return r;if(e){const t=e.split(",");if(t.length>1){if(r){for(let n=t.length;n--;)if(t[n].substring(0,4)===r.substring(0,4))return t[n]}return t[0]}}return e||r}function p3(r,e){return jD(r,e)&&WD(r,e)}function WK(r){const e=r.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function JK(r){if(r.startsWith("av01.")){const e=r.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return r}function m3(r){const e=mf(r)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function ZC(r){return r.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const $K={supported:!0,powerEfficient:!0,smooth:!0},QK={supported:!1,smooth:!1,powerEfficient:!1},nU={supported:!0,configurations:[],decodingInfoResults:[$K]};function iU(r,e){return{supported:!1,configurations:e,decodingInfoResults:[QK],error:r}}function ZK(r,e,t,n,i,s){const a=r.videoCodec,o=r.audioCodec?r.audioGroups:null,c=s?.audioCodec,u=s?.channels,h=u?parseInt(u):c?1/0:2;let p=null;if(o!=null&&o.length)try{o.length===1&&o[0]?p=e.groups[o[0]].channels:p=o.reduce((v,y)=>{if(y){const x=e.groups[y];if(!x)throw new Error(`Audio track group ${y} not found`);Object.keys(x.channels).forEach(S=>{v[S]=(v[S]||0)+x.channels[S]})}return v},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(v=>_T(v))||r.width>1920&&r.height>1088||r.height>1920&&r.width>1088||r.frameRate>Math.max(n,30)||r.videoRange!=="SDR"&&r.videoRange!==t||r.bitrate>Math.max(i,8e6))||!!p&&zt(h)&&Object.keys(p).some(v=>parseInt(v)>h)}function sU(r,e,t,n={}){const i=r.videoCodec;if(!i&&!r.audioCodec||!t)return Promise.resolve(nU);const s=[],a=eq(r),o=a.length,c=tq(r,e,o>0),u=c.length;for(let h=o||1*u||1;h--;){const p={type:"media-source"};if(o&&(p.video=a[h%o]),u){p.audio=c[h%u];const v=p.audio.bitrate;p.video&&v&&(p.video.bitrate-=v)}s.push(p)}if(i){const h=navigator.userAgent;if(i.split(",").some(p=>_T(p))&&tU())return Promise.resolve(iU(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${h})`),s))}return Promise.all(s.map(h=>{const p=iq(h);return n[p]||(n[p]=t.decodingInfo(h))})).then(h=>({supported:!h.some(p=>!p.supported),configurations:s,decodingInfoResults:h})).catch(h=>({supported:!1,configurations:s,decodingInfoResults:[],error:h}))}function eq(r){var e;const t=(e=r.videoCodec)==null?void 0:e.split(","),n=rU(r),i=r.width||640,s=r.height||480,a=r.frameRate||30,o=r.videoRange.toLowerCase();return t?t.map(c=>{const u={contentType:xx(JK(c),"video"),width:i,height:s,bitrate:n,framerate:a};return o!=="sdr"&&(u.transferFunction=o),u}):[]}function tq(r,e,t){var n;const i=(n=r.audioCodec)==null?void 0:n.split(","),s=rU(r);return i&&r.audioGroups?r.audioGroups.reduce((a,o)=>{var c;const u=o?(c=e.groups[o])==null?void 0:c.tracks:null;return u?u.reduce((h,p)=>{if(p.groupId===o){const v=parseFloat(p.channels||"");i.forEach(y=>{const x={contentType:xx(y,"audio"),bitrate:t?nq(y,s):s};v&&(x.channels=""+v),h.push(x)})}return h},a):a},[]):[]}function nq(r,e){if(e<=1)return 1;let t=128e3;return r==="ec-3"?t=768e3:r==="ac-3"&&(t=64e4),Math.min(e/2,t)}function rU(r){return Math.ceil(Math.max(r.bitrate*.9,r.averageBitrate)/1e3)*1e3||1}function iq(r){let e="";const{audio:t,video:n}=r;if(n){const i=ZC(n.contentType);e+=`${i}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(t){const i=ZC(t.contentType);e+=`${n?"_":""}${i}_c${t.channels}`}return e}const eR=["NONE","TYPE-0","TYPE-1",null];function sq(r){return eR.indexOf(r)>-1}const mb=["SDR","PQ","HLG"];function rq(r){return!!r&&mb.indexOf(r)>-1}var Xy={No:"",Yes:"YES",v2:"v2"};function g3(r){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=r,i=n<e/2;return e&&i?t?Xy.v2:Xy.Yes:Xy.No}class tR{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class mg{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return v3(this._audioGroups,e)}hasSubtitleGroup(e){return v3(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function v3(r,e){return!e||!r?!1:r.indexOf(e)!==-1}function aq(){if(typeof matchMedia=="function"){const r=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(r.media!==e.media)return r.matches===!0}return!1}function oq(r,e){let t=!1,n=[];if(r&&(t=r!=="SDR",n=[r]),e){n=e.allowedVideoRanges||mb.slice(0);const i=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:i&&aq(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const lq=r=>{const e=new WeakSet;return(t,n)=>{if(r&&(n=r(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},ji=(r,e)=>JSON.stringify(r,lq(e));function cq(r,e,t,n,i){const s=Object.keys(r),a=n?.channels,o=n?.audioCodec,c=i?.videoCodec,u=a&&parseInt(a)===2;let h=!1,p=!1,v=1/0,y=1/0,x=1/0,S=1/0,E=0,b=[];const{preferHDR:T,allowedVideoRanges:R}=oq(e,i);for(let U=s.length;U--;){const B=r[s[U]];h||(h=B.channels[2]>0),v=Math.min(v,B.minHeight),y=Math.min(y,B.minFramerate),x=Math.min(x,B.minBitrate),R.filter(z=>B.videoRanges[z]>0).length>0&&(p=!0)}v=zt(v)?v:0,y=zt(y)?y:0;const D=Math.max(1080,v),P=Math.max(30,y);x=zt(x)?x:t,t=Math.max(x,t),p||(e=void 0);const O=s.length>1;return{codecSet:s.reduce((U,B)=>{const I=r[B];if(B===U)return U;if(b=p?R.filter(z=>I.videoRanges[z]>0):[],O){if(I.minBitrate>t)return qc(B,`min bitrate of ${I.minBitrate} > current estimate of ${t}`),U;if(!I.hasDefaultAudio)return qc(B,"no renditions with default or auto-select sound found"),U;if(o&&B.indexOf(o.substring(0,4))%5!==0)return qc(B,`audio codec preference "${o}" not found`),U;if(a&&!u){if(!I.channels[a])return qc(B,`no renditions with ${a} channel sound found (channels options: ${Object.keys(I.channels)})`),U}else if((!o||u)&&h&&I.channels[2]===0)return qc(B,"no renditions with stereo sound found"),U;if(I.minHeight>D)return qc(B,`min resolution of ${I.minHeight} > maximum of ${D}`),U;if(I.minFramerate>P)return qc(B,`min framerate of ${I.minFramerate} > maximum of ${P}`),U;if(!b.some(z=>I.videoRanges[z]>0))return qc(B,`no variants with VIDEO-RANGE of ${ji(b)} found`),U;if(c&&B.indexOf(c.substring(0,4))%5!==0)return qc(B,`video codec preference "${c}" not found`),U;if(I.maxScore<E)return qc(B,`max score of ${I.maxScore} < selected max of ${E}`),U}return U&&(db(B)>=db(U)||I.fragmentError>r[U].fragmentError)?U:(S=I.minIndex,E=I.maxScore,B)},void 0),videoRanges:b,preferHDR:T,minFramerate:y,minBitrate:x,minIndex:S}}function qc(r,e){Pi.log(`[abr] start candidates with "${r}" ignored because ${e}`)}function aU(r){return r.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const i=t.channels||"2";return n.channels[i]=(n.channels[i]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function uq(r,e,t,n){return r.slice(t,n+1).reduce((i,s,a)=>{if(!s.codecSet)return i;const o=s.audioGroups;let c=i[s.codecSet];c||(i[s.codecSet]=c={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),c.minBitrate=Math.min(c.minBitrate,s.bitrate);const u=Math.min(s.height,s.width);return c.minHeight=Math.min(c.minHeight,u),c.minFramerate=Math.min(c.minFramerate,s.frameRate),c.minIndex=Math.min(c.minIndex,a),c.maxScore=Math.max(c.maxScore,s.score),c.fragmentError+=s.fragmentError,c.videoRanges[s.videoRange]=(c.videoRanges[s.videoRange]||0)+1,o&&o.forEach(h=>{if(!h)return;const p=e.groups[h];p&&(c.hasDefaultAudio=c.hasDefaultAudio||e.hasDefaultAudio?p.hasDefault:p.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(p.channels).forEach(v=>{c.channels[v]=(c.channels[v]||0)+p.channels[v]}))}),i},{})}function y3(r){if(!r)return r;const{lang:e,assocLang:t,characteristics:n,channels:i,audioCodec:s}=r;return{lang:e,assocLang:t,characteristics:n,channels:i,audioCodec:s}}function tu(r,e,t){if("attrs"in r){const n=e.indexOf(r);if(n!==-1)return n}for(let n=0;n<e.length;n++){const i=e[n];if(_p(r,i,t))return n}return-1}function _p(r,e,t){const{groupId:n,name:i,lang:s,assocLang:a,default:o}=r,c=r.forced;return(n===void 0||e.groupId===n)&&(i===void 0||e.name===i)&&(s===void 0||fq(s,e.lang))&&(s===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(c===void 0||e.forced===c)&&(!("characteristics"in r)||hq(r.characteristics||"",e.characteristics))&&(t===void 0||t(r,e))}function fq(r,e="--"){return r.length===e.length?r===e:r.startsWith(e)||e.startsWith(r)}function hq(r,e=""){const t=r.split(","),n=e.split(",");return t.length===n.length&&!t.some(i=>n.indexOf(i)===-1)}function ip(r,e){const{audioCodec:t,channels:n}=r;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function dq(r,e,t,n,i){const s=e[n],o=e.reduce((v,y,x)=>{const S=y.uri;return(v[S]||(v[S]=[])).push(x),v},{})[s.uri];o.length>1&&(n=Math.max.apply(Math,o));const c=s.videoRange,u=s.frameRate,h=s.codecSet.substring(0,4),p=x3(e,n,v=>{if(v.videoRange!==c||v.frameRate!==u||v.codecSet.substring(0,4)!==h)return!1;const y=v.audioGroups,x=t.filter(S=>!y||y.indexOf(S.groupId)!==-1);return tu(r,x,i)>-1});return p>-1?p:x3(e,n,v=>{const y=v.audioGroups,x=t.filter(S=>!y||y.indexOf(S.groupId)!==-1);return tu(r,x,i)>-1})}function x3(r,e,t){for(let n=e;n>-1;n--)if(t(r[n]))return n;for(let n=e+1;n<r.length;n++)if(t(r[n]))return n;return-1}function gb(r,e){var t;return!!r&&r!==((t=e.loadLevelObj)==null?void 0:t.uri)}class oU extends Cl{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:i,partCurrent:s,hls:a}=this,{autoLevelEnabled:o,media:c}=a;if(!i||!c)return;const u=performance.now(),h=s?s.stats:i.stats,p=s?s.duration:i.duration,v=u-h.loading.start,y=a.minAutoLevel,x=i.level,S=this._nextAutoLevel;if(h.aborted||h.loaded&&h.loaded===h.total||x<=y){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const E=S>-1&&S!==x,b=!!t||E;if(!b&&(c.paused||!c.playbackRate||!c.readyState))return;const T=a.mainForwardBufferInfo;if(!b&&T===null)return;const R=this.bwEstimator.getEstimateTTFB(),D=Math.abs(c.playbackRate);if(v<=Math.max(R,1e3*(p/(D*2))))return;const P=T?T.len/D:0,O=h.loading.first?h.loading.first-h.loading.start:-1,N=h.loaded&&O>-1,U=this.getBwEstimate(),B=a.levels,I=B[x],z=Math.max(h.loaded,Math.round(p*(i.bitrate||I.averageBitrate)/8));let W=N?v-O:v;W<1&&N&&(W=Math.min(v,h.loaded*8/U));const Z=N?h.loaded*1e3/W:0,te=R/1e3,re=Z?(z-h.loaded)/Z:z*8/U+te;if(re<=P)return;const k=Z?Z*8:U,j=((n=t?.details||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,J=this.hls.config.abrBandWidthUpFactor;let oe=Number.POSITIVE_INFINITY,K;for(K=x-1;K>y;K--){const _e=B[K].maxBitrate,Be=!B[K].details||j;if(oe=this.getTimeToLoadFrag(te,k,p*_e,Be),oe<Math.min(P,p+te))break}if(oe>=re||oe>p*10)return;N?this.bwEstimator.sample(v-Math.min(R,O),h.loaded):this.bwEstimator.sampleTTFB(v);const X=B[K].maxBitrate;this.getBwEstimate()*J>X&&this.resetEstimator(X);const ne=this.findBestLevel(X,y,K,0,P,1,1);ne>-1&&(K=ne),this.warn(`Fragment ${i.sn}${s?" part "+s.index:""} of level ${x} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${P.toFixed(3)} s
      Estimated load time for current fragment: ${re.toFixed(3)} s
      Estimated load time for down switch fragment: ${oe.toFixed(3)} s
      TTFB estimate: ${O|0} ms
      Current BW estimate: ${zt(U)?U|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${K} @ ${X|0} bps`),a.nextLoadLevel=a.nextAutoLevel=K,this.clearTimer();const xe=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===K&&K>0){const _e=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${K>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${_e.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,K>y){let Be=this.findBestLevel(this.hls.levels[y].bitrate,y,K,0,_e,1,1);Be===-1&&(Be=y),this.hls.nextLoadLevel=this.hls.nextAutoLevel=Be,this.resetEstimator(this.hls.levels[Be].bitrate)}}};E||re>oe*2?xe():this.timer=self.setInterval(xe,oe*1e3),a.trigger(H.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:s,stats:h})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new _K(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.FRAG_LOADING,this.onFragLoading,this),e.on(H.FRAG_LOADED,this.onFragLoaded,this),e.on(H.FRAG_BUFFERED,this.onFragBuffered,this),e.on(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(H.LEVEL_LOADED,this.onLevelLoaded,this),e.on(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(H.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(H.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.FRAG_LOADING,this.onFragLoading,this),e.off(H.FRAG_LOADED,this.onFragLoaded,this),e.off(H.FRAG_BUFFERED,this.onFragBuffered,this),e.off(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(H.LEVEL_LOADED,this.onLevelLoaded,this),e.off(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(H.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(H.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var i;this.fragCurrent=n,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Ie.BUFFER_ADD_CODEC_ERROR:case Ie.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Ie.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:i,partCurrent:s}=this;if(n&&i&&n.sn===i.sn&&n.level===i.level){const a=performance.now(),o=s?s.stats:n.stats,c=a-o.loading.start,u=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&u>-1){const p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(c-Math.min(p,u),o.loaded)}else this.bwEstimator.sampleTTFB(c)}break}}}getTimeToLoadFrag(e,t,n,i){const s=e+n/t,a=i?e+this.lastLevelLoadSec:0;return s+a}onLevelLoaded(e,t){const n=this.hls.config,{loading:i}=t.stats,s=i.end-i.first;zt(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const i=n?n.stats:t.stats;if(t.type===qt.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=n?n.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+i.loaded,c=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:o,duration:c},a.realBitrate=Math.round(8*o/c)}if(t.bitrateTest){const s={stats:i,frag:t,part:n,id:t.type};this.onFragBuffered(H.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:i}=t,s=i!=null&&i.stats.loaded?i.stats:n.stats;if(s.aborted||this.ignoreFragment(n))return;const a=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,s.loaded),s.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==qt.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,s=this.findBestLevel(n,t,e,0,i,1,1);if(s>-1)return s;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=n&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,s)&&a[e].loadError<=a[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:i,config:s,minAutoLevel:a}=n,o=t?t.duration:e?e.duration:0,c=this.getBwEstimate(),u=this.getStarvationDelay();let h=s.abrBandWidthFactor,p=s.abrBandWidthUpFactor;if(u){const E=this.findBestLevel(c,a,i,u,0,h,p);if(E>=0)return this.rebufferNotice=-1,E}let v=o?Math.min(o,s.maxStarvationDelay):s.maxStarvationDelay;if(!u){const E=this.bitrateTestDelay;E&&(v=(o?Math.min(o,s.maxLoadingDelay):s.maxLoadingDelay)-E,this.info(`bitrate test took ${Math.round(1e3*E)}ms, set first fragment max fetchDuration to ${Math.round(1e3*v)} ms`),h=p=1)}const y=this.findBestLevel(c,a,i,u,v,h,p);if(this.rebufferNotice!==y&&(this.rebufferNotice=y,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${y}`)),y>-1)return y;const x=n.levels[a],S=n.loadLevelObj;return S&&x?.bitrate<S.bitrate?a:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,i,s,a,o){var c;const u=i+s,h=this.lastLoadedFragLevel,p=h===-1?this.hls.firstLevel:h,{fragCurrent:v,partCurrent:y}=this,{levels:x,allAudioTracks:S,loadLevel:E,config:b}=this.hls;if(x.length===1)return 0;const T=x[p],R=!!((c=this.hls.latestLevelDetails)!=null&&c.live),D=E===-1||h===-1;let P,O="SDR",N=T?.frameRate||0;const{audioPreference:U,videoPreference:B}=b,I=this.audioTracksByGroup||(this.audioTracksByGroup=aU(S));let z=-1;if(D){if(this.firstSelection!==-1)return this.firstSelection;const k=this.codecTiers||(this.codecTiers=uq(x,I,t,n)),j=cq(k,O,e,U,B),{codecSet:J,videoRanges:oe,minFramerate:K,minBitrate:X,minIndex:ne,preferHDR:xe}=j;z=ne,P=J,O=xe?oe[oe.length-1]:oe[0],N=K,e=Math.max(e,X),this.log(`picked start tier ${ji(j)}`)}else P=T?.codecSet,O=T?.videoRange;const W=y?y.duration:v?v.duration:0,Z=this.bwEstimator.getEstimateTTFB()/1e3,te=[];for(let k=n;k>=t;k--){var re;const j=x[k],J=k>p;if(!j)continue;if(b.useMediaCapabilities&&!j.supportedResult&&!j.supportedPromise){const Be=navigator.mediaCapabilities;typeof Be?.decodingInfo=="function"&&ZK(j,I,O,N,e,U)?(j.supportedPromise=sU(j,I,Be,this.supportedCache),j.supportedPromise.then(pe=>{if(!this.hls)return;j.supportedResult=pe;const be=this.hls.levels,je=be.indexOf(j);pe.error?this.warn(`MediaCapabilities decodingInfo error: "${pe.error}" for level ${je} ${ji(pe)}`):pe.supported?pe.decodingInfoResults.some(gt=>gt.smooth===!1||gt.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${je} not smooth or powerEfficient: ${ji(pe)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${je} ${ji(pe)}`),je>-1&&be.length>1&&(this.log(`Removing unsupported level ${je}`),this.hls.removeLevel(je),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(pe=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${pe}`)})):j.supportedResult=nU}if((P&&j.codecSet!==P||O&&j.videoRange!==O||J&&N>j.frameRate||!J&&N>0&&N<j.frameRate||(re=j.supportedResult)!=null&&(re=re.decodingInfoResults)!=null&&re.some(Be=>Be.smooth===!1))&&(!D||k!==z)){te.push(k);continue}const oe=j.details,K=(y?oe?.partTarget:oe?.averagetargetduration)||W;let X;J?X=o*e:X=a*e;const ne=W&&i>=W*2&&s===0?j.averageBitrate:j.maxBitrate,xe=this.getTimeToLoadFrag(Z,X,ne*K,oe===void 0);if(X>=ne&&(k===h||j.loadError===0&&j.fragmentError===0)&&(xe<=Z||!zt(xe)||R&&!this.bitrateTestDelay||xe<u)){const Be=this.forcedAutoLevel;return k!==E&&(Be===-1||Be!==E)&&(te.length&&this.trace(`Skipped level(s) ${te.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${x[te[0]].codecs}" ${x[te[0]].videoRange}; not compatible with "${P}" ${O}`),this.info(`switch candidate:${p}->${k} adjustedbw(${Math.round(X)})-bitrate=${Math.round(X-ne)} ttfb:${Z.toFixed(1)} avgDuration:${K.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${xe.toFixed(1)} firstSelection:${D} codecSet:${j.codecSet} videoRange:${j.videoRange} hls.loadLevel:${E}`)),D&&(this.firstSelection=k),k}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const lU={search:function(r,e){let t=0,n=r.length-1,i=null,s=null;for(;t<=n;){i=(t+n)/2|0,s=r[i];const a=e(s);if(a>0)t=i+1;else if(a<0)n=i-1;else return s}return null}};function pq(r,e,t){if(e===null||!Array.isArray(r)||!r.length||!zt(e))return null;const n=r[0].programDateTime;if(e<(n||0))return null;const i=r[r.length-1].endProgramDateTime;if(e>=(i||0))return null;for(let s=0;s<r.length;++s){const a=r[s];if(gq(e,t,a))return a}return null}function Up(r,e,t=0,n=0,i=.005){let s=null;if(r){s=e[1+r.sn-e[0].sn]||null;const o=r.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),s&&r.level!==s.level&&s.end<=r.end&&(s=e[2+r.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!r||r.level===s.level)&&_3(t,n,s)===0||mq(s,r,Math.min(i,n))))return s;const a=lU.search(e,_3.bind(null,t,n));return a&&(a!==r||!s)?a:s}function mq(r,e,t){if(e&&e.start===0&&e.level<r.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((i,s)=>(s[0]==="INF"&&(i+=parseFloat(s[1])),i),t);return r.start<=n}return!1}function _3(r=0,e=0,t){if(t.start<=r&&t.start+t.duration>r)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=r?1:t.start-n>r&&t.start?-1:0}function gq(r,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>r}function cU(r,e,t){if(r&&r.startCC<=e&&r.endCC>=e){let n=r.fragments;const{fragmentHint:i}=r;i&&(n=n.concat(i));let s;return lU.search(n,a=>a.cc<e?1:a.cc>e?-1:(s=a,a.end<=t?1:a.start>t?-1:0)),s||null}return null}function vb(r){switch(r.details){case Ie.FRAG_LOAD_TIMEOUT:case Ie.KEY_LOAD_TIMEOUT:case Ie.LEVEL_LOAD_TIMEOUT:case Ie.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function uU(r){return r.details.startsWith("key")}function fU(r){return uU(r)&&!!r.frag&&!r.frag.decryptdata}function S3(r,e){const t=vb(e);return r.default[`${t?"timeout":"error"}Retry`]}function JD(r,e){const t=r.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*r.retryDelayMs,r.maxRetryDelayMs)}function A3(r){return Oi(Oi({},r),{errorRetry:null,timeoutRetry:null})}function yb(r,e,t,n){if(!r)return!1;const i=n?.code,s=e<r.maxNumRetry&&(vq(i)||!!t);return r.shouldRetry?r.shouldRetry(r,e,t,n,s):s}function vq(r){return nR(r)||!!r&&(r<400||r>499)}function nR(r){return r===0&&navigator.onLine===!1}var nr={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},to={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4,SwitchToSDR:8};class hU extends Cl{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(H.ERROR,this.onError,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(H.ERROR,this.onError,this),e.off(H.ERROR,this.onErrorOut,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===qt.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||n===-1?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if((n=e.details)!=null&&n.hasKey(t))return!0;const i=e.audioGroups;if(i)return this.hls.allAudioTracks.filter(a=>i.indexOf(a.groupId)>=0).some(a=>{var o;return(o=a.details)==null?void 0:o.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const i=this.hls,s=t.context;switch(t.details){case Ie.FRAG_LOAD_ERROR:case Ie.FRAG_LOAD_TIMEOUT:case Ie.KEY_LOAD_ERROR:case Ie.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Ie.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=z0();return}case Ie.FRAG_GAP:case Ie.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=nr.SendAlternateToPenaltyBox;return}case Ie.LEVEL_EMPTY_ERROR:case Ie.LEVEL_PARSING_ERROR:{var a;const c=t.parent===qt.MAIN?t.level:i.loadLevel;t.details===Ie.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,c):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,c))}return;case Ie.LEVEL_LOAD_ERROR:case Ie.LEVEL_LOAD_TIMEOUT:typeof s?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case Ie.AUDIO_TRACK_LOAD_ERROR:case Ie.AUDIO_TRACK_LOAD_TIMEOUT:case Ie.SUBTITLE_LOAD_ERROR:case Ie.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const c=i.loadLevelObj;if(c&&(s.type===jn.AUDIO_TRACK&&c.hasAudioGroup(s.groupId)||s.type===jn.SUBTITLE_TRACK&&c.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=nr.SendAlternateToPenaltyBox,t.errorAction.flags=to.MoveAllAlternatesMatchingHost;return}}return;case Ie.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:nr.SendAlternateToPenaltyBox,flags:to.MoveAllAlternatesMatchingHDCP};return;case Ie.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Ie.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Ie.KEY_SYSTEM_NO_SESSION:t.errorAction={action:nr.SendAlternateToPenaltyBox,flags:to.MoveAllAlternatesMatchingKey};return;case Ie.BUFFER_ADD_CODEC_ERROR:case Ie.REMUX_ALLOC_ERROR:case Ie.BUFFER_APPEND_ERROR:if(!t.errorAction){var o;t.errorAction=this.getLevelSwitchAction(t,(o=t.level)!=null?o:i.loadLevel)}return;case Ie.INTERNAL_EXCEPTION:case Ie.BUFFER_APPENDING_ERROR:case Ie.BUFFER_FULL_ERROR:case Ie.LEVEL_SWITCH_ERROR:case Ie.BUFFER_STALLED_ERROR:case Ie.BUFFER_SEEK_OVER_HOLE:case Ie.BUFFER_NUDGE_ON_STALL:t.errorAction=z0();return}t.type===rn.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=z0())}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,i=S3(n.config.playlistLoadPolicy,e),s=this.playlistError++;if(yb(i,s,vb(e),e.response))return{action:nr.RetryRequest,flags:to.None,retryConfig:i,retryCount:s};const o=this.getLevelSwitchAction(e,t);return i&&(o.retryConfig=i,o.retryCount=s),o}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),i=t.levels[n],{fragLoadPolicy:s,keyLoadPolicy:a}=t.config,o=S3(uU(e)?a:s,e),c=t.levels.reduce((h,p)=>h+p.fragmentError,0);if(i&&(e.details!==Ie.FRAG_GAP&&i.fragmentError++,!fU(e)&&yb(o,c,vb(e),e.response)))return{action:nr.RetryRequest,flags:to.None,retryConfig:o,retryCount:c};const u=this.getLevelSwitchAction(e,n);return o&&(u.retryConfig=o,u.retryCount=c),u}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const i=this.hls.levels[t];if(i){var s,a;const u=e.details;i.loadError++,u===Ie.BUFFER_APPEND_ERROR&&i.fragmentError++;let h=-1;const{levels:p,loadLevel:v,minAutoLevel:y,maxAutoLevel:x}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const S=(s=e.frag)==null?void 0:s.type,b=(S===qt.AUDIO&&u===Ie.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===Ie.BUFFER_ADD_CODEC_ERROR||u===Ie.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:O})=>i.audioCodec!==O),R=e.sourceBufferName==="video"&&(u===Ie.BUFFER_ADD_CODEC_ERROR||u===Ie.BUFFER_APPEND_ERROR)&&p.some(({codecSet:O,audioCodec:N})=>i.codecSet!==O&&i.audioCodec===N),{type:D,groupId:P}=(a=e.context)!=null?a:{};for(let O=p.length;O--;){const N=(O+v)%p.length;if(N!==v&&N>=y&&N<=x&&p[N].loadError===0){var o,c;const U=p[N];if(u===Ie.FRAG_GAP&&S===qt.MAIN&&e.frag){const B=p[N].details;if(B){const I=Up(e.frag,B.fragments,e.frag.start);if(I!=null&&I.gap)continue}}else{if(D===jn.AUDIO_TRACK&&U.hasAudioGroup(P)||D===jn.SUBTITLE_TRACK&&U.hasSubtitleGroup(P))continue;if(S===qt.AUDIO&&(o=i.audioGroups)!=null&&o.some(B=>U.hasAudioGroup(B))||S===qt.SUBTITLE&&(c=i.subtitleGroups)!=null&&c.some(B=>U.hasSubtitleGroup(B))||b&&i.audioCodec===U.audioCodec||R&&i.codecSet===U.codecSet||!b&&i.codecSet!==U.codecSet)continue}h=N;break}}if(h>-1&&n.loadLevel!==h)return e.levelRetry=!0,this.playlistError=0,{action:nr.SendAlternateToPenaltyBox,flags:to.None,nextAutoLevel:h}}return{action:nr.SendAlternateToPenaltyBox,flags:to.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case nr.DoNothing:break;case nr.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Ie.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break;case nr.RetryRequest:break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:i}=n,s=n.nextAutoLevel;switch(i){case to.None:this.switchLevel(e,s);break;case to.MoveAllAlternatesMatchingHDCP:{const c=this.getVariantLevelIndex(e.frag),u=t.levels[c],h=u?.attrs["HDCP-LEVEL"];if(n.hdcpLevel=h,h==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(h){t.maxHdcpLevel=eR[eR.indexOf(h)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case to.MoveAllAlternatesMatchingKey:{const c=e.decryptdata;if(c){const u=this.hls.levels,h=u.length;for(let v=h;v--;)if(this.variantHasKey(u[v],c)){var a,o;this.log(`Banned key found in level ${v} (${u[v].bitrate}bps) or audio group "${(a=u[v].audioGroups)==null?void 0:a.join(",")}" (${(o=e.frag)==null?void 0:o.type} fragment) ${Nr(c.keyId||[])}`),u[v].fragmentError++,u[v].loadError++,this.log(`Removing level ${v} with key error (${e.error})`),this.hls.removeLevel(v)}const p=e.frag;if(this.hls.levels.length<h)n.resolved=!0;else if(p&&p.type!==qt.MAIN){const v=p.decryptdata;v&&!c.matches(v)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,s)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Ie.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=ZC(e.mimeType),i=this.hls.levels;for(let s=i.length;s--;)i[s][`${e.sourceBufferName}Codec`]===n&&(this.log(`Removing level ${s} for ${e.details} ("${n}" not supported)`),this.hls.removeLevel(s))}}}function z0(r){const e={action:nr.DoNothing,flags:to.None};return r&&(e.resolved=!0),e}var rr={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class yq{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.BUFFER_APPENDED,this.onBufferAppended,this),e.on(H.FRAG_BUFFERED,this.onFragBuffered,this),e.on(H.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.BUFFER_APPENDED,this.onBufferAppended,this),e.off(H.FRAG_BUFFERED,this.onFragBuffered,this),e.off(H.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let i=n.length;i--;){const s=n[i];if(!s)break;if(s.start<=e&&e<=s.end&&s.loaded)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:i}=this,s=Object.keys(i);for(let a=s.length;a--;){const o=i[s[a]];if(o?.body.type===t&&(!n||o.buffered)){const c=o.body;if(c.start<=e&&e<=c.end)return c}}return null}detectEvictedFragments(e,t,n,i,s){this.timeRanges&&(this.timeRanges[e]=t);const a=i?.fragment.sn||-1;Object.keys(this.fragments).forEach(o=>{const c=this.fragments[o];if(!c||a>=c.body.sn)return;if(!c.buffered&&(!c.loaded||s)){c.body.type===n&&this.removeFragment(c.body);return}const u=c.range[e];if(u){if(u.time.length===0){this.removeFragment(c.body);return}u.time.some(h=>{const p=!this.isTimeBuffered(h.startPTS,h.endPTS,t);return p&&this.removeFragment(c.body),p})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,i=b0(n),s=this.fragments[i];if(!s||s.buffered&&n.gap)return;const a=!n.relurl;Object.keys(t).forEach(o=>{const c=n.elementaryStreams[o];if(!c)return;const u=t[o],h=a||c.partial===!0;s.range[o]=this.getBufferedTimes(n,e.part,h,u)}),s.loaded=null,Object.keys(s.range).length?(this.bufferedEnd(s,n),xA(s)||this.removeParts(n.sn-1,n.type)):this.removeFragment(s.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=E3(n,i=>i.fragment.sn>=e))}fragBuffered(e,t){const n=b0(e);let i=this.fragments[n];!i&&t&&(i=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,this.bufferedEnd(i,e))}getBufferedTimes(e,t,n,i){const s={time:[],partial:n},a=e.start,o=e.end,c=e.minEndPTS||o,u=e.maxStartPTS||a;for(let h=0;h<i.length;h++){const p=i.start(h)-this.bufferPadding,v=i.end(h)+this.bufferPadding;if(u>=p&&c<=v){s.time.push({startPTS:Math.max(a,i.start(h)),endPTS:Math.min(o,i.end(h))});break}else if(a<v&&o>p){const y=Math.max(a,i.start(h)),x=Math.min(o,i.end(h));x>y&&(s.partial=!0,s.time.push({startPTS:y,endPTS:x}))}else if(o<=p)break}return s}getPartialFragment(e){let t=null,n,i,s,a=0;const{bufferPadding:o,fragments:c}=this;return Object.keys(c).forEach(u=>{const h=c[u];h&&xA(h)&&(i=h.body.start-o,s=h.body.end+o,e>=i&&e<=s&&(n=Math.min(e-i,s-e),a<=n&&(t=h.body,a=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||xA(t))}getState(e){const t=b0(e),n=this.fragments[t];return n?n.buffered?xA(n)?rr.PARTIAL:rr.OK:rr.APPENDING:rr.NOT_LOADED}isTimeBuffered(e,t,n){let i,s;for(let a=0;a<n.length;a++){if(i=n.start(a)-this.bufferPadding,s=n.end(a)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,i=t.part?null:t,s=b0(n);this.fragments[s]={body:n,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:i,timeRanges:s,type:a}=t;if(n.sn==="initSegment")return;const o=n.type;if(i){let u=this.activePartLists[o];u||(this.activePartLists[o]=u=[]),u.push(i)}this.timeRanges=s;const c=s[a];this.detectEvictedFragments(a,c,o,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=b0(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let i=n.length;i--;){const s=t[n[i]];if(s?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,i,s){i&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const c=o.body;c.type!==n||i&&!c.gap||c.start<t&&c.end>e&&(o.buffered||s)&&this.removeFragment(c)})}removeFragment(e){const t=b0(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const i=e.sn;this.activePartLists[e.type]=E3(n,s=>s.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(n=>n.clearElementaryStreamInfo())}}function xA(r){var e,t,n;return r.buffered&&!!(r.body.gap||(e=r.range.video)!=null&&e.partial||(t=r.range.audio)!=null&&t.partial||(n=r.range.audiovideo)!=null&&n.partial)}function b0(r){return`${r.type}_${r.level}_${r.sn}`}function E3(r,e){return r.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var Ph={cbc:0,ctr:1};class xq{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case Ph.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Ph.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function _q(r){const e=r.byteLength,t=e&&new DataView(r.buffer).getUint8(e-1);return t?r.slice(0,e-t):r}class Sq{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let i=0;i<4;i++)n[i]=t.getUint32(i*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,i=n[0],s=n[1],a=n[2],o=n[3],c=this.invSubMix,u=c[0],h=c[1],p=c[2],v=c[3],y=new Uint32Array(256);let x=0,S=0,E=0;for(E=0;E<256;E++)E<128?y[E]=E<<1:y[E]=E<<1^283;for(E=0;E<256;E++){let b=S^S<<1^S<<2^S<<3^S<<4;b=b>>>8^b&255^99,e[x]=b,t[b]=x;const T=y[x],R=y[T],D=y[R];let P=y[b]*257^b*16843008;i[x]=P<<24|P>>>8,s[x]=P<<16|P>>>16,a[x]=P<<8|P>>>24,o[x]=P,P=D*16843009^R*65537^T*257^x*16843008,u[b]=P<<24|P>>>8,h[b]=P<<16|P>>>16,p[b]=P<<8|P>>>24,v[b]=P,x?(x=T^y[y[y[D^T]]],S^=y[y[S]]):x=S=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,i=0;for(;i<t.length&&n;)n=t[i]===this.key[i],i++;if(n)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const a=this.ksRows=(s+6+1)*4;let o,c;const u=this.keySchedule=new Uint32Array(a),h=this.invKeySchedule=new Uint32Array(a),p=this.sBox,v=this.rcon,y=this.invSubMix,x=y[0],S=y[1],E=y[2],b=y[3];let T,R;for(o=0;o<a;o++){if(o<s){T=u[o]=t[o];continue}R=T,o%s===0?(R=R<<8|R>>>24,R=p[R>>>24]<<24|p[R>>>16&255]<<16|p[R>>>8&255]<<8|p[R&255],R^=v[o/s|0]<<24):s>6&&o%s===4&&(R=p[R>>>24]<<24|p[R>>>16&255]<<16|p[R>>>8&255]<<8|p[R&255]),u[o]=T=(u[o-s]^R)>>>0}for(c=0;c<a;c++)o=a-c,c&3?R=u[o]:R=u[o-4],c<4||o<=4?h[c]=R:h[c]=x[p[R>>>24]]^S[p[R>>>16&255]]^E[p[R>>>8&255]]^b[p[R&255]],h[c]=h[c]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const i=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,c=o[0],u=o[1],h=o[2],p=o[3],v=this.uint8ArrayToUint32Array_(n);let y=v[0],x=v[1],S=v[2],E=v[3];const b=new Int32Array(e),T=new Int32Array(b.length);let R,D,P,O,N,U,B,I,z,W,Z,te,re,k;const j=this.networkToHostOrderSwap;for(;t<b.length;){for(z=j(b[t]),W=j(b[t+1]),Z=j(b[t+2]),te=j(b[t+3]),N=z^s[0],U=te^s[1],B=Z^s[2],I=W^s[3],re=4,k=1;k<i;k++)R=c[N>>>24]^u[U>>16&255]^h[B>>8&255]^p[I&255]^s[re],D=c[U>>>24]^u[B>>16&255]^h[I>>8&255]^p[N&255]^s[re+1],P=c[B>>>24]^u[I>>16&255]^h[N>>8&255]^p[U&255]^s[re+2],O=c[I>>>24]^u[N>>16&255]^h[U>>8&255]^p[B&255]^s[re+3],N=R,U=D,B=P,I=O,re=re+4;R=a[N>>>24]<<24^a[U>>16&255]<<16^a[B>>8&255]<<8^a[I&255]^s[re],D=a[U>>>24]<<24^a[B>>16&255]<<16^a[I>>8&255]<<8^a[N&255]^s[re+1],P=a[B>>>24]<<24^a[I>>16&255]<<16^a[N>>8&255]<<8^a[U&255]^s[re+2],O=a[I>>>24]<<24^a[N>>16&255]<<16^a[U>>8&255]<<8^a[B&255]^s[re+3],T[t]=j(R^y),T[t+1]=j(O^x),T[t+2]=j(P^S),T[t+3]=j(D^E),y=z,x=W,S=Z,E=te,t=t+4}return T.buffer}}class Aq{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=Eq(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function Eq(r){switch(r){case Ph.cbc:return"AES-CBC";case Ph.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${r}`)}}const bq=16;class $D{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?_q(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,i){return this.useSoftware?new Promise((s,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,n,i);const c=this.flush();c?s(c.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,i)}softwareDecrypt(e,t,n,i){const{currentIV:s,currentResult:a,remainderData:o}=this;if(i!==Ph.cbc||t.byteLength!==16)return Pi.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=bl(o,e),this.remainderData=null);const c=this.getValidChunk(e);if(!c.length)return null;s&&(n=s);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new Sq),u.expandKey(t);const h=a;return this.currentResult=u.decrypt(c.buffer,0,n),this.currentIV=c.slice(-16).buffer,h||null}webCryptoDecrypt(e,t,n,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,i));this.key=t,this.fastAesKey=new Aq(this.subtle,t,i)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new xq(this.subtle,new Uint8Array(n),i).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(Pi.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,n,i)))}onWebCryptoError(e,t,n,i){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,i);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%bq;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(Pi.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const b3=Math.pow(2,17);class Tq{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Qu({type:rn.NETWORK_ERROR,details:Ie.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,s=i.fLoader,a=i.loader;return new Promise((o,c)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(x=>x[0]==="GAP")){c(M3(e));return}else e.gap=!1;const u=this.loader=s?new s(i):new a(i),h=T3(e);e.loader=u;const p=A3(i.fragLoadPolicy.default),v={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:b3};e.stats=u.stats;const y={onSuccess:(x,S,E,b)=>{this.resetLoader(e,u);let T=x.data;E.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(T.slice(0,16)),T=T.slice(16)),o({frag:e,part:null,payload:T,networkDetails:b})},onError:(x,S,E,b)=>{this.resetLoader(e,u),c(new Qu({type:rn.NETWORK_ERROR,details:Ie.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Oi({url:n,data:void 0},x),error:new Error(`HTTP Error ${x.code} ${x.text}`),networkDetails:E,stats:b}))},onAbort:(x,S,E)=>{this.resetLoader(e,u),c(new Qu({type:rn.NETWORK_ERROR,details:Ie.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:E,stats:x}))},onTimeout:(x,S,E)=>{this.resetLoader(e,u),c(new Qu({type:rn.NETWORK_ERROR,details:Ie.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:E,stats:x}))}};t&&(y.onProgress=(x,S,E,b)=>t({frag:e,part:null,payload:E,networkDetails:b})),u.load(h,v,y)})}loadPart(e,t,n){this.abort();const i=this.config,s=i.fLoader,a=i.loader;return new Promise((o,c)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){c(M3(e,t));return}const u=this.loader=s?new s(i):new a(i),h=T3(e,t);e.loader=u;const p=A3(i.fragLoadPolicy.default),v={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:b3};t.stats=u.stats,u.load(h,v,{onSuccess:(y,x,S,E)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const b={frag:e,part:t,payload:y.data,networkDetails:E};n(b),o(b)},onError:(y,x,S,E)=>{this.resetLoader(e,u),c(new Qu({type:rn.NETWORK_ERROR,details:Ie.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Oi({url:h.url,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:S,stats:E}))},onAbort:(y,x,S)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),c(new Qu({type:rn.NETWORK_ERROR,details:Ie.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:S,stats:y}))},onTimeout:(y,x,S)=>{this.resetLoader(e,u),c(new Qu({type:rn.NETWORK_ERROR,details:Ie.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:S,stats:y}))}})})}updateStatsFromPart(e,t){const n=e.stats,i=t.stats,s=i.total;if(n.loaded+=i.loaded,s){const c=Math.round(e.duration/t.duration),u=Math.min(Math.round(n.loaded/s),c),p=(c-u)*Math.round(n.loaded/u);n.total=n.loaded+p}else n.total=Math.max(n.loaded,n.total);const a=n.loading,o=i.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function T3(r,e=null){const t=e||r,n={frag:r,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(zt(i)&&zt(s)){var a;let o=i,c=s;if(r.sn==="initSegment"&&Mq((a=r.decryptdata)==null?void 0:a.method)){const u=s-i;u%16&&(c=s+(16-u%16)),i!==0&&(n.resetIV=!0,o=i-16)}n.rangeStart=o,n.rangeEnd=c}return n}function M3(r,e){const t=new Error(`GAP ${r.gap?"tag":"attribute"} found`),n={type:rn.MEDIA_ERROR,details:Ie.FRAG_GAP,fatal:!1,frag:r,error:t,networkDetails:null};return e&&(n.part=e),(e||r).stats.aborted=!0,new Qu(n)}function Mq(r){return r==="AES-128"||r==="AES-256"}class Qu extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class dU extends Cl{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class ST{constructor(e,t,n,i=0,s=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=_A(),this.buffering={audio:_A(),video:_A(),audiovideo:_A()},this.level=e,this.sn=t,this.id=n,this.size=i,this.part=s,this.partial=a}}function _A(){return{start:0,executeStart:0,executeEnd:0,end:0}}const C3={length:0,start:()=>0,end:()=>0};class Dn{static isBuffered(e,t){if(e){const n=Dn.getBuffered(e);for(let i=n.length;i--;)if(t>=n.start(i)&&t<=n.end(i))return!0}return!1}static bufferedRanges(e){if(e){const t=Dn.getBuffered(e);return Dn.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const i=Dn.bufferedRanges(e);if(i.length)return Dn.bufferedInfo(i,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((h,p)=>h.start-p.start||p.end-h.end);let i=-1,s=[];if(n)for(let h=0;h<e.length;h++){t>=e[h].start&&t<=e[h].end&&(i=h);const p=s.length;if(p){const v=s[p-1].end;e[h].start-v<n?e[h].end>v&&(s[p-1].end=e[h].end):s.push(e[h])}else s.push(e[h])}else s=e;let a=0,o,c=t,u=t;for(let h=0;h<s.length;h++){const p=s[h].start,v=s[h].end;if(i===-1&&t>=p&&t<=v&&(i=h),t+n>=p&&t<v)c=p,u=v,a=u-t;else if(t+n<p){o=p;break}}return{len:a,start:c||0,end:u||0,nextStart:o,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||C3}catch(t){return Pi.log("failed to get media.buffered",t),C3}}}const pU=/\{\$([a-zA-Z0-9-_]+)\}/g;function R3(r){return pU.test(r)}function iR(r,e){if(r.variableList!==null||r.hasVariableRefs){const t=r.variableList;return e.replace(pU,n=>{const i=n.substring(2,n.length-1),s=t?.[i];return s===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),n):s})}return e}function D3(r,e,t){let n=r.variableList;n||(r.variableList=n={});let i,s;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(i))s=a.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(a){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else i=e.NAME,s=e.VALUE;i in n?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):n[i]=s||""}function Cq(r,e,t){const n=e.IMPORT;if(t&&n in t){let i=r.variableList;i||(r.variableList=i={}),i[n]=t[n]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const Rq=/^(\d+)x(\d+)$/,L3=/(.+?)=(".*?"|.*?)(?:,|$)/g;class os{constructor(e,t){typeof e=="string"&&(e=os.parseAttrList(e,t)),Gi(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)n[i]=parseInt(t.slice(i*2,i*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((i,s)=>(i[s.toLowerCase()]=!0,i),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=Rq.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const i={};for(L3.lastIndex=0;(n=L3.exec(e))!==null;){const a=n[1].trim();let o=n[2];const c=o.indexOf('"')===0&&o.lastIndexOf('"')===o.length-1;let u=!1;if(c)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(c||u))o=iR(t,o);else if(!u&&!c)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Pi.warn(`${e}: attribute ${a} is missing quotes`)}i[a]=o}return i}}const Dq="com.apple.hls.interstitial";function Lq(r){return r!=="ID"&&r!=="CLASS"&&r!=="CUE"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function wq(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"||r==="SCTE35-CMD"}class QD{constructor(e,t,n=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(i=t?.tagOrder)!=null?i:n,t){const s=t.attr;for(const a in s)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==s[a]){Pi.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=Gi(new os({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=t?.endDate||new Date(this.attr["END-DATE"]);zt(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Pi.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(zt(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===Dq}get isValid(){return!!this.id&&!this._badValueForSameId&&zt(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const Iq=10;class mU{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return this.fragments.length?zt(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Iq}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function xb(r,e){return r.length===e.length?!r.some((t,n)=>t!==e[n]):!1}function w3(r,e){return!r&&!e?!0:!r||!e?!1:xb(r,e)}function V0(r){return r==="AES-128"||r==="AES-256"||r==="AES-256-CTR"}function ZD(r){switch(r){case"AES-128":case"AES-256":return Ph.cbc;case"AES-256-CTR":return Ph.ctr;default:throw new Error(`invalid full segment method ${r}`)}}function eL(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))}function sR(r){return Uint8Array.from(unescape(encodeURIComponent(r)),e=>e.charCodeAt(0))}function Bq(r){const e=sR(r).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function gU(r){const e=function(n,i,s){const a=n[i];n[i]=n[s],n[s]=a};e(r,0,3),e(r,1,2),e(r,4,5),e(r,6,7)}function vU(r){const e=r.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),i=n[n.length-1].split(",");if(i.length===2){const s=i[0]==="base64",a=i[1];s?(n.splice(-1,1),t=eL(a)):t=Bq(a)}}return t}const _b=typeof self<"u"?self:void 0;var us={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Er={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function sE(r){switch(r){case Er.FAIRPLAY:return us.FAIRPLAY;case Er.PLAYREADY:return us.PLAYREADY;case Er.WIDEVINE:return us.WIDEVINE;case Er.CLEARKEY:return us.CLEARKEY}}function UM(r){switch(r){case us.FAIRPLAY:return Er.FAIRPLAY;case us.PLAYREADY:return Er.PLAYREADY;case us.WIDEVINE:return Er.WIDEVINE;case us.CLEARKEY:return Er.CLEARKEY}}function Cy(r){const{drmSystems:e,widevineLicenseUrl:t}=r,n=e?[us.FAIRPLAY,us.WIDEVINE,us.PLAYREADY,us.CLEARKEY].filter(i=>!!e[i]):[];return!n[us.WIDEVINE]&&t&&n.push(us.WIDEVINE),n}const tL=(function(r){return _b!=null&&(r=_b.navigator)!=null&&r.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function Oq(r,e,t,n){let i;switch(r){case us.FAIRPLAY:i=["cenc","sinf"];break;case us.WIDEVINE:case us.PLAYREADY:i=["cenc"];break;case us.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return Pq(i,e,t,n)}function Pq(r,e,t,n){return[{initDataTypes:r,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function Nq(r){var e;return!!r&&(r.sessionType==="persistent-license"||!!((e=r.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function yU(r){const e=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const c=eL(o).subarray(0,16);return gU(c),c}}return null}let T0={};class hf{static clearKeyUriToKeyIdMap(){T0={}}static setKeyIdForUri(e,t){T0[e]=t}static addKeyIdForUri(e){const t=Object.keys(T0).length%Number.MAX_SAFE_INTEGER,n=new Uint8Array(16);return new DataView(n.buffer,12,4).setUint32(0,t),T0[e]=n,n}constructor(e,t,n,i=[1],s=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=i,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!V0(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(XN(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&xb(e.keyFormatVersions,this.keyFormatVersions)&&w3(e.iv,this.iv)&&w3(e.keyId,this.keyId)}isSupported(){if(this.method){if(V0(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Er.FAIRPLAY:case Er.WIDEVINE:case Er.PLAYREADY:case Er.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(V0(this.method)){let s=this.iv;return s||(typeof e!="number"&&(Pi.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),s=Fq(e)),new hf(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.keyId){const s=T0[this.uri];if(s&&!xb(this.keyId,s)&&hf.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=vU(this.uri);if(n)switch(this.keyFormat){case Er.WIDEVINE:if(this.pssh=n,!this.keyId){const s=YK(n.buffer);if(s.length){var i;const a=s[0];this.keyId=(i=a.kids)!=null&&i.length?a.kids[0]:null}}this.keyId||(this.keyId=I3(t));break;case Er.PLAYREADY:{const s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=VK(s,null,n),this.keyId=yU(n);break}default:{let s=n.subarray(0,16);if(s.length!==16){const a=new Uint8Array(16);a.set(s,16-s.length),s=a}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){let s;s=Uq(t),s||(s=I3(t),s||(s=T0[this.uri])),s&&(this.keyId=s,hf.setKeyIdForUri(this.uri,s))}return this}}function Uq(r){const e=r?.[Er.WIDEVINE];return e?e.keyId:null}function I3(r){const e=r?.[Er.PLAYREADY];if(e){const t=vU(e.uri);if(t)return yU(t)}return null}function Fq(r){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e}const B3=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,O3=/#EXT-X-MEDIA:(.*)/g,kq=/^#EXT(?:INF|-X-TARGETDURATION):/m,FM=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Gq=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class oc{static findGroup(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.id===t)return i}}static resolve(e,t){return XD.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return kq.test(e)}static parseMasterPlaylist(e,t){const n=R3(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},s=[];if(B3.lastIndex=0,!e.startsWith("#EXTM3U"))return i.playlistParsingError=new Error("no EXTM3U delimiter"),i;let a;for(;(a=B3.exec(e))!=null;)if(a[1]){var o;const u=new os(a[1],i),h=iR(i,a[2]),p={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:oc.resolve(h,t)},v=u.decimalResolution("RESOLUTION");v&&(p.width=v.width,p.height=v.height),U3(u.CODECS,p);const y=u["SUPPLEMENTAL-CODECS"];y&&(p.supplemental={},U3(y,p.supplemental)),(o=p.unknownCodecs)!=null&&o.length||s.push(p),i.levels.push(p)}else if(a[3]){const u=a[3],h=a[4];switch(u){case"SESSION-DATA":{const p=new os(h,i),v=p["DATA-ID"];v&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[v]=p);break}case"SESSION-KEY":{const p=P3(h,t,i);p.encrypted&&p.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(p)):Pi.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${h}"`);break}case"DEFINE":{{const p=new os(h,i);D3(i,p,t)}break}case"CONTENT-STEERING":{const p=new os(h,i);i.contentSteering={uri:oc.resolve(p["SERVER-URI"],t),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=N3(h);break}}}const c=s.length>0&&s.length<i.levels.length;return i.levels=c?s:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,n){let i;const s={},a=n.levels,o={AUDIO:a.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:a.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let c=0;for(O3.lastIndex=0;(i=O3.exec(e))!==null;){const u=new os(i[1],n),h=u.TYPE;if(h){const p=o[h],v=s[h]||[];s[h]=v;const y=u.LANGUAGE,x=u["ASSOC-LANGUAGE"],S=u.CHANNELS,E=u.CHARACTERISTICS,b=u["INSTREAM-ID"],T={attrs:u,bitrate:0,id:c++,groupId:u["GROUP-ID"]||"",name:u.NAME||y||"",type:h,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:y,url:u.URI?oc.resolve(u.URI,t):""};if(x&&(T.assocLang=x),S&&(T.channels=S),E&&(T.characteristics=E),b&&(T.instreamId=b),p!=null&&p.length){const R=oc.findGroup(p,T.groupId)||p[0];F3(T,R,"audioCodec"),F3(T,R,"textCodec")}v.push(T)}}return s}static parseLevelPlaylist(e,t,n,i,s,a){var o;const c={url:t},u=new mU(t),h=u.fragments,p=[];let v=null,y=0,x=0,S=0,E=0,b=0,T=null,R=new nE(i,c),D,P,O,N=-1,U=!1,B=null,I;if(FM.lastIndex=0,u.m3u8=e,u.hasVariableRefs=R3(e),((o=FM.exec(e))==null?void 0:o[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(D=FM.exec(e))!==null;){U&&(U=!1,R=new nE(i,c),R.playlistOffset=S,R.setStart(S),R.sn=y,R.cc=E,b&&(R.bitrate=b),R.level=n,v&&(R.initSegment=v,v.rawProgramDateTime&&(R.rawProgramDateTime=v.rawProgramDateTime,v.rawProgramDateTime=null),B&&(R.setByteRange(B),B=null)));const te=D[1];if(te){R.duration=parseFloat(te);const re=(" "+D[2]).slice(1);R.title=re||null,R.tagList.push(re?["INF",te,re]:["INF",te])}else if(D[3]){if(zt(R.duration)){R.playlistOffset=S,R.setStart(S),O&&G3(R,O,u),R.sn=y,R.level=n,R.cc=E,h.push(R);const re=(" "+D[3]).slice(1);R.relurl=iR(u,re),rR(R,T,p),T=R,S+=R.duration,y++,x=0,U=!0}}else{if(D=D[0].match(Gq),!D){Pi.warn("No matches on slow regex match for level playlist!");continue}for(P=1;P<D.length&&D[P]===void 0;P++);const re=(" "+D[P]).slice(1),k=(" "+D[P+1]).slice(1),j=D[P+2]?(" "+D[P+2]).slice(1):null;switch(re){case"BYTERANGE":T?R.setByteRange(k,T):R.setByteRange(k);break;case"PROGRAM-DATE-TIME":R.rawProgramDateTime=k,R.tagList.push(["PROGRAM-DATE-TIME",k]),N===-1&&(N=h.length);break;case"PLAYLIST-TYPE":u.type&&Wu(u,re,D),u.type=k.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?Wu(u,re,D):h.length>0&&H3(u,re,D),y=u.startSN=parseInt(k);break;case"SKIP":{u.skippedSegments&&Wu(u,re,D);const J=new os(k,u),oe=J.decimalInteger("SKIPPED-SEGMENTS");if(zt(oe)){u.skippedSegments+=oe;for(let X=oe;X--;)h.push(null);y+=oe}const K=J.enumeratedString("RECENTLY-REMOVED-DATERANGES");K&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(K.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&Wu(u,re,D),u.targetduration=Math.max(parseInt(k),1);break;case"VERSION":u.version!==null&&Wu(u,re,D),u.version=parseInt(k);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||Wu(u,re,D),u.live=!1;break;case"#":(k||j)&&R.tagList.push(j?[k,j]:[k]);break;case"DISCONTINUITY":E++,R.tagList.push(["DIS"]);break;case"GAP":R.gap=!0,R.tagList.push([re]);break;case"BITRATE":R.tagList.push([re,k]),b=parseInt(k)*1e3,zt(b)?R.bitrate=b:b=0;break;case"DATERANGE":{const J=new os(k,u),oe=new QD(J,u.dateRanges[J.ID],u.dateRangeTagCount);u.dateRangeTagCount++,oe.isValid||u.skippedSegments?u.dateRanges[oe.id]=oe:Pi.warn(`Ignoring invalid DATERANGE tag: "${k}"`),R.tagList.push(["EXT-X-DATERANGE",k]);break}case"DEFINE":{{const J=new os(k,u);"IMPORT"in J?Cq(u,J,a):D3(u,J,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?Wu(u,re,D):h.length>0&&H3(u,re,D),u.startCC=E=parseInt(k);break;case"KEY":{const J=P3(k,t,u);if(J.isSupported()){if(J.method==="NONE"){O=void 0;break}O||(O={});const oe=O[J.keyFormat];oe!=null&&oe.matches(J)||(oe&&(O=Gi({},O)),O[J.keyFormat]=J)}else Pi.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${k}"`);break}case"START":u.startTimeOffset=N3(k);break;case"MAP":{const J=new os(k,u);if(R.duration){const oe=new nE(i,c);k3(oe,J,n,O),v=oe,R.initSegment=v,v.rawProgramDateTime&&!R.rawProgramDateTime&&(R.rawProgramDateTime=v.rawProgramDateTime)}else{const oe=R.byteRangeEndOffset;if(oe){const K=R.byteRangeStartOffset;B=`${oe-K}@${K}`}else B=null;k3(R,J,n,O),v=R,U=!0}v.cc=E;break}case"SERVER-CONTROL":{I&&Wu(u,re,D),I=new os(k),u.canBlockReload=I.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=I.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&I.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=I.optionalFloat("PART-HOLD-BACK",0),u.holdBack=I.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&Wu(u,re,D);const J=new os(k);u.partTarget=J.decimalFloatingPoint("PART-TARGET");break}case"PART":{let J=u.partList;J||(J=u.partList=[]);const oe=x>0?J[J.length-1]:void 0,K=x++,X=new os(k,u),ne=new KN(X,R,c,K,oe);J.push(ne),R.duration+=ne.duration;break}case"PRELOAD-HINT":{const J=new os(k,u);u.preloadHint=J;break}case"RENDITION-REPORT":{const J=new os(k,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(J);break}default:Pi.warn(`line parsed but not handled: ${D}`);break}}}T&&!T.relurl?(h.pop(),S-=T.duration,u.partList&&(u.fragmentHint=T)):u.partList&&(rR(R,T,p),R.cc=E,u.fragmentHint=R,O&&G3(R,O,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));const z=h.length,W=h[0],Z=h[z-1];if(S+=u.skippedSegments*u.targetduration,S>0&&z&&Z){u.averagetargetduration=S/z;const te=Z.sn;u.endSN=te!=="initSegment"?te:0,u.live||(Z.endList=!0),N>0&&(zq(h,N),W&&p.unshift(W))}return u.fragmentHint&&(S+=u.fragmentHint.duration),u.totalduration=S,p.length&&u.dateRangeTagCount&&W&&xU(p,u),u.endCC=E,u}}function xU(r,e){let t=r.length;if(!t)if(e.hasProgramDateTime){const o=e.fragments[e.fragments.length-1];r.push(o),t++}else return;const n=r[t-1],i=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let o=s.length;o--;){const c=e.dateRanges[s[o]],u=c.startDate.getTime();c.tagAnchor=n.ref;for(let h=t;h--;){var a;if(((a=r[h])==null?void 0:a.sn)<e.startSN)break;const p=Hq(e,u,r,h,i);if(p!==-1){c.tagAnchor=e.fragments[p].ref;break}}}}function Hq(r,e,t,n,i){const s=t[n];if(s){const o=s.programDateTime;if(e>=o||n===0){var a;const c=(((a=t[n+1])==null?void 0:a.start)||i)-s.start;if(e<=o+c*1e3){const u=t[n].sn-r.startSN;if(u<0)return-1;const h=r.fragments;if(h.length>t.length){const v=(t[n+1]||h[h.length-1]).sn-r.startSN;for(let y=v;y>u;y--){const x=h[y].programDateTime;if(e>=x&&e<x+h[y].duration*1e3)return y}}return u}}}return-1}function P3(r,e,t){var n,i;const s=new os(r,t),a=(n=s.METHOD)!=null?n:"",o=s.URI,c=s.hexadecimalInteger("IV"),u=s.KEYFORMATVERSIONS,h=(i=s.KEYFORMAT)!=null?i:"identity";o&&s.IV&&!c&&Pi.error(`Invalid IV: ${s.IV}`);const p=o?oc.resolve(o,e):"",v=(u||"1").split("/").map(Number).filter(Number.isFinite);return new hf(a,p,h,v,c,s.KEYID)}function N3(r){const t=new os(r).decimalFloatingPoint("TIME-OFFSET");return zt(t)?t:null}function U3(r,e){let t=(r||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const i=t.filter(s=>jD(s,n));i.length&&(e[`${n}Codec`]=i.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>i.indexOf(s)===-1))}),e.unknownCodecs=t}function F3(r,e,t){const n=e[t];n&&(r[t]=n)}function zq(r,e){let t=r[e];for(let n=e;n--;){const i=r[n];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function rR(r,e,t){r.rawProgramDateTime?t.push(r):e!=null&&e.programDateTime&&(r.programDateTime=e.endProgramDateTime)}function k3(r,e,t,n){r.relurl=e.URI,e.BYTERANGE&&r.setByteRange(e.BYTERANGE),r.level=t,r.sn="initSegment",n&&(r.levelkeys=n),r.initSegment=null}function G3(r,e,t){r.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&n.push(r)}function Wu(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function H3(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function kM(r,e){const t=e.startPTS;if(zt(t)){let n=0,i;e.sn>r.sn?(n=t-r.start,i=r):(n=r.start-t,i=e),i.duration!==n&&i.setDuration(n)}else e.sn>r.sn?r.cc===e.cc&&r.minEndPTS?e.setStart(r.start+(r.minEndPTS-r.start)):e.setStart(r.start+r.duration):e.setStart(Math.max(r.start-e.duration,0))}function _U(r,e,t,n,i,s,a){n-t<=0&&(a.warn("Fragment should have a positive duration",e),n=t+e.duration,s=i+e.duration);let c=t,u=n;const h=e.startPTS,p=e.endPTS;if(zt(h)){const b=Math.abs(h-t);r&&b>r.totalduration?a.warn(`media timestamps and playlist times differ by ${b}s for level ${e.level} ${r.url}`):zt(e.deltaPTS)?e.deltaPTS=Math.max(b,e.deltaPTS):e.deltaPTS=b,c=Math.max(t,h),t=Math.min(t,h),i=e.startDTS!==void 0?Math.min(i,e.startDTS):i,u=Math.min(n,p),n=Math.max(n,p),s=e.endDTS!==void 0?Math.max(s,e.endDTS):s}const v=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=c,e.startDTS=i,e.endPTS=n,e.minEndPTS=u,e.endDTS=s;const y=e.sn;if(!r||y<r.startSN||y>r.endSN)return 0;let x;const S=y-r.startSN,E=r.fragments;for(E[S]=e,x=S;x>0;x--)kM(E[x],E[x-1]);for(x=S;x<E.length-1;x++)kM(E[x],E[x+1]);return r.fragmentHint&&kM(E[E.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,v}function Vq(r,e,t){if(r===e)return;let n=null;const i=r.fragments;for(let h=i.length-1;h>=0;h--){const p=i[h].initSegment;if(p){n=p;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let s;Kq(r,e,(h,p,v,y)=>{if((!e.startCC||e.skippedSegments)&&p.cc!==h.cc){const x=h.cc-p.cc;for(let S=v;S<y.length;S++)y[S].cc+=x;e.endCC=y[y.length-1].cc}zt(h.startPTS)&&zt(h.endPTS)&&(p.setStart(p.startPTS=h.startPTS),p.startDTS=h.startDTS,p.maxStartPTS=h.maxStartPTS,p.endPTS=h.endPTS,p.endDTS=h.endDTS,p.minEndPTS=h.minEndPTS,p.setDuration(h.endPTS-h.startPTS),p.duration&&(s=p),e.PTSKnown=e.alignedSliding=!0),h.hasStreams&&(p.elementaryStreams=h.elementaryStreams),p.loader=h.loader,h.hasStats&&(p.stats=h.stats),h.initSegment&&(p.initSegment=h.initSegment,n=h.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(n&&o.forEach(h=>{var p;h&&(!h.initSegment||h.initSegment.relurl===((p=n)==null?void 0:p.relurl))&&(h.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(h=>!h),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let h=e.skippedSegments;h--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=Yq(r.dateRanges,e,t));const h=r.fragments.filter(p=>p.rawProgramDateTime);if(r.hasProgramDateTime&&!e.hasProgramDateTime)for(let p=1;p<o.length;p++)o[p].programDateTime===null&&rR(o[p],o[p-1],h);xU(h,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var c;const h=EU(r,e.startSN-1);e.startCC=(c=h?.cc)!=null?c:a[0].cc}Xq(r.partList,e.partList,(h,p)=>{p.elementaryStreams=h.elementaryStreams,p.stats=h.stats}),s?_U(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,t):SU(r,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const h=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=h),e.driftEndTime=u,e.driftEnd=h}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=r.requestScheduled)}function Yq(r,e,t){const{dateRanges:n,recentlyRemovedDateranges:i}=e,s=Gi({},r);i&&i.forEach(c=>{delete s[c]});const o=Object.keys(s).length;return o?(Object.keys(n).forEach(c=>{const u=s[c],h=new QD(n[c].attr,u);h.isValid?(s[c]=h,u||(h.tagOrder+=o)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${ji(n[c].attr)}"`)}),s):n}function Xq(r,e,t){if(r&&e){let n=0;for(let i=0,s=r.length;i<=s;i++){const a=r[i],o=e[i+n];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):n--}}}function Kq(r,e,t){const n=e.skippedSegments,i=Math.max(r.startSN,e.startSN)-e.startSN,s=(r.fragmentHint?1:0)+(n?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,a=e.startSN-r.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,c=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let u=i;u<=s;u++){const h=c[a+u];let p=o[u];if(n&&!p&&h&&(p=e.fragments[u]=h),h&&p){t(h,p,u,o);const v=h.relurl,y=p.relurl;if(v&&qq(v,y)){e.playlistParsingError=z3(`media sequence mismatch ${p.sn}:`,r,e,h,p);return}else if(h.cc!==p.cc){e.playlistParsingError=z3(`discontinuity sequence mismatch (${h.cc}!=${p.cc})`,r,e,h,p);return}}}}function z3(r,e,t,n,i){return new Error(`${r} ${i.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function SU(r,e,t=!0){const n=e.startSN+e.skippedSegments-r.startSN,i=r.fragments,s=n>=0;let a=0;if(s&&n<i.length)a=i[n].start;else if(s&&e.startSN===r.endSN+1)a=r.fragmentEnd;else if(s&&t)a=r.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=r.fragmentStart;else return;aR(e,a)}function aR(r,e){if(e){const t=r.fragments;for(let n=r.skippedSegments;n<t.length;n++)t[n].addStart(e);r.fragmentHint&&r.fragmentHint.addStart(e)}}function AU(r,e=1/0){let t=1e3*r.targetduration;if(r.updated){const n=r.fragments;if(n.length&&t*4>e){const s=n[n.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function EU(r,e,t){if(!r)return null;let n=r.fragments[e-r.startSN];return n||(n=r.fragmentHint,n&&n.sn===e)?n:e<r.startSN&&t&&t.sn===e?t:null}function V3(r,e,t){return r?bU(r.partList,e,t):null}function bU(r,e,t){if(r)for(let n=r.length;n--;){const i=r[n];if(i.index===t&&i.fragment.sn===e)return i}return null}function TU(r){r.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(i=>{i.level=t,i.initSegment&&(i.initSegment.level=t)})})}function qq(r,e){return r!==e&&e?Y3(r)!==Y3(e):!1}function Y3(r){return r.replace(/\?[^?]*$/,"")}function Ky(r,e){for(let n=0,i=r.length;n<i;n++){var t;if(((t=r[n])==null?void 0:t.cc)===e)return r[n]}return null}function jq(r,e){return!!(r&&e.startCC<r.endCC&&e.endCC>r.startCC)}function X3(r,e){const t=r.start+e;r.startPTS=t,r.setStart(t),r.endPTS=t+r.duration}function MU(r,e){const t=e.fragments;for(let n=0,i=t.length;n<i;n++)X3(t[n],r);e.fragmentHint&&X3(e.fragmentHint,r),e.alignedSliding=!0}function Wq(r,e){r&&(CU(e,r),e.alignedSliding||Sb(e,r),!e.alignedSliding&&!e.skippedSegments&&SU(r,e,!1))}function CU(r,e){if(!jq(e,r))return;const t=Math.min(e.endCC,r.endCC),n=Ky(e.fragments,t),i=Ky(r.fragments,t);if(!n||!i)return;Pi.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=n.start-i.start;MU(s,r)}function Sb(r,e){if(!r.hasProgramDateTime||!e.hasProgramDateTime)return;const t=r.fragments,n=e.fragments;if(!t.length||!n.length)return;let i,s;const a=Math.min(e.endCC,r.endCC);e.startCC<a&&r.startCC<a&&(i=Ky(n,a),s=Ky(t,a)),(!i||!s)&&(i=n[Math.floor(n.length/2)],s=Ky(t,i.cc)||t[Math.floor(t.length/2)]);const o=i.programDateTime,c=s.programDateTime;if(!o||!c)return;const u=(c-o)/1e3-(s.start-i.start);MU(u,r)}function ka(r,e,t){oo(r,e,t),r.addEventListener(e,t)}function oo(r,e,t){r.removeEventListener(e,t)}const Jq={toString:function(r){let e="";const t=r.length;for(let n=0;n<t;n++)e+=`[${r.start(n).toFixed(3)}-${r.end(n).toFixed(3)}]`;return e}},lt={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class AT extends dU{constructor(e,t,n,i,s){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=lt.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:c,mediaBuffer:u,state:h}=this,p=c?c.currentTime:0,v=Dn.bufferInfo(u||c,p,a.maxBufferHole),y=!v.len;if(this.log(`Media seeking to ${zt(p)?p.toFixed(3):p}, state: ${h}, ${y?"out of":"in"} buffer`),this.state===lt.ENDED)this.resetLoadingState();else if(o){const x=a.maxFragLookUpTolerance,S=o.start-x,E=o.start+o.duration+x;if(y||E<v.start||S>v.end){const b=p>E;(p<S||b)&&(b&&o.loader&&(this.log(`Cancelling fragment load for seek (sn: ${o.sn})`),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(c){this.fragmentTracker.removeFragmentsInRange(p,1/0,this.playlistType,!0);const x=this.lastCurrentTime;if(p>x&&(this.lastCurrentTime=p),!this.loadingParts){const S=Math.max(v.end,p),E=this.shouldLoadParts(this.getLevelDetails(),S);E&&(this.log(`LL-Part loading ON after seeking to ${p.toFixed(2)} with buffer @${S.toFixed(2)}`),this.loadingParts=E)}}this.hls.hasEnoughToStart||(this.log(`Setting ${y?"startPosition":"nextLoadPosition"} to ${p} for seek without enough to start`),this.nextLoadPosition=p,y&&(this.startPosition=p)),y&&this.state===lt.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new Tq(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new $D(e.config)}registerListeners(){const{hls:e}=this;e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(H.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(H.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===lt.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=lt.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,i=this.config.timelineOffset||0;if(n<=i)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=Dn.bufferedInfo(s,e.start,0));const a=e.nextStart;if(a&&a>i&&a<t.edge||this.media.currentTime<e.start)return!1;const c=t.partList;if(c!=null&&c.length){const h=c[c.length-1];return Dn.isBuffered(this.media,h.start+h.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;ka(n,"seeking",this.onMediaSeeking),ka(n,"ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===lt.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,i=this.media;if(i!==null){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),oo(i,"seeking",this.onMediaSeeking),oo(i,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=lt.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const i=s=>{const a=s.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(a,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,n,i).then(s=>{if(!s)return;const a=this.state,o=s.frag;if(this.fragContextChanged(o)){(a===lt.FRAG_LOADING||!this.fragCurrent&&a===lt.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=lt.IDLE);return}"payload"in s&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(H.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===lt.STOPPED||this.state===lt.ERROR||(this.warn(`Frag error: ${s?.message||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===rr.APPENDING){const s=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,s),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),c=this.backtrackFragment;((c?e.sn-c.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===rr.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:n};this.hls.trigger(H.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const i=n?.frag;if(!i||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:i}=this,{frag:s,payload:a}=n,o=s.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&V0(o.method)){const c=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,ZD(o.method)).catch(u=>{throw i.trigger(H.ERROR,{type:rn.MEDIA_ERROR,details:Ie.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:s}),u}).then(u=>{const h=self.performance.now();return i.trigger(H.FRAG_DECRYPTED,{frag:s,payload:u,stats:{tstart:c,tdecrypt:h}}),n.payload=u,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===lt.STOPPED||this.state===lt.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==lt.STOPPED&&(this.state=lt.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,i;const s=e.tracks;if(s&&!t.encrypted&&((n=s.audio)!=null&&n.encrypted||(i=s.video)!=null&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,o=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(o.message),!a||a.mediaKeys?!1:(this.hls.trigger(H.ERROR,{type:rn.KEY_SYSTEM_ERROR,details:Ie.KEY_SYSTEM_NO_KEYS,fatal:!1,error:o,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?Jq.toString(Dn.getBuffered(n)):"(detached)"})`),Ps(e)){var i;if(e.type!==qt.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=lt.IDLE;return}}const s=(i=this.levels)==null?void 0:i[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=lt.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:i,partsLoaded:s}=e,a=!s||s.length===0||s.some(c=>!c),o=new ST(n.level,n.sn,n.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,i){var s;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=lt.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(v=>{if(!this.fragContextChanged(v.frag))return this.hls.trigger(H.KEY_LOADED,v),this.state===lt.KEY_LOADING&&(this.state=lt.IDLE),v}),this.hls.trigger(H.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));const c=this.fragPrevious;if(Ps(e)&&(!c||e.sn!==c.sn)){const v=this.shouldLoadParts(t.details,e.end);v!==this.loadingParts&&(this.log(`LL-Part loading ${v?"ON":"OFF"} loading sn ${c?.sn}->${e.sn}`),this.loadingParts=v)}if(n=Math.max(e.start,n||0),this.loadingParts&&Ps(e)){const v=a.partList;if(v&&i){n>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const y=this.getNextPart(v,e,n);if(y>-1){const x=v[y];e=this.fragCurrent=x.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${x.index} (${y}/${v.length-1}) of ${this.fragInfo(e,!1,x)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=x.start+x.duration,this.state=lt.FRAG_LOADING;let S;return o?S=o.then(E=>!E||this.fragContextChanged(E.frag)?null:this.doFragPartsLoad(e,x,t,i)).catch(E=>this.handleFragLoadError(E)):S=this.doFragPartsLoad(e,x,t,i).catch(E=>this.handleFragLoadError(E)),this.hls.trigger(H.FRAG_LOADING,{frag:e,part:x,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):S}else if(!e.url||this.loadedEndOfParts(v,n))return Promise.resolve(null)}}if(Ps(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=a.partList)==null?void 0:u.filter(v=>v.loaded).map(v=>`[${v.start}-${v.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),zt(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=lt.FRAG_LOADING;const h=this.config.progressive&&e.type!==qt.SUBTITLE;let p;return h&&o?p=o.then(v=>!v||this.fragContextChanged(v.frag)?null:this.fragmentLoader.load(e,i)).catch(v=>this.handleFragLoadError(v)):p=Promise.all([this.fragmentLoader.load(e,h?i:void 0),o]).then(([v])=>(!h&&i&&i(v),v)).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(H.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):p}doFragPartsLoad(e,t,n,i){return new Promise((s,a)=>{var o;const c=[],u=(o=n.details)==null?void 0:o.partList,h=p=>{this.fragmentLoader.loadPart(e,p,i).then(v=>{c[p.index]=v;const y=v.part;this.hls.trigger(H.FRAG_LOADED,v);const x=V3(n.details,e.sn,p.index+1)||bU(u,e.sn,p.index+1);if(x)h(x);else return s({frag:e,part:y,partsLoaded:c})}).catch(a)};h(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===Ie.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===rn.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(H.ERROR,t)}else this.hls.trigger(H.ERROR,{type:rn.OTHER_ERROR,details:Ie.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==lt.PARSING){!this.fragCurrent&&this.state!==lt.STOPPED&&this.state!==lt.ERROR&&(this.state=lt.IDLE);return}const{frag:n,part:i,level:s}=t,a=self.performance.now();n.stats.parsing.end=a,i&&(i.stats.parsing.end=a);const o=this.getLevelDetails(),u=o&&n.sn>o.endSN||this.shouldLoadParts(o,n.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(n,i,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const s=e.partList[0];if(s.fragment.type===qt.SUBTITLE)return!1;const a=s.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=a){var i;if((this.hls.hasEnoughToStart?((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:i,sn:s,part:a}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const o=t[i],c=o.details,u=a>-1?V3(c,s,a):null,h=u?u.fragment:EU(c,s,n);return h?(n&&n!==h&&(h.stats=n.stats),{frag:h,part:u,level:o}):null}bufferFragmentData(e,t,n,i,s){if(this.state!==lt.PARSING)return;const{data1:a,data2:o}=e;let c=a;if(o&&(c=bl(a,o)),!c.length)return;const u=this.initPTS[t.cc],h=u?-u.baseTime/u.timescale:void 0,p={type:e.type,frag:t,part:n,chunkMeta:i,offset:h,parent:t.type,data:c};if(this.hls.trigger(H.BUFFER_APPENDING,p),e.dropped&&e.independent&&!n){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Dn.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,i=Dn.bufferInfo(t,n,0),s=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),o=Math.max(Math.min(e.start-a,i.end-a),n+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var n;const i=this.getLoadPosition();if(!zt(i))return null;const a=this.lastCurrentTime>i||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,a)}getFwdBufferInfoAtPos(e,t,n,i){const s=Dn.bufferInfo(e,t,i);if(s.len===0&&s.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,n);if(a&&(s.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(s.nextStart,a.end)-t,i);return Dn.bufferInfo(e,t,o)}}return s}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,i=Math.max(Math.min(e-t,n.maxBufferLength),t),s=Math.max(e-t*3,n.maxMaxBufferLength/2,i);return s>=i?(n.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=qt.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,i=n.length;if(!i)return null;const{config:s}=this,a=n[0].start,o=s.lowLatencyMode&&!!t.partList;let c=null;if(t.live){const p=s.initialLiveManifestSize;if(i<p)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${p})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var u;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),c=this.getInitialLiveFragment(t);const v=this.hls.startPosition,y=this.hls.liveSyncPosition,x=c?(v!==-1&&v>=a?v:y)||c.start:e;this.log(`Setting startPosition to ${x} to match start frag at live edge. mainStart: ${v} liveSyncPosition: ${y} frag.start: ${(u=c)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=x}}else e<=a&&(c=n[0]);if(!c){const p=this.loadingParts?t.partEnd:t.fragmentEnd;c=this.getFragmentAtPosition(e,p,t)}let h=this.filterReplacedPrimary(c,t);if(!h&&c){const p=c.sn-t.startSN;h=this.filterReplacedPrimary(n[p+1]||null,t)}return this.mapToInitFragWhenRequired(h)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===rr.OK||n===rr.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,i,s){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&n.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,i,0);if(o!==null&&n.len+o.len>=s){const c=a.sn;return this.loopSn!==c&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${c}`),this.loopSn=c),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(K3(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(K3(this.config)&&e.type!==qt.SUBTITLE){const n=this.hls.interstitialsManager,i=n?.bufferingItem;if(i){const a=i.event;if(a){if(a.appendInPlace||Math.abs(e.start-i.start)>1||i.start===0)return null}else if(e.end<=i.start&&t?.live===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const s=n?.playerQueue;if(s)for(let a=s.length;a--;){const o=s[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let i=-1,s=!1,a=!0;for(let o=0,c=e.length;o<c;o++){const u=e[o];if(a=a&&!u.independent,i>-1&&n<u.start)break;const h=u.loaded;h?i=-1:(s||(u.independent||a)&&u.fragment===t)&&(u.fragment!==t&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${u.start}`),i=o),s=h}return i}loadedEndOfParts(e,t){let n;for(let i=e.length;i--;){if(n=e[i],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let i=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),i=pq(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const s=n.sn+1;if(s>=e.startSN&&s<=e.endSN){const a=t[s-e.startSN];n.cc===a.cc&&(i=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=cU(e,n.cc,n.end),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,n){const{config:i}=this;let{fragPrevious:s}=this,{fragments:a,endSN:o}=n;const{fragmentHint:c}=n,{maxFragLookUpTolerance:u}=i,h=n.partList,p=!!(this.loadingParts&&h!=null&&h.length&&c);p&&!this.bitrateTest&&h[h.length-1].fragment.sn===c.sn&&(a=a.concat(c),o=c.sn);let v;if(e<t){var y;const S=e<this.lastCurrentTime||e>t-u||(y=this.media)!=null&&y.paused||!this.startFragRequested?0:u;v=Up(s,a,e,S)}else v=a[a.length-1];if(v){const x=v.sn-n.startSN,S=this.fragmentTracker.getState(v);if((S===rr.OK||S===rr.PARTIAL&&v.gap)&&(s=v),s&&v.sn===s.sn&&(!p||h[0].fragment.sn>v.sn||!n.live)&&v.level===s.level){const b=a[x+1];v.sn<o&&this.fragmentTracker.getState(b)!==rr.OK?v=b:v=null}}return v}alignPlaylists(e,t,n){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,a=!t,o=e.alignedSliding&&zt(s);if(a||!o&&!s){Wq(n,e);const c=e.fragmentStart;return this.log(`Live playlist sliding: ${c.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),c}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const i=this.timelineOffset;if(n===-1){const s=this.startTimeOffset!==null,a=s?this.startTimeOffset:e.startTimeOffset;a!==null&&zt(a)?(n=t+a,a<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${a} found in ${s?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+i}this.nextLoadPosition=n+i}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Ps(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==lt.FRAG_LOADING_WAITING_RETRY)&&(this.state=lt.IDLE)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const b=this.getCurrentContext(t.chunkMeta);b&&(t.frag=b.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var s;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const a=t.details===Ie.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(i,!0);const o=t.errorAction;if(!o){this.state=lt.ERROR;return}const{action:c,flags:u,retryCount:h=0,retryConfig:p}=o,v=!!p,y=v&&c===nr.RetryRequest,x=v&&!o.resolved&&u===to.MoveAllAlternatesMatchingHost,S=(n=this.hls.latestLevelDetails)==null?void 0:n.live;if(!y&&x&&Ps(i)&&!i.endList&&S&&!fU(t))this.resetFragmentErrors(e),this.treatAsGap(i),o.resolved=!0;else if((y||x)&&h<p.maxNumRetry){var E;const b=nR((E=t.response)==null?void 0:E.code),T=JD(p,h);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+T,this.state=lt.FRAG_LOADING_WAITING_RETRY,o.resolved=!0,b){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${h+1}/${p.maxNumRetry} in ${T}ms`)}else if(p)if(this.resetFragmentErrors(e),h<p.maxNumRetry)!a&&c!==nr.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${h})`);return}else c===nr.SendAlternateToPenaltyBox?this.state=lt.WAITING_LEVEL:this.state=lt.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!nR(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=lt.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===lt.PARSING||this.state===lt.PARSED){const t=e.frag,n=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,n),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len,t?.duration||10);const a=!s;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===qt.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==lt.STOPPED&&(this.state=lt.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const i=Dn.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,n),this.state===lt.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==lt.STOPPED&&(this.state=lt.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,i){const s=n.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((c,u)=>{const h=e.elementaryStreams[u];if(h){const p=h.endPTS-h.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${p})`),c||!1;const v=i?0:_U(s,e,h.startPTS,h.endPTS,h.startDTS,h.endDTS,this);return this.hls.trigger(H.LEVEL_PTS_UPDATED,{details:s,level:n,drift:v,type:u,frag:e,start:h.startPTS,end:h.endPTS}),!0}return c},!1)){var o;const c=((o=this.transmuxer)==null?void 0:o.error)===null;if((n.fragmentError===0||c&&(n.fragmentError<2||e.endList))&&this.treatAsGap(e,n),c){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(H.ERROR,{type:rn.MEDIA_ERROR,details:Ie.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=lt.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(H.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===qt.MAIN?"level":"track"}fragInfo(e,t=!0,n){var i,s;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((i=t&&!n?e.startPTS:(n||e).start)!=null?i:NaN).toFixed(3)}-${((s=t&&!n?e.endPTS:(n||e).end)!=null?s:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function K3(r){return!!r.interstitialsController&&r.enableInterstitialPlayback!==!1}class RU{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=$q(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function $q(r,e){const t=new Uint8Array(e);let n=0;for(let i=0;i<r.length;i++){const s=r[i];t.set(s,n),n+=s.length}return t}var GM={exports:{}},q3;function Qq(){return q3||(q3=1,(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(c,u,h){this.fn=c,this.context=u,this.once=h||!1}function s(c,u,h,p,v){if(typeof h!="function")throw new TypeError("The listener must be a function");var y=new i(h,p||c,v),x=t?t+u:u;return c._events[x]?c._events[x].fn?c._events[x]=[c._events[x],y]:c._events[x].push(y):(c._events[x]=y,c._eventsCount++),c}function a(c,u){--c._eventsCount===0?c._events=new n:delete c._events[u]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],h,p;if(this._eventsCount===0)return u;for(p in h=this._events)e.call(h,p)&&u.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(h)):u},o.prototype.listeners=function(u){var h=t?t+u:u,p=this._events[h];if(!p)return[];if(p.fn)return[p.fn];for(var v=0,y=p.length,x=new Array(y);v<y;v++)x[v]=p[v].fn;return x},o.prototype.listenerCount=function(u){var h=t?t+u:u,p=this._events[h];return p?p.fn?1:p.length:0},o.prototype.emit=function(u,h,p,v,y,x){var S=t?t+u:u;if(!this._events[S])return!1;var E=this._events[S],b=arguments.length,T,R;if(E.fn){switch(E.once&&this.removeListener(u,E.fn,void 0,!0),b){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,h),!0;case 3:return E.fn.call(E.context,h,p),!0;case 4:return E.fn.call(E.context,h,p,v),!0;case 5:return E.fn.call(E.context,h,p,v,y),!0;case 6:return E.fn.call(E.context,h,p,v,y,x),!0}for(R=1,T=new Array(b-1);R<b;R++)T[R-1]=arguments[R];E.fn.apply(E.context,T)}else{var D=E.length,P;for(R=0;R<D;R++)switch(E[R].once&&this.removeListener(u,E[R].fn,void 0,!0),b){case 1:E[R].fn.call(E[R].context);break;case 2:E[R].fn.call(E[R].context,h);break;case 3:E[R].fn.call(E[R].context,h,p);break;case 4:E[R].fn.call(E[R].context,h,p,v);break;default:if(!T)for(P=1,T=new Array(b-1);P<b;P++)T[P-1]=arguments[P];E[R].fn.apply(E[R].context,T)}}return!0},o.prototype.on=function(u,h,p){return s(this,u,h,p,!1)},o.prototype.once=function(u,h,p){return s(this,u,h,p,!0)},o.prototype.removeListener=function(u,h,p,v){var y=t?t+u:u;if(!this._events[y])return this;if(!h)return a(this,y),this;var x=this._events[y];if(x.fn)x.fn===h&&(!v||x.once)&&(!p||x.context===p)&&a(this,y);else{for(var S=0,E=[],b=x.length;S<b;S++)(x[S].fn!==h||v&&!x[S].once||p&&x[S].context!==p)&&E.push(x[S]);E.length?this._events[y]=E.length===1?E[0]:E:a(this,y)}return this},o.prototype.removeAllListeners=function(u){var h;return u?(h=t?t+u:u,this._events[h]&&a(this,h)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o})(GM)),GM.exports}var Zq=Qq(),nL=RK(Zq);const _x="1.6.15",gg={};function ej(){return typeof __HLS_WORKER_BUNDLE__=="function"}function tj(){const r=gg[_x];if(r)return r.clientCount++,r;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),i={worker:new self.Worker(t),objectURL:t,clientCount:1};return gg[_x]=i,i}function nj(r){const e=gg[r];if(e)return e.clientCount++,e;const t=new self.URL(r,self.location.href).href,i={worker:new self.Worker(t),scriptURL:t,clientCount:1};return gg[r]=i,i}function ij(r){const e=gg[r||_x];if(e&&e.clientCount--===1){const{worker:n,objectURL:i}=e;delete gg[r||_x],i&&self.URL.revokeObjectURL(i),n.terminate()}}function DU(r,e){return e+10<=r.length&&r[e]===51&&r[e+1]===68&&r[e+2]===73&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function iL(r,e){return e+10<=r.length&&r[e]===73&&r[e+1]===68&&r[e+2]===51&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function ET(r,e){let t=0;return t=(r[e]&127)<<21,t|=(r[e+1]&127)<<14,t|=(r[e+2]&127)<<7,t|=r[e+3]&127,t}function Sx(r,e){const t=e;let n=0;for(;iL(r,e);){n+=10;const i=ET(r,e+6);n+=i,DU(r,e+10)&&(n+=10),e+=n}if(n>0)return r.subarray(t,t+n)}function sj(r,e,t,n){const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],a=s>>2&15;if(a>12){const y=new Error(`invalid ADTS sampling index:${a}`);r.emit(H.ERROR,H.ERROR,{type:rn.MEDIA_ERROR,details:Ie.FRAG_PARSING_ERROR,fatal:!0,error:y,reason:y.message});return}const o=(s>>6&3)+1,c=e[t+3]>>6&3|(s&1)<<2,u="mp4a.40."+o,h=i[a];let p=a;(o===5||o===29)&&(p-=3);const v=[o<<3|(p&14)>>1,(p&1)<<7|c<<3];return Pi.log(`manifest codec:${n}, parsed codec:${u}, channels:${c}, rate:${h} (ADTS object type:${o} sampling index:${a})`),{config:v,samplerate:h,channelCount:c,codec:u,parsedCodec:u,manifestCodec:n}}function LU(r,e){return r[e]===255&&(r[e+1]&246)===240}function wU(r,e){return r[e+1]&1?7:9}function sL(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function rj(r,e){return e+5<r.length}function Ab(r,e){return e+1<r.length&&LU(r,e)}function aj(r,e){return rj(r,e)&&LU(r,e)&&sL(r,e)<=r.length-e}function oj(r,e){if(Ab(r,e)){const t=wU(r,e);if(e+t>=r.length)return!1;const n=sL(r,e);if(n<=t)return!1;const i=e+n;return i===r.length||Ab(r,i)}return!1}function IU(r,e,t,n,i){if(!r.samplerate){const s=sj(e,t,n,i);if(!s)return;Gi(r,s)}}function BU(r){return 1024*9e4/r}function lj(r,e){const t=wU(r,e);if(e+t<=r.length){const n=sL(r,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function OU(r,e,t,n,i){const s=BU(r.samplerate),a=n+i*s,o=lj(e,t);let c;if(o){const{frameLength:p,headerLength:v}=o,y=v+p,x=Math.max(0,t+y-e.length);x?(c=new Uint8Array(y-v),c.set(e.subarray(t+v,e.length),0)):c=e.subarray(t+v,t+y);const S={unit:c,pts:a};return x||r.samples.push(S),{sample:S,length:y,missing:x}}const u=e.length-t;return c=new Uint8Array(u),c.set(e.subarray(t,e.length),0),{sample:{unit:c,pts:a},length:u,missing:-1}}function cj(r,e){return iL(r,e)&&ET(r,e+6)+10<=r.length-e}function uj(r){return r instanceof ArrayBuffer?r:r.byteOffset==0&&r.byteLength==r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer}function HM(r,e=0,t=1/0){return fj(r,e,t,Uint8Array)}function fj(r,e,t,n){const i=hj(r);let s=1;"BYTES_PER_ELEMENT"in n&&(s=n.BYTES_PER_ELEMENT);const a=dj(r)?r.byteOffset:0,o=(a+r.byteLength)/s,c=(a+e)/s,u=Math.floor(Math.max(0,Math.min(c,o))),h=Math.floor(Math.min(u+Math.max(t,0),o));return new n(i,u,h-u)}function hj(r){return r instanceof ArrayBuffer?r:r.buffer}function dj(r){return r&&r.buffer instanceof ArrayBuffer&&r.byteLength!==void 0&&r.byteOffset!==void 0}function pj(r){const e={key:r.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(r.size<2)return;if(r.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=r.data.subarray(1).indexOf(0);if(n===-1)return;const i=ko(HM(r.data,1,n)),s=r.data[2+n],a=r.data.subarray(3+n).indexOf(0);if(a===-1)return;const o=ko(HM(r.data,3+n,a));let c;return i==="-->"?c=ko(HM(r.data,4+n+a)):c=uj(r.data.subarray(4+n+a)),e.mimeType=i,e.pictureType=s,e.description=o,e.data=c,e}function mj(r){if(r.size<2)return;const e=ko(r.data,!0),t=new Uint8Array(r.data.subarray(e.length+1));return{key:r.type,info:e,data:t.buffer}}function gj(r){if(r.size<2)return;if(r.type==="TXXX"){let t=1;const n=ko(r.data.subarray(t),!0);t+=n.length+1;const i=ko(r.data.subarray(t));return{key:r.type,info:n,data:i}}const e=ko(r.data.subarray(1));return{key:r.type,info:"",data:e}}function vj(r){if(r.type==="WXXX"){if(r.size<2)return;let t=1;const n=ko(r.data.subarray(t),!0);t+=n.length+1;const i=ko(r.data.subarray(t));return{key:r.type,info:n,data:i}}const e=ko(r.data);return{key:r.type,info:"",data:e}}function yj(r){return r.type==="PRIV"?mj(r):r.type[0]==="W"?vj(r):r.type==="APIC"?pj(r):gj(r)}function xj(r){const e=String.fromCharCode(r[0],r[1],r[2],r[3]),t=ET(r,4),n=10;return{type:e,size:t,data:r.subarray(n,n+t)}}const SA=10,_j=10;function PU(r){let e=0;const t=[];for(;iL(r,e);){const n=ET(r,e+6);r[e+5]>>6&1&&(e+=SA),e+=SA;const i=e+n;for(;e+_j<i;){const s=xj(r.subarray(e)),a=yj(s);a&&t.push(a),e+=s.size+SA}DU(r,e)&&(e+=SA)}return t}function NU(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"}function Sj(r){if(r.data.byteLength===8){const e=new Uint8Array(r.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function rL(r){const e=PU(r);for(let t=0;t<e.length;t++){const n=e[t];if(NU(n))return Sj(n)}}let io=(function(r){return r.audioId3="org.id3",r.dateRange="com.apple.quicktime.HLS",r.emsg="https://aomedia.org/emsg/ID3",r.misbklv="urn:misb:KLV:bin:1910.1",r})({});function Qc(r="",e=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class aL{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=bl(this.cachedData,e),this.cachedData=null);let n=Sx(e,0),i=n?n.length:0,s;const a=this._audioTrack,o=this._id3Track,c=n?rL(n):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&zt(c))&&(this.basePTS=Aj(c,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:io.audioId3,duration:Number.POSITIVE_INFINITY});i<u;){if(this.canParse(e,i)){const h=this.appendFrame(a,e,i);h?(this.frameIndex++,this.lastPTS=h.sample.pts,i+=h.length,s=i):i=u}else cj(e,i)?(n=Sx(e,i),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:io.audioId3,duration:Number.POSITIVE_INFINITY}),i+=n.length,s=i):i++;if(i===u&&s!==u){const h=e.slice(s);this.cachedData?this.cachedData=bl(this.cachedData,h):this.cachedData=h}}return{audioTrack:a,videoTrack:Qc(),id3Track:o,textTrack:Qc()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Qc(),id3Track:this._id3Track,textTrack:Qc()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const Aj=(r,e,t)=>{if(zt(r))return r*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let AA=null;const Ej=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],bj=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Tj=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Mj=[0,1,1,4];function UU(r,e,t,n,i){if(t+24>e.length)return;const s=FU(e,t);if(s&&t+s.frameLength<=e.length){const a=s.samplesPerFrame*9e4/s.sampleRate,o=n+i*a,c={unit:e.subarray(t,t+s.frameLength),pts:o,dts:o};return r.config=[],r.channelCount=s.channelCount,r.samplerate=s.sampleRate,r.samples.push(c),{sample:c,length:s.frameLength,missing:0}}}function FU(r,e){const t=r[e+1]>>3&3,n=r[e+1]>>1&3,i=r[e+2]>>4&15,s=r[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&s!==3){const a=r[e+2]>>1&1,o=r[e+3]>>6,c=t===3?3-n:n===3?3:4,u=Ej[c*14+i-1]*1e3,p=bj[(t===3?0:t===2?1:2)*3+s],v=o===3?1:2,y=Tj[t][n],x=Mj[n],S=y*8*x,E=Math.floor(y*u/p+a)*x;if(AA===null){const R=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);AA=R?parseInt(R[1]):0}return!!AA&&AA<=87&&n===2&&u>=224e3&&o===0&&(r[e+3]=r[e+3]|128),{sampleRate:p,channelCount:v,frameLength:E,samplesPerFrame:S}}}function oL(r,e){return r[e]===255&&(r[e+1]&224)===224&&(r[e+1]&6)!==0}function kU(r,e){return e+1<r.length&&oL(r,e)}function Cj(r,e){return oL(r,e)&&4<=r.length-e}function GU(r,e){if(e+1<r.length&&oL(r,e)){const n=FU(r,e);let i=4;n!=null&&n.frameLength&&(i=n.frameLength);const s=e+i;return s===r.length||kU(r,s)}return!1}class Rj extends aL{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=Sx(e,0);let i=n?.length||0;if(GU(e,i))return!1;for(let s=e.length;i<s;i++)if(oj(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return aj(e,t)}appendFrame(e,t,n){IU(e,this.observer,t,n,e.manifestCodec);const i=OU(e,t,n,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const HU=(r,e)=>{let t=0,n=5;e+=n;const i=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;n>0;){a[0]=r[e];const o=Math.min(n,8),c=8-o;s[0]=4278190080>>>24+c<<c,i[0]=(a[0]&s[0])>>c,t=t?t<<o|i[0]:i[0],e+=1,n-=o}return t};class Dj extends aL{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const i=zU(e,t,n,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=Sx(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&rL(t)!==void 0&&HU(e,n)<16}}function zU(r,e,t,n,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const o=[48e3,44100,32e3][s],c=e[t+4]&63,h=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][c*3+s]*2;if(t+h>e.length)return-1;const p=e[t+6]>>5;let v=0;p===2?v+=2:(p&1&&p!==1&&(v+=2),p&4&&(v+=2));const y=(e[t+6]<<8|e[t+7])>>12-v&1,S=[2,1,2,3,3,4,4,5][p]+y,E=e[t+5]>>3,b=e[t+5]&7,T=new Uint8Array([s<<6|E<<1|b>>2,(b&3)<<6|p<<3|y<<2|c>>4,c<<4&224]),R=1536/o*9e4,D=n+i*R,P=e.subarray(t,t+h);return r.config=T,r.channelCount=S,r.samplerate=o,r.samples.push({unit:P,pts:D}),h}class Lj extends aL{resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Sx(e,0);let n=t?.length||0;if(t&&e[n]===11&&e[n+1]===119&&rL(t)!==void 0&&HU(e,n)<=16)return!1;for(let i=e.length;n<i;n++)if(GU(e,n))return Pi.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return Cj(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return UU(e,t,n,this.basePTS,this.frameIndex)}}const wj=/\/emsg[-/]ID3/i;class Ij{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,i){const s=this.videoTrack=Qc("video",1),a=this.audioTrack=Qc("audio",1),o=this.txtTrack=Qc("text",1);if(this.id3Track=Qc("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const c=$N(e);if(c.video){const{id:u,timescale:h,codec:p,supplemental:v}=c.video;s.id=u,s.timescale=o.timescale=h,s.codec=p,s.supplemental=v}if(c.audio){const{id:u,timescale:h,codec:p}=c.audio;a.id=u,a.timescale=h,a.codec=p}o.id=jN.text,s.sampleDuration=0,s.duration=a.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return IK(e)}demux(e,t){this.timeOffset=t;let n=e;const i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=bl(this.remainderData,e));const o=kK(n);this.remainderData=o.remainder,i.samples=o.valid||new Uint8Array}else i.samples=n;const a=this.extractID3Track(i,t);return s.samples=h3(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return n.samples=h3(e,t),{videoTrack:t,audioTrack:Qc(),id3Track:i,textTrack:Qc()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const i=Yn(e.samples,["emsg"]);i&&i.forEach(s=>{const a=HK(s);if(wj.test(a.schemeIdUri)){const o=j3(a,t);let c=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;c<=.001&&(c=Number.POSITIVE_INFINITY);const u=a.payload;n.samples.push({data:u,len:u.byteLength,dts:o,pts:o,type:io.emsg,duration:c})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=j3(a,t);n.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:io.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function j3(r,e){return zt(r.presentationTime)?r.presentationTime/r.timeScale:e+r.presentationTimeDelta/r.timeScale}class Bj{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new $D(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Ph.cbc)}decryptAacSample(e,t,n){const i=e[t].unit;if(i.length<=16)return;const s=i.subarray(16,i.length-i.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then(o=>{const c=new Uint8Array(o);i.set(c,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)n.set(e.subarray(s,s+16),i);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)e.set(n.subarray(i,i+16),s);return e}decryptAvcSample(e,t,n,i,s){const a=eU(s.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(c=>{s.data=this.getAvcDecryptedUnit(a,c),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,i)}).catch(i)}decryptAvcSamples(e,t,n,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){i();return}const s=e[t].units;for(;!(n>=s.length);n++){const a=s[n];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,n,i,a),!this.decrypter.isSync()))return}}}}class VU{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,i;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const s=n.units;i=s[s.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,i=n.length;if(i){const s=n[i-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const i=t.byteLength;let s=e.naluState||0;const a=s,o=[];let c=0,u,h,p,v=-1,y=0;for(s===-1&&(v=0,y=this.getNALuType(t,0),s=0,c=1);c<i;){if(u=t[c++],!s){s=u?0:1;continue}if(s===1){s=u?0:2;continue}if(!u)s=3;else if(u===1){if(h=c-s-1,v>=0){const x={data:t.subarray(v,h),type:y};o.push(x)}else{const x=this.getLastNalUnit(e.samples);x&&(a&&c<=4-a&&x.state&&(x.data=x.data.subarray(0,x.data.byteLength-a)),h>0&&(x.data=bl(x.data,t.subarray(0,h)),x.state=0))}c<i?(p=this.getNALuType(t,c),v=c,y=p,s=0):s=-1}else s=0}if(v>=0&&s>=0){const x={data:t.subarray(v,i),type:y,state:s};o.push(x)}if(o.length===0){const x=this.getLastNalUnit(e.samples);x&&(x.data=bl(x.data,t))}return e.naluState=s,o}}class qy{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");i.set(e.subarray(n,n+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&Pi.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Oj extends VU{parsePES(e,t,n,i){const s=this.parseNALu(e,n.data,i);let a=this.VideoSample,o,c=!1;n.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(u=>{var h,p;switch(u.type){case 1:{let S=!1;o=!0;const E=u.data;if(c&&E.length>4){const b=this.readSliceType(E);(b===2||b===4||b===7||b===9)&&(S=!0)}if(S){var v;(v=a)!=null&&v.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.frame=!0,a.key=S;break}case 5:o=!0,(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,qD(u.data,1,n.pts,t.samples);break}case 7:{var y,x;o=!0,c=!0;const S=u.data,E=this.readSPS(S);if(!e.sps||e.width!==E.width||e.height!==E.height||((y=e.pixelRatio)==null?void 0:y[0])!==E.pixelRatio[0]||((x=e.pixelRatio)==null?void 0:x[1])!==E.pixelRatio[1]){e.width=E.width,e.height=E.height,e.pixelRatio=E.pixelRatio,e.sps=[S];const b=S.subarray(1,4);let T="avc1.";for(let R=0;R<3;R++){let D=b[R].toString(16);D.length<2&&(D="0"+D),T+=D}e.codec=T}break}case 8:o=!0,e.pps=[u.data];break;case 9:o=!0,e.audFound=!0,(p=a)!=null&&p.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(u)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new qy(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,i=8,s;for(let a=0;a<e;a++)i!==0&&(s=t.readEG(),i=(n+s+256)%256),n=i===0?n:i}readSPS(e){const t=new qy(e);let n=0,i=0,s=0,a=0,o,c,u;const h=t.readUByte.bind(t),p=t.readBits.bind(t),v=t.readUEG.bind(t),y=t.readBoolean.bind(t),x=t.skipBits.bind(t),S=t.skipEG.bind(t),E=t.skipUEG.bind(t),b=this.skipScalingList.bind(this);h();const T=h();if(p(5),x(3),h(),E(),T===100||T===110||T===122||T===244||T===44||T===83||T===86||T===118||T===128){const U=v();if(U===3&&x(1),E(),E(),x(1),y())for(c=U!==3?8:12,u=0;u<c;u++)y()&&(u<6?b(16,t):b(64,t))}E();const R=v();if(R===0)v();else if(R===1)for(x(1),S(),S(),o=v(),u=0;u<o;u++)S();E(),x(1);const D=v(),P=v(),O=p(1);O===0&&x(1),x(1),y()&&(n=v(),i=v(),s=v(),a=v());let N=[1,1];if(y()&&y())switch(h()){case 1:N=[1,1];break;case 2:N=[12,11];break;case 3:N=[10,11];break;case 4:N=[16,11];break;case 5:N=[40,33];break;case 6:N=[24,11];break;case 7:N=[20,11];break;case 8:N=[32,11];break;case 9:N=[80,33];break;case 10:N=[18,11];break;case 11:N=[15,11];break;case 12:N=[64,33];break;case 13:N=[160,99];break;case 14:N=[4,3];break;case 15:N=[3,2];break;case 16:N=[2,1];break;case 255:{N=[h()<<8|h(),h()<<8|h()];break}}return{width:Math.ceil((D+1)*16-n*2-i*2),height:(2-O)*(P+1)*16-(O?2:4)*(s+a),pixelRatio:N}}}class Pj extends VU{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,i){const s=this.parseNALu(e,n.data,i);let a=this.VideoSample,o,c=!1;n.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(u=>{var h,p;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,c){var v;(v=a)!=null&&v.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,qD(u.data,2,n.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Gi(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(o=!0,c=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const y=this.readSPS(u.data);e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.codec=y.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const x in y.params)e.params[x]=y.params[x]}this.pushParameterSet(e.sps,u.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const y=this.readPPS(u.data);for(const x in y)e.params[x]=y[x]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(p=a)!=null&&p.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:o=!1;break}a&&o&&a.units.push(u)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let i=0;i<e.byteLength;i++)i>=2&&e[i]===3&&e[i-1]===0&&e[i-2]===0||(t[n]=e[i],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new qy(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),i=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:i}}readSPS(e){const t=new qy(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const i=t.readBits(2),s=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),c=t.readUByte(),u=t.readUByte(),h=t.readUByte(),p=t.readUByte(),v=t.readUByte(),y=t.readUByte(),x=t.readUByte(),S=t.readUByte(),E=t.readUByte(),b=t.readUByte(),T=[],R=[];for(let Oe=0;Oe<n;Oe++)T.push(t.readBoolean()),R.push(t.readBoolean());if(n>0)for(let Oe=n;Oe<8;Oe++)t.readBits(2);for(let Oe=0;Oe<n;Oe++)T[Oe]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),R[Oe]&&t.readUByte();t.readUEG();const D=t.readUEG();D==3&&t.skipBits(1);const P=t.readUEG(),O=t.readUEG(),N=t.readBoolean();let U=0,B=0,I=0,z=0;N&&(U+=t.readUEG(),B+=t.readUEG(),I+=t.readUEG(),z+=t.readUEG());const W=t.readUEG(),Z=t.readUEG(),te=t.readUEG(),re=t.readBoolean();for(let Oe=re?0:n;Oe<=n;Oe++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let ue=0;ue<4;ue++)for(let st=0;st<(ue===3?2:6);st++)if(!t.readBoolean())t.readUEG();else{const _t=Math.min(64,1<<4+(ue<<1));ue>1&&t.readEG();for(let it=0;it<_t;it++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const J=t.readUEG();let oe=0;for(let Oe=0;Oe<J;Oe++){let ue=!1;if(Oe!==0&&(ue=t.readBoolean()),ue){Oe===J&&t.readUEG(),t.readBoolean(),t.readUEG();let st=0;for(let $e=0;$e<=oe;$e++){const _t=t.readBoolean();let it=!1;_t||(it=t.readBoolean()),(_t||it)&&st++}oe=st}else{const st=t.readUEG(),$e=t.readUEG();oe=st+$e;for(let _t=0;_t<st;_t++)t.readUEG(),t.readBoolean();for(let _t=0;_t<$e;_t++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Oe=t.readUEG();for(let ue=0;ue<Oe;ue++){for(let st=0;st<te+4;st++)t.readBits(1);t.readBits(1)}}let X=0,ne=1,xe=1,_e=!0,Be=1,pe=0;t.readBoolean(),t.readBoolean();let be=!1;if(t.readBoolean()){if(t.readBoolean()){const Tt=t.readUByte(),se=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],q=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Tt>0&&Tt<16?(ne=se[Tt-1],xe=q[Tt-1]):Tt===255&&(ne=t.readBits(16),xe=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),be=t.readBoolean(),be&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(Be=t.readBits(32),pe=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const q=t.readBoolean(),Ee=t.readBoolean();let Ge=!1;(q||Ee)&&(Ge=t.readBoolean(),Ge&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Ge&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Ve=0;Ve<=n;Ve++){_e=t.readBoolean();const Pe=_e||t.readBoolean();let wt=!1;Pe?t.readEG():wt=t.readBoolean();const bt=wt?1:t.readUEG()+1;if(q)for(let Ft=0;Ft<bt;Ft++)t.readUEG(),t.readUEG(),Ge&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Ee)for(let Ft=0;Ft<bt;Ft++)t.readUEG(),t.readUEG(),Ge&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),X=t.readUEG())}let gt=P,St=O;if(N){let Oe=1,ue=1;D===1?Oe=ue=2:D==2&&(Oe=2),gt=P-Oe*B-Oe*U,St=O-ue*z-ue*I}const At=i?["A","B","C"][i]:"",jt=o<<24|c<<16|u<<8|h;let vt=0;for(let Oe=0;Oe<32;Oe++)vt=(vt|(jt>>Oe&1)<<31-Oe)>>>0;let ze=vt.toString(16);return a===1&&ze==="2"&&(ze="6"),{codecString:`hvc1.${At}${a}.${ze}.${s?"H":"L"}${b}.B0`,params:{general_tier_flag:s,general_profile_idc:a,general_profile_space:i,general_profile_compatibility_flags:[o,c,u,h],general_constraint_indicator_flags:[p,v,y,x,S,E],general_level_idc:b,bit_depth:W+8,bit_depth_luma_minus8:W,bit_depth_chroma_minus8:Z,min_spatial_segmentation_idc:X,chroma_format_idc:D,frame_rate:{fixed:_e,fps:pe/Be}},width:gt,height:St,pixelRatio:[ne,xe]}}readPPS(e){const t=new qy(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const i=t.readBoolean(),s=t.readBoolean();let a=1;return s&&i?a=0:s?a=3:i&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const _r=188;class gh{constructor(e,t,n,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=i,this.videoParser=null}static probe(e,t){const n=gh.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(_r*5,t-_r)+1,i=0;for(;i<n;){let s=!1,a=-1,o=0;for(let c=i;c<t;c+=_r)if(e[c]===71&&(t-c===_r||e[c+_r]===71)){if(o++,a===-1&&(a=c,a!==0&&(n=Math.min(a+_r*99,e.length-_r)+1)),s||(s=oR(e,c)===0),s&&o>1&&(a===0&&o>2||c+_r>n))return a}else{if(o)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:jN[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=gh.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=gh.createTrack("audio",i),this._id3Track=gh.createTrack("id3"),this._txtTrack=gh.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,i=!1){n||(this.sampleAes=null);let s;const a=this._videoTrack,o=this._audioTrack,c=this._id3Track,u=this._txtTrack;let h=a.pid,p=a.pesData,v=o.pid,y=c.pid,x=o.pesData,S=c.pesData,E=null,b=this.pmtParsed,T=this._pmtId,R=e.length;if(this.remainderData&&(e=bl(this.remainderData,e),R=e.length,this.remainderData=null),R<_r&&!i)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:c,textTrack:u};const D=Math.max(0,gh.syncOffset(e));R-=(R-D)%_r,R<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,R,e.buffer.byteLength-R));let P=0;for(let N=D;N<R;N+=_r)if(e[N]===71){const U=!!(e[N+1]&64),B=oR(e,N),I=(e[N+3]&48)>>4;let z;if(I>1){if(z=N+5+e[N+4],z===N+_r)continue}else z=N+4;switch(B){case h:U&&(p&&(s=M0(p,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,u,s,!1)),p={data:[],size:0}),p&&(p.data.push(e.subarray(z,N+_r)),p.size+=N+_r-z);break;case v:if(U){if(x&&(s=M0(x,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,s);break;case"mp3":this.parseMPEGPES(o,s);break;case"ac3":this.parseAC3PES(o,s);break}x={data:[],size:0}}x&&(x.data.push(e.subarray(z,N+_r)),x.size+=N+_r-z);break;case y:U&&(S&&(s=M0(S,this.logger))&&this.parseID3PES(c,s),S={data:[],size:0}),S&&(S.data.push(e.subarray(z,N+_r)),S.size+=N+_r-z);break;case 0:U&&(z+=e[z]+1),T=this._pmtId=Nj(e,z);break;case T:{U&&(z+=e[z]+1);const W=Uj(e,z,this.typeSupported,n,this.observer,this.logger);h=W.videoPid,h>0&&(a.pid=h,a.segmentCodec=W.segmentVideoCodec),v=W.audioPid,v>0&&(o.pid=v,o.segmentCodec=W.segmentAudioCodec),y=W.id3Pid,y>0&&(c.pid=y),E!==null&&!b&&(this.logger.warn(`MPEG-TS PMT found at ${N} after unknown PID '${E}'. Backtracking to sync byte @${D} to parse all TS packets.`),E=null,N=D-188),b=this.pmtParsed=!0;break}case 17:case 8191:break;default:E=B;break}}else P++;P>0&&lR(this.observer,new Error(`Found ${P} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=p,o.pesData=x,c.pesData=S;const O={audioTrack:o,videoTrack:a,id3Track:c,textTrack:u};return i&&this.extractRemainingSamples(O),O}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:i,textTrack:s}=e,a=n.pesData,o=t.pesData,c=i.pesData;let u;if(a&&(u=M0(a,this.logger))?(this.readyVideoParser(n.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(n,s,u,!0),n.pesData=null)):n.pesData=a,o&&(u=M0(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;c&&(u=M0(c,this.logger))?(this.parseID3PES(i,u),i.pesData=null):i.pesData=c}demuxSampleAes(e,t,n){const i=this.demux(e,n,!0,!this.config.progressive),s=this.sampleAes=new Bj(this.observer,this.config,t);return this.decrypt(i,s)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new Oj:e==="hevc"&&(this.videoParser=new Pj))}decrypt(e,t){return new Promise(n=>{const{audioTrack:i,videoTrack:s}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{n(e)}):n(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const i=this.aacOverFlow;let s=t.data;if(i){this.aacOverFlow=null;const p=i.missing,v=i.sample.unit.byteLength;if(p===-1)s=bl(i.sample.unit,s);else{const y=v-p;i.sample.unit.set(s.subarray(0,p),y),e.samples.push(i.sample),n=i.missing}}let a,o;for(a=n,o=s.length;a<o-1&&!Ab(s,a);a++);if(a!==n){let p;const v=a<o-1;if(v?p=`AAC PES did not start with ADTS header,offset:${a}`:p="No ADTS header found in AAC PES",lR(this.observer,new Error(p),v,this.logger),!v)return}IU(e,this.observer,s,a,this.audioCodec);let c;if(t.pts!==void 0)c=t.pts;else if(i){const p=BU(e.samplerate);c=i.sample.pts+p}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,h;for(;a<o;)if(h=OU(e,s,a,c,u),a+=h.length,h.missing){this.aacOverFlow=h;break}else for(u++;a<o-1&&!Ab(s,a);a++);}parseMPEGPES(e,t){const n=t.data,i=n.length;let s=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<i;)if(kU(n,a)){const c=UU(e,n,a,o,s);if(c)a+=c.length,s++;else break}else a++}parseAC3PES(e,t){{const n=t.data,i=t.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=n.length;let a=0,o=0,c;for(;o<s&&(c=zU(e,n,o,i,a++))>0;)o+=c}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=Gi({},t,{type:this._videoTrack?io.emsg:io.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function oR(r,e){return((r[e+1]&31)<<8)+r[e+2]}function Nj(r,e){return(r[e+10]&31)<<8|r[e+11]}function Uj(r,e,t,n,i,s){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(r[e+1]&15)<<8|r[e+2],c=e+3+o-4,u=(r[e+10]&15)<<8|r[e+11];for(e+=12+u;e<c;){const h=oR(r,e),p=(r[e+3]&15)<<8|r[e+4];switch(r[e]){case 207:if(!n){zM("ADTS AAC",s);break}case 15:a.audioPid===-1&&(a.audioPid=h);break;case 21:a.id3Pid===-1&&(a.id3Pid=h);break;case 219:if(!n){zM("H.264",s);break}case 27:a.videoPid===-1&&(a.videoPid=h);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=h,a.segmentAudioCodec="mp3");break;case 193:if(!n){zM("AC-3",s);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=h,a.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&p>0){let v=e+5,y=p;for(;y>2;){switch(r[v]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=h,a.segmentAudioCodec="ac3");break}const S=r[v+1]+2;v+=S,y-=S}}break;case 194:case 135:return lR(i,new Error("Unsupported EC-3 in M2TS found"),void 0,s),a;case 36:a.videoPid===-1&&(a.videoPid=h,a.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=p+5}return a}function lR(r,e,t,n){n.warn(`parsing error: ${e.message}`),r.emit(H.ERROR,H.ERROR,{type:rn.MEDIA_ERROR,details:Ie.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function zM(r,e){e.log(`${r} with AES-128-CBC encryption found in unencrypted stream`)}function M0(r,e){let t=0,n,i,s,a,o;const c=r.data;if(!r||r.size===0)return null;for(;c[0].length<19&&c.length>1;)c[0]=bl(c[0],c[1]),c.splice(1,1);if(n=c[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(i=(n[4]<<8)+n[5],i&&i>r.size-6)return null;const h=n[7];h&192&&(a=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,h&64?(o=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),s=n[8];let p=s+9;if(r.size<=p)return null;r.size-=p;const v=new Uint8Array(r.size);for(let y=0,x=c.length;y<x;y++){n=c[y];let S=n.byteLength;if(p)if(p>S){p-=S;continue}else n=n.subarray(p),S-=p,p=0;v.set(n,t),t+=S}return i&&(i-=s+3),{data:v,pts:a,dts:o,len:i}}return null}class Fj{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const hh=Math.pow(2,32)-1;class we{static init(){we.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in we.types)we.types.hasOwnProperty(e)&&(we.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);we.HDLR_TYPES={video:t,audio:n};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);we.STTS=we.STSC=we.STCO=s,we.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),we.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),we.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),we.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);we.FTYP=we.box(we.types.ftyp,a,c,a,o),we.DINF=we.box(we.types.dinf,we.box(we.types.dref,i))}static box(e,...t){let n=8,i=t.length;const s=i;for(;i--;)n+=t[i].byteLength;const a=new Uint8Array(n);for(a[0]=n>>24&255,a[1]=n>>16&255,a[2]=n>>8&255,a[3]=n&255,a.set(e,4),i=0,n=8;i<s;i++)a.set(t[i],n),n+=t[i].byteLength;return a}static hdlr(e){return we.box(we.types.hdlr,we.HDLR_TYPES[e])}static mdat(e){return we.box(we.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(hh+1)),i=Math.floor(t%(hh+1));return we.box(we.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return we.box(we.types.mdia,we.mdhd(e.timescale||0,e.duration||0),we.hdlr(e.type),we.minf(e))}static mfhd(e){return we.box(we.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?we.box(we.types.minf,we.box(we.types.smhd,we.SMHD),we.DINF,we.stbl(e)):we.box(we.types.minf,we.box(we.types.vmhd,we.VMHD),we.DINF,we.stbl(e))}static moof(e,t,n){return we.box(we.types.moof,we.mfhd(e),we.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=we.trak(e[t]);return we.box.apply(null,[we.types.moov,we.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(we.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=we.trex(e[t]);return we.box.apply(null,[we.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(hh+1)),i=Math.floor(t%(hh+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return we.box(we.types.mvhd,s)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let i,s;for(i=0;i<t.length;i++)s=t[i].flags,n[i+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return we.box(we.types.sdtp,n)}static stbl(e){return we.box(we.types.stbl,we.stsd(e),we.box(we.types.stts,we.STTS),we.box(we.types.stsc,we.STSC),we.box(we.types.stsz,we.STSZ),we.box(we.types.stco,we.STCO))}static avc1(e){let t=[],n=[],i,s,a;for(i=0;i<e.sps.length;i++)s=e.sps[i],a=s.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(s));for(i=0;i<e.pps.length;i++)s=e.pps[i],a=s.byteLength,n.push(a>>>8&255),n.push(a&255),n=n.concat(Array.prototype.slice.call(s));const o=we.box(we.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),c=e.width,u=e.height,h=e.pixelRatio[0],p=e.pixelRatio[1];return we.box(we.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,we.box(we.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),we.box(we.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return we.box(we.types.mp4a,we.audioStsd(e),we.box(we.types.esds,we.esds(e)))}static mp3(e){return we.box(we.types[".mp3"],we.audioStsd(e))}static ac3(e){return we.box(we.types["ac-3"],we.audioStsd(e),we.box(we.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return we.box(we.types.stsd,we.STSD,we.mp4a(e));if(t==="ac3"&&e.config)return we.box(we.types.stsd,we.STSD,we.ac3(e));if(t==="mp3"&&e.codec==="mp3")return we.box(we.types.stsd,we.STSD,we.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return we.box(we.types.stsd,we.STSD,we.avc1(e));if(t==="hevc"&&e.vps)return we.box(we.types.stsd,we.STSD,we.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),i=e.width||0,s=e.height||0,a=Math.floor(n/(hh+1)),o=Math.floor(n%(hh+1));return we.box(we.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const n=we.sdtp(e),i=e.id,s=Math.floor(t/(hh+1)),a=Math.floor(t%(hh+1));return we.box(we.types.traf,we.box(we.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),we.box(we.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255])),we.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,we.box(we.types.trak,we.tkhd(e),we.mdia(e))}static trex(e){const t=e.id;return we.box(we.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],i=n.length,s=12+16*i,a=new Uint8Array(s);let o,c,u,h,p,v;for(t+=8+s,a.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<i;o++)c=n[o],u=c.duration,h=c.size,p=c.flags,v=c.cts,a.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*o);return we.box(we.types.trun,a)}static initSegment(e){we.types||we.init();const t=we.moov(e);return bl(we.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],i=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),i-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let a=s.length;for(let x=0;x<n.length;x+=1){a+=3;for(let S=0;S<n[x].length;S+=1)a+=2+n[x][S].length}const o=new Uint8Array(a);o.set(s,0),a=s.length;const c=n.length-1;for(let x=0;x<n.length;x+=1){o.set(new Uint8Array([32+x|(x===c?128:0),0,n[x].length]),a),a+=3;for(let S=0;S<n[x].length;S+=1)o.set(new Uint8Array([n[x][S].length>>8,n[x][S].length&255]),a),a+=2,o.set(n[x][S],a),a+=n[x][S].length}const u=we.box(we.types.hvcC,o),h=e.width,p=e.height,v=e.pixelRatio[0],y=e.pixelRatio[1];return we.box(we.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,we.box(we.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),we.box(we.types.pasp,new Uint8Array([v>>24,v>>16&255,v>>8&255,v&255,y>>24,y>>16&255,y>>8&255,y&255])))}}we.types=void 0;we.HDLR_TYPES=void 0;we.STTS=void 0;we.STSC=void 0;we.STCO=void 0;we.STSZ=void 0;we.VMHD=void 0;we.SMHD=void 0;we.STSD=void 0;we.FTYP=void 0;we.DINF=void 0;const YU=9e4;function lL(r,e,t=1,n=!1){const i=r*e*t;return n?Math.round(i):i}function kj(r,e,t=1,n=!1){return lL(r,e,1/t,n)}function yy(r,e=!1){return lL(r,1e3,1/YU,e)}function Gj(r,e=1){return lL(r,YU,1/e)}function W3(r){const{baseTime:e,timescale:t,trackId:n}=r;return`${e/t} (${e}/${t}) trackId: ${n}`}const Hj=10*1e3,zj=1024,Vj=1152,Yj=1536;let C0=null,VM=null;function J3(r,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:r?2:1,isNonSync:r?0:1}}}class rE extends Cl{constructor(e,t,n,i){if(super("mp4-remuxer",i),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,C0===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);C0=a?parseInt(a[1]):0}if(VM===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);VM=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&W3(t)} > ${e&&W3(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,i=e.reduce((s,a)=>{let o=a.pts,c=o-s;return c<-4294967296&&(t=!0,o=Do(o,n),c=o-s),c>0?s:o},n);return t&&this.debug("PTS rollover detected"),i}remux(e,t,n,i,s,a,o,c){let u,h,p,v,y,x,S=s,E=s;const b=e.pid>-1,T=t.pid>-1,R=t.samples.length,D=e.samples.length>0,P=o&&R>0||R>1;if((!b||D)&&(!T||P)||this.ISGenerated||o){if(this.ISGenerated){var N,U,B,I;const te=this.videoTrackConfig;(te&&(t.width!==te.width||t.height!==te.height||((N=t.pixelRatio)==null?void 0:N[0])!==((U=te.pixelRatio)==null?void 0:U[0])||((B=t.pixelRatio)==null?void 0:B[1])!==((I=te.pixelRatio)==null?void 0:I[1]))||!te&&P||this.nextAudioTs===null&&D)&&this.resetInitSegment()}this.ISGenerated||(p=this.generateIS(e,t,s,a));const z=this.isVideoContiguous;let W=-1,Z;if(P&&(W=Xj(t.samples),!z&&this.config.forceKeyFrameOnDiscontinuity))if(x=!0,W>0){this.warn(`Dropped ${W} out of ${R} video samples due to a missing keyframe`);const te=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(W),t.dropped+=W,E+=(t.samples[0].pts-te)/t.inputTimeScale,Z=E}else W===-1&&(this.warn(`No keyframe found out of ${R} video samples`),x=!1);if(this.ISGenerated){if(D&&P){const te=this.getVideoStartPts(t.samples),k=(Do(e.samples[0].pts,te)-te)/t.inputTimeScale;S+=Math.max(0,k),E+=Math.max(0,-k)}if(D){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),p=this.generateIS(e,t,s,a)),h=this.remuxAudio(e,S,this.isAudioContiguous,a,T||P||c===qt.AUDIO?E:void 0),P){const te=h?h.endPTS-h.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),p=this.generateIS(e,t,s,a)),u=this.remuxVideo(t,E,z,te)}}else P&&(u=this.remuxVideo(t,E,z,0));u&&(u.firstKeyFrame=W,u.independent=W!==-1,u.firstKeyFramePTS=Z)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(y=XU(n,s,this._initPTS,this._initDTS)),i.samples.length&&(v=KU(i,s,this._initPTS))),{audio:h,video:u,initSegment:p,independent:x,text:v,id3:y}}computeInitPts(e,t,n,i){const s=Math.round(n*t);let a=Do(e,s);if(a<s+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(s-a)/t} ${i}`);a<s+t;)a+=8589934592;return a-s}generateIS(e,t,n,i){const s=e.samples,a=t.samples,o=this.typeSupported,c={},u=this._initPTS;let h=!u||i,p="audio/mp4",v,y,x,S=-1;if(h&&(v=y=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(p="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}c.audio={id:"audio",container:p,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):we.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(S=e.id,x=e.inputTimeScale,!u||x!==u.timescale?v=y=this.computeInitPts(s[0].pts,x,n,"audio"):h=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:we.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(S=t.id,x=t.inputTimeScale,!u||x!==u.timescale){const E=this.getVideoStartPts(a),b=Do(a[0].dts,E),T=this.computeInitPts(b,x,n,"video"),R=this.computeInitPts(E,x,n,"video");y=Math.min(y,T),v=Math.min(v,R)}else h=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(c).length)return this.ISGenerated=!0,h?(u&&this.warn(`Timestamps at playlist time: ${i?"":"~"}${n} ${v/x} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${v/x} (${v}/${x}) trackId: ${S}`),this._initPTS={baseTime:v,timescale:x,trackId:S},this._initDTS={baseTime:y,timescale:x,trackId:S}):v=x=void 0,{tracks:c,initPTS:v,timescale:x,trackId:S}}remuxVideo(e,t,n,i){const s=e.inputTimeScale,a=e.samples,o=[],c=a.length,u=this._initPTS,h=u.baseTime*s/u.timescale;let p=this.nextVideoTs,v=8,y=this.videoSampleDuration,x,S,E=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY,T=!1;if(!n||p===null){const X=h+t*s,ne=a[0].pts-Do(a[0].dts,a[0].pts);C0&&p!==null&&Math.abs(X-ne-(p+h))<15e3?n=!0:p=X-ne-h}const R=p+h;for(let X=0;X<c;X++){const ne=a[X];ne.pts=Do(ne.pts,R),ne.dts=Do(ne.dts,R),ne.dts<a[X>0?X-1:X].dts&&(T=!0)}T&&a.sort(function(X,ne){const xe=X.dts-ne.dts,_e=X.pts-ne.pts;return xe||_e}),x=a[0].dts,S=a[a.length-1].dts;const D=S-x,P=D?Math.round(D/(c-1)):y||e.inputTimeScale/30;if(n){const X=x-R,ne=X>P,xe=X<-1;if((ne||xe)&&(ne?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${yy(X,!0)} ms (${X}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${yy(-X,!0)} ms (${X}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!xe||R>=a[0].pts||C0)){x=R;const _e=a[0].pts-X;if(ne)a[0].dts=x,a[0].pts=_e;else{let Be=!0;for(let pe=0;pe<a.length&&!(a[pe].dts>_e&&Be);pe++){const be=a[pe].pts;if(a[pe].dts-=X,a[pe].pts-=X,pe<a.length-1){const je=a[pe+1].pts,gt=a[pe].pts,St=je<=gt,At=je<=be;Be=St==At}}}this.log(`Video: Initial PTS/DTS adjusted: ${yy(_e,!0)}/${yy(x,!0)}, delta: ${yy(X,!0)} ms`)}}x=Math.max(0,x);let O=0,N=0,U=x;for(let X=0;X<c;X++){const ne=a[X],xe=ne.units,_e=xe.length;let Be=0;for(let pe=0;pe<_e;pe++)Be+=xe[pe].data.length;N+=Be,O+=_e,ne.length=Be,ne.dts<U?(ne.dts=U,U+=P/4|0||1):U=ne.dts,E=Math.min(ne.pts,E),b=Math.max(ne.pts,b)}S=a[c-1].dts;const B=N+4*O+8;let I;try{I=new Uint8Array(B)}catch(X){this.observer.emit(H.ERROR,H.ERROR,{type:rn.MUX_ERROR,details:Ie.REMUX_ALLOC_ERROR,fatal:!1,error:X,bytes:B,reason:`fail allocating video mdat ${B}`});return}const z=new DataView(I.buffer);z.setUint32(0,B),I.set(we.types.mdat,4);let W=!1,Z=Number.POSITIVE_INFINITY,te=Number.POSITIVE_INFINITY,re=Number.NEGATIVE_INFINITY,k=Number.NEGATIVE_INFINITY;for(let X=0;X<c;X++){const ne=a[X],xe=ne.units;let _e=0;for(let be=0,je=xe.length;be<je;be++){const gt=xe[be],St=gt.data,At=gt.data.byteLength;z.setUint32(v,At),v+=4,I.set(St,v),v+=At,_e+=4+At}let Be;if(X<c-1)y=a[X+1].dts-ne.dts,Be=a[X+1].pts-ne.pts;else{const be=this.config,je=X>0?ne.dts-a[X-1].dts:P;if(Be=X>0?ne.pts-a[X-1].pts:P,be.stretchShortVideoTrack&&this.nextAudioTs!==null){const gt=Math.floor(be.maxBufferHole*s),St=(i?E+i*s:this.nextAudioTs+h)-ne.pts;St>gt?(y=St-je,y<0?y=je:W=!0,this.log(`It is approximately ${St/90} ms to the next segment; using duration ${y/90} ms for the last video frame.`)):y=je}else y=je}const pe=Math.round(ne.pts-ne.dts);Z=Math.min(Z,y),re=Math.max(re,y),te=Math.min(te,Be),k=Math.max(k,Be),o.push(J3(ne.key,y,_e,pe))}if(o.length){if(C0){if(C0<70){const X=o[0].flags;X.dependsOn=2,X.isNonSync=0}}else if(VM&&k-te<re-Z&&P/re<.025&&o[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let X=x;for(let ne=0,xe=o.length;ne<xe;ne++){const _e=X+o[ne].duration,Be=X+o[ne].cts;if(ne<xe-1){const pe=_e+o[ne+1].cts;o[ne].duration=pe-Be}else o[ne].duration=ne?o[ne-1].duration:P;o[ne].cts=0,X=_e}}}y=W||!y?P:y;const j=S+y;this.nextVideoTs=p=j-h,this.videoSampleDuration=y,this.isVideoContiguous=!0;const K={data1:we.moof(e.sequenceNumber++,x,Gi(e,{samples:o})),data2:I,startPTS:(E-h)/s,endPTS:(b+y-h)/s,startDTS:(x-h)/s,endDTS:p/s,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,K}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return Vj;case"ac3":return Yj;default:return zj}}remuxAudio(e,t,n,i,s){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,c=a/o,u=this.getSamplesPerFrame(e),h=u*c,p=this._initPTS,v=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,y=[],x=s!==void 0;let S=e.samples,E=v?0:8,b=this.nextAudioTs||-1;const T=p.baseTime*a/p.timescale,R=T+t*a;if(this.isAudioContiguous=n=n||S.length&&b>0&&(i&&Math.abs(R-(b+T))<9e3||Math.abs(Do(S[0].pts,R)-(b+T))<20*h),S.forEach(function(k){k.pts=Do(k.pts,R)}),!n||b<0){const k=S.length;if(S=S.filter(j=>j.pts>=0),k!==S.length&&this.warn(`Removed ${S.length-k} of ${k} samples (initPTS ${T} / ${a})`),!S.length)return;s===0?b=0:i&&!x?b=Math.max(0,R-T):b=S[0].pts-T}if(e.segmentCodec==="aac"){const k=this.config.maxAudioFramesDrift;for(let j=0,J=b+T;j<S.length;j++){const oe=S[j],K=oe.pts,X=K-J,ne=Math.abs(1e3*X/a);if(X<=-k*h&&x)j===0&&(this.warn(`Audio frame @ ${(K/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*X/a)} ms.`),this.nextAudioTs=b=K-T,J=K);else if(X>=k*h&&ne<Hj&&x){let xe=Math.round(X/h);for(J=K-xe*h;J<0&&xe&&h;)xe--,J+=h;j===0&&(this.nextAudioTs=b=J-T),this.warn(`Injecting ${xe} audio frames @ ${((J-T)/a).toFixed(3)}s due to ${Math.round(1e3*X/a)} ms gap.`);for(let _e=0;_e<xe;_e++){let Be=Fj.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);Be||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),Be=oe.unit.subarray()),S.splice(j,0,{unit:Be,pts:J}),J+=h,j++}}oe.pts=J,J+=h}}let D=null,P=null,O,N=0,U=S.length;for(;U--;)N+=S[U].unit.byteLength;for(let k=0,j=S.length;k<j;k++){const J=S[k],oe=J.unit;let K=J.pts;if(P!==null){const ne=y[k-1];ne.duration=Math.round((K-P)/c)}else if(n&&e.segmentCodec==="aac"&&(K=b+T),D=K,N>0){N+=E;try{O=new Uint8Array(N)}catch(ne){this.observer.emit(H.ERROR,H.ERROR,{type:rn.MUX_ERROR,details:Ie.REMUX_ALLOC_ERROR,fatal:!1,error:ne,bytes:N,reason:`fail allocating audio mdat ${N}`});return}v||(new DataView(O.buffer).setUint32(0,N),O.set(we.types.mdat,4))}else return;O.set(oe,E);const X=oe.byteLength;E+=X,y.push(J3(!0,u,X,0)),P=K}const B=y.length;if(!B)return;const I=y[y.length-1];b=P-T,this.nextAudioTs=b+c*I.duration;const z=v?new Uint8Array(0):we.moof(e.sequenceNumber++,D/c,Gi({},e,{samples:y}));e.samples=[];const W=(D-T)/a,Z=this.nextAudioTs/a,re={data1:z,data2:O,startPTS:W,endPTS:Z,startDTS:W,endDTS:Z,type:"audio",hasAudio:!0,hasVideo:!1,nb:B};return this.isAudioContiguous=!0,re}}function Do(r,e){let t;if(e===null)return r;for(e<r?t=-8589934592:t=8589934592;Math.abs(r-e)>4294967296;)r+=t;return r}function Xj(r){for(let e=0;e<r.length;e++)if(r[e].key)return e;return-1}function XU(r,e,t,n){const i=r.samples.length;if(!i)return;const s=r.inputTimeScale;for(let o=0;o<i;o++){const c=r.samples[o];c.pts=Do(c.pts-t.baseTime*s/t.timescale,e*s)/s,c.dts=Do(c.dts-n.baseTime*s/n.timescale,e*s)/s}const a=r.samples;return r.samples=[],{samples:a}}function KU(r,e,t){const n=r.samples.length;if(!n)return;const i=r.inputTimeScale;for(let a=0;a<n;a++){const o=r.samples[a];o.pts=Do(o.pts-t.baseTime*i/t.timescale,e*i)/i}r.samples.sort((a,o)=>a.pts-o.pts);const s=r.samples;return r.samples=[],{samples:s}}class Kj extends Cl{constructor(e,t,n,i){super("passthrough-remuxer",i),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,i){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,i),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:s,video:a}=this.initData=$N(e);if(t)NK(e,t);else{const c=s||a;c!=null&&c.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${c.codec}")!`)}s&&(n=$3(s,qi.AUDIO,this)),a&&(i=$3(a,qi.VIDEO,this));const o={};s&&a?o.audiovideo={container:"video/mp4",codec:n+","+i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:s?o.audio={container:"audio/mp4",codec:n,encrypted:s.encrypted,initSegment:e,id:"audio"}:a?o.video={container:"video/mp4",codec:i,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,n,i,s,a){var o,c;let{initPTS:u,lastEndTime:h}=this;const p={audio:void 0,video:void 0,text:i,id3:n,initSegment:void 0};zt(h)||(h=this.lastEndTime=s||0);const v=t.samples;if(!v.length)return p;const y={initPTS:void 0,timescale:void 0,trackId:void 0};let x=this.initData;if((o=x)!=null&&o.length||(this.generateInitSegment(v),x=this.initData),!((c=x)!=null&&c.length))return this.warn("Failed to generate initSegment."),p;this.emitInitSegment&&(y.tracks=this.initTracks,this.emitInitSegment=!1);const S=FK(v,x,this),E=x.audio?S[x.audio.id]:null,b=x.video?S[x.video.id]:null,T=EA(b,1/0),R=EA(E,1/0),D=EA(b,0,!0),P=EA(E,0,!0);let O=s,N=0;const U=E&&(!b||!u&&R<T||u&&u.trackId===x.audio.id),B=U?E:b;if(B){const J=B.timescale,oe=B.start-s*J,K=U?x.audio.id:x.video.id;O=B.start/J,N=U?P-R:D-T,(a||!u)&&(qj(u,O,s,N)||J!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${s} ${oe/J} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${O-s} (${oe}/${J}) trackId: ${K}`),u=null,y.initPTS=oe,y.timescale=J,y.trackId=K)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${s}`);u?(y.initPTS=u.baseTime,y.timescale=u.timescale,y.trackId=u.trackId):((!y.timescale||y.trackId===void 0||y.initPTS===void 0)&&(this.warn("Could not set initPTS"),y.initPTS=O,y.timescale=1,y.trackId=-1),this.initPTS=u={baseTime:y.initPTS,timescale:y.timescale,trackId:y.trackId});const I=O-u.baseTime/u.timescale,z=I+N;N>0?this.lastEndTime=z:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const W=!!x.audio,Z=!!x.video;let te="";W&&(te+="audio"),Z&&(te+="video");const re=(x.audio?x.audio.encrypted:!1)||(x.video?x.video.encrypted:!1),k={data1:v,startPTS:I,startDTS:I,endPTS:z,endDTS:z,type:te,hasAudio:W,hasVideo:Z,nb:1,dropped:0,encrypted:re};p.audio=W&&!Z?k:void 0,p.video=Z?k:void 0;const j=b?.sampleCount;if(j){const J=b.keyFrameIndex,oe=J!==-1;k.nb=j,k.dropped=J===0||this.isVideoContiguous?0:oe?J:j,k.independent=oe,k.firstKeyFrame=J,oe&&b.keyFrameStart&&(k.firstKeyFramePTS=(b.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(p.independent=oe),this.isVideoContiguous||(this.isVideoContiguous=oe),k.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${J}/${j} dropped: ${k.dropped} start: ${k.firstKeyFramePTS||"NA"}`)}return p.initSegment=y,p.id3=XU(n,s,u,u),i.samples.length&&(p.text=KU(i,s,u)),p}}function EA(r,e,t=!1){return r?.start!==void 0?(r.start+(t?r.duration:0))/r.timescale:e}function qj(r,e,t,n){if(r===null)return!0;const i=Math.max(n,1),s=e-r.baseTime/r.timescale;return Math.abs(s-t)>i}function $3(r,e,t){const n=r.codec;return n&&n.length>4?n:e===qi.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?pb(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let Zu;try{Zu=self.performance.now.bind(self.performance)}catch{Zu=Date.now}const aE=[{demux:Ij,remux:Kj},{demux:gh,remux:rE},{demux:Rj,remux:rE},{demux:Lj,remux:rE}];aE.splice(2,0,{demux:Dj,remux:rE});class Q3{constructor(e,t,n,i,s,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=s,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,i){const s=n.transmuxing;s.executeStart=Zu();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:c}=this;i&&(this.currentTransmuxState=i);const{contiguous:u,discontinuity:h,trackSwitch:p,accurateTimeOffset:v,timeOffset:y,initSegmentChange:x}=i||o,{audioCodec:S,videoCodec:E,defaultInitPts:b,duration:T,initSegmentData:R}=c,D=jj(a,t);if(D&&V0(D.method)){const U=this.getDecrypter(),B=ZD(D.method);if(U.isSync()){let I=U.softwareDecrypt(a,D.key.buffer,D.iv.buffer,B);if(n.part>-1){const W=U.flush();I=W&&W.buffer}if(!I)return s.executeEnd=Zu(),YM(n);a=new Uint8Array(I)}else return this.asyncResult=!0,this.decryptionPromise=U.webCryptoDecrypt(a,D.key.buffer,D.iv.buffer,B).then(I=>{const z=this.push(I,null,n);return this.decryptionPromise=null,z}),this.decryptionPromise}const P=this.needsProbing(h,p);if(P){const U=this.configureTransmuxer(a);if(U)return this.logger.warn(`[transmuxer] ${U.message}`),this.observer.emit(H.ERROR,H.ERROR,{type:rn.MEDIA_ERROR,details:Ie.FRAG_PARSING_ERROR,fatal:!1,error:U,reason:U.message}),s.executeEnd=Zu(),YM(n)}(h||p||x||P)&&this.resetInitSegment(R,S,E,T,t),(h||x||P)&&this.resetInitialTimestamp(b),u||this.resetContiguity();const O=this.transmux(a,D,y,v,n);this.asyncResult=Ax(O);const N=this.currentTransmuxState;return N.contiguous=!0,N.discontinuity=!1,N.trackSwitch=!1,s.executeEnd=Zu(),O}flush(e){const t=e.transmuxing;t.executeStart=Zu();const{decrypter:n,currentTransmuxState:i,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const a=[],{timeOffset:o}=i;if(n){const p=n.flush();p&&a.push(this.push(p.buffer,null,e))}const{demuxer:c,remuxer:u}=this;if(!c||!u){t.executeEnd=Zu();const p=[YM(e)];return this.asyncResult?Promise.resolve(p):p}const h=c.flush(o);return Ax(h)?(this.asyncResult=!0,h.then(p=>(this.flushRemux(a,p,e),a))):(this.flushRemux(a,h,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,n){const{audioTrack:i,videoTrack:s,id3Track:a,textTrack:o}=t,{accurateTimeOffset:c,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===qt.MAIN?"level":"track"} ${n.level}`);const h=this.remuxer.remux(i,s,a,o,u,c,!0,this.id);e.push({remuxResult:h,chunkMeta:n}),n.transmuxing.executeEnd=Zu()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,i,s){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,n,i),o.resetInitSegment(e,t,n,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,i,s){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,n,i,s):a=this.transmuxUnencrypted(e,n,i,s),a}transmuxUnencrypted(e,t,n,i){const{audioTrack:s,videoTrack:a,id3Track:o,textTrack:c}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,a,o,c,t,n,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,n,i,s){return this.demuxer.demuxSampleAes(e,t,n).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,n,i,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:i}=this;let s;for(let p=0,v=aE.length;p<v;p++){var a;if((a=aE[p].demux)!=null&&a.probe(e,this.logger)){s=aE[p];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,c=this.remuxer,u=s.remux,h=s.demux;(!c||!(c instanceof u))&&(this.remuxer=new u(n,t,i,this.logger)),(!o||!(o instanceof h))&&(this.demuxer=new h(n,t,i,this.logger),this.probe=h.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new $D(this.config)),e}}function jj(r,e){let t=null;return r.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const YM=r=>({remuxResult:{},chunkMeta:r});function Ax(r){return"then"in r&&r.then instanceof Function}class Wj{constructor(e,t,n,i,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=i,this.defaultInitPts=s||null}}class Jj{constructor(e,t,n,i,s,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=s,this.initSegmentChange=a}}let Z3=0;class qU{constructor(e,t,n,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Z3++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=c=>{const u=c.data,h=this.hls;if(!(!h||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var p;const v=(p=this.workerContext)==null?void 0:p.objectURL;v&&self.URL.revokeObjectURL(v);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{h.logger[u.data.logType]&&h.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,h.trigger(u.event,u.data);break}}},this.onWorkerError=c=>{if(!this.hls)return;const u=new Error(`${c.message}  (${c.filename}:${c.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(H.ERROR,{type:rn.OTHER_ERROR,details:Ie.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;const a=(c,u)=>{u=u||{},u.frag=this.frag||void 0,c===H.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(c,u)};this.observer=new nL,this.observer.on(H.FRAG_DECRYPTED,a),this.observer.on(H.ERROR,a);const o=m3(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const c=this.hls.logger;if(s.workerPath||ej()){try{s.workerPath?(c.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=nj(s.workerPath)):(c.log(`injecting Web Worker for "${t}"`),this.workerContext=tj());const{worker:h}=this.workerContext;h.addEventListener("message",this.onWorkerMessage),h.addEventListener("error",this.onWorkerError),h.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:ji(s)})}catch(h){c.warn(`Error setting up "${t}" Web Worker, fallback to inline`,h),this.terminateWorker(),this.error=null,this.transmuxer=new Q3(this.observer,o,s,"",t,e.logger)}return}}this.transmuxer=new Q3(this.observer,o,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Z3++;const t=this.hls.config,n=m3(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:ji(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),ij(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,i,s,a,o,c,u,h){var p,v;u.transmuxing.start=self.performance.now();const{instanceNo:y,transmuxer:x}=this,S=a?a.start:s.start,E=s.decryptdata,b=this.frag,T=!(b&&s.cc===b.cc),R=!(b&&u.level===b.level),D=b?u.sn-b.sn:-1,P=this.part?u.part-this.part.index:-1,O=D===0&&u.id>1&&u.id===b?.stats.chunkCount,N=!R&&(D===1||D===0&&(P===1||O&&P<=0)),U=self.performance.now();(R||D||s.stats.parsing.start===0)&&(s.stats.parsing.start=U),a&&(P||!N)&&(a.stats.parsing.start=U);const B=!(b&&((p=s.initSegment)==null?void 0:p.url)===((v=b.initSegment)==null?void 0:v.url)),I=new Jj(T,N,c,R,S,B);if(!N||T||B){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===qt.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${T}
        trackSwitch: ${R}
        contiguous: ${N}
        accurateTimeOffset: ${c}
        timeOffset: ${S}
        initSegmentChange: ${B}`);const z=new Wj(n,i,t,o,h);this.configureTransmuxer(z)}if(this.frag=s,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:y,cmd:"demux",data:e,decryptdata:E,chunkMeta:u,state:I},e instanceof ArrayBuffer?[e]:[]);else if(x){const z=x.push(e,E,u,I);Ax(z)?z.then(W=>{this.handleTransmuxComplete(W)}).catch(W=>{this.transmuxerError(W,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(z)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const i=n.flush(e);Ax(i)?i.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(i,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(H.ERROR,{type:rn.MEDIA_ERROR,details:Ie.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const eB=100;class jU extends AT{constructor(e,t,n){super(e,t,n,"audio-stream-controller",qt.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(H.LEVEL_LOADED,this.onLevelLoaded,this),e.on(H.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(H.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(H.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(H.BUFFER_RESET,this.onBufferReset,this),e.on(H.BUFFER_CREATED,this.onBufferCreated,this),e.on(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(H.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(H.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(H.FRAG_LOADING,this.onFragLoading,this),e.on(H.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(H.LEVEL_LOADED,this.onLevelLoaded,this),e.off(H.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(H.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(H.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(H.BUFFER_RESET,this.onBufferReset,this),e.off(H.BUFFER_CREATED,this.onBufferCreated,this),e.off(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(H.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(H.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(H.FRAG_LOADING,this.onFragLoading,this),e.off(H.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:s,trackId:a}){if(n===qt.MAIN){const o=t.cc,c=this.fragCurrent;if(this.initPTS[o]={baseTime:i,timescale:s,trackId:a},this.log(`InitPTS for cc: ${o} found from main: ${i/s} (${i}/${s}) trackId: ${a}`),this.mainAnchor=t,this.state===lt.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==o)&&this.syncWithAnchor(t,u?.frag)}else!this.hls.hasEnoughToStart&&c&&c.cc!==o?(c.abortRequests(),this.syncWithAnchor(t,c)):this.state===lt.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const i=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&i?.cc===t.cc)return;const s=(i||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),c=cU(a,s,o);c&&(this.log(`Syncing with main frag at ${c.start} cc ${c.cc}`),this.startFragRequested=!1,this.nextLoadPosition=c.start,this.resetLoadingState(),this.state===lt.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=lt.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(eB),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=lt.IDLE):this.state=lt.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case lt.IDLE:this.doTickIdle();break;case lt.WAITING_TRACK:{const{levels:e,trackId:t}=this,n=e?.[t],i=n?.details;if(i&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(i))break;this.state=lt.WAITING_INIT_PTS}break}case lt.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case lt.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:i,complete:s}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=lt.FRAG_LOADING;const o=i.flush().buffer,c={frag:t,part:n,payload:o,networkDetails:null};this._handleFragmentLoadProgress(c),s&&super._handleFragmentLoadComplete(c)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=lt.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:i,trackId:s}=this,a=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(n!=null&&n[s]))return;const o=n[s],c=o.details;if(!c||this.waitForLive(o)||this.waitForCdnTuneIn(c)){this.state=lt.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,qi.AUDIO,qt.AUDIO));const h=this.getFwdBufferInfo(u,qt.AUDIO);if(h===null)return;if(!this.switchingTrack&&this._streamEnded(h,c)){t.trigger(H.BUFFER_EOS,{type:"audio"}),this.state=lt.ENDED;return}const p=h.len,v=t.maxBufferLength,y=c.fragments,x=y[0].start,S=this.getLoadPosition(),E=this.flushing?S:h.end;if(this.switchingTrack&&i){const R=S;c.PTSKnown&&R<x&&(h.end>x||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=x+.05)}if(p>=v&&!this.switchingTrack&&E<y[y.length-1].start)return;let b=this.getNextFragment(E,c);if(b&&this.isLoopLoading(b,E)&&(b=this.getNextFragmentLoopLoading(b,c,h,qt.MAIN,v)),!b){this.bufferFlushed=!0;return}let T=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&T&&Ps(b)&&!b.endList&&(!c.live||!this.loadingParts&&E<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(T)===rr.OK&&(this.mainFragLoading=T=null),T&&Ps(T))){if(b.start>T.end){const D=this.fragmentTracker.getFragAtPos(E,qt.MAIN);D&&D.end>T.end&&(T=D,this.mainFragLoading={frag:D,targetBufferTime:null})}if(b.start>T.end)return}this.loadFragment(b,o,E)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new mg(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==lt.STOPPED&&(this.setInterval(eB),this.state=lt.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(H.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:i}=this,{details:s,id:a,groupId:o,track:c}=t;if(!i){this.warn(`Audio tracks reset while loading track ${a} "${c.name}" of "${o}"`);return}const u=this.mainDetails;if(!u||s.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==lt.STOPPED&&(this.state=lt.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${c.name}" of "${o}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const h=i[a];let p=0;if(s.live||(n=h.details)!=null&&n.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(h.details){var v;p=this.alignPlaylists(s,h.details,(v=this.levelLastLoaded)==null?void 0:v.details)}s.alignedSliding||(CU(s,u),s.alignedSliding||Sb(s,u),p=s.fragmentStart)}h.details=s,this.levelLastLoaded=h,this.startFragRequested||this.setStartPosition(u,p),this.hls.trigger(H.AUDIO_TRACK_UPDATED,{details:s,id:a,groupId:t.groupId}),this.state===lt.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=lt.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:i,payload:s}=e,{config:a,trackId:o,levels:c}=this;if(!c){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const u=c[o];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const h=u.details;if(!h){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const p=a.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let v=this.transmuxer;v||(v=this.transmuxer=new qU(this.hls,qt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const y=this.initPTS[n.cc],x=(t=n.initSegment)==null?void 0:t.data;if(y!==void 0){const E=i?i.index:-1,b=E!==-1,T=new ST(n.level,n.sn,n.stats.chunkCount,s.byteLength,E,b);v.push(s,x,p,"",n,i,h.totalduration,!1,T,y)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${h.startSN} ,${h.endSN}],track ${o}`);const{cache:S}=this.waitingData=this.waitingData||{frag:n,part:i,cache:new RU,complete:!1};S.push(new Uint8Array(s)),this.state!==lt.STOPPED&&(this.state=lt.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===qt.MAIN&&Ps(t.frag)&&(this.mainFragLoading=t,this.state===lt.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:i}=t;if(n.type!==qt.AUDIO){!this.audioOnly&&n.type===qt.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Ps(n)){this.fragPrevious=n;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(H.AUDIO_TRACK_SWITCHED,Oi({},s)))}this.fragBufferedComplete(n,i),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=lt.ERROR;return}switch(t.details){case Ie.FRAG_GAP:case Ie.FRAG_PARSING_ERROR:case Ie.FRAG_DECRYPT_ERROR:case Ie.FRAG_LOAD_ERROR:case Ie.FRAG_LOAD_TIMEOUT:case Ie.KEY_LOAD_ERROR:case Ie.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(qt.AUDIO,t);break;case Ie.AUDIO_TRACK_LOAD_ERROR:case Ie.AUDIO_TRACK_LOAD_TIMEOUT:case Ie.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===lt.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===jn.AUDIO_TRACK&&(this.state=lt.IDLE);break;case Ie.BUFFER_ADD_CODEC_ERROR:case Ie.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Ie.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Ie.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==qi.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==qi.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===lt.ENDED&&(this.state=lt.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,qt.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:i}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:c,part:u,level:h}=o,{details:p}=h,{audio:v,text:y,id3:x,initSegment:S}=s;if(this.fragContextChanged(c)||!p){this.fragmentTracker.removeFragment(c);return}if(this.state=lt.PARSING,this.switchingTrack&&v&&this.completeAudioSwitch(this.switchingTrack),S!=null&&S.tracks){const E=c.initSegment||c;if(this.unhandledEncryptionError(S,c))return;this._bufferInitSegment(h,S.tracks,E,a),i.trigger(H.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:n,tracks:S.tracks})}if(v){const{startPTS:E,endPTS:b,startDTS:T,endDTS:R}=v;u&&(u.elementaryStreams[qi.AUDIO]={startPTS:E,endPTS:b,startDTS:T,endDTS:R}),c.setElementaryStreamInfo(qi.AUDIO,E,b,T,R),this.bufferFragmentData(v,c,u,a)}if(x!=null&&(t=x.samples)!=null&&t.length){const E=Gi({id:n,frag:c,details:p},x);i.trigger(H.FRAG_PARSING_METADATA,E)}if(y){const E=Gi({id:n,frag:c,details:p},y);i.trigger(H.FRAG_PARSING_USERDATA,E)}}_bufferInitSegment(e,t,n,i){if(this.state!==lt.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=qt.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${a}/${s.codec}]`),a&&a.split(",").length===1&&(s.levelCodec=a),this.hls.trigger(H.BUFFER_CODECS,t);const o=s.initSegment;if(o!=null&&o.byteLength){const c={type:"audio",frag:n,part:null,chunkMeta:i,parent:n.type,data:o};this.hls.trigger(H.BUFFER_APPENDING,c)}this.tickImmediate()}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===rr.NOT_LOADED||i===rr.PARTIAL){var s;if(!Ps(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=lt.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&Sb(t.details,a)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:i,characteristics:s,audioCodec:a,channels:o}=this.bufferedTrack;_p({name:t,lang:n,assocLang:i,characteristics:s,audioCodec:a,channels:o},e,ip)||(gb(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(H.AUDIO_TRACK_SWITCHED,Oi({},e))}}class bT extends Cl{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const i=t?.renditionReports;if(i){let s=-1;for(let a=0;a<i.length;a++){const o=i[a];let c;try{c=new self.URL(o.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),c=o.URI||""}if(c===e){s=a;break}else c===e.substring(0,c.length)&&(s=a)}if(s!==-1){const a=i[s],o=parseInt(a["LAST-MSN"])||t.lastPartSn;let c=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const h=Math.min(t.age-t.partTarget,t.targetduration);c>=0&&h>t.partTarget&&(c+=1)}const u=n&&g3(n);return new tR(o,c>=0?c:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:i,stats:s}=t,a=self.performance.now(),o=s.loading.first?Math.max(0,a-s.loading.first):0;i.advancedDateTime=Date.now()-o;const c=this.hls.config.timelineOffset;if(c!==i.appliedTimelineOffset){const h=Math.max(c||0,0);i.appliedTimelineOffset=h,i.fragments.forEach(p=>{p.setStart(p.playlistOffset+h)})}if(i.live||n!=null&&n.live){const h="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(n),n&&i.fragments.length>0){Vq(n,i,this);const T=i.playlistParsingError;if(T){this.warn(T);const R=this.hls;if(!R.config.ignorePlaylistParsingErrors){var u;const{networkDetails:D}=t;R.trigger(H.ERROR,{type:rn.NETWORK_ERROR,details:Ie.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:T,reason:T.message,level:t.level||void 0,parent:(u=i.fragments[0])==null?void 0:u.type,networkDetails:D,stats:s});return}i.playlistParsingError=null}}i.requestScheduled===-1&&(i.requestScheduled=s.loading.start);const p=this.hls.mainForwardBufferInfo,v=p?p.end-p.len:0,y=(i.edge-v)*1e3,x=AU(i,y);if(i.requestScheduled+x<a?i.requestScheduled=a:i.requestScheduled+=x,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let S,E,b;if(i.canBlockReload&&i.endSN&&i.advanced){const T=this.hls.config.lowLatencyMode,R=i.lastPartSn,D=i.endSN,P=i.lastPartIndex,O=P!==-1,N=R===D;O?N?(E=D+1,b=T?0:P):(E=R,b=T?P+1:i.maxPartIndex):E=D+1;const U=i.age,B=U+i.ageHeader;let I=Math.min(B-i.partTarget,i.targetduration*1.5);if(I>0){if(B>i.targetduration*3)this.log(`Playlist last advanced ${U.toFixed(2)}s ago. Omitting segment and part directives.`),E=void 0,b=void 0;else if(n!=null&&n.tuneInGoal&&B-i.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${I} with playlist age: ${i.age}`),I=0;else{const z=Math.floor(I/i.targetduration);if(E+=z,b!==void 0){const W=Math.round(I%i.targetduration/i.partTarget);b+=W}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${U.toFixed(2)}s goal: ${I} skip sn ${z} to part ${b}`)}i.tuneInGoal=I}if(S=this.getDeliveryDirectives(i,t.deliveryDirectives,E,b),T||!N){i.requestScheduled=a,this.loadingPlaylist(h,S);return}}else(i.canBlockReload||i.canSkipUntil)&&(S=this.getDeliveryDirectives(i,t.deliveryDirectives,E,b));S&&E!==void 0&&i.canBlockReload&&(i.requestScheduled=s.loading.first+Math.max(x-o*2,x/2)),this.scheduleLoading(h,S,i)}else this.clearTimer()}scheduleLoading(e,t,n){const i=n||e.details;if(!i){this.loadingPlaylist(e,t);return}const s=self.performance.now(),a=i.requestScheduled;if(s>=a){this.loadingPlaylist(e,t);return}const o=a-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,n,i){let s=g3(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,i=t.part,s=Xy.No),new tR(n,i,s)}checkRetry(e){const t=e.details,n=vb(e),i=e.errorAction,{action:s,retryCount:a=0,retryConfig:o}=i||{},c=!!i&&!!o&&(s===nr.RetryRequest||!i.resolved&&s===nr.SendAlternateToPenaltyBox);if(c){var u;if(a>=o.maxNumRetry)return!1;if(n&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const h=JD(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),h),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${h}ms`)}e.levelRetry=!0,i.resolved=!0}return c}}function WU(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!Ex(r[t].attrs,e[t].attrs))return!1;return!0}function Ex(r,e,t){const n=r["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>r[i]!==e[i])}function cR(r,e){return e.label.toLowerCase()===r.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(r.lang||"").toLowerCase())}class JU extends bT{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.LEVEL_LOADING,this.onLevelLoading,this),e.on(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(H.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(H.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.LEVEL_LOADING,this.onLevelLoading,this),e.off(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(H.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(H.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:i,details:s}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==i){this.warn(`Audio track with id:${n} and group:${i} not found in active group ${a?.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${n} "${a.name}" lang:${a.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,i=this.groupIds;let s=this.currentTrack;if(!n||i?.length!==n?.length||n!=null&&n.some(o=>i?.indexOf(o)===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(v=>!n||n.indexOf(v.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(v=>v.default)&&(this.selectDefaultTrack=!1),o.forEach((v,y)=>{v.id=y});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const c=this.hls.config.audioPreference;if(!s&&c){const v=tu(c,o,ip);if(v>-1)s=o[v];else{const y=tu(c,this.tracks);s=this.tracks[y]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));const h={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${n?.join(",")}`),this.hls.trigger(H.AUDIO_TRACKS_UPDATED,h);const p=this.trackId;if(u!==-1&&p===-1)this.setAudioTrack(u);else if(o.length&&p===-1){var a;const v=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(v.message),this.hls.trigger(H.ERROR,{type:rn.MEDIA_ERROR,details:Ie.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:v})}}}onError(e,t){t.fatal||!t.context||t.context.type===jn.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const i=this.currentTrack;if(i&&_p(e,i,ip))return i;const s=tu(e,this.tracksInGroup,ip);if(s>-1){const a=this.tracksInGroup[s];return this.setAudioTrack(s),a}else if(i){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=dq(e,t.levels,n,a,ip);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=tu(e,n);if(a>-1)return n[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e],s=i.details&&!i.details.live;if(e===this.trackId&&i===n&&s||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(H.AUDIO_TRACK_SWITCHING,Oi({},i)),s))return;const a=this.switchParams(i.url,n?.details,i.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if(!(this.selectDefaultTrack&&!i.default)&&(!e||_p(e,i,ip)))return n}if(e){const{name:n,lang:i,assocLang:s,characteristics:a,audioCodec:o,channels:c}=e;for(let u=0;u<t.length;u++){const h=t[u];if(_p({name:n,lang:i,assocLang:s,characteristics:a,audioCodec:o,channels:c},h,ip))return u}for(let u=0;u<t.length;u++){const h=t[u];if(Ex(e.attrs,h.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const h=t[u];if(Ex(e.attrs,h.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&gb(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,o=a?.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${i}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(H.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:i,deliveryDirectives:t||null,track:e})}}class $j{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const i=this.queues[t];i.push(e),i.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(s){var n;if(i.onError(s),this.queues===null||this.tracks===null)return;const a=(n=this.tracks[e])==null?void 0:n.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],i=n?.buffer;return i?`SourceBuffer${i.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const tB=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,$U="HlsJsTrackRemovedError";class Qj extends Error{constructor(e){super(e),this.name=$U}}class QU extends Cl{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var i;this.hls&&((i=this.mediaSource)==null?void 0:i.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:i,mediaSource:s}=this;n&&this.log("Media source opened"),!(!i||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(H.MEDIA_ATTACHED,{media:i,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:i}=this;n!==i&&this.error(`Media element src was set while attaching MediaSource (${i} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=CK(mf(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.BUFFER_RESET,this.onBufferReset,this),e.on(H.BUFFER_APPENDING,this.onBufferAppending,this),e.on(H.BUFFER_CODECS,this.onBufferCodecs,this),e.on(H.BUFFER_EOS,this.onBufferEos,this),e.on(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(H.FRAG_PARSED,this.onFragParsed,this),e.on(H.FRAG_CHANGED,this.onFragChanged,this),e.on(H.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.BUFFER_RESET,this.onBufferReset,this),e.off(H.BUFFER_APPENDING,this.onBufferAppending,this),e.off(H.BUFFER_CODECS,this.onBufferCodecs,this),e.off(H.BUFFER_EOS,this.onBufferEos,this),e.off(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(H.FRAG_PARSED,this.onFragParsed,this),e.off(H.FRAG_CHANGED,this.onFragChanged,this),e.off(H.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const a=this.isQueued();(s||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?Gi(n,i.tracks):this.sourceBuffers.forEach(s=>{const[a]=s;a&&(n[a]=Gi({},this.tracks[a]),this.removeBuffer(a)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const i=mf(this.appendSource);if(i){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(a),s)this._objectUrl=n.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{n.removeAttribute("src");const c=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||c&&a instanceof c,nB(n),Zj(n,o),n.load()}catch{n.src=o}else n.src=o}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,i=t.tracks,s=i?Object.keys(i):null,a=s?s.length:0,o=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(i&&s&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${ji(n,(c,u)=>c==="initSegment"?void 0:u)};
transfer tracks: ${ji(i,(c,u)=>c==="initSegment"?void 0:u)}}`),!YN(i,n)){t.mediaSource=null,t.tracks=void 0;const c=e.currentTime,u=this.details,h=Math.max(c,u?.fragments[0].start||0);if(h-c>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${c} -> ${h}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(n)}") start time: ${h} currentTime: ${c}`),this.onMediaDetaching(H.MEDIA_DETACHING,{}),this.onMediaAttaching(H.MEDIA_ATTACHING,t),e.currentTime=h;return}this.transferData=void 0,s.forEach(c=>{const u=c,h=i[u];if(h){const p=h.buffer;if(p){const v=this.fragmentTracker,y=h.id;if(v.hasFragments(y)||v.hasParts(y)){const E=Dn.getBuffered(p);v.detectEvictedFragments(u,E,y,null,!0)}const x=XM(u),S=[u,p];this.sourceBuffers[x]=S,p.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,h)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:s,_objectUrl:a}=this;if(s){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=s.readyState==="open";try{const c=s.sourceBuffers;for(let u=c.length;u--;)o&&c[u].abort(),s.removeSourceBuffer(c[u]);o&&s.endOfStream()}catch(c){this.warn(`onMediaDetaching: ${c.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),n||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(i.removeAttribute("src"),this.appendSource&&nB(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(H.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var i;(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[XM(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new $j(this.tracks)}onBufferCodecs(e,t){var n;const i=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),o=!a&&this.sourceBufferCount&&this.media&&s.some(c=>!i[c]);if(a||o){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${s}" SourceBuffers`);return}s.forEach(c=>{var u,h;const p=t[c],{id:v,codec:y,levelCodec:x,container:S,metadata:E,supplemental:b}=p;let T=i[c];const R=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[c],D=R!=null&&R.buffer?R:T,P=D?.pendingCodec||D?.codec,O=D?.levelCodec;T||(T=i[c]={buffer:void 0,listeners:[],codec:y,supplemental:b,container:S,levelCodec:x,metadata:E,id:v});const N=iE(P,O),U=N?.replace(tB,"$1");let B=iE(y,x);const I=(h=B)==null?void 0:h.replace(tB,"$1");B&&N&&U!==I&&(c.slice(0,5)==="audio"&&(B=pb(B,this.appendSource)),this.log(`switching codec ${P} to ${B}`),B!==(T.pendingCodec||T.codec)&&(T.pendingCodec=B),T.container=S,this.appendChangeType(c,S,B))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((n=t.audio)==null?void 0:n.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const i=`${t};codecs=${n}`,s={label:`change-type=${i}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),o.changeType(i),a.codec=n,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,i=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,qt.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const c=this.tracks.video;(this.lastVideoAppendEnd>i||c!=null&&c.buffer&&Dn.isBuffered(c.buffer,i)||((o=this.fragmentTracker.getAppendedFrag(i,qt.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:i,type:s,parent:a,frag:o,part:c,chunkMeta:u,offset:h}=t,p=u.buffering[s],{sn:v,cc:y}=o,x=self.performance.now();p.start=x;const S=o.stats.buffering,E=c?c.stats.buffering:null;S.start===0&&(S.start=x),E&&E.start===0&&(E.start=x);const b=n.audio;let T=!1;s==="audio"&&b?.container==="audio/mpeg"&&(T=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const R=n.video,D=R?.buffer;if(D&&v!=="initSegment"){const N=c||o,U=this.blockedAudioAppend;if(s==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(R.ending||R.ended)){const I=N.start+N.duration*.05,z=D.buffered,W=this.currentOp("video");!z.length&&!W?this.blockAudio(N):!W&&!Dn.isBuffered(D,I)&&this.lastVideoAppendEnd<I&&this.blockAudio(N)}else if(s==="video"){const B=N.end;if(U){const I=U.frag.start;(B>I||B<this.lastVideoAppendEnd||Dn.isBuffered(D,I))&&this.unblockAudio()}this.lastVideoAppendEnd=B}}const P=(c||o).start,O={label:`append-${s}`,execute:()=>{var N;p.executeStart=self.performance.now();const U=(N=this.tracks[s])==null?void 0:N.buffer;U&&(T?this.updateTimestampOffset(U,P,.1,s,v,y):h!==void 0&&zt(h)&&this.updateTimestampOffset(U,h,1e-6,s,v,y)),this.appendExecutor(i,s)},onStart:()=>{},onComplete:()=>{const N=self.performance.now();p.executeEnd=p.end=N,S.first===0&&(S.first=N),E&&E.first===0&&(E.first=N);const U={};this.sourceBuffers.forEach(([B,I])=>{B&&(U[B]=Dn.getBuffered(I))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(H.BUFFER_APPENDED,{type:s,frag:o,part:c,chunkMeta:u,parent:o.type,timeRanges:U})},onError:N=>{var U;const B={type:rn.MEDIA_ERROR,parent:o.type,details:Ie.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:o,part:c,chunkMeta:u,error:N,err:N,fatal:!1},I=(U=this.media)==null?void 0:U.error;if(N.code===DOMException.QUOTA_EXCEEDED_ERR||N.name=="QuotaExceededError"||"quota"in N)B.details=Ie.BUFFER_FULL_ERROR;else if(N.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!I)B.errorAction=z0(!0);else if(N.name===$U&&this.sourceBufferCount===0)B.errorAction=z0(!0);else{const z=++this.appendErrors[s];this.warn(`Failed ${z}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${I||"no media error"})`),(z>=this.hls.config.appendErrorMaxRetry||I)&&(B.fatal=!0)}this.hls.trigger(H.ERROR,B)}};this.log(`queuing "${s}" append sn: ${v}${c?" p: "+c.index:""} of ${o.type===qt.MAIN?"level":"track"} ${o.level} cc: ${y}`),this.append(O,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(H.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:n,startOffset:i,endOffset:s}=t;n?this.append(this.getFlushOp(n,i,s),n):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,i,s),a)})}onFragParsed(e,t){const{frag:n,part:i}=t,s=[],a=i?i.elementaryStreams:n.elementaryStreams;a[qi.AUDIOVIDEO]?s.push("audiovideo"):(a[qi.AUDIO]&&s.push("audio"),a[qi.VIDEO]&&s.push("video"));const o=()=>{const c=self.performance.now();n.stats.buffering.end=c,i&&(i.stats.buffering.end=c);const u=i?i.stats:n.stats;this.hls.trigger(H.FRAG_BUFFERED,{frag:n,part:i,stats:u,id:n.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(o,s).catch(c=>{this.warn(`Fragment buffered callback ${c}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const i=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})?i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(H.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(H.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Ie.BUFFER_APPEND_ERROR&&t.frag){var n;const i=(n=t.errorAction)==null?void 0:n.nextAutoLevel;zt(i)&&i!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const i=e.config,s=n.currentTime,a=t.levelTargetDuration,o=t.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(zt(o)&&o>=0){const u=Math.max(o,a),h=Math.floor(s/a)*a-u;this.flushBackBuffer(s,a,h)}const c=i.frontBufferFlushThreshold;if(zt(c)&&c>0){const u=Math.max(i.maxBufferLength,c),h=Math.max(u,a),p=Math.floor(s/a)*a+h;this.flushFrontBuffer(s,a,p)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([i,s])=>{if(s){const o=Dn.getBuffered(s);if(o.length>0&&n>o.start(0)){var a;this.hls.trigger(H.BACK_BUFFER_REACHED,{bufferEnd:n});const c=this.tracks[i];if((a=this.details)!=null&&a.live)this.hls.trigger(H.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(c!=null&&c.ended){this.log(`Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(H.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:i})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([i,s])=>{if(s){const a=Dn.getBuffered(s),o=a.length;if(o<2)return;const c=a.start(o-1),u=a.end(o-1);if(n>c||e>=c&&e<=u)return;this.hls.trigger(H.BUFFER_FLUSHING,{startOffset:c,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||n?.readyState!=="open")return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),h=Math.max(u,i);return{duration:1/0,start:u,end:h}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return zt(s)?{duration:s}:null;const a=this.media.duration,o=zt(n.duration)?n.duration:0;return i>o&&i>a||!zt(a)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:n}){const i=this.mediaSource;!this.media||!i||i.readyState!=="open"||(i.duration!==e&&(zt(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${n}.`),i.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${ji(n)}`),this.tracksReady){var i;const s=(i=this.transferData)==null?void 0:i.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const i=this.tracks[t];e[t]={buffer:n,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger(H.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(H.ERROR,{type:rn.MEDIA_ERROR,details:Ie.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const a=s,o=e[a];if(this.isPending(o)){const c=this.getTrackCodec(o,a),u=`${o.container};codecs=${c}`;o.codec=c,this.log(`creating sourceBuffer(${u})${this.currentOp(a)?" Queued":""} ${ji(o)}`);try{const h=n.addSourceBuffer(u),p=XM(a),v=[a,h];t[p]=v,o.buffer=h}catch(h){var i;this.error(`error while trying to add sourceBuffer: ${h.message}`),this.shiftAndExecuteNext(a),(i=this.operationQueue)==null||i.removeBlockers(),delete this.tracks[a],this.hls.trigger(H.ERROR,{type:rn.MEDIA_ERROR,details:Ie.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:h,sourceBufferName:a,mimeType:u,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let i=e.codec;n&&(t==="video"||t==="audiovideo")&&yx(n,"video")&&(i=jK(i,n));const s=iE(i,e.levelCodec);return s?t.slice(0,5)==="audio"?pb(s,this.appendSource):s:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(H.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${i}`,t),this.hls.trigger(H.ERROR,{type:rn.MEDIA_ERROR,details:Ie.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const s=this.currentOp(e);s&&s.onError(i)}updateTimestampOffset(e,t,n,i,s,a){const o=t-e.timestampOffset;Math.abs(o)>=n&&(this.log(`Updating ${i} SourceBuffer timestampOffset to ${t} (sn: ${s} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:i,mediaSource:s}=this,a=this.tracks[e],o=a?.buffer;if(!i||!s||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const c=zt(i.duration)?i.duration:1/0,u=zt(s.duration)?s.duration:1/0,h=Math.max(0,t),p=Math.min(n,c,u);p>h&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${h},${p}] from the ${e} SourceBuffer`),o.remove(h,p)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],i=n?.buffer;if(!i)throw new Qj(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,i=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(a=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const i=(n=this.tracks[t])==null?void 0:n.buffer;!i||i.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const i=this.tracks[e];if(!i)return;const s=i.buffer;if(!s)return;const a=n.bind(this,e);i.listeners.push({event:t,listener:a}),s.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(i=>{n.removeEventListener(i.event,i.listener)}),t.listeners.length=0)}}function nB(r){const e=r.querySelectorAll("source");[].slice.call(e).forEach(t=>{r.removeChild(t)})}function Zj(r,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,r.appendChild(t)}function XM(r){return r==="audio"?1:0}class TT{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(H.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(H.BUFFER_CODECS,this.onBufferCodecs,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(H.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(H.BUFFER_CODECS,this.onBufferCodecs,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&zt(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((i,s)=>this.isLevelAllowed(i)&&s<=e);return this.clientRect=null,TT.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const i=(o,c)=>c?o.width!==c.width||o.height!==c.height:!0;let s=e.length-1;const a=Math.max(t,n);for(let o=0;o<e.length;o+=1){const c=e[o];if((c.width>=a||c.height>=a)&&i(c,e[o+1])){s=o;break}}return s}}const eW={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Za=eW,tW={HLS:"h"},nW=tW;class cu{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof cu?n:new cu(n))),this.value=e,this.params=t}}const iW="Dict";function sW(r){return Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r)}function rW(r,e,t,n){return new Error(`failed to ${r} "${sW(e)}" as ${t}`,{cause:n})}function uu(r,e,t){return rW("serialize",r,e,t)}class ZU{constructor(e){this.description=e}}const iB="Bare Item",aW="Boolean";function oW(r){if(typeof r!="boolean")throw uu(r,aW);return r?"?1":"?0"}function lW(r){return btoa(String.fromCharCode(...r))}const cW="Byte Sequence";function uW(r){if(ArrayBuffer.isView(r)===!1)throw uu(r,cW);return`:${lW(r)}:`}const fW="Integer";function hW(r){return r<-999999999999999||999999999999999<r}function eF(r){if(hW(r))throw uu(r,fW);return r.toString()}function dW(r){return`@${eF(r.getTime()/1e3)}`}function tF(r,e){if(r<0)return-tF(-r,e);const t=Math.pow(10,e);if(Math.abs(r*t%1-.5)<Number.EPSILON){const i=Math.floor(r*t);return(i%2===0?i:i+1)/t}else return Math.round(r*t)/t}const pW="Decimal";function mW(r){const e=tF(r,3);if(Math.floor(Math.abs(e)).toString().length>12)throw uu(r,pW);const t=e.toString();return t.includes(".")?t:`${t}.0`}const gW="String",vW=/[\x00-\x1f\x7f]+/;function yW(r){if(vW.test(r))throw uu(r,gW);return`"${r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function xW(r){return r.description||r.toString().slice(7,-1)}const _W="Token";function sB(r){const e=xW(r);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw uu(e,_W);return e}function uR(r){switch(typeof r){case"number":if(!zt(r))throw uu(r,iB);return Number.isInteger(r)?eF(r):mW(r);case"string":return yW(r);case"symbol":return sB(r);case"boolean":return oW(r);case"object":if(r instanceof Date)return dW(r);if(r instanceof Uint8Array)return uW(r);if(r instanceof ZU)return sB(r);default:throw uu(r,iB)}}const SW="Key";function fR(r){if(/^[a-z*][a-z0-9\-_.*]*$/.test(r)===!1)throw uu(r,SW);return r}function cL(r){return r==null?"":Object.entries(r).map(([e,t])=>t===!0?`;${fR(e)}`:`;${fR(e)}=${uR(t)}`).join("")}function nF(r){return r instanceof cu?`${uR(r.value)}${cL(r.params)}`:uR(r)}function AW(r){return`(${r.value.map(nF).join(" ")})${cL(r.params)}`}function EW(r,e={whitespace:!0}){if(typeof r!="object"||r==null)throw uu(r,iW);const t=r instanceof Map?r.entries():Object.entries(r),n=e?.whitespace?" ":"";return Array.from(t).map(([i,s])=>{s instanceof cu||(s=new cu(s));let a=fR(i);return s.value===!0?a+=cL(s.params):(a+="=",Array.isArray(s.value)?a+=AW(s):a+=nF(s)),a}).join(`,${n}`)}function iF(r,e){return EW(r,e)}const jc="CMCD-Object",Cs="CMCD-Request",Jd="CMCD-Session",dh="CMCD-Status",bW={br:jc,ab:jc,d:jc,ot:jc,tb:jc,tpb:jc,lb:jc,tab:jc,lab:jc,url:jc,pb:Cs,bl:Cs,tbl:Cs,dl:Cs,ltc:Cs,mtp:Cs,nor:Cs,nrr:Cs,rc:Cs,sn:Cs,sta:Cs,su:Cs,ttfb:Cs,ttfbb:Cs,ttlb:Cs,cmsdd:Cs,cmsds:Cs,smrt:Cs,df:Cs,cs:Cs,ts:Cs,cid:Jd,pr:Jd,sf:Jd,sid:Jd,st:Jd,v:Jd,msd:Jd,bs:dh,bsd:dh,cdn:dh,rtp:dh,bg:dh,pt:dh,ec:dh,e:dh},TW={REQUEST:Cs};function MW(r){return Object.keys(r).reduce((e,t)=>{var n;return(n=r[t])===null||n===void 0||n.forEach(i=>e[i]=t),e},{})}function CW(r,e){const t={};if(!r)return t;const n=Object.keys(r),i=e?MW(e):{};return n.reduce((s,a)=>{var o;const c=bW[a]||i[a]||TW.REQUEST,u=(o=s[c])!==null&&o!==void 0?o:s[c]={};return u[a]=r[a],s},t)}function RW(r){return["ot","sf","st","e","sta"].includes(r)}function DW(r){return typeof r=="number"?zt(r):r!=null&&r!==""&&r!==!1}const sF="event";function LW(r,e){const t=new URL(r),n=new URL(e);if(t.origin!==n.origin)return r;const i=t.pathname.split("/").slice(1),s=n.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")+t.search+t.hash}const oE=r=>Math.round(r),hR=(r,e)=>Array.isArray(r)?r.map(t=>hR(t,e)):r instanceof cu&&typeof r.value=="string"?new cu(hR(r.value,e),r.params):(e.baseUrl&&(r=LW(r,e.baseUrl)),e.version===1?encodeURIComponent(r):r),bA=r=>oE(r/100)*100,wW=(r,e)=>{let t=r;return e.version>=2&&(r instanceof cu&&typeof r.value=="string"?t=new cu([r]):typeof r=="string"&&(t=[r])),hR(t,e)},IW={br:oE,d:oE,bl:bA,dl:bA,mtp:bA,nor:wW,rtp:bA,tb:oE},rF="request",aF="response",uL=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],BW=["e"],OW=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function MT(r){return OW.test(r)}function PW(r){return uL.includes(r)||BW.includes(r)||MT(r)}const oF=["d","dl","nor","ot","rtp","su"];function NW(r){return uL.includes(r)||oF.includes(r)||MT(r)}const UW=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function FW(r){return uL.includes(r)||oF.includes(r)||UW.includes(r)||MT(r)}const kW=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function GW(r){return kW.includes(r)||MT(r)}const HW={[aF]:FW,[sF]:PW,[rF]:NW};function lF(r,e={}){const t={};if(r==null||typeof r!="object")return t;const n=e.version||r.v||1,i=e.reportingMode||rF,s=n===1?GW:HW[i];let a=Object.keys(r).filter(s);const o=e.filter;typeof o=="function"&&(a=a.filter(o));const c=i===aF||i===sF;c&&!a.includes("ts")&&a.push("ts"),n>1&&!a.includes("v")&&a.push("v");const u=Gi({},IW,e.formatters),h={version:n,reportingMode:i,baseUrl:e.baseUrl};return a.sort().forEach(p=>{let v=r[p];const y=u[p];if(typeof y=="function"&&(v=y(v,h)),p==="v"){if(n===1)return;v=n}p=="pr"&&v===1||(c&&p==="ts"&&!zt(v)&&(v=Date.now()),DW(v)&&(RW(p)&&typeof v=="string"&&(v=new ZU(v)),t[p]=v))}),t}function zW(r,e={}){const t={};if(!r)return t;const n=lF(r,e),i=CW(n,e?.customHeaderMap);return Object.entries(i).reduce((s,[a,o])=>{const c=iF(o,{whitespace:!1});return c&&(s[a]=c),s},t)}function VW(r,e,t){return Gi(r,zW(e,t))}const YW="CMCD";function XW(r,e={}){return r?iF(lF(r,e),{whitespace:!1}):""}function KW(r,e={}){if(!r)return"";const t=XW(r,e);return encodeURIComponent(t)}function qW(r,e={}){if(!r)return"";const t=KW(r,e);return`${YW}=${t}`}const rB=/CMCD=[^&#]+/;function jW(r,e,t){const n=qW(e,t);if(!n)return r;if(rB.test(r))return r.replace(rB,n);const i=r.includes("?")?"&":"?";return`${r}${i}${n}`}class cF{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:Za.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=i=>{try{const{frag:s,part:a}=i,o=this.hls.levels[s.level],c=this.getObjectType(s),u={d:(a||s).duration*1e3,ot:c};(c===Za.VIDEO||c===Za.AUDIO||c==Za.MUXED)&&(u.br=o.bitrate/1e3,u.tb=this.getTopBandwidth(c)/1e3,u.bl=this.getBufferLength(c));const h=a?this.getNextPart(a):this.getNextFrag(s);h!=null&&h.url&&h.url!==s.url&&(u.nor=h.url),this.apply(i,u)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHED,this.onMediaDetached,this),e.on(H.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHED,this.onMediaDetached,this),e.off(H.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,i;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:nW.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Gi(t,this.createData());const n=t.ot===Za.INIT||t.ot===Za.VIDEO||t.ot===Za.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((a,o)=>(i.includes(o)&&(a[o]=t[o]),a),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),VW(e.headers,t,s)):e.url=jW(e.url,t,s)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const i=e.sn-n.startSN;return n.fragments[i+1]}}getNextPart(e){var t;const{index:n,fragment:i}=e,s=(t=this.hls.levels[i.level])==null||(t=t.details)==null?void 0:t.partList;if(s){const{sn:a}=i;for(let o=s.length-1;o>=0;o--){const c=s[o];if(c.index===n&&c.fragment.sn===a)return s[o+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Za.TIMED_TEXT;if(e.sn==="initSegment")return Za.INIT;if(t==="audio")return Za.AUDIO;if(t==="main")return this.hls.audioTracks.length?Za.VIDEO:Za.MUXED}getTopBandwidth(e){let t=0,n;const i=this.hls;if(e===Za.AUDIO)n=i.audioTracks;else{const s=i.maxAutoLevel,a=s>-1?s+1:i.levels.length;n=i.levels.slice(0,a)}return n.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===Za.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:Dn.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}}const WW=3e5;class uF extends Cl{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if(n?.action===nr.SendAlternateToPenaltyBox&&n.flags===to.MoveAllAlternatesMatchingHost){const i=this.levels;let s=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:c,type:u}=t.context;o&&i?a=this.getPathwayForGroupId(o,u,a):c&&(a=c)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!s&&i&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),n.resolved=this.pathwayId!==a),t.details===Ie.BUFFER_APPEND_ERROR&&!t.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${i&&i.length} priorities: ${ji(s)} penalized: ${ji(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,i=performance.now();Object.keys(n).forEach(s=>{i-n[s]>WW&&delete n[s]});for(let s=0;s<e.length;s++){const a=e[s];if(a in n)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,c=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,TU(t),this.hls.trigger(H.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[o];c&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==c.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==c.bitrate&&this.log(`Unstable Pathways change from bitrate ${c.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,n){const i=this.getLevelsForPathway(n).concat(this.levels||[]);for(let s=0;s<i.length;s++)if(t===jn.AUDIO_TRACK&&i[s].hasAudioGroup(e)||t===jn.SUBTITLE_TRACK&&i[s].hasSubtitleGroup(e))return i[s].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},i={};e.forEach(s=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":c}=s;if(t.some(h=>h.pathwayId===a))return;const u=this.getLevelsForPathway(o).map(h=>{const p=new os(h.attrs);p["PATHWAY-ID"]=a;const v=p.AUDIO&&`${p.AUDIO}_clone_${a}`,y=p.SUBTITLES&&`${p.SUBTITLES}_clone_${a}`;v&&(n[p.AUDIO]=v,p.AUDIO=v),y&&(i[p.SUBTITLES]=y,p.SUBTITLES=y);const x=fF(h.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",c),S=new mg({attrs:p,audioCodec:h.audioCodec,bitrate:h.bitrate,height:h.height,name:h.name,url:x,videoCodec:h.videoCodec,width:h.width});if(h.audioGroups)for(let E=1;E<h.audioGroups.length;E++)S.addGroupId("audio",`${h.audioGroups[E]}_clone_${a}`);if(h.subtitleGroups)for(let E=1;E<h.subtitleGroups.length;E++)S.addGroupId("text",`${h.subtitleGroups[E]}_clone_${a}`);return S});t.push(...u),aB(this.audioTracks,n,c,a),aB(this.subtitleTracks,i,c,a)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const h=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+h)}const s={responseType:"json",url:i.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},c={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},u={onSuccess:(h,p,v,y)=>{this.log(`Loaded steering manifest: "${i}"`);const x=h.data;if(x?.VERSION!==1){this.log(`Steering VERSION ${x.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=x.TTL;const{"RELOAD-URI":S,"PATHWAY-CLONES":E,"PATHWAY-PRIORITY":b}=x;if(S)try{this.uri=new self.URL(S,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${S}`);return}this.scheduleRefresh(this.uri||v.url),E&&this.clonePathways(E);const T={steeringManifest:x,url:i.toString()};this.hls.trigger(H.STEERING_MANIFEST_LOADED,T),b&&this.updatePathwayPriority(b)},onError:(h,p,v,y)=>{if(this.log(`Error loading steering manifest: ${h.code} ${h.text} (${p.url})`),this.stopLoad(),h.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let x=this.timeToLoad*1e3;if(h.code===429){const S=this.loader;if(typeof S?.getResponseHeader=="function"){const E=S.getResponseHeader("Retry-After");E&&(x=parseFloat(E)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,x)},onTimeout:(h,p,v)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(s,c,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const i=(n=this.hls)==null?void 0:n.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function aB(r,e,t,n){r&&Object.keys(e).forEach(i=>{const s=r.filter(a=>a.groupId===i).map(a=>{const o=Gi({},a);return o.details=void 0,o.attrs=new os(o.attrs),o.url=o.attrs.URI=fF(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[i],o.attrs["PATHWAY-ID"]=n,o});r.push(...s)})}function fF(r,e,t,n){const{HOST:i,PARAMS:s,[t]:a}=n;let o;e&&(o=a?.[e],o&&(r=o));const c=new self.URL(r);return i&&!o&&(c.host=i),s&&Object.keys(s).sort().forEach(u=>{u&&c.searchParams.set(u,s[u])}),c.href}class Sp extends Cl{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Sp.CDMCleanupPromise?[Sp.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:n,initData:i}=t,s=`"${t.type}" event: init data type: "${n}"`;if(this.debug(s),i!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=Cy(this.config));const o=a.map(UM).filter(c=>!!c);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=sE(a);if(n!=="sinf"||o!==us.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${n}" for selected key-system ${o}`);return}let c;try{const y=tr(new Uint8Array(i)),x=eL(JSON.parse(y).sinf),S=ZN(x);if(!S)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");c=new Uint8Array(S.subarray(8,24))}catch(y){this.warn(`${s} Failed to parse sinf: ${y}`);return}const u=Nr(c),{keyIdToKeySessionPromise:h,mediaKeySessions:p}=this;let v=h[u];for(let y=0;y<p.length;y++){const x=p[y],S=x.decryptdata;if(!S.keyId)continue;const E=Nr(S.keyId);if(xb(c,S.keyId)||S.uri.replace(/-/g,"").indexOf(u)!==-1){if(v=h[E],!v)continue;if(S.pssh)break;delete h[E],S.pssh=new Uint8Array(i),S.keyId=c,v=h[u]=v.then(()=>this.generateRequestWithPreferredKeySession(x,n,i,"encrypted-event-key-match")),v.catch(b=>this.handleError(b));break}}v||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${p.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(H.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(H.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(H.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(H.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(H.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(H.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(H.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(H.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,i=t?.[e];if(i)return i.licenseUrl;if(e===us.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t?.[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(a,o,c)=>!!a&&c.indexOf(a)===o,i=t.map(a=>a.audioCodec).filter(n),s=t.map(a=>a.videoCodec).filter(n);return i.length+s.length===0&&s.push("avc1.42e01e"),new Promise((a,o)=>{const c=u=>{const h=u.shift();this.getMediaKeysPromise(h,i,s).then(p=>a({keySystem:h,mediaKeys:p})).catch(p=>{u.length?c(u):p instanceof Ro?o(p):o(new Ro({type:rn.KEY_SYSTEM_ERROR,details:Ie.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};c(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${n}`;return tL===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return n(e,t)}getMediaKeysPromise(e,t,n){var i;const s=Oq(e,t,n,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],o=(i=a)==null?void 0:i.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${ji(s)}`),o=this.requestMediaKeySystemAccess(e,s);const c=a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),o.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const h=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const p=c.mediaKeys=u.createMediaKeys().then(v=>(this.log(`Media-keys created for "${e}"`),c.hasMediaKeys=!0,h.then(y=>y?this.setMediaKeysServerCertificate(v,e,y):v)));return p.catch(v=>{this.error(`Failed to create media-keys for "${e}"}: ${v}`)}),p})}return o.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${Nr(e.keyId||[])} keyUri: ${e.uri}`);const i=n.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),i=TA(t),s="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${Nr(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>UM(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:i})=>{const s=UM(i);s?t(s):n(new Error(`Unable to find format for key-system "${i}"`))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Cy(this.config),n=e.map(sE).filter(i=>!!i&&t.indexOf(i)!==-1);return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const i=JW(e,t[n]);if(i)return i}}loadKey(e){const t=e.keyInfo.decryptdata,n=TA(t),i=this.bannedKeyIds[n];if(i||this.getKeyStatus(t)==="internal-error"){const o=oB(i||"internal-error",t);return this.handleError(o,e.frag),Promise.reject(o)}const s=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);const a=this.keyIdToKeySessionPromise[n];if(!a){const o=this.getKeySystemForKeyPromise(t).then(({keySystem:c,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(c,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:c,mediaKeys:u,decryptdata:t}))))).then(c=>{const u="cenc",h=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(c,u,h,"playlist-key")});return o.catch(c=>this.handleError(c,e.frag)),this.keyIdToKeySessionPromise[n]=o,o}return a.catch(o=>{if(o instanceof Ro){const c=Oi({},o.data);this.getKeyStatus(t)==="internal-error"&&(c.decryptdata=t);const u=new Ro(c,o.message);this.handleError(u,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Ro){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error(`${e.message}${n?` (${Nr(n.keyId||[])})`:""}`),this.hls.trigger(H.ERROR,e.data)}else this.error(e.message),this.hls.trigger(H.ERROR,{type:rn.KEY_SYSTEM_ERROR,details:Ie.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=TA(e),n=this.keyIdToKeySessionPromise[t];if(!n){const i=sE(e.keyFormat),s=i?[i]:Cy(this.config);return this.attemptKeySystemAccess(s)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=Cy(this.config)),e.length===0)throw new Ro({type:rn.KEY_SYSTEM_ERROR,details:Ie.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${ji({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(t):new Promise((s,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(s).catch(a)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>n.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,n,i){var s;const a=(s=this.config.drmSystems)==null||(s=s[e.keySystem])==null?void 0:s.generateRequest;if(a)try{const x=a.call(this.hls,t,n,e);if(!x)throw new Error("Invalid response from configured generateRequest filter");t=x.initDataType,n=x.initData?x.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(x){if(this.warn(x.message),this.hls&&this.hls.config.debug)throw x}if(n===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const o=TA(e.decryptdata),c=e.decryptdata.uri;this.log(`Generating key-session request for "${i}" keyId: ${o} URI: ${c} (init data type: ${t} length: ${n.byteLength})`);const u=new nL,h=e._onmessage=x=>{const S=e.mediaKeysSession;if(!S){u.emit("error",new Error("invalid state"));return}const{messageType:E,message:b}=x;this.log(`"${E}" message event for session "${S.sessionId}" message size: ${b.byteLength}`),E==="license-request"||E==="license-renewal"?this.renewLicense(e,b).catch(T=>{u.eventNames().length?u.emit("error",T):this.handleError(T)}):E==="license-release"?e.keySystem===us.FAIRPLAY&&this.updateKeySession(e,sR("acknowledged")).then(()=>this.removeSession(e)).catch(T=>this.handleError(T)):this.warn(`unhandled media key message type "${E}"`)},p=(x,S)=>{S.keyStatus=x;let E;x.startsWith("usable")?u.emit("resolved"):x==="internal-error"||x==="output-restricted"||x==="output-downscaled"?E=oB(x,S.decryptdata):x==="expired"?E=new Error(`key expired (keyId: ${o})`):x==="released"?E=new Error("key released"):x==="status-pending"||this.warn(`unhandled key status change "${x}" (keyId: ${o})`),E&&(u.eventNames().length?u.emit("error",E):this.handleError(E))},v=e._onkeystatuseschange=x=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}const E=this.getKeyStatuses(e);if(!Object.keys(E).some(D=>E[D]!=="status-pending"))return;if(E[o]==="expired"){this.log(`Expired key ${ji(E)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let T=E[o];if(T)p(T,e);else{var R;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(R=e.keyStatusTimeouts)[o]||(R[o]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const P=this.getKeyStatus(e.decryptdata);if(P&&P!=="status-pending")return this.log(`No status for keyId ${o} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${P} from other session.`),p(P,e);this.log(`key status for ${o} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),T="internal-error",p(T,e)},1e3)),this.log(`No status for keyId ${o} (${ji(E)}).`)}};ka(e.mediaKeysSession,"message",h),ka(e.mediaKeysSession,"keystatuseschange",v);const y=new Promise((x,S)=>{u.on("error",S),u.on("resolved",x)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${o} URI: ${c}`)}).catch(x=>{throw new Ro({type:rn.KEY_SYSTEM_ERROR,details:Ie.KEY_SYSTEM_NO_SESSION,error:x,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${x}`)}).then(()=>y).catch(x=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw x}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,i)=>{if(typeof i=="string"&&typeof n=="object"){const o=i;i=n,n=o}const s="buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i);if(e.keySystem===us.PLAYREADY&&s.length===16){const o=Nr(s);t[o]=n,gU(s)}const a=Nr(s);n==="internal-error"&&(this.bannedKeyIds[a]=n),this.log(`key status change "${n}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=n}),t}fetchServerCertificate(e){const t=this.config,n=t.loader,i=new n(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const c={responseType:"arraybuffer",url:s},u=t.certLoadPolicy.default,h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,y,x,S)=>{a(v.data)},onError:(v,y,x,S)=>{o(new Ro({type:rn.KEY_SYSTEM_ERROR,details:Ie.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:x,response:Oi({url:c.url,data:void 0},v)},`"${e}" certificate request failed (${s}). Status: ${v.code} (${v.text})`))},onTimeout:(v,y,x)=>{o(new Ro({type:rn.KEY_SYSTEM_ERROR,details:Ie.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:x,response:{url:c.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(v,y,x)=>{o(new Error("aborted"))}};i.load(c,h,p)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((i,s)=>{e.setServerCertificate(n).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${n.byteLength}) on "${t}"`),i(e)}).catch(a=>{s(new Ro({type:rn.KEY_SYSTEM_ERROR,details:Ie.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(i=>{throw new Ro({type:rn.KEY_SYSTEM_ERROR,details:Ie.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:i,fatal:!1},i.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(n,"application/xml"),s=i.querySelectorAll("HttpHeader");if(s.length>0){let h;for(let p=0,v=s.length;p<v;p++){var a,o;h=s[p];const y=(a=h.querySelector("name"))==null?void 0:a.textContent,x=(o=h.querySelector("value"))==null?void 0:o.textContent;y&&x&&e.setRequestHeader(y,x)}}const c=i.querySelector("Challenge"),u=c?.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return sR(atob(u))}setupLicenseXHR(e,t,n,i){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,n,i)}).catch(a=>{if(!n.decryptdata)throw a;return e.open("POST",t,!0),s.call(this.hls,e,t,n,i)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((i,s)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let c=o.response;this.log(`License received ${c instanceof ArrayBuffer?c.byteLength:c}`);const u=this.config.licenseResponseCallback;if(u)try{c=u.call(this.hls,o,a,e)}catch(h){this.error(h)}i(c)}else{const c=n.errorRetry,u=c?c.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||o.status>=400&&o.status<500)s(new Ro({type:rn.KEY_SYSTEM_ERROR,details:Ie.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const h=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${h} attempts left`),this.requestLicense(e,t).then(i,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:c,licenseChallenge:u})=>{e.keySystem==us.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(c,u)),c.send(u)}).catch(s)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,ka(n,"encrypted",this.onMediaEncrypted),ka(n,"waitingforkey",this.onWaitingForKey);const i=this.mediaResolved;i?i():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&(oo(e,"encrypted",this.onMediaEncrypted),oo(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,hf.clearKeyUriToKeyIdMap();const s=i.length;Sp.CDMCleanupPromise=Promise.all(i.map(a=>this.removeSession(a)).concat((n==null||(e=n.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(H.ERROR,{type:rn.OTHER_ERROR,details:Ie.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(H.ERROR,{type:rn.OTHER_ERROR,details:Ie.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((i,s)=>(i.indexOf(s.keyFormat)===-1&&i.push(s.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:i}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Nr(i?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(u=>self.clearTimeout(a[u]));const{drmSystemOptions:o}=this.config;return(Nq(o)?new Promise((u,h)=>{self.setTimeout(()=>h(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(u).catch(h)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger(H.ERROR,{type:rn.OTHER_ERROR,details:Ie.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>t.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger(H.ERROR,{type:rn.OTHER_ERROR,details:Ie.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}Sp.CDMCleanupPromise=void 0;function TA(r){if(!r)throw new Error("Could not read keyId of undefined decryptdata");if(r.keyId===null)throw new Error("keyId is null");return Nr(r.keyId)}function JW(r,e){if(r.keyId&&e.mediaKeysSession.keyStatuses.has(r.keyId))return e.mediaKeysSession.keyStatuses.get(r.keyId);if(r.matches(e.decryptdata))return e.keyStatus}class Ro extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function oB(r,e){const t=r==="output-restricted",n=t?Ie.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Ie.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Ro({type:rn.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${r}"`)}class hF{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(H.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(H.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(H.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(H.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const i=performance.now();if(t){if(this.lastTime){const s=i-this.lastTime,a=n-this.lastDroppedFrames,o=t-this.lastDecodedFrames,c=1e3*a/s,u=this.hls;if(u.trigger(H.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:n}),c>0&&a>u.config.fpsDroppedMonitoringThreshold*o){let h=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=h)&&(h=h-1,u.trigger(H.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:u.currentLevel}),u.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function dF(r,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=r,e.dispatchEvent(t)}function pF(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(e.id))try{if(r.addCue(e),!r.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){Pi.debug(`[texttrack-utils]: ${n}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,r.addCue(i)}catch(i){Pi.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(r.mode=t)}function P0(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues)for(let n=r.cues.length;n--;)e&&r.cues[n].removeEventListener("enter",e),r.removeCue(r.cues[n]);t==="disabled"&&(r.mode=t)}function dR(r,e,t,n){const i=r.mode;if(i==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){const s=QW(r.cues,e,t);for(let a=0;a<s.length;a++)(!n||n(s[a]))&&r.removeCue(s[a])}i==="disabled"&&(r.mode=i)}function $W(r,e){if(e<=r[0].startTime)return 0;const t=r.length-1;if(e>r[t].endTime)return-1;let n=0,i=t,s;for(;n<=i;)if(s=Math.floor((i+n)/2),e<r[s].startTime)i=s-1;else if(e>r[s].startTime&&n<t)n=s+1;else return s;return r[n].startTime-e<e-r[i].startTime?n:i}function QW(r,e,t){const n=[],i=$W(r,e);if(i>-1)for(let s=i,a=r.length;s<a;s++){const o=r[s];if(o.startTime>=e&&o.endTime<=t)n.push(o);else if(o.startTime>t)return n}return n}function lE(r){const e=[];for(let t=0;t<r.length;t++){const n=r[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(r[t])}return e}class mF extends bT{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=lE(this.media.textTracks);for(let s=0;s<n.length;s++)if(n[s].mode==="hidden")t=n[s];else if(n[s].mode==="showing"){t=n[s];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.LEVEL_LOADING,this.onLevelLoading,this),e.on(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(H.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(H.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.LEVEL_LOADING,this.onLevelLoading,this),e.off(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(H.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(H.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;lE(n.textTracks).forEach(a=>{P0(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:i,details:s}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==i){this.warn(`Subtitle track with id:${n} and group:${i} not found in active group ${a?.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${n} "${a.name}" lang:${a.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,i=this.groupIds;let s=this.currentTrack;if(!n||i?.length!==n?.length||n!=null&&n.some(a=>i?.indexOf(a)===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(h=>!n||n.indexOf(h.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(h=>h.default)&&(this.selectDefaultTrack=!1),a.forEach((h,p)=>{h.id=p});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!s&&o){this.selectDefaultTrack=!1;const h=tu(o,a);if(h>-1)s=a[h];else{const p=tu(o,this.tracks);s=this.tracks[p]}}let c=this.findTrackId(s);c===-1&&s&&(c=this.findTrackId(null));const u={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${n?.join(",")}" group-id`),this.hls.trigger(H.SUBTITLE_TRACKS_UPDATED,u),c!==-1&&this.trackId===-1&&this.setSubtitleTrack(c)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const s=t[i];if(!(n&&!s.default||!n&&!e)&&(!e||_p(s,e)))return i}if(e){for(let i=0;i<t.length;i++){const s=t[i];if(Ex(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const s=t[i];if(Ex(e.attrs,s.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if(cR(i,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===jn.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&_p(e,n))return n;const i=tu(e,this.tracksInGroup);if(i>-1){const s=this.tracksInGroup[i];return this.setSubtitleTrack(i),s}else{if(n)return null;{const s=tu(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,o=a?.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${i}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(H.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=lE(e.textTracks),n=this.currentTrack;let i;if(n&&(i=t.filter(s=>cR(n,s))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==i&&(s.mode="disabled")}),i){const s=this.subtitleDisplay?"showing":"hidden";i.mode!==s&&(i.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!zt(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(H.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!i.details&&!i.details.live;if(e===this.trackId&&i===n&&s)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:a,groupId:o="",name:c,type:u,url:h}=i;this.hls.trigger(H.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:c,type:u,url:h});const p=this.switchParams(i.url,n?.details,i.details);this.loadPlaylist(p)}}function ZW(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?s:s&3|8).toString(16)})}}}function jy(r){let e=5381,t=r.length;for(;t;)e=e*33^r.charCodeAt(--t);return(e>>>0).toString()}const Y0=.025;let Eb=(function(r){return r[r.Point=0]="Point",r[r.Range=1]="Range",r})({});function eJ(r,e,t){return`${r.identifier}-${t+1}-${jy(e)}`}class tJ{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return KM(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=KM(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=zt(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return KM(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Y0))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Eb.Range:Eb.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return nJ(this)}}function KM(r,e){return r-e.start<e.duration/2&&!(Math.abs(r-(e.start+e.duration))<Y0)?e.start:e.start+e.duration}function gF(r,e,t){const n=new self.URL(r,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function qM(r,e){for(;(t=r.assetList[++e])!=null&&t.error;)var t;return e}function nJ(r){return`["${r.identifier}" ${r.cue.pre?"<pre>":r.cue.post?"<post>":""}${r.timelineStart.toFixed(2)}-${r.resumeTime.toFixed(2)}]`}function w0(r){const e=r.timelineStart,t=r.duration||0;return`["${r.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class iJ{constructor(e,t,n,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(H.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=n,this.assetItem=i;const a=()=>{this.hasDetails=!0};s.once(H.LEVEL_LOADED,a),s.once(H.AUDIO_TRACK_LOADED,a),s.once(H.SUBTITLE_TRACK_LOADED,a),s.on(H.MEDIA_ATTACHING,(o,{media:c})=>{this.removeMediaListeners(),this.mediaAttached=c,this.interstitial.playoutLimit&&(c.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(H.BUFFER_APPENDED,()=>{const h=this.bufferedEnd;this.reachedPlayout(h)&&(this._bufferedEosTime=h,s.trigger(H.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=gF(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,s=Dn.bufferInfo(e,i,0);return this.getAssetTime(s.end)>=n-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Dn.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var i;(i=this.hls)==null||i.on(e,t)}once(e,t,n){var i;(i=this.hls)==null||i.once(e,t)}off(e,t,n){var i;(i=this.hls)==null||i.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${w0(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const lB=.033;class sJ extends Cl{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(s=i[n])!=null&&s.event;){var s;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let i=0;i<n.length;i++){let s=n[i];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return i}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let i=e;i<=t&&n[i];i++){const s=n[i].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var n;if(((n=t[i].event)==null?void 0:n.identifier)===e)return i}return-1}findAssetIndex(e,t){const n=e.assetList,i=n.length;if(i>1)for(let s=0;s<i;s++){const a=n[s];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&(t<o+(a.duration||0)||s===i-1))return s}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const n=t.assetList,i=n[n.length-1];if(i)return i.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:i}=n,s=this.events,a=this.parseDateRanges(i,{url:n.url},t),o=Object.keys(i),c=s?s.filter(u=>!o.includes(u.identifier)):[];a.length&&a.sort((u,h)=>{const p=u.cue.pre,v=u.cue.post,y=h.cue.pre,x=h.cue.post;if(p&&!y)return-1;if(y&&!p||v&&!x)return 1;if(x&&!v)return-1;if(!p&&!y&&!v&&!x){const S=u.startTime,E=h.startTime;if(S!==E)return S-E}return u.dateRange.tagOrder-h.dateRange.tagOrder}),this.events=a,c.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,c)}updateSchedule(e,t=[],n=!1){const i=this.events||[];if(i.length||t.length||this.length<2){const s=this.items,a=this.parseSchedule(i,e);(n||t.length||s?.length!==a.length||a.some((c,u)=>Math.abs(c.playout.start-s[u].playout.start)>.005||Math.abs(c.playout.end-s[u].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,n){const i=[],s=Object.keys(e);for(let a=0;a<s.length;a++){const o=s[a],c=e[o];if(c.isInterstitial){let u=this.eventMap[o];u?u.setDateRange(c):(u=new tJ(c,t),this.eventMap[o]=u,n===!1&&(u.appendInPlace=n)),i.push(u)}}return i}parseSchedule(e,t){const n=[],i=t.main.details,s=i.live?1/0:i.edge;let a=0;if(e=e.filter(c=>!c.error&&!(c.cue.once&&c.hasPlayed)),e.length){this.resolveOffsets(e,t);let c=0,u=0;if(e.forEach((h,p)=>{const v=h.cue.pre,y=h.cue.post,x=e[p-1]||null,S=h.appendInPlace,E=y?s:h.startOffset,b=h.duration,T=h.timelineOccupancy===Eb.Range?b:0,R=h.resumptionOffset,D=x?.startTime===E,P=E+h.cumulativeDuration;let O=S?P+b:E+R;if(v||!y&&E<=0){const U=u;u+=T,h.timelineStart=P;const B=a;a+=b,n.push({event:h,start:P,end:O,playout:{start:B,end:a},integrated:{start:U,end:u}})}else if(E<=s){if(!D){const I=E-c;if(I>lB){const z=c,W=u;u+=I;const Z=a;a+=I;const te={previousEvent:e[p-1]||null,nextEvent:h,start:z,end:z+I,playout:{start:Z,end:a},integrated:{start:W,end:u}};n.push(te)}else I>0&&x&&(x.cumulativeDuration+=I,n[n.length-1].end=E)}y&&(O=P),h.timelineStart=P;const U=u;u+=T;const B=a;a+=b,n.push({event:h,start:P,end:O,playout:{start:B,end:a},integrated:{start:U,end:u}})}else return;const N=h.resumeTime;y||N>s?c=s:c=N}),c<s){var o;const h=c,p=u,v=s-c;u+=v;const y=a;a+=v,n.push({previousEvent:((o=n[n.length-1])==null?void 0:o.event)||null,nextEvent:null,start:c,end:h+v,playout:{start:y,end:a},integrated:{start:p,end:u}})}this.setDurations(s,a,u)}else n.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,i=n.live?1/0:n.edge;let s=0,a=-1;e.forEach((o,c)=>{const u=o.cue.pre,h=o.cue.post,p=u?0:h?i:o.startTime;this.updateAssetDurations(o),a===p?o.cumulativeDuration=s:(s=0,a=p),!h&&o.snapOptions.in&&(o.resumeAnchor=Up(null,n.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&c+1<e.length&&e[c+1].startTime-e[c].resumeTime<lB&&(e[c+1].appendInPlace=!1,e[c+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const y=zt(o.resumeOffset)?o.resumeOffset:o.duration;s+=y})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(n-i)>Y0?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${i}`),!1):!Object.keys(t).some(a=>{const o=t[a].details,c=o.edge;if(n>=c)return this.log(`"${e.identifier}" resumption ${n} past ${a} playlist end ${c}`),!1;const u=Up(null,o.fragments,n);if(!u)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const h=a==="audio"?.175:0;return Math.abs(u.start-n)<Y0+h||Math.abs(u.end-n)<Y0+h?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${a} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,i=!1,s=!1;for(let a=0;a<e.assetList.length;a++){const o=e.assetList[a],c=t+n;o.startOffset=n,o.timelineStart=c,i||(i=o.duration===null),s||(s=!!o.error);const u=o.error?0:o.duration||0;n+=u}i&&!s?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function ec(r){return`[${r.event?'"'+r.event.identifier+'"':"primary"}: ${r.start.toFixed(2)}-${r.end.toFixed(2)}]`}class rJ{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let i;try{i=gF(n,this.hls.sessionId,e.baseUrl)}catch(v){const y=this.assignAssetListError(e,Ie.ASSET_LIST_LOAD_ERROR,v,n);this.hls.trigger(H.ERROR,y);return}t&&i.protocol!=="data:"&&i.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,a=s.loader,o=new a(s),c={responseType:"json",url:i.href},u=s.interstitialAssetListLoadPolicy.default,h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,y,x,S)=>{const E=v.data,b=E?.ASSETS;if(!Array.isArray(b)){const T=this.assignAssetListError(e,Ie.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),x.url,y,S);this.hls.trigger(H.ERROR,T);return}e.assetListResponse=E,this.hls.trigger(H.ASSET_LIST_LOADED,{event:e,assetListResponse:E,networkDetails:S})},onError:(v,y,x,S)=>{const E=this.assignAssetListError(e,Ie.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${v.code} ${v.text} (${y.url})`),y.url,S,x);this.hls.trigger(H.ERROR,E)},onTimeout:(v,y,x)=>{const S=this.assignAssetListError(e,Ie.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${y.url})`),y.url,v,x);this.hls.trigger(H.ERROR,S)}};return o.load(c,h,p),this.hls.trigger(H.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,n,i,s,a){return e.error=n,{type:rn.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:n,networkDetails:a,stats:s}}}function cB(r){var e;r==null||(e=r.play())==null||e.catch(()=>{})}function MA(r,e){return`[${r}] Advancing timeline position to ${e}`}class aJ extends Cl{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled||!this.schedule)return;const i=n-this.timelinePos;if(Math.abs(i)<1/7056e5)return;const a=i<=-.01;this.timelinePos=n,this.bufferedPos=n;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(n,n-i)&&this.updateSchedule(!0),this.checkBuffer(),a&&n<o.start||n>=o.end){var c;const y=this.findItemIndex(o);let x=this.schedule.findItemIndexAtTime(n);if(x===-1&&(x=y+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${n} (resolving from ${y} to ${x})`)),!this.isInterstitial(o)&&(c=this.media)!=null&&c.paused&&(this.shouldPlay=!1),!a&&x>y){const S=this.schedule.findJumpRestrictedIndex(y+1,x);if(S>y){this.setSchedulePosition(S);return}}this.setSchedulePosition(x);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(o)){const y=o.event.assetList[0];y&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,y))}return}const h=u.timelineStart,p=u.duration||0;if(a&&n<h||n>=h+p){var v;(v=o.event)!=null&&v.appendInPlace&&(this.clearAssetPlayers(o.event,o),this.flushFrontBuffer(n)),this.setScheduleToAssetAtTime(n,u)}},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const i=this.playingItem;if(!i||this.playingLastItem)return;if(n>=i.end){this.timelinePos=i.end;const o=this.findItemIndex(i);this.setSchedulePosition(o+1)}const s=this.playingAsset;if(!s)return;const a=s.timelineStart+(s.duration||0);n>=a&&this.setScheduleToAssetAtTime(n,s)},this.onScheduleUpdate=(n,i)=>{const s=this.schedule;if(!s)return;const a=this.playingItem,o=s.events||[],c=s.items||[],u=s.durations,h=n.map(S=>S.identifier),p=!!(o.length||h.length);(p||i)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${c.map(S=>ec(S))} pos: ${this.timelinePos}`),h.length&&this.log(`Removed events ${h}`);let v=null,y=null;a&&(v=this.updateItem(a,this.timelinePos),this.itemsMatch(a,v)?this.playingItem=v:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const x=this.bufferingItem;if(x&&(y=this.updateItem(x,this.bufferedPos),this.itemsMatch(x,y)?this.bufferingItem=y:x.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(x.event,null))),n.forEach(S=>{S.assetList.forEach(E=>{this.clearAssetPlayer(E.identifier,null)})}),this.playerQueue.forEach(S=>{if(S.interstitial.appendInPlace){const E=S.assetItem.timelineStart,b=S.timelineOffset-E;if(b)try{S.timelineOffset=E}catch(T){Math.abs(b)>Y0&&this.warn(`${T} ("${S.assetId}" ${S.timelineOffset}->${E})`)}}}),p||i){if(this.hls.trigger(H.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:c.slice(0),durations:u,removedIds:h}),this.isInterstitial(a)&&h.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(v,a),x&&y!==v&&this.trimInPlace(y,x),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new rJ(e),this.schedule=new sJ(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(H.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(H.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(H.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(H.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(H.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(H.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(H.BUFFER_APPENDED,this.onBufferAppended,this),e.on(H.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(H.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(H.MEDIA_ENDED,this.onMediaEnded,this),e.on(H.ERROR,this.onError,this),e.on(H.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(H.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(H.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(H.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(H.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(H.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(H.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(H.BUFFER_CODECS,this.onBufferCodecs,this),e.off(H.BUFFER_APPENDED,this.onBufferAppended,this),e.off(H.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(H.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(H.MEDIA_ENDED,this.onMediaEnded,this),e.off(H.ERROR,this.onError,this),e.off(H.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){oo(e,"play",this.onPlay),oo(e,"pause",this.onPause),oo(e,"seeking",this.onSeeking),oo(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;ka(n,"seeking",this.onSeeking),ka(n,"timeupdate",this.onTimeupdate),ka(n,"play",this.onPlay),ka(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!i){this.clearScheduleState();const s=this.findItemIndex(n);this.setSchedulePosition(s)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,i=this.media;if(this.media=null,!n&&(i&&this.removeMediaListeners(i),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.log(`Removing schedule state for detachedData and ${s}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=p=>p&&e.getAssetPlayer(p.identifier),i=(p,v,y,x,S)=>{if(p){let E=p[v].start;const b=p.event;if(b){if(v==="playout"||b.timelineOccupancy!==Eb.Point){const T=n(y);T?.interstitial===b&&(E+=T.assetItem.startOffset+T[S])}}else{const T=x==="bufferedPos"?a():e[x];E+=T-p.start}return E}return 0},s=(p,v)=>{var y;if(p!==0&&v!=="primary"&&(y=e.schedule)!=null&&y.length){var x;const S=e.schedule.findItemIndexAtTime(p),E=(x=e.schedule.items)==null?void 0:x[S];if(E){const b=E[v].start-E.start;return p+b}}return p},a=()=>{const p=e.bufferedPos;return p===Number.MAX_VALUE?o("primary"):Math.max(p,0)},o=p=>{var v,y;return(v=e.primaryDetails)!=null&&v.live?e.primaryDetails.edge:((y=e.schedule)==null?void 0:y.durations[p])||0},c=(p,v)=>{var y,x;const S=e.effectivePlayingItem;if(S!=null&&(y=S.event)!=null&&y.restrictions.skip||!e.schedule)return;e.log(`seek to ${p} "${v}"`);const E=e.effectivePlayingItem,b=e.schedule.findItemIndexAtTime(p,v),T=(x=e.schedule.items)==null?void 0:x[b],R=e.getBufferingPlayer(),D=R?.interstitial,P=D?.appendInPlace,O=E&&e.itemsMatch(E,T);if(E&&(P||O)){const N=n(e.playingAsset),U=N?.media||e.primaryMedia;if(U){const B=v==="primary"?U.currentTime:i(E,v,e.playingAsset,"timelinePos","currentTime"),I=p-B,z=(P?B:U.currentTime)+I;if(z>=0&&(!N||P||z<=N.duration)){U.currentTime=z;return}}}if(T){let N=p;if(v!=="primary"){const B=T[v].start,I=p-B;N=T.start+I}const U=!e.isInterstitial(T);if((!e.isInterstitial(E)||E.event.appendInPlace)&&(U||T.event.appendInPlace)){const B=e.media||(P?R?.media:null);B&&(B.currentTime=N)}else if(E){const B=e.findItemIndex(E);if(b>B){const z=e.schedule.findJumpRestrictedIndex(B+1,b);if(z>B){e.setSchedulePosition(z);return}}let I=0;if(U)e.timelinePos=N,e.checkBuffer();else{const z=T.event.assetList,W=p-(T[v]||T).start;for(let Z=z.length;Z--;){const te=z[Z];if(te.duration&&W>=te.startOffset&&W<te.startOffset+te.duration){I=Z;break}}}e.setSchedulePosition(b,I)}}},u=()=>{const p=e.effectivePlayingItem;if(e.isInterstitial(p))return p;const v=t();return e.isInterstitial(v)?v:null},h={get bufferedEnd(){const p=t(),v=e.bufferingItem;if(v&&v===p){var y;return i(v,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-v.playout.start||((y=e.bufferingAsset)==null?void 0:y.startOffset)||0}return 0},get currentTime(){const p=u(),v=e.effectivePlayingItem;return v&&v===p?i(v,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-v.playout.start:0},set currentTime(p){const v=u(),y=e.effectivePlayingItem;y&&y===v&&c(p+y.playout.start,"playout")},get duration(){const p=u();return p?p.playout.end-p.playout.start:0},get assetPlayers(){var p;const v=(p=u())==null?void 0:p.event.assetList;return v?v.map(y=>e.getAssetPlayer(y.identifier)):[]},get playingIndex(){var p;const v=(p=u())==null?void 0:p.event;return v&&e.effectivePlayingAsset?v.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var p;return((p=e.schedule)==null||(p=p.events)==null?void 0:p.slice(0))||[]},get schedule(){var p;return((p=e.schedule)==null||(p=p.items)==null?void 0:p.slice(0))||[]},get interstitialPlayer(){return u()?h:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const p=t();return e.findItemIndex(p)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const p=e.effectivePlayingItem;return e.findItemIndex(p)},primary:{get bufferedEnd(){return a()},get currentTime(){const p=e.timelinePos;return p>0?p:0},set currentTime(p){c(p,"primary")},get duration(){return o("primary")},get seekableStart(){var p;return((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(p){c(p,"integrated")},get duration(){return o("integrated")},get seekableStart(){var p;return s(((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0,"integrated")}},skip:()=>{const p=e.effectivePlayingItem,v=p?.event;if(v&&!v.restrictions.skip){const y=e.findItemIndex(p);if(v.appendInPlace){const x=p.playout.start+p.event.duration;c(x+.001,"playout")}else e.advanceAfterAssetEnded(v,y,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let i=this.media;!i&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(i=this.primaryMedia);const s=(t=i)==null?void 0:t.currentTime;if(!(s===void 0||!zt(s)))return s}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,i=e.media;if(n&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${ji(s)}`),this.detachedData=s}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var n,i;if(e.media===t)return;let s=null;const a=this.hls,o=e!==a,c=o&&e.interstitial.appendInPlace,u=(n=this.detachedData)==null?void 0:n.mediaSource;let h;if(a.media)c&&(s=a.transferMedia(),this.detachedData=s),h="Primary";else if(u){const x=this.getBufferingPlayer();x?(s=x.transferMedia(),h=`${x}`):h="detached MediaSource"}else h="detached media";if(!s){if(u)s=this.detachedData,this.log(`using detachedData: MediaSource ${ji(s)}`);else if(!this.detachedData||a.media===t){const x=this.playerQueue;x.length>1&&x.forEach(S=>{if(o&&S.interstitial.appendInPlace!==c){const E=S.interstitial;this.clearInterstitial(S.interstitial,null),E.appendInPlace=!1,E.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${E}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const p=s&&"mediaSource"in s&&((i=s.mediaSource)==null?void 0:i.readyState)!=="closed",v=p&&s?s:t;this.log(`${p?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${h} (media.currentTime: ${t.currentTime})`);const y=this.schedule;if(v===s&&y){const x=o&&e.assetId===y.assetIdAtEnd;v.overrides={duration:y.duration,endOfStream:!o||x,cueRemoval:!o}}e.attachMedia(v)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,i=this.effectivePlayingItem;if(n===-1){const s=this.hls.startPosition;if(this.log(MA("checkStart",s)),this.timelinePos=s,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(s>=0||!this.primaryLive){const a=this.timelinePos=s>0?s:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(i&&!this.playingItem){const s=e.findItemIndex(i);this.setSchedulePosition(s)}}advanceAssetBuffering(e,t){const n=e.event,i=n.findAssetIndex(t),s=qM(n,i);if(!n.isAssetPastPlayoutLimit(s))this.bufferedToEvent(e,s);else if(this.schedule){var a;const o=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];o&&this.bufferedToItem(o)}}advanceAfterAssetEnded(e,t,n){const i=qM(e,n);if(e.isAssetPastPlayoutLimit(i)){if(this.schedule){const s=this.schedule.items;if(s){const a=t+1,o=s.length;if(a>=o){this.setSchedulePosition(-1);return}const c=e.resumeTime;this.timelinePos<c&&(this.log(MA("advanceAfterAssetEnded",c)),this.timelinePos=c,e.appendInPlace&&this.advanceInPlace(c),this.checkBuffer(this.bufferedPos<c)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const s=e.assetList[i];s&&this.advanceInPlace(s.timelineStart)}this.setSchedulePosition(t,i)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const i=t.parentIdentifier,s=n.getEvent(i);if(s){const a=n.findEventIndex(i),o=n.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,a,o-1)}}setSchedulePosition(e,t){var n;const i=(n=this.schedule)==null?void 0:n.items;if(!i||this.playbackDisabled)return;const s=e>=0?i[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${s&&ec(s)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,o=this.playingLastItem;if(this.isInterstitial(a)){const h=a.event,p=this.playingAsset,v=p?.identifier,y=v?this.getAssetPlayer(v):null;if(y&&v&&(!this.eventItemsMatch(a,s)||t!==void 0&&v!==h.assetList[t].identifier)){var c;const x=h.findAssetIndex(p);if(this.log(`INTERSTITIAL_ASSET_ENDED ${x+1}/${h.assetList.length} ${w0(p)}`),this.endedAsset=p,this.playingAsset=null,this.hls.trigger(H.INTERSTITIAL_ASSET_ENDED,{asset:p,assetListIndex:x,event:h,schedule:i.slice(0),scheduleIndex:e,player:y}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(h,this.findItemIndex(this.playingItem),x);return}this.retreiveMediaSource(v,s),y.media&&!((c=this.detachedData)!=null&&c.mediaSource)&&y.detachMedia()}if(!this.eventItemsMatch(a,s)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${h} ${ec(a)}`),h.hasPlayed=!0,this.hls.trigger(H.INTERSTITIAL_ENDED,{event:h,schedule:i.slice(0),scheduleIndex:e}),h.cue.once)){var u;this.updateSchedule();const x=(u=this.schedule)==null?void 0:u.items;if(s&&x){const S=this.findItemIndex(s);this.advanceSchedule(S,x,t,a,o)}return}}this.advanceSchedule(e,i,t,a,o)}advanceSchedule(e,t,n,i,s){const a=this.schedule;if(!a)return;const o=t[e]||null,c=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(h=>{const p=h.interstitial,v=a.findEventIndex(p.identifier);(v<e||v>e+1)&&this.clearInterstitial(p,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const h=o.event;if(n===void 0){n=a.findAssetIndex(h,this.timelinePos);const x=qM(h,n-1);if(h.isAssetPastPlayoutLimit(x)||h.appendInPlace&&this.timelinePos===o.end){this.advanceAfterAssetEnded(h,e,n);return}n=x}const p=this.waitingItem;this.assetsBuffered(o,c)||this.setBufferingItem(o);let v=this.preloadAssets(h,n);if(this.eventItemsMatch(o,p||i)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${ec(o)} ${h.appendInPlace?"append in place":""}`),this.hls.trigger(H.INTERSTITIAL_STARTED,{event:h,schedule:t.slice(0),scheduleIndex:e})),!h.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${h}`);return}if(h.assetListLoader&&(h.assetListLoader.destroy(),h.assetListLoader=void 0),!c){this.log(`Waiting for attachMedia to start Interstitial ${h}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const y=h.assetList[n];if(!y){this.advanceAfterAssetEnded(h,e,n||0);return}if(v||(v=this.getAssetPlayer(y.identifier)),v===null||v.destroyed){const x=h.assetList.length;this.warn(`asset ${n+1}/${x} player destroyed ${h}`),v=this.createAssetPlayer(h,y,n),v.loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&h.appendInPlace&&this.isAssetBuffered(y))return;this.startAssetPlayer(v,n,t,e,c),this.shouldPlay&&cB(v.media)}else o?(this.resumePrimary(o,e,i),this.shouldPlay&&cB(this.hls.media)):s&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var i,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${ec(e)}`),!((i=this.detachedData)!=null&&i.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.log(MA("resumePrimary",o)),this.timelinePos=o),this.attachPrimary(o,e)}if(!n)return;const a=(s=this.schedule)==null?void 0:s.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${ec(e)}`),this.hls.trigger(H.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const i=this.primaryDetails;if(t===0)return this.hls.startPosition;if(i&&(n<i.fragmentStart||n>i.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Dn.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,i),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(MA("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs((((n=i.mainForwardBufferInfo)==null?void 0:n.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(H.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(H.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const i=Oi(Oi({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Oi(Oi({},this.altSelection),{},{audio:n});return}const s=Oi(Oi({},i),{},{audio:n});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Oi(Oi({},this.altSelection),{},{subtitles:n});return}const s=Oi(Oi({},i),{},{subtitles:n});this.mediaSelection=s}onAudioTrackSwitching(e,t){const n=y3(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setAudioOption(t)||i.setAudioOption(n)))}onSubtitleTrackSwitch(e,t){const n=y3(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setSubtitleOption(t)||t.id!==-1&&i.setSubtitleOption(n)))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let i=0;i<t.length;i++){const s=t[i];if(s.cue.post){var n;const a=this.schedule.findEventIndex(s.identifier),o=(n=this.schedule.items)==null?void 0:n[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const i=(n=this.schedule)==null?void 0:n.items;if(e&&i){const s=this.findItemIndex(e,t);return i[s]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(s.identifier,null)});const n=e.end+.25,i=Dn.bufferInfo(this.primaryMedia,n,0);(i.end>n||(i.nextStart||0)>n)&&(this.log(`trim buffered interstitial ${ec(e)} (was ${ec(t)})`),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const n=this.mediaSelection;n&&((t=this.schedule)==null||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=(t=this.schedule)==null?void 0:t.items;if(!n)return;const i=Dn.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,n,e)}updateBufferedPos(e,t,n){const i=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!i)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let c=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;const h=this.findItemIndex(s),p=Math.min(h+1,t.length-1),v=t[p];if((c===-1&&s&&e>=s.end||(u=v.event)!=null&&u.appendInPlace&&e+.01>=v.start)&&(c=p),this.isInterstitial(s)){const y=s.event;if(p-o>1&&y.appendInPlace===!1||y.assetList.length===0&&y.assetListLoader)return}if(this.bufferedPos=e,c>h&&c>o)this.bufferedToItem(v);else{const y=this.primaryDetails;this.primaryLive&&y&&e>y.edge-y.targetduration&&v.start<y.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(v)&&this.preloadAssets(v.event,0)}}else n&&a&&!this.itemsMatch(a,s)&&(c===o?this.bufferedToItem(a):c===o+1&&this.bufferedToItem(t[c]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(i=>{const s=this.getAssetPlayer(i.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:i,events:s}=n;if(!i||!s)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const c=o?o.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${ec(e)}`+(t?` (${c.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const u=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((h,p)=>{const v=this.getAssetPlayer(h.identifier);v&&(p===u&&v.loadSource(),v.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(H.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const i=this.detachedData;i?i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,i=n.assetList.length===0&&!n.assetListLoader,s=n.cue.once;if(i||!s){const a=this.preloadAssets(n,t);if(a!=null&&a.interstitial.appendInPlace){const o=this.primaryMedia;o&&this.bufferAssetPlayer(a,o)}}}preloadAssets(e,t){const n=e.assetUrl,i=e.assetList.length,s=i===0&&!e.assetListLoader,a=e.cue.once;if(s){const c=e.timelineStart;if(e.appendInPlace){var o;const v=this.playingItem;!this.isInterstitial(v)&&(v==null||(o=v.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(c+.25)}let u,h=0;if(!this.playingItem&&this.primaryLive&&(h=this.hls.startPosition,h===-1&&(h=this.hls.liveSyncPosition||0)),h&&!(e.cue.pre||e.cue.post)){const v=h-c;v>0&&(u=Math.round(v*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:i} ${e}${u?` live-start: ${h} start-offset: ${u}`:""}`),n)return this.createAsset(e,0,0,c,e.duration,n);const p=this.assetListLoader.loadAssetList(e,u);p&&(e.assetListLoader=p)}else if(!a&&i){for(let u=t;u<i;u++){const h=e.assetList[u],p=this.getAssetPlayerQueueIndex(h.identifier);(p===-1||this.playerQueue[p].destroyed)&&!h.error&&this.createAssetPlayer(e,h,u)}const c=e.assetList[t];if(c){const u=this.getAssetPlayer(c.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(i=>{this.hls.trigger(H.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:i})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,i,s,a){const o={parentIdentifier:e.identifier,identifier:eJ(e,a,t),duration:s,startOffset:n,timelineStart:i,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,n){const i=this.hls,s=i.userConfig;let a=s.videoPreference;const o=i.loadLevelObj||i.levels[i.currentLevel];(a||o)&&(a=Gi({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const c=i.audioTracks[i.audioTrack],u=i.subtitleTracks[i.subtitleTrack];let h=0;if(this.primaryLive||e.appendInPlace){const D=this.timelinePos-t.timelineStart;if(D>1){const P=t.duration;P&&D<P&&(h=D)}}const p=t.identifier,v=Oi(Oi({},s),{},{maxMaxBufferLength:Math.min(180,i.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:h,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:c||s.audioPreference,subtitlePreference:u||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(v.timelineOffset=t.timelineStart));const y=v.cmcd;y!=null&&y.sessionId&&y.contentId&&(v.cmcd=Gi({},y,{contentId:jy(t.uri)})),this.getAssetPlayer(p)&&this.warn(`Duplicate date range identifier ${e} and asset ${p}`);const x=new iJ(this.HlsPlayerClass,v,e,t);this.playerQueue.push(x),e.assetList[n]=t;let S=!0;const E=D=>{if(D.live){var P;const U=new Error(`Interstitials MUST be VOD assets ${e}`),B={fatal:!0,type:rn.OTHER_ERROR,details:Ie.INTERSTITIAL_ASSET_ITEM_ERROR,error:U},I=((P=this.schedule)==null?void 0:P.findEventIndex(e.identifier))||-1;this.handleAssetItemError(B,e,I,n,U.message);return}const O=D.edge-D.fragmentStart,N=t.duration;(S||N===null||O>N)&&(S=!1,this.log(`Interstitial asset "${p}" duration change ${N} > ${O}`),t.duration=O,this.updateSchedule())};x.on(H.LEVEL_UPDATED,(D,{details:P})=>E(P)),x.on(H.LEVEL_PTS_UPDATED,(D,{details:P})=>E(P)),x.on(H.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const b=(D,P)=>{const O=this.getAssetPlayer(p);if(O&&P.tracks){O.off(H.BUFFER_CODECS,b),O.tracks=P.tracks;const N=this.primaryMedia;this.bufferingAsset===O.assetItem&&N&&!O.media&&this.bufferAssetPlayer(O,N)}};x.on(H.BUFFER_CODECS,b);const T=()=>{var D;const P=this.getAssetPlayer(p);if(this.log(`buffered to end of asset ${P}`),!P||!this.schedule)return;const O=this.schedule.findEventIndex(e.identifier),N=(D=this.schedule.items)==null?void 0:D[O];this.isInterstitial(N)&&this.advanceAssetBuffering(N,t)};x.on(H.BUFFERED_TO_END,T);const R=D=>()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;this.shouldPlay=!0;const O=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,O,D)};return x.once(H.MEDIA_ENDED,R(n)),x.once(H.PLAYOUT_LIMIT_REACHED,R(1/0)),x.on(H.ERROR,(D,P)=>{if(!this.schedule)return;const O=this.getAssetPlayer(p);if(P.details===Ie.BUFFER_STALLED_ERROR){if(O!=null&&O.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(P,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${P.error} ${e}`)}),x.on(H.DESTROYING,()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;const P=new Error(`Asset player destroyed unexpectedly ${p}`),O={fatal:!0,type:rn.OTHER_ERROR,details:Ie.INTERSTITIAL_ASSET_ITEM_ERROR,error:P};this.handleAssetItemError(O,e,this.schedule.findEventIndex(e.identifier),n,P.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${w0(t)}`),this.hls.trigger(H.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:x}),x}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){const i=this.playerQueue[n];this.log(`clear ${i} toSegment: ${t&&ec(t)}`),this.transferMediaFromPlayer(i,t),this.playerQueue.splice(n,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,i,s){const{interstitial:a,assetItem:o,assetId:c}=e,u=a.assetList.length,h=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!h||h.identifier!==c)&&(h&&(this.clearAssetPlayer(h.identifier,n[i]),delete h.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${w0(o)}`),this.hls.trigger(H.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:n.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var n,i;if(!this.schedule)return;const{interstitial:s,assetItem:a}=e,o=this.schedule.findEventIndex(s.identifier),c=(n=this.schedule.items)==null?void 0:n[o];if(!c)return;e.loadSource(),this.setBufferingItem(c),this.bufferingAsset=a;const u=this.getBufferingPlayer();if(u===e)return;const h=s.appendInPlace;if(h&&u?.interstitial.appendInPlace===!1)return;const p=u?.tracks||((i=this.detachedData)==null?void 0:i.tracks)||this.requiredTracks;if(h&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(p&&!YN(p,e.tracks)){const v=new Error(`Asset ${w0(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(p)}')`),y={fatal:!0,type:rn.OTHER_ERROR,details:Ie.INTERSTITIAL_ASSET_ITEM_ERROR,error:v},x=s.findAssetIndex(a);this.handleAssetItemError(y,s,o,x,v.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const i=n.currentTime,s=t.findAssetIndex(e,i),a=e.assetList[s];if(a){const o=this.getAssetPlayer(a.identifier);if(o){const c=o.currentTime||i-a.timelineStart,u=o.duration-c;if(this.warn(`Stalled at ${c} of ${c+u} in ${o} ${e} (media.currentTime: ${i})`),c&&(u/n.playbackRate<.5||o.bufferedInPlaceToEnd(n))&&o.hls){const h=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,h,s)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,i,s){if(e.details===Ie.BUFFER_STALLED_ERROR)return;const a=t.assetList[i]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&w0(a)} ${e.error}`),!this.schedule)return;const o=a?.identifier||"",c=this.getAssetPlayerQueueIndex(o),u=this.playerQueue[c]||null,h=this.schedule.items,p=Gi({},e,{fatal:!1,errorAction:z0(!0),asset:a,assetListIndex:i,event:t,schedule:h,scheduleIndex:n,player:u});if(this.hls.trigger(H.INTERSTITIAL_ASSET_ERROR,p),!e.fatal)return;const v=this.playingAsset,y=this.bufferingAsset,x=new Error(s);if(a&&(this.clearAssetPlayer(o,null),a.error=x),!t.assetList.some(S=>!S.error))t.error=x;else for(let S=i;S<t.assetList.length;S++)this.resetAssetPlayer(t.assetList[S].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):v&&v.identifier===o?this.advanceAfterAssetEnded(t,n,i):y&&y.identifier===o&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,y)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;let i=this.timelinePos;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${i} playing: ${ec(n)} error: ${e.error}`),i===-1&&(i=this.hls.startPosition);const a=this.updateItem(n,i);this.itemsMatch(n,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(i===-1){this.checkStart();return}if(!this.schedule)return;const s=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(s)}onAssetListLoaded(e,t){var n,i;const s=t.event,a=s.identifier,o=t.assetListResponse.ASSETS;if(!((n=this.schedule)!=null&&n.hasEvent(a)))return;const c=s.timelineStart,u=s.duration;let h=0;o.forEach((S,E)=>{const b=parseFloat(S.DURATION);this.createAsset(s,E,h,c+h,b,S.URI),h+=b}),s.duration=h,this.log(`Loaded asset-list with duration: ${h} (was: ${u}) ${s}`);const p=this.waitingItem,v=p?.event.identifier===a;this.updateSchedule();const y=(i=this.bufferingItem)==null?void 0:i.event;if(v){var x;const S=this.schedule.findEventIndex(a),E=(x=this.schedule.items)==null?void 0:x[S];if(E){if(!this.playingItem&&this.timelinePos>E.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==S){s.error=new Error(`Interstitial ${o.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${s}`),this.log(s.error.message),this.updateSchedule(!0),this.primaryFallback(s);return}this.setBufferingItem(E)}this.setSchedulePosition(S)}else if(y?.identifier===a){const S=s.assetList[0];if(S){const E=this.getAssetPlayer(S.identifier);if(y.appendInPlace){const b=this.primaryMedia;E&&b&&this.bufferAssetPlayer(E,b)}else E&&E.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case Ie.ASSET_LIST_PARSING_ERROR:case Ie.ASSET_LIST_LOAD_ERROR:case Ie.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break}case Ie.BUFFER_STALLED_ERROR:{const n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace){this.handleInPlaceStall(n.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const uB=500;class vF extends AT{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",qt.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(H.LEVEL_LOADED,this.onLevelLoaded,this),e.on(H.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(H.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(H.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(H.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(H.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(H.LEVEL_LOADED,this.onLevelLoaded,this),e.off(H.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(H.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(H.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(H.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(H.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=lt.IDLE,this.setInterval(uB),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:i}=t;if(this.fragContextChanged(n)||(Ps(n)&&(this.fragPrevious=n),this.state=lt.IDLE),!i)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let a;const o=n.start;for(let u=0;u<s.length;u++)if(o>=s[u].start&&o<=s[u].end){a=s[u];break}const c=n.start+n.duration;a?a.end=c:(a={start:o,end:c},s.push(a)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:i}=t;if(n===0&&i!==Number.POSITIVE_INFINITY){const s=i-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=s){a.shift();continue}else if(a[o].start<s)a[o].start=s;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(n,s,qt.SUBTITLE)}}onError(e,t){const n=t.frag;n?.type===qt.SUBTITLE&&(t.details===Ie.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==lt.STOPPED&&(this.state=lt.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&WU(this.levels,t)){this.levels=t.map(n=>new mg(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const i=new mg(n);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,qt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==lt.STOPPED&&this.setInterval(uB)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:i,levels:s}=this,{details:a,id:o}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const c=s[o];if(o>=s.length||!c)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(a.live||(n=c.details)!=null&&n.live){if(a.deltaUpdateFailed)return;const p=this.mainDetails;if(!p){this.startFragRequested=!1;return}const v=p.fragments[0];if(!c.details)a.hasProgramDateTime&&p.hasProgramDateTime?(Sb(a,p),u=a.fragmentStart):v&&(u=v.start,aR(a,u));else{var h;u=this.alignPlaylists(a,c.details,(h=this.levelLastLoaded)==null?void 0:h.details),u===0&&v&&(u=v.start,aR(a,u))}p&&!this.startFragRequested&&this.setStartPosition(p,u)}c.details=a,this.levelLastLoaded=c,o===i&&(this.hls.trigger(H.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===lt.IDLE&&(Up(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),c.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,i=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&i!=null&&i.key&&i.iv&&V0(i.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer,ZD(i.method)).catch(o=>{throw s.trigger(H.ERROR,{type:rn.MEDIA_ERROR,details:Ie.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const c=performance.now();s.trigger(H.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:c}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=lt.IDLE})}}doTick(){if(!this.media){this.state=lt.IDLE;return}if(this.state===lt.IDLE){const{currentTrackId:e,levels:t}=this,n=t?.[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:i}=this,s=this.getLoadPosition(),a=Dn.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,i.maxBufferHole),{end:o,len:c}=a,u=n.details,h=this.hls.maxBufferLength+u.levelTargetDuration;if(c>h)return;const p=u.fragments,v=p.length,y=u.edge;let x=null;const S=this.fragPrevious;if(o<y){const T=i.maxFragLookUpTolerance,R=o>y-T?0:T;x=Up(S,p,Math.max(p[0].start,o),R),!x&&S&&S.start<p[0].start&&(x=p[0])}else x=p[v-1];if(x=this.filterReplacedPrimary(x,n.details),!x)return;const E=x.sn-u.startSN,b=p[E-1];if(b&&b.cc===x.cc&&this.fragmentTracker.getState(b)===rr.NOT_LOADED&&(x=b),this.fragmentTracker.getState(x)===rr.NOT_LOADED){const T=this.mapToInitFragWhenRequired(x);T&&this.loadFragment(T,n,o)}}}loadFragment(e,t,n){Ps(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new oJ(this.tracksBuffered[this.currentTrackId]||[])}}class oJ{constructor(e){this.buffered=void 0;const t=(n,i,s)=>{if(i=i>>>0,i>s-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const lJ={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},yF=r=>String.fromCharCode(lJ[r]||r),nc=15,Ju=100,cJ={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},uJ={17:2,18:4,21:6,22:8,23:10,19:13,20:15},fJ={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},hJ={25:2,26:4,29:6,30:8,31:10,27:13,28:15},dJ=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class pJ{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;Pi.log(`${this.time} [${e}] ${n}`)}}}const $d=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class xF{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const i=t[n];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class mJ{constructor(){this.uchar=" ",this.penState=new xF}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class gJ{constructor(e){this.chars=[],this.pos=0,this.currPenState=new xF,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Ju;t++)this.chars.push(new mJ);this.logger=e}equals(e){for(let t=0;t<Ju;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Ju;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Ju;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Ju&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Ju)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=yF(e);if(this.pos>=Ju){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Ju;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<Ju;n++){const i=this.chars[n].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class jM{constructor(e){this.rows=[],this.currRow=nc-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<nc;t++)this.rows.push(new gJ(e));this.logger=e}reset(){for(let e=0;e<nc;e++)this.rows[e].clear();this.currRow=nc-1}equals(e){let t=!0;for(let n=0;n<nc;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<nc;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<nc;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+ji(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<nc;o++)this.rows[o].clear();const s=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[s].cueStartTime,c=this.logger.time;if(o!==null&&c!==null&&o<c)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(a.rows[s+u])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,a=Math.max(s-1,0);n.setCursor(e.indent),e.color=n.chars[a].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+ji(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",i=-1;for(let s=0;s<nc;s++){const a=this.rows[s].getTextString();a&&(i=s+1,e?t.push("Row "+i+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class fB{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new jM(n),this.nonDisplayedMemory=new jM(n),this.lastOutputScreen=new jM(n),this.currRollUpRow=this.displayedMemory.rows[nc-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[nc-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[n]}this.logger.log(2,"MIDROW: "+ji(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class hB{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=yJ(),this.logger=void 0;const i=this.logger=new pJ;this.channels=[null,new fB(e,t,i),new fB(e+1,n,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const i=t[n]&127,s=t[n+1]&127;let a=!1,o=null;if(i===0&&s===0)continue;this.logger.log(3,()=>"["+$d([t[n],t[n+1]])+"] -> ("+$d([i,s])+")");const c=this.cmdHistory;if(i>=16&&i<=31){if(vJ(i,s,c)){CA(null,null,c),this.logger.log(3,()=>"Repeated command ("+$d([i,s])+") is dropped");continue}CA(i,s,this.cmdHistory),a=this.parseCmd(i,s),a||(a=this.parseMidrow(i,s)),a||(a=this.parsePAC(i,s)),a||(a=this.parseBackgroundAttributes(i,s))}else CA(null,null,c);if(!a&&(o=this.parseChars(i,s),o)){const h=this.currentChannel;h&&h>0?this.channels[h].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+$d([i,s])+" orig: "+$d([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(n||i))return!1;const s=e===20||e===21||e===23?1:2,a=this.channels[s];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[n];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+$d([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(i||s))return!1;const a=e<=23?1:2;t>=64&&t<=95?n=a===1?cJ[e]:fJ[e]:n=a===1?uJ[e]:hJ[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(n,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let n;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,i.underline=(n&1)===1,n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((n-16)/2)*4,i}parseChars(e,t){let n,i=null,s=null;if(e>=25?(n=2,s=e-8):(n=1,s=e),s>=17&&s<=19){let a;s===17?a=t+80:s===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+yF(a)+"' in channel "+n),i=[a]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+$d(i).join(",")),i}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(n||i))return!1;let s;const a={};e===16||e===24?(s=Math.floor((t-32)/2),a.background=dJ[s],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}CA(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function CA(r,e,t){t.a=r,t.b=e}function vJ(r,e,t){return t.a===r&&t.b===e}function yJ(){return{a:null,b:null}}var fL=(function(){if(_b!=null&&_b.VTTCue)return self.VTTCue;const r=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,c){if(typeof c!="string"||!Array.isArray(o))return!1;const u=c.toLowerCase();return~o.indexOf(u)?u:!1}function n(o){return t(r,o)}function i(o){return t(e,o)}function s(o,...c){let u=1;for(;u<arguments.length;u++){const h=arguments[u];for(const p in h)o[p]=h[p]}return o}function a(o,c,u){const h=this,p={enumerable:!0};h.hasBeenReset=!1;let v="",y=!1,x=o,S=c,E=u,b=null,T="",R=!0,D="auto",P="start",O=50,N="middle",U=50,B="middle";Object.defineProperty(h,"id",s({},p,{get:function(){return v},set:function(I){v=""+I}})),Object.defineProperty(h,"pauseOnExit",s({},p,{get:function(){return y},set:function(I){y=!!I}})),Object.defineProperty(h,"startTime",s({},p,{get:function(){return x},set:function(I){if(typeof I!="number")throw new TypeError("Start time must be set to a number.");x=I,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",s({},p,{get:function(){return S},set:function(I){if(typeof I!="number")throw new TypeError("End time must be set to a number.");S=I,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",s({},p,{get:function(){return E},set:function(I){E=""+I,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",s({},p,{get:function(){return b},set:function(I){b=I,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",s({},p,{get:function(){return T},set:function(I){const z=n(I);if(z===!1)throw new SyntaxError("An invalid or illegal string was specified.");T=z,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",s({},p,{get:function(){return R},set:function(I){R=!!I,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",s({},p,{get:function(){return D},set:function(I){if(typeof I!="number"&&I!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");D=I,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",s({},p,{get:function(){return P},set:function(I){const z=i(I);if(!z)throw new SyntaxError("An invalid or illegal string was specified.");P=z,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",s({},p,{get:function(){return O},set:function(I){if(I<0||I>100)throw new Error("Position must be between 0 and 100.");O=I,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",s({},p,{get:function(){return N},set:function(I){const z=i(I);if(!z)throw new SyntaxError("An invalid or illegal string was specified.");N=z,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",s({},p,{get:function(){return U},set:function(I){if(I<0||I>100)throw new Error("Size must be between 0 and 100.");U=I,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",s({},p,{get:function(){return B},set:function(I){const z=i(I);if(!z)throw new SyntaxError("An invalid or illegal string was specified.");B=z,this.hasBeenReset=!0}})),h.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a})();class xJ{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function _F(r){function e(n,i,s,a){return(n|0)*3600+(i|0)*60+(s|0)+parseFloat(a||0)}const t=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class _J{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function SF(r,e,t,n){const i=n?r.split(n):[r];for(const s in i){if(typeof i[s]!="string")continue;const a=i[s].split(t);if(a.length!==2)continue;const o=a[0],c=a[1];e(o,c)}}const pR=new fL(0,0,""),RA=pR.align==="middle"?"middle":"center";function SJ(r,e,t){const n=r;function i(){const o=_F(r);if(o===null)throw new Error("Malformed timestamp: "+n);return r=r.replace(/^[^\sa-zA-Z-]+/,""),o}function s(o,c){const u=new _J;SF(o,function(v,y){let x;switch(v){case"region":for(let S=t.length-1;S>=0;S--)if(t[S].id===y){u.set(v,t[S].region);break}break;case"vertical":u.alt(v,y,["rl","lr"]);break;case"line":x=y.split(","),u.integer(v,x[0]),u.percent(v,x[0])&&u.set("snapToLines",!1),u.alt(v,x[0],["auto"]),x.length===2&&u.alt("lineAlign",x[1],["start",RA,"end"]);break;case"position":x=y.split(","),u.percent(v,x[0]),x.length===2&&u.alt("positionAlign",x[1],["start",RA,"end","line-left","line-right","auto"]);break;case"size":u.percent(v,y);break;case"align":u.alt(v,y,["start",RA,"end","left","right"]);break}},/:/,/\s/),c.region=u.get("region",null),c.vertical=u.get("vertical","");let h=u.get("line","auto");h==="auto"&&pR.line===-1&&(h=-1),c.line=h,c.lineAlign=u.get("lineAlign","start"),c.snapToLines=u.get("snapToLines",!0),c.size=u.get("size",100),c.align=u.get("align",RA);let p=u.get("position","auto");p==="auto"&&pR.position===50&&(p=c.align==="start"||c.align==="left"?0:c.align==="end"||c.align==="right"?100:50),c.position=p}function a(){r=r.replace(/^\s+/,"")}if(a(),e.startTime=i(),a(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);r=r.slice(3),a(),e.endTime=i(),a(),s(r,e)}function AF(r){return r.replace(/<br(?: \/)?>/gi,`
`)}class AJ{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new xJ,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let s=t.buffer,a=0;for(s=AF(s);a<s.length&&s[a]!=="\r"&&s[a]!==`
`;)++a;const o=s.slice(0,a);return s[a]==="\r"&&++a,s[a]===`
`&&++a,t.buffer=s.slice(a),o}function i(s){SF(s,function(a,o){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=n();const o=s.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:s=n(),t.state){case"HEADER":/:/.test(s)?i(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new fL(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{SJ(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=s.indexOf("-->")!==-1;if(!s||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const EJ=/\r\n|\n\r|\n|\r/g,WM=function(e,t,n=0){return e.slice(n,n+t.length)===t},bJ=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!zt(t)||!zt(n)||!zt(i)||!zt(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*i,t+=3600*1e3*s,t};function hL(r,e,t){return jy(r.toString())+jy(e.toString())+jy(t)}const TJ=function(e,t,n){let i=e[t],s=e[i.prevCC];if(!s||!s.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(a=s)!=null&&a.new;){var a;e.ccOffset+=i.start-s.start,i.new=!1,i=s,s=e[i.prevCC]}e.presentationOffset=n};function MJ(r,e,t,n,i,s,a){const o=new AJ,c=ko(new Uint8Array(r)).trim().replace(EJ,`
`).split(`
`),u=[],h=e?Gj(e.baseTime,e.timescale):0;let p="00:00.000",v=0,y=0,x,S=!0;o.oncue=function(E){const b=t[n];let T=t.ccOffset;const R=(v-h)/9e4;if(b!=null&&b.new&&(y!==void 0?T=t.ccOffset=b.start:TJ(t,n,R)),R){if(!e){x=new Error("Missing initPTS for VTT MPEGTS");return}T=R-t.presentationOffset}const D=E.endTime-E.startTime,P=Do((E.startTime+T-y)*9e4,i*9e4)/9e4;E.startTime=Math.max(P,0),E.endTime=Math.max(P+D,0);const O=E.text.trim();E.text=decodeURIComponent(encodeURIComponent(O)),E.id||(E.id=hL(E.startTime,E.endTime,O)),E.endTime>0&&u.push(E)},o.onparsingerror=function(E){x=E},o.onflush=function(){if(x){a(x);return}s(u)},c.forEach(E=>{if(S)if(WM(E,"X-TIMESTAMP-MAP=")){S=!1,E.slice(16).split(",").forEach(b=>{WM(b,"LOCAL:")?p=b.slice(6):WM(b,"MPEGTS:")&&(v=parseInt(b.slice(7)))});try{y=bJ(p)/1e3}catch(b){x=b}return}else E===""&&(S=!1);o.parse(E+`
`)}),o.flush()}const JM="stpp.ttml.im1t",EF=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,bF=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,CJ={left:"start",center:"center",right:"end",start:"start",end:"end"};function dB(r,e,t,n){const i=Yn(new Uint8Array(r),["mdat"]);if(i.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const s=i.map(o=>ko(o)),a=kj(e.baseTime,1,e.timescale);try{s.forEach(o=>t(RJ(o,a)))}catch(o){n(o)}}function RJ(r,e){const i=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce((p,v)=>(p[v]=i.getAttribute(`ttp:${v}`)||s[v],p),{}),o=i.getAttribute("xml:space")!=="preserve",c=pB($M(i,"styling","style")),u=pB($M(i,"layout","region")),h=$M(i,"body","[begin]");return[].map.call(h,p=>{const v=TF(p,o);if(!v||!p.hasAttribute("begin"))return null;const y=ZM(p.getAttribute("begin"),a),x=ZM(p.getAttribute("dur"),a);let S=ZM(p.getAttribute("end"),a);if(y===null)throw mB(p);if(S===null){if(x===null)throw mB(p);S=y+x}const E=new fL(y-e,S-e,v);E.id=hL(E.startTime,E.endTime,E.text);const b=u[p.getAttribute("region")],T=c[p.getAttribute("style")],R=DJ(b,T,c),{textAlign:D}=R;if(D){const P=CJ[D];P&&(E.lineAlign=P),E.align=D}return Gi(E,R),E}).filter(p=>p!==null)}function $M(r,e,t){const n=r.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function pB(r){return r.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function TF(r,e){return[].slice.call(r.childNodes).reduce((t,n,i)=>{var s;return n.nodeName==="br"&&i?t+`
`:(s=n.childNodes)!=null&&s.length?TF(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function DJ(r,e,t){const n="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(i=t[a]),s.reduce((o,c)=>{const u=QM(e,n,c)||QM(r,n,c)||QM(i,n,c);return u&&(o[c]=u),o},{})}function QM(r,e,t){return r&&r.hasAttributeNS(e,t)?r.getAttributeNS(e,t):null}function mB(r){return new Error(`Could not parse ttml timestamp ${r}`)}function ZM(r,e){if(!r)return null;let t=_F(r);return t===null&&(EF.test(r)?t=LJ(r,e):bF.test(r)&&(t=wJ(r,e))),t}function LJ(r,e){const t=EF.exec(r),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function wJ(r,e){const t=bF.exec(r),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class DA{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class MF{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=vB(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(H.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(H.FRAG_LOADING,this.onFragLoading,this),e.on(H.FRAG_LOADED,this.onFragLoaded,this),e.on(H.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(H.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(H.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(H.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(H.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(H.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(H.FRAG_LOADING,this.onFragLoading,this),e.off(H.FRAG_LOADED,this.onFragLoaded,this),e.off(H.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(H.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(H.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(H.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(H.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new DA(this,"textTrack1"),t=new DA(this,"textTrack2"),n=new DA(this,"textTrack3"),i=new DA(this,"textTrack4");this.cea608Parser1=new hB(1,e,t),this.cea608Parser2=new hB(3,n,i)}addCues(e,t,n,i,s){let a=!1;for(let o=s.length;o--;){const c=s[o],u=IJ(c[0],c[1],t,n);if(u>=0&&(c[0]=Math.min(c[0],t),c[1]=Math.max(c[1],n),a=!0,u/(n-t)>.5))return}if(a||s.push([t,n]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,n,i)}else{const o=this.Cues.newCue(null,t,n,i);this.hls.trigger(H.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:s,trackId:a}){const{unparsedVttFrags:o}=this;n===qt.MAIN&&(this.initPTS[t.cc]={baseTime:i,timescale:s,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(c=>{this.initPTS[c.frag.cc]?this.onFragLoaded(H.FRAG_LOADED,c):this.hls.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let i=0;i<n.textTracks.length;i++){const s=n.textTracks[i];if(gB(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:i}=this,{label:s,languageCode:a}=t[e],o=this.getExistingTrack(s,a);if(o)n[e]=o,P0(n[e]),dF(n[e],i);else{const c=this.createTextTrack("captions",s,a);c&&(c[e]=!0,n[e]=c)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,i={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(H.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,n){const i=this.media;if(i)return i.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:i}=this;Object.keys(i).forEach(s=>{P0(i[s]),delete i[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=vB(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)P0(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],i=n.some(s=>s.textCodec===JM);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(WU(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const a=this.media,o=a?lE(a.textTracks):null;if(this.tracks.forEach((c,u)=>{let h;if(o){let p=null;for(let v=0;v<o.length;v++)if(o[v]&&gB(o[v],c)){p=o[v],o[v]=null;break}p&&(h=p)}if(h)P0(h);else{const p=CF(c);h=this.createTextTrack(p,c.name,c.lang),h&&(h.mode="disabled")}h&&this.textTracks.push(h)}),o!=null&&o.length){const c=o.filter(u=>u!==null).map(u=>u.label);c.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${c.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(H.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const i=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!i)return;const s=`textTrack${i[1]}`,a=this.captionsProperties[s];a&&(a.label=n.name,n.lang&&(a.languageCode=n.lang),a.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===qt.MAIN){var n,i;const{cea608Parser1:s,cea608Parser2:a,lastSn:o}=this,{cc:c,sn:u}=t.frag,h=(n=(i=t.part)==null?void 0:i.index)!=null?n:-1;s&&a&&(u!==o+1||u===o&&h!==this.lastPartIndex+1||c!==this.lastCc)&&(s.reset(),a.reset()),this.lastCc=c,this.lastSn=u,this.lastPartIndex=h}}onFragLoaded(e,t){const{frag:n,payload:i}=t;if(n.type===qt.SUBTITLE)if(i.byteLength){const s=n.decryptdata,a="stats"in t;if(s==null||!s.encrypted||a){const o=this.tracks[n.level],c=this.vttCCs;c[n.cc]||(c[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),o&&o.textCodec===JM?this._parseIMSC1(n,i):this._parseVTTs(t)}}else this.hls.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;dB(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),n.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{n.logger.log(`Failed to parse IMSC1: ${i}`),n.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:n,payload:i}=e,{initPTS:s,unparsedVttFrags:a}=this,o=s.length-1;if(!s[n.cc]&&o===-1){a.push(e);return}const c=this.hls,u=(t=n.initSegment)!=null&&t.data?bl(n.initSegment.data,new Uint8Array(i)).buffer:i;MJ(u,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,h=>{this._appendCues(h,n.level),c.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},h=>{const p=h.message==="Missing initPTS for VTT MPEGTS";p?a.push(e):this._fallbackToIMSC1(n,i),c.logger.log(`Failed to parse VTT cue: ${h}`),!(p&&o>n.cc)&&c.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:h})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||dB(t,this.initPTS[e.cc],()=>{n.textCodec=JM,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(s=>pF(i,s))}else{const i=this.tracks[t];if(!i)return;const s=i.default?"default":"subtitles"+t;n.trigger(H.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===qt.SUBTITLE&&this.onFragLoaded(H.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:i}=t;if(!(n.type===qt.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let s=0;s<i.length;s++){const a=i[s].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(i[s].pts,o[0]),this.cea608Parser2.addData(i[s].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:i,type:s}){const{media:a}=this;if(!(!a||a.currentTime<n)){if(!s||s==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(c=>dR(o[c],t,n))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(c=>dR(o[c],t,i))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let i=2;for(let s=0;s<n;s++){const a=e[i++],o=127&e[i++],c=127&e[i++];if(o===0&&c===0)continue;if((4&a)!==0){const h=3&a;(h===0||h===1)&&(t[h].push(o),t[h].push(c))}}return t}}function CF(r){return r.characteristics&&/transcribes-spoken-dialog/gi.test(r.characteristics)&&/describes-music-and-sound/gi.test(r.characteristics)?"captions":"subtitles"}function gB(r,e){return!!r&&r.kind===CF(e)&&cR(e,r)}function IJ(r,e,t,n){return Math.min(e,n)-Math.max(r,t)}function vB(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const BJ=/\s/,RF={newCue(r,e,t,n){const i=[];let s,a,o,c,u;const h=self.VTTCue||self.TextTrackCue;for(let v=0;v<n.rows.length;v++)if(s=n.rows[v],o=!0,c=0,u="",!s.isEmpty()){var p;for(let S=0;S<s.chars.length;S++)BJ.test(s.chars[S].uchar)&&o?c++:(u+=s.chars[S].uchar,o=!1);s.cueStartTime=e,e===t&&(t+=1e-4),c>=16?c--:c++;const y=AF(u.trim()),x=hL(e,t,y);r!=null&&(p=r.cues)!=null&&p.getCueById(x)||(a=new h(e,t,y),a.id=x,a.line=v+1,a.align="left",a.position=10+Math.min(80,Math.floor(c*8/32)*10),i.push(a))}return r&&i.length&&(i.sort((v,y)=>v.line==="auto"||y.line==="auto"?0:v.line>8&&y.line>8?y.line-v.line:v.line-y.line),i.forEach(v=>pF(r,v))),i}};function DF(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const OJ=/(\d+)-(\d+)\/(\d+)/;class mR{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||FJ,this.controller=new self.AbortController,this.stats=new xT}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const s=PJ(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:c,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=c&&zt(c)?c:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(Ax(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(p=>{var v;this.response=this.loader=p;const y=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},u-(y-i.loading.start)),!p.ok){const{status:S,statusText:E}=p;throw new kJ(E||"fetch, bad network response",S,p)}i.loading.first=y,i.total=UJ(p.headers)||i.total;const x=(v=this.callbacks)==null?void 0:v.onProgress;return x&&zt(t.highWaterMark)?this.loadProgressively(p,i,e,t.highWaterMark,x):a?p.arrayBuffer():e.responseType==="json"?p.json():p.text()}).then(p=>{var v,y;const x=this.response;if(!x)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const S=p[o];S&&(i.loaded=i.total=S);const E={url:x.url,data:p,code:x.status},b=(v=this.callbacks)==null?void 0:v.onProgress;b&&!zt(t.highWaterMark)&&b(i,e,p,x),(y=this.callbacks)==null||y.onSuccess(E,i,e,x)}).catch(p=>{var v;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const y=p&&p.code||0,x=p?p.message:null;(v=this.callbacks)==null||v.onError({code:y,text:x},e,p?p.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,i=0,s){const a=new RU,o=e.body.getReader(),c=()=>o.read().then(u=>{if(u.done)return a.dataLength&&s(t,n,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const h=u.value,p=h.length;return t.loaded+=p,p<i||a.dataLength?(a.push(h),a.dataLength>=i&&s(t,n,a.flush().buffer,e)):s(t,n,h.buffer,e),c()}).catch(()=>Promise.reject());return c()}}function PJ(r,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Gi({},r.headers))};return r.rangeEnd&&t.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),t}function NJ(r){const e=OJ.exec(r);if(e)return parseInt(e[2])-parseInt(e[1])+1}function UJ(r){const e=r.get("Content-Range");if(e){const n=NJ(e);if(zt(n))return n}const t=r.get("Content-Length");if(t)return parseInt(t)}function FJ(r,e){return new self.Request(r.url,e)}class kJ extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const GJ=/^age:\s*[\d.]+\s*$/im;class dL{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new xT,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return s(n,t.url)}).catch(a=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),s(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:n.status,text:a.message},t,n,i)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:a}=n.loadPolicy;if(i)for(const o in i)e.setRequestHeader(o,i[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=s&&zt(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const i=t.readyState,s=this.config;if(!n.aborted&&i>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,h=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const x=h??t.response;if(x!=null){var a,o;n.loading.end=Math.max(self.performance.now(),n.loading.first);const S=t.responseType==="arraybuffer"?x.byteLength:x.length;n.loaded=n.total=S,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const E=(a=this.callbacks)==null?void 0:a.onProgress;E&&E(n,e,x,t);const b={url:t.responseURL,data:x,code:u};(o=this.callbacks)==null||o.onSuccess(b,n,e,t);return}}const p=s.loadPolicy.errorRetry,v=n.retry,y={url:e.url,data:void 0,code:u};if(yb(p,v,!1,y))this.retry(p);else{var c;Pi.error(`${u} while loading ${e.url}`),(c=this.callbacks)==null||c.onError({code:u,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(yb(e,t,!0))this.retry(e);else{var n;Pi.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=JD(e,n.retry),n.retry++,Pi.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&GJ.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const HJ={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},zJ=Oi(Oi({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:dL,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:oU,bufferController:QU,capLevelController:TT,errorController:hU,fpsController:hF,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:tL,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:HJ},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},VJ()),{},{subtitleStreamController:vF,subtitleTrackController:mF,timelineController:MF,audioStreamController:jU,audioTrackController:JU,emeController:Sp,cmcdController:cF,contentSteeringController:uF,interstitialsController:aJ});function VJ(){return{cueHandler:RF,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function YJ(r,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=gR(r),i=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,c=e[o]===void 0,u=[];s.forEach(h=>{const p=`${a}Loading${h}`,v=e[p];if(v!==void 0&&c){u.push(p);const y=n[o].default;switch(e[o]={default:y},h){case"TimeOut":y.maxLoadTimeMs=v,y.maxTimeToFirstByteMs=v;break;case"MaxRetry":y.errorRetry.maxNumRetry=v,y.timeoutRetry.maxNumRetry=v;break;case"RetryDelay":y.errorRetry.retryDelayMs=v,y.timeoutRetry.retryDelayMs=v;break;case"MaxRetryTimeout":y.errorRetry.maxRetryDelayMs=v,y.timeoutRetry.maxRetryDelayMs=v;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${o}": ${ji(e[o])}`)}),Oi(Oi({},n),e)}function gR(r){return r&&typeof r=="object"?Array.isArray(r)?r.map(gR):Object.keys(r).reduce((e,t)=>(e[t]=gR(r[t]),e),{}):r}function XJ(r,e){const t=r.loader;t!==mR&&t!==dL?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):DF()&&(r.loader=mR,r.progressive=!0,r.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const cE=2,KJ=.1,qJ=.05,jJ=100;class WJ extends dU{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(H.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(jJ),this.mediaSource=t.mediaSource;const n=this.media=t.media;ka(n,"playing",this.onMediaPlaying),ka(n,"waiting",this.onMediaWaiting),ka(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(oo(n,"playing",this.onMediaPlaying),oo(n,"waiting",this.onMediaWaiting),oo(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,i;const s=(n=this.hls)==null?void 0:n.config;if(!s)return;const a=this.media;if(!a)return;const{seeking:o}=a,c=this.seeking&&!o,u=!this.seeking&&o,h=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!h&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||c){c&&this.stallResolved(e);return}if(h){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(H.MEDIA_ENDED,{stalled:!1}));return}if(!Dn.getBuffered(a).length){this.nudgeRetry=0;return}const p=Dn.bufferInfo(a,e,0),v=p.nextStart||0,y=this.fragmentTracker;if(o&&y&&this.hls){const O=yB(this.hls.inFlightFragments,e),N=p.len>cE,U=!v||O||v-e>cE&&!y.getPartialFragment(e);if(N||U)return;this.moved=!1}const x=(i=this.hls)==null?void 0:i.latestLevelDetails;if(!this.moved&&this.stalled!==null&&y){if(!(p.len>0)&&!v)return;const N=Math.max(v,p.start||0)-e,B=!!(x!=null&&x.live)?x.targetduration*2:cE,I=LA(e,y);if(N>0&&(N<=B||I)){a.paused||this._trySkipBufferHole(I);return}}const S=s.detectStallWithCurrentTimeMs,E=self.performance.now(),b=this.waiting;let T=this.stalled;if(T===null)if(b>0&&E-b<S)T=this.stalled=b;else{this.stalled=E;return}const R=E-T;if(!o&&(R>=S||b)&&this.hls){var D;if(((D=this.mediaSource)==null?void 0:D.readyState)==="ended"&&!(x!=null&&x.live)&&Math.abs(e-(x?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(H.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(p),!this.media||!this.hls)return}const P=Dn.bufferInfo(a,e,s.maxBufferHole);this._tryFixBufferStall(P,R,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(H.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&i&&i.length>1&&e>i.end(0)){const s=Dn.bufferedInfo(Dn.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const a=Dn.timeRangesToArray(i),o=Dn.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const c=Dn.bufferedInfo(a,e,0).bufferedIndex,u=a[o].end,h=a[o+1].start;if((c===-1||c>o)&&h-u<1&&e-u<2){const p=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${h} buffered index: ${c}`);this.warn(p.message),this.media.currentTime+=1e-6;let v=LA(e,this.fragmentTracker);v&&"fragment"in v?v=v.fragment:v||(v=void 0);const y=Dn.bufferInfo(this.media,e,0);this.hls.trigger(H.ERROR,{type:rn.MEDIA_ERROR,details:Ie.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:v,buffer:y.len,bufferInfo:y})}}}}}_tryFixBufferStall(e,t,n){var i,s;const{fragmentTracker:a,media:o}=this,c=(i=this.hls)==null?void 0:i.config;if(!o||!a||!c)return;const u=(s=this.hls)==null?void 0:s.latestLevelDetails,h=LA(n,a);if((h||u!=null&&u.live&&n<u.fragmentStart)&&(this._trySkipBufferHole(h)||!this.media))return;const p=e.buffered,v=this.adjacentTraversal(e,n);(p&&p.length>1&&e.len>c.maxBufferHole||e.nextStart&&(e.nextStart-n<c.maxBufferHole||v))&&(t>c.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,i=e.nextStart;if(n&&i){const s=n.getFragAtPos(t,qt.MAIN),a=n.getFragAtPos(i,qt.MAIN);if(s&&a)return a.sn-s.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:i,stalled:s}=this;if(!i&&s!==null&&n&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${ji(e)})`);this.warn(a.message),t.trigger(H.ERROR,{type:rn.MEDIA_ERROR,details:Ie.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:i}=this,s=(t=this.hls)==null?void 0:t.config;if(!i||!n||!s)return 0;const a=i.currentTime,o=Dn.bufferInfo(i,a,0),c=a<o.start?o.start:o.nextStart;if(c&&this.hls){const h=o.len<=s.maxBufferHole,p=o.len>0&&o.len<1&&i.readyState<3,v=c-a;if(v>0&&(h||p)){if(v>s.maxBufferHole){let x=!1;if(a===0){const S=n.getAppendedFrag(0,qt.MAIN);S&&c<S.end&&(x=!0)}if(!x&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||yB(this.hls.inFlightFragments,c))return 0;let E=!1,b=e.end;for(;b<c;){const T=LA(b,n);if(T)b+=T.duration;else{E=!0;break}}if(E)return 0}}const y=Math.max(c+qJ,a+KJ);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${y}`),this.moved=!0,i.currentTime=y,!(e!=null&&e.gap)){const x=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${y}`),S={type:rn.MEDIA_ERROR,details:Ie.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:x,reason:x.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?S.part=e:S.frag=e),this.hls.trigger(H.ERROR,S)}return y}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:i}=this,s=t?.config;if(!n||!s)return 0;const a=n.currentTime;if(this.nudgeRetry++,i<s.nudgeMaxRetry){const o=a+(i+1)*s.nudgeOffset,c=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(c.message),n.currentTime=o,t.trigger(H.ERROR,{type:rn.MEDIA_ERROR,details:Ie.BUFFER_NUDGE_ON_STALL,error:c,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${s.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(H.ERROR,{type:rn.MEDIA_ERROR,details:Ie.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function yB(r,e){const t=xB(r.main);if(t&&t.start<=e)return t;const n=xB(r.audio);return n&&n.start<=e?n:null}function xB(r){if(!r)return null;switch(r.state){case lt.IDLE:case lt.STOPPED:case lt.ENDED:case lt.ERROR:return null}return r.frag}function LA(r,e){return e.getAppendedFrag(r,qt.MAIN)||e.getPartialFragment(r)}const JJ=.25;function vR(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function eC(r,e,t,n,i){let s=new r(e,t,"");try{s.value=n,i&&(s.type=i)}catch{s=new r(e,t,ji(i?Oi({type:i},n):n))}return s}const wA=(()=>{const r=vR();try{r&&new r(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class $J{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(H.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(H.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(H.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&P0(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return dF(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:i}=this.hls.config;if(!n&&!i)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=vR();if(a)for(let o=0;o<s.length;o++){const c=s[o].type;if(c===io.emsg&&!n||!i)continue;const u=PU(s[o].data),h=s[o].pts;let p=h+s[o].duration;p>wA&&(p=wA),p-h<=0&&(p=h+JJ);for(let y=0;y<u.length;y++){const x=u[y];if(!NU(x)){this.updateId3CueEnds(h,c);const S=eC(a,h,p,x,c);S&&this.id3Track.addCue(S)}}}}updateId3CueEnds(e,t){var n;const i=(n=this.id3Track)==null?void 0:n.cues;if(i)for(let s=i.length;s--;){const a=i[s];a.type===t&&a.startTime<e&&a.endTime===wA&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:i}){const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:c}}=a;if(s&&(o||c)){let u;i==="audio"?u=h=>h.type===io.audioId3&&c:i==="video"?u=h=>h.type===io.emsg&&o:u=h=>h.type===io.audioId3&&c||h.type===io.emsg&&o,dR(s,t,n,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:i,enableDateRangeMetadataCues:s,interstitialsController:a}=this.hls.config;if(!s)return;const o=vR();if(n&&i&&!a){const{fragmentStart:S,fragmentEnd:E}=e;let b=this.assetCue;b?(b.startTime=S,b.endTime=E):o&&(b=this.assetCue=eC(o,S,E,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),b&&(b.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(b),b.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:c}=this,{dateRanges:u}=e,h=Object.keys(u);let p=this.dateRangeCuesAppended;if(c&&t){var v;if((v=c.cues)!=null&&v.length){const S=Object.keys(p).filter(E=>!h.includes(E));for(let E=S.length;E--;){var y;const b=S[E],T=(y=p[b])==null?void 0:y.cues;delete p[b],T&&Object.keys(T).forEach(R=>{const D=T[R];if(D){D.removeEventListener("enter",this.onEventCueEnter);try{c.removeCue(D)}catch{}}})}}else p=this.dateRangeCuesAppended={}}const x=e.fragments[e.fragments.length-1];if(!(h.length===0||!zt(x?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let S=0;S<h.length;S++){const E=h[S],b=u[E],T=b.startTime,R=p[E],D=R?.cues||{};let P=R?.durationKnown||!1,O=wA;const{duration:N,endDate:U}=b;if(U&&N!==null)O=T+N,P=!0;else if(b.endOnNext&&!P){const I=h.reduce((z,W)=>{if(W!==b.id){const Z=u[W];if(Z.class===b.class&&Z.startDate>b.startDate&&(!z||b.startDate<z.startDate))return Z}return z},null);I&&(O=I.startTime,P=!0)}const B=Object.keys(b.attr);for(let I=0;I<B.length;I++){const z=B[I];if(!Lq(z))continue;const W=D[z];if(W)P&&!(R!=null&&R.durationKnown)?W.endTime=O:Math.abs(W.startTime-T)>.01&&(W.startTime=T,W.endTime=O);else if(o){let Z=b.attr[z];wq(z)&&(Z=XN(Z));const re=eC(o,T,O,{key:z,data:Z},io.dateRange);re&&(re.id=E,this.id3Track.addCue(re),D[z]=re,a&&(z==="X-ASSET-LIST"||z==="X-ASSET-URL")&&re.addEventListener("enter",this.onEventCueEnter))}}p[E]={cues:D,dateRange:b,durationKnown:P}}}}}class QJ{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:a}=this.config;if(!s||a===1||!n.live)return;const o=this.targetLatency;if(o===null)return;const c=i-o,u=Math.min(this.maxLatency,o+n.targetduration);if(c<u&&c>.05&&this.forwardBufferLength>1){const p=Math.min(2,Math.max(1,a)),v=Math.round(2/(1+Math.exp(-.75*c-this.edgeStalled))*20)/20,y=Math.min(p,Math.max(1,v));this.changeMediaPlaybackRate(t,y)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:i}=e,{liveSyncDuration:s,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,c=this.hls.userConfig;let u=o&&n||t;(this._targetLatencyUpdated||c.liveSyncDuration||c.liveSyncDurationCount||u===0)&&(u=s!==void 0?s:a*i);const h=i;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,h)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const i=n.edge,s=e-t-this.edgeStalled,a=i-n.totalduration,o=i-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(a,s),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(H.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(H.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===Ie.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,i;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(i=this.targetLatency)==null?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class ZJ extends bT{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(H.LEVEL_LOADED,this.onLevelLoaded,this),e.on(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(H.FRAG_BUFFERED,this.onFragBuffered,this),e.on(H.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(H.LEVEL_LOADED,this.onLevelLoaded,this),e.off(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(H.FRAG_BUFFERED,this.onFragBuffered,this),e.off(H.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,i=[],s={},a={};let o=!1,c=!1,u=!1;t.levels.forEach(h=>{const p=h.attrs;let{audioCodec:v,videoCodec:y}=h;v&&(h.audioCodec=v=pb(v,n)||void 0),y&&(y=h.videoCodec=WK(y));const{width:x,height:S,unknownCodecs:E}=h,b=E?.length||0;if(o||(o=!!(x&&S)),c||(c=!!y),u||(u=!!v),b||v&&!this.isAudioSupported(v)||y&&!this.isVideoSupported(y)){this.log(`Some or all CODECS not supported "${p.CODECS}"`);return}const{CODECS:T,"FRAME-RATE":R,"HDCP-LEVEL":D,"PATHWAY-ID":P,RESOLUTION:O,"VIDEO-RANGE":N}=p,B=`${`${P||"."}-`}${h.bitrate}-${O}-${R}-${T}-${N}-${D}`;if(s[B])if(s[B].uri!==h.url&&!h.attrs["PATHWAY-ID"]){const I=a[B]+=1;h.attrs["PATHWAY-ID"]=new Array(I+1).join(".");const z=this.createLevel(h);s[B]=z,i.push(z)}else s[B].addGroupId("audio",p.AUDIO),s[B].addGroupId("text",p.SUBTITLES);else{const I=this.createLevel(h);s[B]=I,a[B]=1,i.push(I)}}),this.filterAndSortMediaOptions(i,t,o,c,u)}createLevel(e){const t=new mg(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const i=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(i.message),t.supportedResult=iU(i,[])}return t}isAudioSupported(e){return yx(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return yx(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,i,s){var a;let o=[],c=[],u=e;const h=((a=t.stats)==null?void 0:a.parsing)||{};if((n||i)&&s&&(u=u.filter(({videoCodec:T,videoRange:R,width:D,height:P})=>(!!T||!!(D&&P))&&rq(R))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let T="no level with compatible codecs found in manifest",R=T;t.levels.length&&(R=`one or more CODECS in variant not supported: ${ji(t.levels.map(P=>P.attrs.CODECS).filter((P,O,N)=>N.indexOf(P)===O))}`,this.warn(R),T+=` (${R})`);const D=new Error(T);this.hls.trigger(H.ERROR,{type:rn.MEDIA_ERROR,details:Ie.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:D,reason:R})}}),h.end=performance.now();return}t.audioTracks&&(o=t.audioTracks.filter(T=>!T.audioCodec||this.isAudioSupported(T.audioCodec)),_B(o)),t.subtitles&&(c=t.subtitles,_B(c));const p=u.slice(0);u.sort((T,R)=>{if(T.attrs["HDCP-LEVEL"]!==R.attrs["HDCP-LEVEL"])return(T.attrs["HDCP-LEVEL"]||"")>(R.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&T.height!==R.height)return T.height-R.height;if(T.frameRate!==R.frameRate)return T.frameRate-R.frameRate;if(T.videoRange!==R.videoRange)return mb.indexOf(T.videoRange)-mb.indexOf(R.videoRange);if(T.videoCodec!==R.videoCodec){const D=d3(T.videoCodec),P=d3(R.videoCodec);if(D!==P)return P-D}if(T.uri===R.uri&&T.codecSet!==R.codecSet){const D=db(T.codecSet),P=db(R.codecSet);if(D!==P)return P-D}return T.averageBitrate!==R.averageBitrate?T.averageBitrate-R.averageBitrate:0});let v=p[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==p.length)){for(let T=0;T<p.length;T++)if(p[T].pathwayId===u[0].pathwayId){v=p[T];break}}this._levels=u;for(let T=0;T<u.length;T++)if(u[T]===v){var y;this._firstLevel=T;const R=v.bitrate,D=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${R}`),((y=this.hls.userConfig)==null?void 0:y.abrEwmaDefaultEstimate)===void 0){const P=Math.min(R,this.hls.config.abrEwmaDefaultEstimateMax);P>D&&D===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=P)}break}const x=s&&!i,S=this.hls.config,E=!!(S.audioStreamController&&S.audioTrackController),b={levels:u,audioTracks:o,subtitleTracks:c,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:i,altAudio:E&&!x&&o.some(T=>!!T.url)};h.end=performance.now(),this.hls.trigger(H.MANIFEST_PARSED,b)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const h=new Error("invalid level idx"),p=e<0;if(this.hls.trigger(H.ERROR,{type:rn.OTHER_ERROR,details:Ie.LEVEL_SWITCH_ERROR,level:e,fatal:p,error:h,reason:h.message}),p)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,i=this.currentLevel,s=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,n===e&&i&&s===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${n}${s?" with Pathway "+s:""}`);const c={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(H.LEVEL_SWITCHING,c);const u=a.details;if(!u||u.live){const h=this.switchParams(a.uri,i?.details,u);this.loadPlaylist(h)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(i=>t.indexOf(i)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===jn.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===qt.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(s=>!!n[s]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var n;const{level:i,details:s}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${i}`),(o=t.deliveryDirectives)!=null&&o.skip&&(s.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let c=a.details;c===t.details&&c.advanced&&(c=void 0),this.playlistLoaded(i,t,c)}else(n=t.deliveryDirectives)!=null&&n.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],a=e.details,o=a?.age;this.log(`Loading level index ${i}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(H.LEVEL_LOADING,{url:n,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((s,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(o=>o.level=-1)),!1));TU(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=n.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(H.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(H.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function _B(r){const e={};r.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function LF(){return self.SourceBuffer||self.WebKitSourceBuffer}function pL(){if(!mf())return!1;const e=LF();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function wF(){if(!pL())return!1;const r=mf();return typeof r?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>r.isTypeSupported(xx(e,"video")))||["mp4a.40.2","fLaC"].some(e=>r.isTypeSupported(xx(e,"audio"))))}function e$(){var r;const e=LF();return typeof(e==null||(r=e.prototype)==null?void 0:r.changeType)=="function"}const t$=100;class n$ extends AT{constructor(e,t,n){super(e,t,n,"stream-controller",qt.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const i=this.media,s=i?i.currentTime:null;if(s===null||!zt(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const a=this.getFwdBufferInfoAtPos(i,s,qt.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.LEVEL_LOADING,this.onLevelLoading,this),e.on(H.LEVEL_LOADED,this.onLevelLoaded,this),e.on(H.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(H.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(H.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(H.BUFFER_CREATED,this.onBufferCreated,this),e.on(H.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(H.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.LEVEL_LOADED,this.onLevelLoaded,this),e.off(H.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(H.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(H.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(H.BUFFER_CREATED,this.onBufferCreated,this),e.off(H.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(H.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:i}=this;if(this.stopLoad(),this.setInterval(t$),this.level=-1,!this.startFragRequested){let s=i.startLevel;s===-1&&(i.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=i.firstAutoLevel),i.nextLoadLevel=s,this.level=i.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=lt.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=lt.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case lt.WAITING_LEVEL:{const{levels:e,level:t}=this,n=e?.[t],i=n?.details;if(i&&(!i.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(i))break;this.state=lt.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=lt.IDLE;break}break}case lt.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===lt.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:i}=this;if(t===null||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[s]))return;const a=n[s],o=this.getMainFwdBufferInfo();if(o===null)return;const c=this.getLevelDetails();if(c&&this._streamEnded(o,c)){const S={};this.altAudio===2&&(S.type="video"),this.hls.trigger(H.BUFFER_EOS,S),this.state=lt.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const u=a.details;if(!u||this.state===lt.WAITING_LEVEL||this.waitForLive(a)){this.level=s,this.state=lt.WAITING_LEVEL,this.startFragRequested=!1;return}const h=o.len,p=this.getMaxBufferLength(a.maxBitrate);if(h>=p)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const v=this.backtrackFragment?this.backtrackFragment.start:o.end;let y=this.getNextFragment(v,u);if(this.couldBacktrack&&!this.fragPrevious&&y&&Ps(y)&&this.fragmentTracker.getState(y)!==rr.OK){var x;const E=((x=this.backtrackFragment)!=null?x:y).sn-u.startSN,b=u.fragments[E-1];b&&y.cc===b.cc&&(y=b,this.fragmentTracker.removeFragment(b))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(y&&this.isLoopLoading(y,v)){if(!y.gap){const E=this.audioOnly&&!this.altAudio?qi.AUDIO:qi.VIDEO,b=(E===qi.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;b&&this.afterBufferFlushed(b,E,qt.MAIN)}y=this.getNextFragmentLoopLoading(y,u,o,qt.MAIN,p)}y&&(y.initSegment&&!y.initSegment.data&&!this.bitrateTest&&(y=y.initSegment),this.loadFragment(y,a,v))}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);i===rr.NOT_LOADED||i===rr.PARTIAL?Ps(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,qt.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<s.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,c=e[o],u=this.fragLastKbps;u&&this.fragCurrent?n=this.fragCurrent.duration*c.maxBitrate/(1e3*u)+1:n=0}else n=0;const a=this.getBufferedFrag(t.currentTime+n);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const c=o.maxStartPTS?o.maxStartPTS:o.start,u=o.duration,h=Math.max(a.end,c+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(h,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case lt.KEY_LOADING:case lt.FRAG_LOADING:case lt.FRAG_LOADING_WAITING_RETRY:case lt.PARSING:case lt.PARSED:this.state=lt.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;ka(n,"playing",this.onMediaPlaying),ka(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(oo(n,"playing",this.onMediaPlaying),oo(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(H.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,i=!1;for(let s=0;s<t.levels.length;s++){const a=t.levels[s].audioCodec;a&&(n=n||a.indexOf("mp4a.40.2")!==-1,i=i||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=n&&i&&!e$(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==lt.IDLE)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=lt.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:i,startFragRequested:s}=this,a=t.level,o=t.details,c=o.totalduration;if(!i){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${c}`);const u=t.levelInfo,h=this.fragCurrent;h&&(this.state===lt.FRAG_LOADING||this.state===lt.FRAG_LOADING_WAITING_RETRY)&&h.level!==t.level&&h.loader&&this.abortCurrentFrag();let p=0;if(o.live||(n=u.details)!=null&&n.live){var v;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;p=this.alignPlaylists(o,u.details,(v=this.levelLastLoaded)==null?void 0:v.details)}if(u.details=o,this.levelLastLoaded=u,s||this.setStartPosition(o,p),this.hls.trigger(H.LEVEL_UPDATED,{details:o,level:a}),this.state===lt.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=lt.IDLE}s&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const i=this.hls.liveSyncPosition,s=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,c=s>=a-t.maxFragLookUpTolerance&&s<=o;if(i!==null&&n.duration>i&&(s<i||!c)){const h=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!c&&n.readyState<4||s<o-h)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),n.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${i.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const p=Dn.bufferInfo(n,i,0);if(!((u=p.buffered)!=null&&u.length)){n.currentTime=i;return}if(p.start<=s){n.currentTime=i;return}const{nextStart:y}=Dn.bufferedInfo(p.buffered,s,0);y&&(n.currentTime=y)}else n.currentTime=i}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:i,payload:s}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const o=a[n.level];if(!o){this.warn(`Level ${n.level} not found on progress`);return}const c=o.details;if(!c){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const u=o.videoCodec,h=c.PTSKnown||!c.live,p=(t=n.initSegment)==null?void 0:t.data,v=this._getAudioCodec(o),y=this.transmuxer=this.transmuxer||new qU(this.hls,qt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),x=i?i.index:-1,S=x!==-1,E=new ST(n.level,n.sn,n.stats.chunkCount,s.byteLength,x,S),b=this.initPTS[n.cc];y.push(s,p,v,u,n,i,c.totalduration,h,E,b)}onAudioTrackSwitching(e,t){const n=this.hls,i=this.altAudio!==0;if(gb(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.altAudio=0,this.fragmentTracker.removeAllFragments(),n.once(H.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(H.AUDIO_TRACK_SWITCHED,t)}),n.trigger(H.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(H.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=gb(t.url,this.hls);if(n){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let i,s,a=!1;for(const o in n){const c=n[o];if(c.id==="main"){if(s=o,i=c,o==="video"){const u=n[o];u&&(this.videoBuffer=u.buffer)}}else a=!0}a&&i?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:i}=t,s=n.type===qt.MAIN;if(s){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===lt.PARSED&&(this.state=lt.IDLE);return}const o=i?i.stats:n.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),Ps(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,i)}const a=this.media;a&&(!this._hasEnoughToStart&&Dn.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=lt.ERROR;return}switch(t.details){case Ie.FRAG_GAP:case Ie.FRAG_PARSING_ERROR:case Ie.FRAG_DECRYPT_ERROR:case Ie.FRAG_LOAD_ERROR:case Ie.FRAG_LOAD_TIMEOUT:case Ie.KEY_LOAD_ERROR:case Ie.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(qt.MAIN,t);break;case Ie.LEVEL_LOAD_ERROR:case Ie.LEVEL_LOAD_TIMEOUT:case Ie.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===lt.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===jn.LEVEL&&(this.state=lt.IDLE);break;case Ie.BUFFER_ADD_CODEC_ERROR:case Ie.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Ie.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case Ie.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=lt.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==qi.AUDIO||!this.altAudio){const n=(t===qi.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,qt.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const i=this.timelineOffset;i&&n&&(n+=i);const s=this.getLevelDetails(),a=Dn.getBuffered(e),o=a.length?a.start(0):0,c=o-n,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||c>0&&(c<u||this.loadingParts&&c<2*(s?.partTarget||0)))&&(this.log(`adjusting start position by ${c} to match buffer start`),n+=c,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${o}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:i}=this,s=n?.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=lt.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=s.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),i.trigger(H.FRAG_LOADED,n),s.bitrateTest=!1}).catch(n=>{this.state===lt.STOPPED||this.state===lt.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:i,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a){this.resetWhenMissingContext(s);return}const{frag:o,part:c,level:u}=a,{video:h,text:p,id3:v,initSegment:y}=i,{details:x}=u,S=this.altAudio?void 0:i.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=lt.PARSING,y){const E=y.tracks;if(E){const D=o.initSegment||o;if(this.unhandledEncryptionError(y,o))return;this._bufferInitSegment(u,E,D,s),n.trigger(H.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:t,tracks:E})}const b=y.initPTS,T=y.timescale,R=this.initPTS[o.cc];if(zt(b)&&(!R||R.baseTime!==b||R.timescale!==T)){const D=y.trackId;this.initPTS[o.cc]={baseTime:b,timescale:T,trackId:D},n.trigger(H.INIT_PTS_FOUND,{frag:o,id:t,initPTS:b,timescale:T,trackId:D})}}if(h&&x){S&&h.type==="audiovideo"&&this.logMuxedErr(o);const E=x.fragments[o.sn-1-x.startSN],b=o.sn===x.startSN,T=!E||o.cc>E.cc;if(i.independent!==!1){const{startPTS:R,endPTS:D,startDTS:P,endDTS:O}=h;if(c)c.elementaryStreams[h.type]={startPTS:R,endPTS:D,startDTS:P,endDTS:O};else if(h.firstKeyFrame&&h.independent&&s.id===1&&!T&&(this.couldBacktrack=!0),h.dropped&&h.independent){const N=this.getMainFwdBufferInfo(),U=(N?N.end:this.getLoadPosition())+this.config.maxBufferHole,B=h.firstKeyFramePTS?h.firstKeyFramePTS:R;if(!b&&U<B-this.config.maxBufferHole&&!T){this.backtrack(o);return}else T&&(o.gap=!0);o.setElementaryStreamInfo(h.type,o.start,D,o.start,O,!0)}else b&&R-(x.appliedTimelineOffset||0)>cE&&(o.gap=!0);o.setElementaryStreamInfo(h.type,R,D,P,O),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(h,o,c,s,b||T)}else if(b||T)o.gap=!0;else{this.backtrack(o);return}}if(S){const{startPTS:E,endPTS:b,startDTS:T,endDTS:R}=S;c&&(c.elementaryStreams[qi.AUDIO]={startPTS:E,endPTS:b,startDTS:T,endDTS:R}),o.setElementaryStreamInfo(qi.AUDIO,E,b,T,R),this.bufferFragmentData(S,o,c,s)}if(x&&v!=null&&v.samples.length){const E={id:t,frag:o,details:x,samples:v.samples};n.trigger(H.FRAG_PARSING_METADATA,E)}if(x&&p){const E={id:t,frag:o,details:x,samples:p.samples};n.trigger(H.FRAG_PARSING_USERDATA,E)}}logMuxedErr(e){this.warn(`${Ps(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,i){if(this.state!==lt.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:s,video:a,audiovideo:o}=t;if(s){const u=e.audioCodec;let h=iE(s.codec,u);h==="mp4a"&&(h="mp4a.40.5");const p=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){h&&(h.indexOf("mp4a.40.5")!==-1?h="mp4a.40.2":h="mp4a.40.5");const v=s.metadata;v&&"channelCount"in v&&(v.channelCount||1)!==1&&p.indexOf("firefox")===-1&&(h="mp4a.40.5")}h&&h.indexOf("mp4a.40.5")!==-1&&p.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(h="mp4a.40.2",this.log(`Android: force audio codec to ${h}`)),u&&u!==h&&this.log(`Swapping manifest audio codec "${u}" for "${h}"`),s.levelCodec=h,s.id=qt.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${h||""}/${u||""}/${s.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=qt.MAIN;const u=a.codec;if(u?.length===4)switch(u){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${a.codec!==u?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const c=Object.keys(t);if(c.length){if(this.hls.trigger(H.BUFFER_CODECS,t),!this.hls)return;c.forEach(u=>{const p=t[u].initSegment;p!=null&&p.byteLength&&this.hls.trigger(H.BUFFER_APPENDING,{type:u,data:p,frag:n,part:null,chunkMeta:i,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,qt.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e?.[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=lt.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(Dn.isBuffered(e,n)?t=this.getAppendedFrag(n):Dn.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,s=t.level;(!i||t.sn!==i.sn||i.level!==s)&&(this.fragPlaying=t,this.hls.trigger(H.FRAG_CHANGED,{frag:t}),(!i||i.level!==s)&&this.hls.trigger(H.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return zt(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(zt(t)){const n=this.getLevelDetails(),i=this.currentFrag||(n?Up(null,n.fragments,t):null);if(i){const s=i.programDateTime;if(s!==null){const a=s+(t-i.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class i$ extends Cl{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const i=this.keyIdToKeyInfo[n].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=Ie.KEY_LOAD_ERROR,n,i,s){return new Qu({type:rn.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:n,networkDetails:i})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let i=0,s=t.length;i<s;i++){const a=t[i];if(e.cc<=a.cc&&(!Ps(e)||!Ps(a)||e.sn<a.sn)||!n&&i==s-1)return this.emeController.selectKeySystemFormat(a).then(o=>{if(!this.emeController)return;a.setKeyFormat(o);const c=sE(o);if(c)return this.emeController.getKeySystemAccess([c])})}if(this.config.requireKeySystemAccessOnStart){const i=Cy(this.config);if(i.length)return this.emeController.getKeySystemAccess(i)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,i;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,Ie.KEY_LOAD_ERROR,u))}const a=s.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,Ie.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const o=tC(s);let c=this.keyIdToKeyInfo[o];if((n=c)!=null&&n.decryptdata.key)return s.key=c.decryptdata.key,Promise.resolve({frag:e,keyInfo:c});if(this.emeController&&(i=c)!=null&&i.keyLoadPromise)switch(this.emeController.getKeyStatus(c.decryptdata)){case"usable":case"usable-in-future":return c.keyLoadPromise.then(h=>{const{keyInfo:p}=h;return s.key=p.decryptdata.key,{frag:e,keyInfo:p}})}switch(this.log(`${this.keyIdToKeyInfo[o]?"Rel":"L"}oading${s.keyId?" keyId: "+Nr(s.keyId):""} URI: ${s.uri} from ${e.type} ${e.level}`),c=this.keyIdToKeyInfo[o]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(c,e):this.loadKeyEME(c,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(c,e);default:return Promise.reject(this.createKeyLoadError(e,Ie.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i;if(!e.decryptdata.keyId&&(i=t.initSegment)!=null&&i.data){const a=UK(t.initSegment.data);if(a.length){let o=a[0];o.some(c=>c!==0)?(this.log(`Using keyId found in init segment ${Nr(o)}`),hf.setKeyIdForUri(e.decryptdata.uri,o)):(o=hf.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Nr(o)}`)),e.decryptdata.keyId=o}}if(!e.decryptdata.keyId&&!Ps(t))return Promise.resolve(n);const s=this.emeController.loadKey(n);return(e.keyLoadPromise=s.then(a=>(e.mediaKeySessionContext=a,n))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,i=n.loader,s=new i(n);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((a,o)=>{const c={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=n.keyLoadPolicy.default,h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,y,x,S)=>{const{frag:E,keyInfo:b}=x,T=tC(b.decryptdata);if(!E.decryptdata||b!==this.keyIdToKeyInfo[T])return o(this.createKeyLoadError(E,Ie.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),S));b.decryptdata.key=E.decryptdata.key=new Uint8Array(v.data),E.keyLoader=null,b.loader=null,a({frag:E,keyInfo:b})},onError:(v,y,x,S)=>{this.resetLoader(y),o(this.createKeyLoadError(t,Ie.KEY_LOAD_ERROR,new Error(`HTTP Error ${v.code} loading key ${v.text}`),x,Oi({url:c.url,data:void 0},v)))},onTimeout:(v,y,x)=>{this.resetLoader(y),o(this.createKeyLoadError(t,Ie.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),x))},onAbort:(v,y,x)=>{this.resetLoader(y),o(this.createKeyLoadError(t,Ie.INTERNAL_ABORTED,new Error("key loading aborted"),x))}};s.load(c,h,p)})}resetLoader(e){const{frag:t,keyInfo:n,url:i}=e,s=n.loader;t.keyLoader===s&&(t.keyLoader=null,n.loader=null);const a=tC(n.decryptdata)||i;delete this.keyIdToKeyInfo[a],s&&s.destroy()}}function tC(r){if(r.keyFormat!==Er.FAIRPLAY){const e=r.keyId;if(e)return Nr(e)}return r.uri}function SB(r){const{type:e}=r;switch(e){case jn.AUDIO_TRACK:return qt.AUDIO;case jn.SUBTITLE_TRACK:return qt.SUBTITLE;default:return qt.MAIN}}function nC(r,e){let t=r.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class s${constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.LEVEL_LOADING,this.onLevelLoading,this),e.on(H.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(H.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(H.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.LEVEL_LOADING,this.onLevelLoading,this),e.off(H.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(H.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(H.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,i=t.loader,s=n||i,a=new s(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:jn.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:i,pathwayId:s,url:a,deliveryDirectives:o,levelInfo:c}=t;this.load({id:n,level:i,pathwayId:s,responseType:"text",type:jn.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:c})}onAudioTrackLoading(e,t){const{id:n,groupId:i,url:s,deliveryDirectives:a,track:o}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:jn.AUDIO_TRACK,url:s,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:n,groupId:i,url:s,deliveryDirectives:a,track:o}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:jn.SUBTITLE_TRACK,url:s,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const n=this.loaders[jn.LEVEL];if(n){const i=n.context;i&&!t.levels.some(s=>s===i.levelOrTrack)&&(n.abort(),delete this.loaders[jn.LEVEL])}}load(e){var t;const n=this.hls.config;let i=this.getInternalLoader(e);if(i){const u=this.hls.logger,h=i.context;if(h&&h.levelOrTrack===e.levelOrTrack&&(h.url===e.url||h.deliveryDirectives&&!e.deliveryDirectives)){h.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${h.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let s;if(e.type===jn.MANIFEST?s=n.manifestLoadPolicy.default:s=Gi({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),zt((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===jn.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===jn.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===jn.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const h=u.partTarget,p=u.targetduration;if(h&&p){const v=Math.max(h*3,p*.8)*1e3;s=Gi({},s,{maxTimeToFirstByteMs:Math.min(v,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(v,s.maxTimeToFirstByteMs)})}}}const a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},c={onSuccess:(u,h,p,v)=>{const y=this.getInternalLoader(p);this.resetInternalLoader(p.type);const x=u.data;h.parsing.start=performance.now(),oc.isMediaPlaylist(x)||p.type!==jn.MANIFEST?this.handleTrackOrLevelPlaylist(u,h,p,v||null,y):this.handleMasterPlaylist(u,h,p,v)},onError:(u,h,p,v)=>{this.handleNetworkError(h,p,!1,u,v)},onTimeout:(u,h,p)=>{this.handleNetworkError(h,p,!0,void 0,u)}};i.load(e,o,c)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,i){const s=this.hls,a=e.data,o=nC(e,n),c=oc.parseMasterPlaylist(a,o);if(c.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,n,c.playlistParsingError,i,t);return}const{contentSteering:u,levels:h,sessionData:p,sessionKeys:v,startTimeOffset:y,variableList:x}=c;this.variableList=x,h.forEach(T=>{const{unknownCodecs:R}=T;if(R){const{preferManagedMediaSource:D}=this.hls.config;let{audioCodec:P,videoCodec:O}=T;for(let N=R.length;N--;){const U=R[N];yx(U,"audio",D)?(T.audioCodec=P=P?`${P},${U}`:U,pg.audio[P.substring(0,4)]=2,R.splice(N,1)):yx(U,"video",D)&&(T.videoCodec=O=O?`${O},${U}`:U,pg.video[O.substring(0,4)]=2,R.splice(N,1))}}});const{AUDIO:S=[],SUBTITLES:E,"CLOSED-CAPTIONS":b}=oc.parseMasterPlaylistMedia(a,o,c);S.length&&!S.some(R=>!R.url)&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),S.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new os({}),bitrate:0,url:""})),s.trigger(H.MANIFEST_LOADED,{levels:h,audioTracks:S,subtitles:E,captions:b,contentSteering:u,url:o,stats:t,networkDetails:i,sessionData:p,sessionKeys:v,startTimeOffset:y,variableList:x})}handleTrackOrLevelPlaylist(e,t,n,i,s){const a=this.hls,{id:o,level:c,type:u}=n,h=nC(e,n),p=zt(c)?c:zt(o)?o:0,v=SB(n),y=oc.parseLevelPlaylist(e.data,h,p,v,0,this.variableList);if(u===jn.MANIFEST){const x={attrs:new os({}),bitrate:0,details:y,name:"",url:h};y.requestScheduled=t.loading.start+AU(y,0),a.trigger(H.MANIFEST_LOADED,{levels:[x],audioTracks:[],url:h,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=y,this.handlePlaylistLoaded(y,e,t,n,i,s)}handleManifestParsingError(e,t,n,i,s){this.hls.trigger(H.ERROR,{type:rn.NETWORK_ERROR,details:Ie.MANIFEST_PARSING_ERROR,fatal:t.type===jn.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:i,stats:s})}handleNetworkError(e,t,n=!1,i,s){let a=`A network ${n?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===jn.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===jn.AUDIO_TRACK||e.type===jn.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let c=Ie.UNKNOWN,u=!1;const h=this.getInternalLoader(e);switch(e.type){case jn.MANIFEST:c=n?Ie.MANIFEST_LOAD_TIMEOUT:Ie.MANIFEST_LOAD_ERROR,u=!0;break;case jn.LEVEL:c=n?Ie.LEVEL_LOAD_TIMEOUT:Ie.LEVEL_LOAD_ERROR,u=!1;break;case jn.AUDIO_TRACK:c=n?Ie.AUDIO_TRACK_LOAD_TIMEOUT:Ie.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case jn.SUBTITLE_TRACK:c=n?Ie.SUBTITLE_TRACK_LOAD_TIMEOUT:Ie.SUBTITLE_LOAD_ERROR,u=!1;break}h&&this.resetInternalLoader(e.type);const p={type:rn.NETWORK_ERROR,details:c,fatal:u,url:e.url,loader:h,context:e,error:o,networkDetails:t,stats:s};if(i){const v=t?.url||e.url;p.response=Oi({url:v,data:void 0},i)}this.hls.trigger(H.ERROR,p)}handlePlaylistLoaded(e,t,n,i,s,a){const o=this.hls,{type:c,level:u,levelOrTrack:h,id:p,groupId:v,deliveryDirectives:y}=i,x=nC(t,i),S=SB(i);let E=typeof i.level=="number"&&S===qt.MAIN?u:void 0;const b=e.playlistParsingError;if(b){if(this.hls.logger.warn(`${b} ${e.url}`),!o.config.ignorePlaylistParsingErrors){o.trigger(H.ERROR,{type:rn.NETWORK_ERROR,details:Ie.LEVEL_PARSING_ERROR,fatal:!1,url:x,error:b,reason:b.message,response:t,context:i,level:E,parent:S,networkDetails:s,stats:n});return}e.playlistParsingError=null}if(!e.fragments.length){const T=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(H.ERROR,{type:rn.NETWORK_ERROR,details:Ie.LEVEL_EMPTY_ERROR,fatal:!1,url:x,error:T,reason:T.message,response:t,context:i,level:E,parent:S,networkDetails:s,stats:n});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),c){case jn.MANIFEST:case jn.LEVEL:if(E){if(!h)E=0;else if(h!==o.levels[E]){const T=o.levels.indexOf(h);T>-1&&(E=T)}}o.trigger(H.LEVEL_LOADED,{details:e,levelInfo:h||o.levels[0],level:E||0,id:p||0,stats:n,networkDetails:s,deliveryDirectives:y,withoutMultiVariant:c===jn.MANIFEST});break;case jn.AUDIO_TRACK:o.trigger(H.AUDIO_TRACK_LOADED,{details:e,track:h,id:p||0,groupId:v||"",stats:n,networkDetails:s,deliveryDirectives:y});break;case jn.SUBTITLE_TRACK:o.trigger(H.SUBTITLE_TRACK_LOADED,{details:e,track:h,id:p||0,groupId:v||"",stats:n,networkDetails:s,deliveryDirectives:y});break}}}class af{static get version(){return _x}static isMSESupported(){return pL()}static isSupported(){return wF()}static getMediaSource(){return mf()}static get Events(){return H}static get MetadataSchema(){return io}static get ErrorTypes(){return rn}static get ErrorDetails(){return Ie}static get DefaultConfig(){return af.defaultConfig?af.defaultConfig:zJ}static set DefaultConfig(e){af.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new nL,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=MK(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=YJ(af.DefaultConfig,e,t);this.userConfig=e,n.progressive&&XJ(n,t);const{abrController:i,bufferController:s,capLevelController:a,errorController:o,fpsController:c}=n,u=new o(this),h=this.abrController=new i(this),p=new yq(this),v=n.interstitialsController,y=v?this.interstitialsController=new v(this,af):null,x=this.bufferController=new s(this,p),S=this.capLevelController=new a(this),E=new c(this),b=new s$(this),T=n.contentSteeringController,R=T?new T(this):null,D=this.levelController=new ZJ(this,R),P=new $J(this),O=new i$(this.config,this.logger),N=this.streamController=new n$(this,p,O),U=this.gapController=new WJ(this,p);S.setStreamController(N),E.setStreamController(N);const B=[b,D,N];y&&B.splice(1,0,y),R&&B.splice(1,0,R),this.networkControllers=B;const I=[h,x,U,S,E,P,p];this.audioTrackController=this.createController(n.audioTrackController,B);const z=n.audioStreamController;z&&B.push(this.audioStreamController=new z(this,p,O)),this.subtitleTrackController=this.createController(n.subtitleTrackController,B);const W=n.subtitleStreamController;W&&B.push(this.subtititleStreamController=new W(this,p,O)),this.createController(n.timelineController,I),O.emeController=this.emeController=this.createController(n.emeController,I),this.cmcdController=this.createController(n.cmcdController,I),this.latencyController=this.createController(QJ,I),this.coreComponents=I,B.push(u);const Z=u.onErrorOut;typeof Z=="function"&&this.on(H.ERROR,Z,u),this.on(H.MANIFEST_LOADED,b.onManifestLoaded,b)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,i){this._emitter.off(e,t,n,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const i=e===H.ERROR;this.trigger(H.ERROR,{type:rn.OTHER_ERROR,details:Ie.INTERNAL_EXCEPTION,fatal:i,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(H.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(H.ERROR,{type:rn.OTHER_ERROR,details:Ie.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,i=t?e:{media:n};this._media=n,this.trigger(H.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(H.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(H.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,i=this._url=XD.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&n&&(n!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(H.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[qt.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[qt.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[qt.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=ZW()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){sq(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let i=0;i<n;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,n)for(let s=i;s--;){const a=e[s].attrs["HDCP-LEVEL"];if(a&&a<=n)return s}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=aU(t);return sU(e,n,navigator.mediaCapabilities)}}af.defaultConfig=void 0;const r$=Object.freeze(Object.defineProperty({__proto__:null,AbrController:oU,AttrList:os,AudioStreamController:jU,AudioTrackController:JU,BasePlaylistController:bT,BaseSegment:KD,BaseStreamController:AT,BufferController:QU,CMCDController:cF,CapLevelController:TT,ChunkMetadata:ST,ContentSteeringController:uF,Cues:RF,DateRange:QD,EMEController:Sp,ErrorActionFlags:to,ErrorController:hU,ErrorDetails:Ie,ErrorTypes:rn,Events:H,FPSController:hF,FetchLoader:mR,Fragment:nE,Hls:af,HlsSkip:Xy,HlsUrlParameters:tR,KeySystemFormats:Er,KeySystems:us,Level:mg,LevelDetails:mU,LevelKey:hf,LoadStats:xT,M3U8Parser:oc,MetadataSchema:io,NetworkErrorAction:nr,Part:KN,PlaylistLevelType:qt,SubtitleStreamController:vF,SubtitleTrackController:mF,TimelineController:MF,XhrLoader:dL,default:af,fetchSupported:DF,getMediaSource:mf,isMSESupported:pL,isSupported:wF,requestMediaKeySystemAccess:tL},Symbol.toStringTag,{value:"Module"})),a$=((r,e)=>typeof window<"u"&&typeof((r=window.document)==null?void 0:r.createElement)=="function"&&typeof((e=window.navigator)==null?void 0:e.userAgent)=="string")();let iC=null;async function o$(...r){var e;(e=iC)!==null&&e!==void 0||(iC=await vK(()=>Promise.resolve().then(()=>r$),void 0,import.meta.url));const t=iC.default;return t.isSupported()?new t(...r):null}function l$(r,{unsuspend:e="loadedmetadata",start:t=!0,hls:n={},crossOrigin:i="anonymous",muted:s=!0,loop:a=!0,playsInline:o=!0,onVideoFrame:c,...u}={}){const h=sa(x=>x.gl),p=Fe.useRef(null),v=dN(()=>new Promise(async x=>{let S,E;typeof r=="string"?S=r:E=r;const b=Object.assign(document.createElement("video"),{src:S,srcObject:E,crossOrigin:i,loop:a,muted:s,playsInline:o,...u});if(S&&a$&&S.endsWith(".m3u8")){const R=p.current=await o$(n);R&&(R.on(H.MEDIA_ATTACHED,()=>void R.loadSource(S)),R.attachMedia(b))}const T=new lD(b);T.colorSpace=h.outputColorSpace,b.addEventListener(e,()=>x(T))}),[r]),y=v.source.data;return c$(y,c),Fe.useEffect(()=>(t&&v.image.play(),()=>{p.current&&(p.current.destroy(),p.current=null)}),[v,t]),v}const c$=(r,e)=>{Fe.useEffect(()=>{if(!e||!r.requestVideoFrameCallback)return;let t;const n=(...i)=>{e(...i),t=r.requestVideoFrameCallback(n)};return r.requestVideoFrameCallback(n),()=>r.cancelVideoFrameCallback(t)},[r,e])},IF=(r,e,t)=>{let n;switch(r){case Ha:n=new Uint8ClampedArray(e*t*4);break;case ar:n=new Uint16Array(e*t*4);break;case lu:n=new Uint32Array(e*t*4);break;case Fb:n=new Int8Array(e*t*4);break;case kb:n=new Int16Array(e*t*4);break;case Ux:n=new Int32Array(e*t*4);break;case Ss:n=new Float32Array(e*t*4);break;default:throw new Error("Unsupported data type")}return n};let IA;const u$=(r,e,t,n)=>{if(IA!==void 0)return IA;const i=new Al(1,1,n);e.setRenderTarget(i);const s=new As(new Hh,new ao({color:16777215}));e.render(s,t),e.setRenderTarget(null);const a=IF(r,i.width,i.height);return e.readRenderTargetPixels(i,0,0,i.width,i.height,a),i.dispose(),s.geometry.dispose(),s.material.dispose(),IA=a[0]!==0,IA};class mL{_renderer;_rendererIsDisposable=!1;_material;_scene;_camera;_quad;_renderTarget;_width;_height;_type;_colorSpace;_supportsReadPixels=!0;constructor(e){this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const t={format:Ns,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:e.renderTargetOptions?.anisotropy!==void 0?e.renderTargetOptions?.anisotropy:1,generateMipmaps:e.renderTargetOptions?.generateMipmaps!==void 0?e.renderTargetOptions?.generateMipmaps:!1,magFilter:e.renderTargetOptions?.magFilter!==void 0?e.renderTargetOptions?.magFilter:yi,minFilter:e.renderTargetOptions?.minFilter!==void 0?e.renderTargetOptions?.minFilter:yi,samples:e.renderTargetOptions?.samples!==void 0?e.renderTargetOptions?.samples:void 0,wrapS:e.renderTargetOptions?.wrapS!==void 0?e.renderTargetOptions?.wrapS:_s,wrapT:e.renderTargetOptions?.wrapT!==void 0?e.renderTargetOptions?.wrapT:_s};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=mL.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Hx,this._camera=new _l,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!u$(this._type,this._renderer,this._camera,t)){let n;switch(this._type){case ar:n=this._renderer.extensions.has("EXT_color_buffer_float")?Ss:void 0;break}n!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Ss}`),this._type=n):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new As(new Hh,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Al(this.width,this.height,t),this._renderTarget.texture.mapping=e.renderTargetOptions?.mapping!==void 0?e.renderTargetOptions?.mapping:Lh}static instantiateRenderer(){const e=new OD;return e.setSize(128,128),e}render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)};toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=IF(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new xl(this.toArray(),this.width,this.height,Ns,this._type,e?.mapping||Lh,e?.wrapS||_s,e?.wrapT||_s,e?.magFilter||yi,e?.minFilter||yi,e?.anisotropy||1,cc);return t.generateMipmaps=e?.generateMipmaps!==void 0?e?.generateMipmaps:!1,t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof za&&Object.values(this.material.uniforms).forEach(t=>{t.value instanceof Ti&&t.value.dispose()}),Object.values(this.material).forEach(t=>{t instanceof Ti&&t.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class BF extends Error{}class OF extends Error{}const xy=(r,e,t)=>{const n=new RegExp(`${e}="([^"]*)"`,"i").exec(r);if(n)return n[1];const i=new RegExp(`<${e}[^>]*>([\\s\\S]*?)</${e}>`,"i").exec(r);if(i){const s=i[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return s&&s.length===3?s.map(a=>a.replace(/<\/?rdf:li>/g,"")):i[1].trim()}if(t!==void 0)return t;throw new Error(`Can't find ${e} in gainmap metadata`)},f$=r=>{let e;typeof TextDecoder<"u"?e=new TextDecoder().decode(r):e=r.toString();let t=e.indexOf("<x:xmpmeta");for(;t!==-1;){const n=e.indexOf("x:xmpmeta>",t),i=e.slice(t,n+10);try{const s=xy(i,"hdrgm:GainMapMin","0"),a=xy(i,"hdrgm:GainMapMax"),o=xy(i,"hdrgm:Gamma","1"),c=xy(i,"hdrgm:OffsetSDR","0.015625"),u=xy(i,"hdrgm:OffsetHDR","0.015625"),h=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(i),p=h?h[1]:"0",v=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(i);if(!v)throw new Error("Incomplete gainmap metadata");const y=v[1];return{gainMapMin:Array.isArray(s)?s.map(x=>parseFloat(x)):[parseFloat(s),parseFloat(s),parseFloat(s)],gainMapMax:Array.isArray(a)?a.map(x=>parseFloat(x)):[parseFloat(a),parseFloat(a),parseFloat(a)],gamma:Array.isArray(o)?o.map(x=>parseFloat(x)):[parseFloat(o),parseFloat(o),parseFloat(o)],offsetSdr:Array.isArray(c)?c.map(x=>parseFloat(x)):[parseFloat(c),parseFloat(c),parseFloat(c)],offsetHdr:Array.isArray(u)?u.map(x=>parseFloat(x)):[parseFloat(u),parseFloat(u),parseFloat(u)],hdrCapacityMin:parseFloat(p),hdrCapacityMax:parseFloat(y)}}catch{}t=e.indexOf("<x:xmpmeta",n)}};class h${options;constructor(e){this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((t,n)=>{const i=this.options.debug,s=new DataView(e.buffer);if(s.getUint16(0)!==65496){n(new Error("Not a valid jpeg"));return}const a=s.byteLength;let o=2,c=0,u;for(;o<a;){if(++c>250){n(new Error(`Found no marker after ${c} loops `));return}if(s.getUint8(o)!==255){n(new Error(`Not a valid marker at offset 0x${o.toString(16)}, found: 0x${s.getUint8(o).toString(16)}`));return}if(u=s.getUint8(o+1),i&&console.log(`Marker: ${u.toString(16)}`),u===226){i&&console.log("Found APP2 marker (0xffe2)");const h=o+4;if(s.getUint32(h)===1297106432){const p=h+4;let v;if(s.getUint16(p)===18761)v=!1;else if(s.getUint16(p)===19789)v=!0;else{n(new Error("No valid endianness marker found in TIFF header"));return}if(s.getUint16(p+2,!v)!==42){n(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const y=s.getUint32(p+4,!v);if(y<8){n(new Error("Not valid TIFF data! (First offset less than 8)"));return}const x=p+y,S=s.getUint16(x,!v),E=x+2;let b=0;for(let P=E;P<E+12*S;P+=12)s.getUint16(P,!v)===45057&&(b=s.getUint32(P+8,!v));const R=x+2+S*12+4,D=[];for(let P=R;P<R+b*16;P+=16){const O={MPType:s.getUint32(P,!v),size:s.getUint32(P+4,!v),dataOffset:s.getUint32(P+8,!v),dependantImages:s.getUint32(P+12,!v),start:-1,end:-1,isFII:!1};O.dataOffset?(O.start=p+O.dataOffset,O.isFII=!1):(O.start=0,O.isFII=!0),O.end=O.start+O.size,D.push(O)}if(this.options.extractNonFII&&D.length){const P=new Blob([s]),O=[];for(const N of D){if(N.isFII&&!this.options.extractFII)continue;const U=P.slice(N.start,N.end+1,"image/jpeg");O.push(U)}t(O)}}}o+=2+s.getUint16(o+2)}})}}const d$=async r=>{const e=f$(r);if(!e)throw new OF("Gain map XMP metadata not found");const n=await new h$({extractFII:!0,extractNonFII:!0}).extract(r);if(n.length!==2)throw new BF("Gain map recovery image not found");return{sdr:new Uint8Array(await n[0].arrayBuffer()),gainMap:new Uint8Array(await n[1].arrayBuffer()),metadata:e}},AB=r=>new Promise((e,t)=>{const n=document.createElement("img");n.onload=()=>{e(n)},n.onerror=i=>{t(i)},n.src=URL.createObjectURL(r)});class p$ extends Hr{_renderer;_renderTargetOptions;_internalLoadingManager;_config;constructor(e,t){super(t),this._config=e,e.renderer&&(this._renderer=e.renderer),this._internalLoadingManager=new dT}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new Ti,sdr:new Ti});return this._config.createQuadRenderer({width:16,height:16,type:ar,colorSpace:cc,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(e,t,n){const i=t?new Blob([t],{type:"image/jpeg"}):void 0,s=new Blob([e],{type:"image/jpeg"});let a,o,c=!1;if(typeof createImageBitmap>"u"){const u=await Promise.all([i?AB(i):Promise.resolve(void 0),AB(s)]);o=u[0],a=u[1],c=n==="flipY"}else{const u=await Promise.all([i?createImageBitmap(i,{imageOrientation:n||"flipY"}):Promise.resolve(void 0),createImageBitmap(s,{imageOrientation:n||"flipY"})]);o=u[0],a=u[1]}return{sdrImage:a,gainMapImage:o,needsFlip:c}}createTextures(e,t,n){const i=new Ti(t||new ImageData(2,2),Lh,_s,_s,yi,DC,Ns,Ha,1,cc);i.flipY=n,i.needsUpdate=!0;const s=new Ti(e,Lh,_s,_s,yi,DC,Ns,Ha,1,sr);return s.flipY=n,s.needsUpdate=!0,{gainMap:i,sdr:s}}updateQuadRenderer(e,t,n,i,s){e.width=t.width,e.height=t.height,e.material.gainMap=n,e.material.sdr=i,e.material.gainMapMin=s.gainMapMin,e.material.gainMapMax=s.gainMapMax,e.material.offsetHdr=s.offsetHdr,e.material.offsetSdr=s.offsetSdr,e.material.gamma=s.gamma,e.material.hdrCapacityMin=s.hdrCapacityMin,e.material.hdrCapacityMax=s.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,s.hdrCapacityMax),e.material.needsUpdate=!0}}const m$=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,g$=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class v$ extends za{_maxDisplayBoost;_hdrCapacityMin;_hdrCapacityMax;constructor({gamma:e,offsetHdr:t,offsetSdr:n,gainMapMin:i,gainMapMax:s,maxDisplayBoost:a,hdrCapacityMin:o,hdrCapacityMax:c,sdr:u,gainMap:h}){super({name:"GainMapDecoderMaterial",vertexShader:m$,fragmentShader:g$,uniforms:{sdr:{value:u},gainMap:{value:h},gamma:{value:new ae(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new ae().fromArray(t)},offsetSdr:{value:new ae().fromArray(n)},gainMapMin:{value:new ae().fromArray(i)},gainMapMax:{value:new ae().fromArray(s)},weightFactor:{value:(Math.log2(a)-o)/(c-o)}},blending:lc,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=a,this._hdrCapacityMin=o,this._hdrCapacityMax=c,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class PF extends p${constructor(e,t){super({renderer:e,createMaterial:n=>new v$(n),createQuadRenderer:n=>new mL(n)},t)}async render(e,t,n,i){const{sdrImage:s,gainMapImage:a,needsFlip:o}=await this.processImages(n,i,"flipY"),{gainMap:c,sdr:u}=this.createTextures(s,a,o);this.updateQuadRenderer(e,s,c,u,t),e.render()}}class y$ extends PF{load([e,t,n],i,s,a){const o=this.prepareQuadRenderer();let c,u,h;const p=async()=>{if(c&&u&&h){try{await this.render(o,h,c,u)}catch(B){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(n),typeof a=="function"&&a(B),o.disposeOnDemandRenderer();return}typeof i=="function"&&i(o),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(n),o.disposeOnDemandRenderer()}};let v=!0,y=0,x=0,S=!0,E=0,b=0,T=!0,R=0,D=0;const P=()=>{if(typeof s=="function"){const B=y+E+R,I=x+b+D,z=v&&S&&T;s(new ProgressEvent("progress",{lengthComputable:z,loaded:I,total:B}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(n);const O=new kr(this._internalLoadingManager);O.setResponseType("arraybuffer"),O.setRequestHeader(this.requestHeader),O.setPath(this.path),O.setWithCredentials(this.withCredentials),O.load(e,async B=>{if(typeof B=="string")throw new Error("Invalid sdr buffer");c=B,await p()},B=>{v=B.lengthComputable,x=B.loaded,y=B.total,P()},B=>{this.manager.itemError(e),typeof a=="function"&&a(B)});const N=new kr(this._internalLoadingManager);N.setResponseType("arraybuffer"),N.setRequestHeader(this.requestHeader),N.setPath(this.path),N.setWithCredentials(this.withCredentials),N.load(t,async B=>{if(typeof B=="string")throw new Error("Invalid gainmap buffer");u=B,await p()},B=>{S=B.lengthComputable,b=B.loaded,E=B.total,P()},B=>{this.manager.itemError(t),typeof a=="function"&&a(B)});const U=new kr(this._internalLoadingManager);return U.setRequestHeader(this.requestHeader),U.setPath(this.path),U.setWithCredentials(this.withCredentials),U.load(n,async B=>{if(typeof B!="string")throw new Error("Invalid metadata string");h=JSON.parse(B),await p()},B=>{T=B.lengthComputable,D=B.loaded,R=B.total,P()},B=>{this.manager.itemError(n),typeof a=="function"&&a(B)}),o}}class x$ extends PF{load(e,t,n,i){const s=this.prepareQuadRenderer(),a=new kr(this._internalLoadingManager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(this.withCredentials),this.manager.itemStart(e),a.load(e,async o=>{if(typeof o=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const c=new Uint8Array(o);let u,h,p;try{const v=await d$(c);u=v.sdr,h=v.gainMap,p=v.metadata}catch(v){if(v instanceof OF||v instanceof BF)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),p={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},u=c;else throw v}try{await this.render(s,p,u.buffer,h?.buffer)}catch(v){this.manager.itemError(e),typeof i=="function"&&i(v),s.disposeOnDemandRenderer();return}typeof t=="function"&&t(s),this.manager.itemEnd(e),s.disposeOnDemandRenderer()},n,o=>{this.manager.itemError(e),typeof i=="function"&&i(o)}),s}}const bx={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},NF="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",X0=r=>Array.isArray(r),gL=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function CT({files:r=gL,path:e="",preset:t=void 0,colorSpace:n=void 0,extensions:i}={}){t&&(vL(t),r=bx[t],e=NF);const s=X0(r),{extension:a,isCubemap:o}=yL(r),c=xL(a);if(!c)throw new Error("useEnvironment: Unrecognized file extension: "+r);const u=sa(y=>y.gl);Fe.useLayoutEffect(()=>{if(a!=="webp"&&a!=="jpg"&&a!=="jpeg")return;function y(){El.clear(c,s?[r]:r)}u.domElement.addEventListener("webglcontextlost",y,{once:!0})},[r,u.domElement]);const h=El(c,s?[r]:r,y=>{(a==="webp"||a==="jpg"||a==="jpeg")&&y.setRenderer(u),y.setPath==null||y.setPath(e),i&&i(y)});let p=s?h[0]:h;if(a==="jpg"||a==="jpeg"||a==="webp"){var v;p=(v=p.renderTarget)==null?void 0:v.texture}return p.mapping=o?ou:Q0,p.colorSpace=n??(o?"srgb":"srgb-linear"),p}const _$={files:gL,path:"",preset:void 0,extensions:void 0};CT.preload=r=>{const e={..._$,...r};let{files:t,path:n=""}=e;const{preset:i,extensions:s}=e;i&&(vL(i),t=bx[i],n=NF);const{extension:a}=yL(t);if(a==="webp"||a==="jpg"||a==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const o=xL(a);if(!o)throw new Error("useEnvironment: Unrecognized file extension: "+t);El.preload(o,X0(t)?[t]:t,c=>{c.setPath==null||c.setPath(n),s&&s(c)})};const S$={files:gL,preset:void 0};CT.clear=r=>{const e={...S$,...r};let{files:t}=e;const{preset:n}=e;n&&(vL(n),t=bx[n]);const{extension:i}=yL(t),s=xL(i);if(!s)throw new Error("useEnvironment: Unrecognized file extension: "+t);El.clear(s,X0(t)?[t]:t)};function vL(r){if(!(r in bx))throw new Error("Preset must be one of: "+Object.keys(bx).join(", "))}function yL(r){var e;const t=X0(r)&&r.length===6,n=X0(r)&&r.length===3&&r.some(a=>a.endsWith("json")),i=X0(r)?r[0]:r;return{extension:t?"cube":n?"webp":i.startsWith("data:application/exr")?"exr":i.startsWith("data:application/hdr")?"hdr":i.startsWith("data:image/jpeg")?"jpg":(e=i.split(".").pop())==null||(e=e.split("?"))==null||(e=e.shift())==null?void 0:e.toLowerCase(),isCubemap:t,isGainmap:n}}function xL(r){return r==="cube"?YP:r==="hdr"?uK:r==="exr"?fK:r==="jpg"||r==="jpeg"?x$:r==="webp"?y$:null}const A$=r=>r.current&&r.current.isScene,E$=r=>A$(r)?r.current:r;function _L(r,e,t,n,i={}){var s,a,o,c;i={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...i};const u=E$(e||t),h=u.background,p=u.environment,v={backgroundBlurriness:u.backgroundBlurriness,backgroundIntensity:u.backgroundIntensity,backgroundRotation:(s=(a=u.backgroundRotation)==null||a.clone==null?void 0:a.clone())!==null&&s!==void 0?s:[0,0,0],environmentIntensity:u.environmentIntensity,environmentRotation:(o=(c=u.environmentRotation)==null||c.clone==null?void 0:c.clone())!==null&&o!==void 0?o:[0,0,0]};return r!=="only"&&(u.environment=n),r&&(u.background=n),rc(u,i),()=>{r!=="only"&&(u.environment=p),r&&(u.background=h),rc(u,v)}}function SL({scene:r,background:e=!1,map:t,...n}){const i=sa(s=>s.scene);return Fe.useLayoutEffect(()=>{if(t)return _L(e,r,i,t,n)}),null}function UF({background:r=!1,scene:e,blur:t,backgroundBlurriness:n,backgroundIntensity:i,backgroundRotation:s,environmentIntensity:a,environmentRotation:o,...c}){const u=CT(c),h=sa(p=>p.scene);return Fe.useLayoutEffect(()=>_L(r,e,h,u,{backgroundBlurriness:t??n,backgroundIntensity:i,backgroundRotation:s,environmentIntensity:a,environmentRotation:o})),Fe.useEffect(()=>()=>{u.dispose()},[u]),null}function b$({children:r,near:e=.1,far:t=1e3,resolution:n=256,frames:i=1,map:s,background:a=!1,blur:o,backgroundBlurriness:c,backgroundIntensity:u,backgroundRotation:h,environmentIntensity:p,environmentRotation:v,scene:y,files:x,path:S,preset:E=void 0,extensions:b}){const T=sa(U=>U.gl),R=sa(U=>U.scene),D=Fe.useRef(null),[P]=Fe.useState(()=>new Hx),O=Fe.useMemo(()=>{const U=new nD(n);return U.texture.type=ar,U},[n]);Fe.useEffect(()=>()=>{O.dispose()},[O]),Fe.useLayoutEffect(()=>{if(i===1){const U=T.autoClear;T.autoClear=!0,D.current.update(T,P),T.autoClear=U}return _L(a,y,R,O.texture,{backgroundBlurriness:o??c,backgroundIntensity:u,backgroundRotation:h,environmentIntensity:p,environmentRotation:v})},[r,P,O.texture,y,R,a,i,T]);let N=1;return GD(()=>{if(i===1/0||N<i){const U=T.autoClear;T.autoClear=!0,D.current.update(T,P),T.autoClear=U,N++}}),Fe.createElement(Fe.Fragment,null,FY(Fe.createElement(Fe.Fragment,null,r,Fe.createElement("cubeCamera",{ref:D,args:[e,t,O]}),x||E?Fe.createElement(UF,{background:!0,files:x,preset:E,path:S,extensions:b}):s?Fe.createElement(SL,{background:!0,map:s,extensions:b}):null),P))}function T$(r){var e,t,n,i;const s=CT(r),a=r.map||s;Fe.useMemo(()=>TN({GroundProjectedEnvImpl:_X}),[]),Fe.useEffect(()=>()=>{s.dispose()},[s]);const o=Fe.useMemo(()=>[a],[a]),c=(e=r.ground)==null?void 0:e.height,u=(t=r.ground)==null?void 0:t.radius,h=(n=(i=r.ground)==null?void 0:i.scale)!==null&&n!==void 0?n:1e3;return Fe.createElement(Fe.Fragment,null,Fe.createElement(SL,Np({},r,{map:a})),Fe.createElement("groundProjectedEnvImpl",{args:o,scale:h,height:c,radius:u}))}function M$(r){return r.ground?Fe.createElement(T$,r):r.map?Fe.createElement(SL,r):r.children?Fe.createElement(b$,r):Fe.createElement(UF,r)}const EB=Fe.forwardRef(({light:r,args:e,map:t,toneMapped:n=!1,color:i="white",form:s="rect",intensity:a=1,scale:o=1,target:c=[0,0,0],children:u,...h},p)=>{const v=Fe.useRef(null);return Fe.useImperativeHandle(p,()=>v.current,[]),Fe.useLayoutEffect(()=>{!u&&!h.material&&(rc(v.current.material,{color:i}),v.current.material.color.multiplyScalar(a))},[i,a,u,h.material]),Fe.useLayoutEffect(()=>{h.rotation||v.current.quaternion.identity(),c&&!h.rotation&&(typeof c=="boolean"?v.current.lookAt(0,0,0):v.current.lookAt(Array.isArray(c)?new ae(...c):c))},[c,h.rotation]),o=Array.isArray(o)&&o.length===2?[o[0],o[1],1]:o,Fe.createElement("mesh",Np({ref:v,scale:o},h),s==="circle"?Fe.createElement("ringGeometry",{args:e||[0,.5,64]}):s==="ring"?Fe.createElement("ringGeometry",{args:e||[.25,.5,64]}):s==="rect"||s==="plane"?Fe.createElement("planeGeometry",{args:e||[1,1]}):s==="box"?Fe.createElement("boxGeometry",{args:e||[1,1,1]}):Fe.createElement(s,{args:e}),u||Fe.createElement("meshBasicMaterial",{toneMapped:n,map:t,side:so}),r&&Fe.createElement("pointLight",Np({castShadow:!0},r)))}),FF=()=>ye.jsxs("group",{name:"lights",children:[ye.jsxs(M$,{resolution:256,preset:"city",background:!1,blur:.8,children:[ye.jsx(EB,{form:"rect",intensity:1.2,position:[0,5,-5],scale:[15,15],"rotation-x":Math.PI/4,color:"#e6e6e6"}),ye.jsx(EB,{form:"rect",intensity:.8,position:[0,-2,5],scale:[12,12],"rotation-x":-Math.PI/4,color:"#e6e6e6"})]}),ye.jsx("spotLight",{position:[4,8,4],angle:.3,penumbra:1,decay:1,intensity:Math.PI*.8,castShadow:!0,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024,"shadow-bias":-1e-4,color:"#f5f5f5"}),ye.jsx("spotLight",{position:[-3,6,-3],angle:.4,penumbra:1,decay:1,intensity:Math.PI*.5,color:"#f0f0f0"}),ye.jsx("directionalLight",{position:[0,3,-6],intensity:Math.PI*.4,color:"#ffffffff"}),ye.jsx("pointLight",{position:[0,-3,0],intensity:Math.PI*.3,distance:15,decay:2,color:"#dddddd"}),ye.jsx("pointLight",{position:[-6,2,0],intensity:Math.PI*.25,distance:12,decay:2,color:"#eeeeee"}),ye.jsx("pointLight",{position:[6,2,0],intensity:Math.PI*.25,distance:12,decay:2,color:"#eeeeee"}),ye.jsx("ambientLight",{intensity:.3,color:"#ffffff"}),ye.jsx("hemisphereLight",{skyColor:"#ffffff",groundColor:"#666666",intensity:.4}),ye.jsx("rectAreaLight",{width:8,height:3,intensity:1.5,position:[0,0,-7],rotation:[0,0,0],color:"#ffffff"})]});function ef(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function kF(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.__proto__=e}var Go={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},vg={duration:.5,overwrite:!1,delay:0},AL,Gr,fs,gl=1e8,Ki=1/gl,yR=Math.PI*2,C$=yR/4,R$=0,GF=Math.sqrt,D$=Math.cos,L$=Math.sin,Cr=function(e){return typeof e=="string"},Rs=function(e){return typeof e=="function"},gf=function(e){return typeof e=="number"},EL=function(e){return typeof e>"u"},fu=function(e){return typeof e=="object"},lo=function(e){return e!==!1},bL=function(){return typeof window<"u"},BA=function(e){return Rs(e)||Cr(e)},HF=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},la=Array.isArray,xR=/(?:-?\.?\d|\.)+/gi,zF=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,N0=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,sC=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,VF=/[+-]=-?[.\d]+/,YF=/[^,'"\[\]\s]+/gi,w$=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,vs,Jc,_R,TL,zo={},bb={},XF,KF=function(e){return(bb=yg(e,zo))&&ho},ML=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Tx=function(e,t){return!t&&console.warn(e)},qF=function(e,t){return e&&(zo[e]=t)&&bb&&(bb[e]=t)||zo},Mx=function(){return 0},I$={suppressEvents:!0,isStart:!0,kill:!1},uE={suppressEvents:!0,kill:!1},B$={suppressEvents:!0},CL={},Ch=[],SR={},jF,Io={},rC={},bB=30,fE=[],RL="",DL=function(e){var t=e[0],n,i;if(fu(t)||Rs(t)||(e=[e]),!(n=(t._gsap||{}).harness)){for(i=fE.length;i--&&!fE[i].targetTest(t););n=fE[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new yk(e[i],n)))||e.splice(i,1);return e},Ap=function(e){return e._gsap||DL(vl(e))[0]._gsap},WF=function(e,t,n){return(n=e[t])&&Rs(n)?e[t]():EL(n)&&e.getAttribute&&e.getAttribute(t)||n},co=function(e,t){return(e=e.split(",")).forEach(t)||e},Os=function(e){return Math.round(e*1e5)/1e5||0},Ks=function(e){return Math.round(e*1e7)/1e7||0},K0=function(e,t){var n=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),n==="+"?e+i:n==="-"?e-i:n==="*"?e*i:e/i},O$=function(e,t){for(var n=t.length,i=0;e.indexOf(t[i])<0&&++i<n;);return i<n},Tb=function(){var e=Ch.length,t=Ch.slice(0),n,i;for(SR={},Ch.length=0,n=0;n<e;n++)i=t[n],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},LL=function(e){return!!(e._initted||e._startAt||e.add)},JF=function(e,t,n,i){Ch.length&&!Gr&&Tb(),e.render(t,n,!!(Gr&&t<0&&LL(e))),Ch.length&&!Gr&&Tb()},$F=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(YF).length<2?t:Cr(e)?e.trim():e},QF=function(e){return e},Vo=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},P$=function(e){return function(t,n){for(var i in n)i in t||i==="duration"&&e||i==="ease"||(t[i]=n[i])}},yg=function(e,t){for(var n in t)e[n]=t[n];return e},TB=function r(e,t){for(var n in t)n!=="__proto__"&&n!=="constructor"&&n!=="prototype"&&(e[n]=fu(t[n])?r(e[n]||(e[n]={}),t[n]):t[n]);return e},Mb=function(e,t){var n={},i;for(i in e)i in t||(n[i]=e[i]);return n},Wy=function(e){var t=e.parent||vs,n=e.keyframes?P$(la(e.keyframes)):Vo;if(lo(e.inherit))for(;t;)n(e,t.vars.defaults),t=t.parent||t._dp;return e},N$=function(e,t){for(var n=e.length,i=n===t.length;i&&n--&&e[n]===t[n];);return n<0},ZF=function(e,t,n,i,s){var a=e[i],o;if(s)for(o=t[s];a&&a[s]>o;)a=a._prev;return a?(t._next=a._next,a._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[i]=t,t._prev=a,t.parent=t._dp=e,t},RT=function(e,t,n,i){n===void 0&&(n="_first"),i===void 0&&(i="_last");var s=t._prev,a=t._next;s?s._next=a:e[n]===t&&(e[n]=a),a?a._prev=s:e[i]===t&&(e[i]=s),t._next=t._prev=t.parent=null},Nh=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Ep=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},U$=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},AR=function(e,t,n,i){return e._startAt&&(Gr?e._startAt.revert(uE):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},F$=function r(e){return!e||e._ts&&r(e.parent)},MB=function(e){return e._repeat?xg(e._tTime,e=e.duration()+e._rDelay)*e:0},xg=function(e,t){var n=Math.floor(e=Ks(e/t));return e&&n===e?n-1:n},Cb=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},DT=function(e){return e._end=Ks(e._start+(e._tDur/Math.abs(e._ts||e._rts||Ki)||0))},LT=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=Ks(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),DT(e),n._dirty||Ep(n,e)),e},ek=function(e,t){var n;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(n=Cb(e.rawTime(),t),(!t._dur||e_(0,t.totalDuration(),n)-t._tTime>Ki)&&t.render(n,!0)),Ep(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-Ki}},Zc=function(e,t,n,i){return t.parent&&Nh(t),t._start=Ks((gf(n)?n:n||e!==vs?ul(e,n,t):e._time)+t._delay),t._end=Ks(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),ZF(e,t,"_first","_last",e._sort?"_start":0),ER(t)||(e._recent=t),i||ek(e,t),e._ts<0&&LT(e,e._tTime),e},tk=function(e,t){return(zo.ScrollTrigger||ML("scrollTrigger",t))&&zo.ScrollTrigger.create(t,e)},nk=function(e,t,n,i,s){if(IL(e,t,s),!e._initted)return 1;if(!n&&e._pt&&!Gr&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&jF!==Oo.frame)return Ch.push(e),e._lazy=[s,i],1},k$=function r(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||r(t))},ER=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},G$=function(e,t,n,i){var s=e.ratio,a=t<0||!t&&(!e._start&&k$(e)&&!(!e._initted&&ER(e))||(e._ts<0||e._dp._ts<0)&&!ER(e))?0:1,o=e._rDelay,c=0,u,h,p;if(o&&e._repeat&&(c=e_(0,e._tDur,t),h=xg(c,o),e._yoyo&&h&1&&(a=1-a),h!==xg(e._tTime,o)&&(s=1-a,e.vars.repeatRefresh&&e._initted&&e.invalidate())),a!==s||Gr||i||e._zTime===Ki||!t&&e._zTime){if(!e._initted&&nk(e,t,i,n,c))return;for(p=e._zTime,e._zTime=t||(n?Ki:0),n||(n=t&&!p),e.ratio=a,e._from&&(a=1-a),e._time=0,e._tTime=c,u=e._pt;u;)u.r(a,u.d),u=u._next;t<0&&AR(e,t,n,!0),e._onUpdate&&!n&&Uo(e,"onUpdate"),c&&e._repeat&&!n&&e.parent&&Uo(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===a&&(a&&Nh(e,1),!n&&!Gr&&(Uo(e,a?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},H$=function(e,t,n){var i;if(n>t)for(i=e._first;i&&i._start<=n;){if(i.data==="isPause"&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=n;){if(i.data==="isPause"&&i._start<t)return i;i=i._prev}},_g=function(e,t,n,i){var s=e._repeat,a=Ks(t)||0,o=e._tTime/e._tDur;return o&&!i&&(e._time*=a/e._dur),e._dur=a,e._tDur=s?s<0?1e10:Ks(a*(s+1)+e._rDelay*s):a,o>0&&!i&&LT(e,e._tTime=e._tDur*o),e.parent&&DT(e),n||Ep(e.parent,e),e},CB=function(e){return e instanceof Ua?Ep(e):_g(e,e._dur)},z$={_start:0,endTime:Mx,totalDuration:Mx},ul=function r(e,t,n){var i=e.labels,s=e._recent||z$,a=e.duration()>=gl?s.endTime(!1):e._dur,o,c,u;return Cr(t)&&(isNaN(t)||t in i)?(c=t.charAt(0),u=t.substr(-1)==="%",o=t.indexOf("="),c==="<"||c===">"?(o>=0&&(t=t.replace(/=/,"")),(c==="<"?s._start:s.endTime(s._repeat>=0))+(parseFloat(t.substr(1))||0)*(u?(o<0?s:n).totalDuration()/100:1)):o<0?(t in i||(i[t]=a),i[t]):(c=parseFloat(t.charAt(o-1)+t.substr(o+1)),u&&n&&(c=c/100*(la(n)?n[0]:n).totalDuration()),o>1?r(e,t.substr(0,o-1),n)+c:a+c)):t==null?a:+t},Jy=function(e,t,n){var i=gf(t[1]),s=(i?2:1)+(e<2?0:1),a=t[s],o,c;if(i&&(a.duration=t[1]),a.parent=n,e){for(o=a,c=n;c&&!("immediateRender"in o);)o=c.vars.defaults||{},c=lo(c.vars.inherit)&&c.parent;a.immediateRender=lo(o.immediateRender),e<2?a.runBackwards=1:a.startAt=t[s-1]}return new Xs(t[0],a,t[s+1])},Vh=function(e,t){return e||e===0?t(e):t},e_=function(e,t,n){return n<e?e:n>t?t:n},aa=function(e,t){return!Cr(e)||!(t=w$.exec(e))?"":t[1]},V$=function(e,t,n){return Vh(n,function(i){return e_(e,t,i)})},bR=[].slice,ik=function(e,t){return e&&fu(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&fu(e[0]))&&!e.nodeType&&e!==Jc},Y$=function(e,t,n){return n===void 0&&(n=[]),e.forEach(function(i){var s;return Cr(i)&&!t||ik(i,1)?(s=n).push.apply(s,vl(i)):n.push(i)})||n},vl=function(e,t,n){return fs&&!t&&fs.selector?fs.selector(e):Cr(e)&&!n&&(_R||!Sg())?bR.call((t||TL).querySelectorAll(e),0):la(e)?Y$(e,n):ik(e)?bR.call(e,0):e?[e]:[]},TR=function(e){return e=vl(e)[0]||Tx("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return vl(t,n.querySelectorAll?n:n===e?Tx("Invalid scope")||TL.createElement("div"):e)}},sk=function(e){return e.sort(function(){return .5-Math.random()})},rk=function(e){if(Rs(e))return e;var t=fu(e)?e:{each:e},n=bp(t.ease),i=t.from||0,s=parseFloat(t.base)||0,a={},o=i>0&&i<1,c=isNaN(i)||o,u=t.axis,h=i,p=i;return Cr(i)?h=p={center:.5,edges:.5,end:1}[i]||0:!o&&c&&(h=i[0],p=i[1]),function(v,y,x){var S=(x||t).length,E=a[S],b,T,R,D,P,O,N,U,B;if(!E){if(B=t.grid==="auto"?0:(t.grid||[1,gl])[1],!B){for(N=-gl;N<(N=x[B++].getBoundingClientRect().left)&&B<S;);B<S&&B--}for(E=a[S]=[],b=c?Math.min(B,S)*h-.5:i%B,T=B===gl?0:c?S*p/B-.5:i/B|0,N=0,U=gl,O=0;O<S;O++)R=O%B-b,D=T-(O/B|0),E[O]=P=u?Math.abs(u==="y"?D:R):GF(R*R+D*D),P>N&&(N=P),P<U&&(U=P);i==="random"&&sk(E),E.max=N-U,E.min=U,E.v=S=(parseFloat(t.amount)||parseFloat(t.each)*(B>S?S-1:u?u==="y"?S/B:B:Math.max(B,S/B))||0)*(i==="edges"?-1:1),E.b=S<0?s-S:s,E.u=aa(t.amount||t.each)||0,n=n&&S<0?mk(n):n}return S=(E[v]-E.min)/E.max||0,Ks(E.b+(n?n(S):S)*E.v)+E.u}},MR=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var i=Ks(Math.round(parseFloat(n)/e)*e*t);return(i-i%1)/t+(gf(n)?0:aa(n))}},ak=function(e,t){var n=la(e),i,s;return!n&&fu(e)&&(i=n=e.radius||gl,e.values?(e=vl(e.values),(s=!gf(e[0]))&&(i*=i)):e=MR(e.increment)),Vh(t,n?Rs(e)?function(a){return s=e(a),Math.abs(s-a)<=i?s:a}:function(a){for(var o=parseFloat(s?a.x:a),c=parseFloat(s?a.y:0),u=gl,h=0,p=e.length,v,y;p--;)s?(v=e[p].x-o,y=e[p].y-c,v=v*v+y*y):v=Math.abs(e[p]-o),v<u&&(u=v,h=p);return h=!i||u<=i?e[h]:a,s||h===a||gf(a)?h:h+aa(a)}:MR(e))},ok=function(e,t,n,i){return Vh(la(e)?!t:n===!0?!!(n=0):!i,function(){return la(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+n*.99))/n)*n*i)/i})},X$=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(i){return t.reduce(function(s,a){return a(s)},i)}},K$=function(e,t){return function(n){return e(parseFloat(n))+(t||aa(n))}},q$=function(e,t,n){return ck(e,t,0,1,n)},lk=function(e,t,n){return Vh(n,function(i){return e[~~t(i)]})},j$=function r(e,t,n){var i=t-e;return la(e)?lk(e,r(0,e.length),t):Vh(n,function(s){return(i+(s-e)%i)%i+e})},W$=function r(e,t,n){var i=t-e,s=i*2;return la(e)?lk(e,r(0,e.length-1),t):Vh(n,function(a){return a=(s+(a-e)%s)%s||0,e+(a>i?s-a:a)})},Cx=function(e){for(var t=0,n="",i,s,a,o;~(i=e.indexOf("random(",t));)a=e.indexOf(")",i),o=e.charAt(i+7)==="[",s=e.substr(i+7,a-i-7).match(o?YF:xR),n+=e.substr(t,i-t)+ok(o?s:+s[0],o?0:+s[1],+s[2]||1e-5),t=a+1;return n+e.substr(t,e.length-t)},ck=function(e,t,n,i,s){var a=t-e,o=i-n;return Vh(s,function(c){return n+((c-e)/a*o||0)})},J$=function r(e,t,n,i){var s=isNaN(e+t)?0:function(y){return(1-y)*e+y*t};if(!s){var a=Cr(e),o={},c,u,h,p,v;if(n===!0&&(i=1)&&(n=null),a)e={p:e},t={p:t};else if(la(e)&&!la(t)){for(h=[],p=e.length,v=p-2,u=1;u<p;u++)h.push(r(e[u-1],e[u]));p--,s=function(x){x*=p;var S=Math.min(v,~~x);return h[S](x-S)},n=t}else i||(e=yg(la(e)?[]:{},e));if(!h){for(c in t)wL.call(o,e,c,"get",t[c]);s=function(x){return PL(x,o)||(a?e.p:e)}}}return Vh(n,s)},RB=function(e,t,n){var i=e.labels,s=gl,a,o,c;for(a in i)o=i[a]-t,o<0==!!n&&o&&s>(o=Math.abs(o))&&(c=a,s=o);return c},Uo=function(e,t,n){var i=e.vars,s=i[t],a=fs,o=e._ctx,c,u,h;if(s)return c=i[t+"Params"],u=i.callbackScope||e,n&&Ch.length&&Tb(),o&&(fs=o),h=c?s.apply(u,c):s.call(u),fs=a,h},Ry=function(e){return Nh(e),e.scrollTrigger&&e.scrollTrigger.kill(!!Gr),e.progress()<1&&Uo(e,"onInterrupt"),e},U0,uk=[],fk=function(e){if(e)if(e=!e.name&&e.default||e,bL()||e.headless){var t=e.name,n=Rs(e),i=t&&!n&&e.init?function(){this._props=[]}:e,s={init:Mx,render:PL,add:wL,kill:hQ,modifier:fQ,rawVars:0},a={targetTest:0,get:0,getSetter:OL,aliases:{},register:0};if(Sg(),e!==i){if(Io[t])return;Vo(i,Vo(Mb(e,s),a)),yg(i.prototype,yg(s,Mb(e,a))),Io[i.prop=t]=i,e.targetTest&&(fE.push(i),CL[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}qF(t,i),e.register&&e.register(ho,i,uo)}else uk.push(e)},Xi=255,Dy={aqua:[0,Xi,Xi],lime:[0,Xi,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Xi],navy:[0,0,128],white:[Xi,Xi,Xi],olive:[128,128,0],yellow:[Xi,Xi,0],orange:[Xi,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Xi,0,0],pink:[Xi,192,203],cyan:[0,Xi,Xi],transparent:[Xi,Xi,Xi,0]},aC=function(e,t,n){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(n-t)*e*6:e<.5?n:e*3<2?t+(n-t)*(2/3-e)*6:t)*Xi+.5|0},hk=function(e,t,n){var i=e?gf(e)?[e>>16,e>>8&Xi,e&Xi]:0:Dy.black,s,a,o,c,u,h,p,v,y,x;if(!i){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),Dy[e])i=Dy[e];else if(e.charAt(0)==="#"){if(e.length<6&&(s=e.charAt(1),a=e.charAt(2),o=e.charAt(3),e="#"+s+s+a+a+o+o+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return i=parseInt(e.substr(1,6),16),[i>>16,i>>8&Xi,i&Xi,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),i=[e>>16,e>>8&Xi,e&Xi]}else if(e.substr(0,3)==="hsl"){if(i=x=e.match(xR),!t)c=+i[0]%360/360,u=+i[1]/100,h=+i[2]/100,a=h<=.5?h*(u+1):h+u-h*u,s=h*2-a,i.length>3&&(i[3]*=1),i[0]=aC(c+1/3,s,a),i[1]=aC(c,s,a),i[2]=aC(c-1/3,s,a);else if(~e.indexOf("="))return i=e.match(zF),n&&i.length<4&&(i[3]=1),i}else i=e.match(xR)||Dy.transparent;i=i.map(Number)}return t&&!x&&(s=i[0]/Xi,a=i[1]/Xi,o=i[2]/Xi,p=Math.max(s,a,o),v=Math.min(s,a,o),h=(p+v)/2,p===v?c=u=0:(y=p-v,u=h>.5?y/(2-p-v):y/(p+v),c=p===s?(a-o)/y+(a<o?6:0):p===a?(o-s)/y+2:(s-a)/y+4,c*=60),i[0]=~~(c+.5),i[1]=~~(u*100+.5),i[2]=~~(h*100+.5)),n&&i.length<4&&(i[3]=1),i},dk=function(e){var t=[],n=[],i=-1;return e.split(Rh).forEach(function(s){var a=s.match(N0)||[];t.push.apply(t,a),n.push(i+=a.length+1)}),t.c=n,t},DB=function(e,t,n){var i="",s=(e+i).match(Rh),a=t?"hsla(":"rgba(",o=0,c,u,h,p;if(!s)return e;if(s=s.map(function(v){return(v=hk(v,t,1))&&a+(t?v[0]+","+v[1]+"%,"+v[2]+"%,"+v[3]:v.join(","))+")"}),n&&(h=dk(e),c=n.c,c.join(i)!==h.c.join(i)))for(u=e.replace(Rh,"1").split(N0),p=u.length-1;o<p;o++)i+=u[o]+(~c.indexOf(o)?s.shift()||a+"0,0,0,0)":(h.length?h:s.length?s:n).shift());if(!u)for(u=e.split(Rh),p=u.length-1;o<p;o++)i+=u[o]+s[o];return i+u[p]},Rh=(function(){var r="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in Dy)r+="|"+e+"\\b";return new RegExp(r+")","gi")})(),$$=/hsl[a]?\(/,pk=function(e){var t=e.join(" "),n;if(Rh.lastIndex=0,Rh.test(t))return n=$$.test(t),e[1]=DB(e[1],n),e[0]=DB(e[0],n,dk(e[1])),!0},Rx,Oo=(function(){var r=Date.now,e=500,t=33,n=r(),i=n,s=1e3/240,a=s,o=[],c,u,h,p,v,y,x=function S(E){var b=r()-i,T=E===!0,R,D,P,O;if((b>e||b<0)&&(n+=b-t),i+=b,P=i-n,R=P-a,(R>0||T)&&(O=++p.frame,v=P-p.time*1e3,p.time=P=P/1e3,a+=R+(R>=s?4:s-R),D=1),T||(c=u(S)),D)for(y=0;y<o.length;y++)o[y](P,v,O,E)};return p={time:0,frame:0,tick:function(){x(!0)},deltaRatio:function(E){return v/(1e3/(E||60))},wake:function(){XF&&(!_R&&bL()&&(Jc=_R=window,TL=Jc.document||{},zo.gsap=ho,(Jc.gsapVersions||(Jc.gsapVersions=[])).push(ho.version),KF(bb||Jc.GreenSockGlobals||!Jc.gsap&&Jc||{}),uk.forEach(fk)),h=typeof requestAnimationFrame<"u"&&requestAnimationFrame,c&&p.sleep(),u=h||function(E){return setTimeout(E,a-p.time*1e3+1|0)},Rx=1,x(2))},sleep:function(){(h?cancelAnimationFrame:clearTimeout)(c),Rx=0,u=Mx},lagSmoothing:function(E,b){e=E||1/0,t=Math.min(b||33,e)},fps:function(E){s=1e3/(E||240),a=p.time*1e3+s},add:function(E,b,T){var R=b?function(D,P,O,N){E(D,P,O,N),p.remove(R)}:E;return p.remove(E),o[T?"unshift":"push"](R),Sg(),R},remove:function(E,b){~(b=o.indexOf(E))&&o.splice(b,1)&&y>=b&&y--},_listeners:o},p})(),Sg=function(){return!Rx&&Oo.wake()},di={},Q$=/^[\d.\-M][\d.\-,\s]/,Z$=/["']/g,eQ=function(e){for(var t={},n=e.substr(1,e.length-3).split(":"),i=n[0],s=1,a=n.length,o,c,u;s<a;s++)c=n[s],o=s!==a-1?c.lastIndexOf(","):c.length,u=c.substr(0,o),t[i]=isNaN(u)?u.replace(Z$,"").trim():+u,i=c.substr(o+1).trim();return t},tQ=function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<n?e.indexOf(")",n+1):n)},nQ=function(e){var t=(e+"").split("("),n=di[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[eQ(t[1])]:tQ(e).split(",").map($F)):di._CE&&Q$.test(e)?di._CE("",e):n},mk=function(e){return function(t){return 1-e(1-t)}},gk=function r(e,t){for(var n=e._first,i;n;)n instanceof Ua?r(n,t):n.vars.yoyoEase&&(!n._yoyo||!n._repeat)&&n._yoyo!==t&&(n.timeline?r(n.timeline,t):(i=n._ease,n._ease=n._yEase,n._yEase=i,n._yoyo=t)),n=n._next},bp=function(e,t){return e&&(Rs(e)?e:di[e]||nQ(e))||t},Kp=function(e,t,n,i){n===void 0&&(n=function(c){return 1-t(1-c)}),i===void 0&&(i=function(c){return c<.5?t(c*2)/2:1-t((1-c)*2)/2});var s={easeIn:t,easeOut:n,easeInOut:i},a;return co(e,function(o){di[o]=zo[o]=s,di[a=o.toLowerCase()]=n;for(var c in s)di[a+(c==="easeIn"?".in":c==="easeOut"?".out":".inOut")]=di[o+"."+c]=s[c]}),s},vk=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},oC=function r(e,t,n){var i=t>=1?t:1,s=(n||(e?.3:.45))/(t<1?t:1),a=s/yR*(Math.asin(1/i)||0),o=function(h){return h===1?1:i*Math.pow(2,-10*h)*L$((h-a)*s)+1},c=e==="out"?o:e==="in"?function(u){return 1-o(1-u)}:vk(o);return s=yR/s,c.config=function(u,h){return r(e,u,h)},c},lC=function r(e,t){t===void 0&&(t=1.70158);var n=function(a){return a?--a*a*((t+1)*a+t)+1:0},i=e==="out"?n:e==="in"?function(s){return 1-n(1-s)}:vk(n);return i.config=function(s){return r(e,s)},i};co("Linear,Quad,Cubic,Quart,Quint,Strong",function(r,e){var t=e<5?e+1:e;Kp(r+",Power"+(t-1),e?function(n){return Math.pow(n,t)}:function(n){return n},function(n){return 1-Math.pow(1-n,t)},function(n){return n<.5?Math.pow(n*2,t)/2:1-Math.pow((1-n)*2,t)/2})});di.Linear.easeNone=di.none=di.Linear.easeIn;Kp("Elastic",oC("in"),oC("out"),oC());(function(r,e){var t=1/e,n=2*t,i=2.5*t,s=function(o){return o<t?r*o*o:o<n?r*Math.pow(o-1.5/e,2)+.75:o<i?r*(o-=2.25/e)*o+.9375:r*Math.pow(o-2.625/e,2)+.984375};Kp("Bounce",function(a){return 1-s(1-a)},s)})(7.5625,2.75);Kp("Expo",function(r){return Math.pow(2,10*(r-1))*r+r*r*r*r*r*r*(1-r)});Kp("Circ",function(r){return-(GF(1-r*r)-1)});Kp("Sine",function(r){return r===1?1:-D$(r*C$)+1});Kp("Back",lC("in"),lC("out"),lC());di.SteppedEase=di.steps=zo.SteppedEase={config:function(e,t){e===void 0&&(e=1);var n=1/e,i=e+(t?0:1),s=t?1:0,a=1-Ki;return function(o){return((i*e_(0,a,o)|0)+s)*n}}};vg.ease=di["quad.out"];co("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(r){return RL+=r+","+r+"Params,"});var yk=function(e,t){this.id=R$++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:WF,this.set=t?t.getSetter:OL},Dx=(function(){function r(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,_g(this,+t.duration,1,1),this.data=t.data,fs&&(this._ctx=fs,fs.data.push(this)),Rx||Oo.wake()}var e=r.prototype;return e.delay=function(n){return n||n===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+n-this._delay),this._delay=n,this):this._delay},e.duration=function(n){return arguments.length?this.totalDuration(this._repeat>0?n+(n+this._rDelay)*this._repeat:n):this.totalDuration()&&this._dur},e.totalDuration=function(n){return arguments.length?(this._dirty=0,_g(this,this._repeat<0?n:(n-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(n,i){if(Sg(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(LT(this,n),!s._dp||s.parent||ek(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&n<this._tDur||this._ts<0&&n>0||!this._tDur&&!n)&&Zc(this._dp,this,this._start-this._delay)}return(this._tTime!==n||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===Ki||!n&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=n),JF(this,n,i)),this},e.time=function(n,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),n+MB(this))%(this._dur+this._rDelay)||(n?this._dur:0),i):this._time},e.totalProgress=function(n,i){return arguments.length?this.totalTime(this.totalDuration()*n,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(n,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-n:n)+MB(this),i):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(n,i){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(n-1)*s,i):this._repeat?xg(this._tTime,s)+1:1},e.timeScale=function(n,i){if(!arguments.length)return this._rts===-Ki?0:this._rts;if(this._rts===n)return this;var s=this.parent&&this._ts?Cb(this.parent._time,this):this._tTime;return this._rts=+n||0,this._ts=this._ps||n===-Ki?0:this._rts,this.totalTime(e_(-Math.abs(this._delay),this.totalDuration(),s),i!==!1),DT(this),U$(this)},e.paused=function(n){return arguments.length?(this._ps!==n&&(this._ps=n,n?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Sg(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Ki&&(this._tTime-=Ki)))),this):this._ps},e.startTime=function(n){if(arguments.length){this._start=n;var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&Zc(i,this,n-this._delay),this}return this._start},e.endTime=function(n){return this._start+(lo(n)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(n){var i=this.parent||this._dp;return i?n&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Cb(i.rawTime(n),this):this._tTime:this._tTime},e.revert=function(n){n===void 0&&(n=B$);var i=Gr;return Gr=n,LL(this)&&(this.timeline&&this.timeline.revert(n),this.totalTime(-.01,n.suppressEvents)),this.data!=="nested"&&n.kill!==!1&&this.kill(),Gr=i,this},e.globalTime=function(n){for(var i=this,s=arguments.length?n:i.rawTime();i;)s=i._start+s/(Math.abs(i._ts)||1),i=i._dp;return!this.parent&&this._sat?this._sat.globalTime(n):s},e.repeat=function(n){return arguments.length?(this._repeat=n===1/0?-2:n,CB(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(n){if(arguments.length){var i=this._time;return this._rDelay=n,CB(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(n){return arguments.length?(this._yoyo=n,this):this._yoyo},e.seek=function(n,i){return this.totalTime(ul(this,n),lo(i))},e.restart=function(n,i){return this.play().totalTime(n?-this._delay:0,lo(i)),this._dur||(this._zTime=-Ki),this},e.play=function(n,i){return n!=null&&this.seek(n,i),this.reversed(!1).paused(!1)},e.reverse=function(n,i){return n!=null&&this.seek(n||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(n,i){return n!=null&&this.seek(n,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(n){return arguments.length?(!!n!==this.reversed()&&this.timeScale(-this._rts||(n?-Ki:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-Ki,this},e.isActive=function(){var n=this.parent||this._dp,i=this._start,s;return!!(!n||this._ts&&this._initted&&n.isActive()&&(s=n.rawTime(!0))>=i&&s<this.endTime(!0)-Ki)},e.eventCallback=function(n,i,s){var a=this.vars;return arguments.length>1?(i?(a[n]=i,s&&(a[n+"Params"]=s),n==="onUpdate"&&(this._onUpdate=i)):delete a[n],this):a[n]},e.then=function(n){var i=this;return new Promise(function(s){var a=Rs(n)?n:QF,o=function(){var u=i.then;i.then=null,Rs(a)&&(a=a(i))&&(a.then||a===i)&&(i.then=u),s(a),i.then=u};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?o():i._prom=o})},e.kill=function(){Ry(this)},r})();Vo(Dx.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Ki,_prom:0,_ps:!1,_rts:1});var Ua=(function(r){kF(e,r);function e(n,i){var s;return n===void 0&&(n={}),s=r.call(this,n)||this,s.labels={},s.smoothChildTiming=!!n.smoothChildTiming,s.autoRemoveChildren=!!n.autoRemoveChildren,s._sort=lo(n.sortChildren),vs&&Zc(n.parent||vs,ef(s),i),n.reversed&&s.reverse(),n.paused&&s.paused(!0),n.scrollTrigger&&tk(ef(s),n.scrollTrigger),s}var t=e.prototype;return t.to=function(i,s,a){return Jy(0,arguments,this),this},t.from=function(i,s,a){return Jy(1,arguments,this),this},t.fromTo=function(i,s,a,o){return Jy(2,arguments,this),this},t.set=function(i,s,a){return s.duration=0,s.parent=this,Wy(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new Xs(i,s,ul(this,a),1),this},t.call=function(i,s,a){return Zc(this,Xs.delayedCall(0,i,s),a)},t.staggerTo=function(i,s,a,o,c,u,h){return a.duration=s,a.stagger=a.stagger||o,a.onComplete=u,a.onCompleteParams=h,a.parent=this,new Xs(i,a,ul(this,c)),this},t.staggerFrom=function(i,s,a,o,c,u,h){return a.runBackwards=1,Wy(a).immediateRender=lo(a.immediateRender),this.staggerTo(i,s,a,o,c,u,h)},t.staggerFromTo=function(i,s,a,o,c,u,h,p){return o.startAt=a,Wy(o).immediateRender=lo(o.immediateRender),this.staggerTo(i,s,o,c,u,h,p)},t.render=function(i,s,a){var o=this._time,c=this._dirty?this.totalDuration():this._tDur,u=this._dur,h=i<=0?0:Ks(i),p=this._zTime<0!=i<0&&(this._initted||!u),v,y,x,S,E,b,T,R,D,P,O,N;if(this!==vs&&h>c&&i>=0&&(h=c),h!==this._tTime||a||p){if(o!==this._time&&u&&(h+=this._time-o,i+=this._time-o),v=h,D=this._start,R=this._ts,b=!R,p&&(u||(o=this._zTime),(i||!s)&&(this._zTime=i)),this._repeat){if(O=this._yoyo,E=u+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(E*100+i,s,a);if(v=Ks(h%E),h===c?(S=this._repeat,v=u):(P=Ks(h/E),S=~~P,S&&S===P&&(v=u,S--),v>u&&(v=u)),P=xg(this._tTime,E),!o&&this._tTime&&P!==S&&this._tTime-P*E-this._dur<=0&&(P=S),O&&S&1&&(v=u-v,N=1),S!==P&&!this._lock){var U=O&&P&1,B=U===(O&&S&1);if(S<P&&(U=!U),o=U?0:h%u?u:h,this._lock=1,this.render(o||(N?0:Ks(S*E)),s,!u)._lock=0,this._tTime=h,!s&&this.parent&&Uo(this,"onRepeat"),this.vars.repeatRefresh&&!N&&(this.invalidate()._lock=1),o&&o!==this._time||b!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(u=this._dur,c=this._tDur,B&&(this._lock=2,o=U?u:-1e-4,this.render(o,!0),this.vars.repeatRefresh&&!N&&this.invalidate()),this._lock=0,!this._ts&&!b)return this;gk(this,N)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(T=H$(this,Ks(o),Ks(v)),T&&(h-=v-(v=T._start))),this._tTime=h,this._time=v,this._act=!R,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,o=0),!o&&h&&!s&&!P&&(Uo(this,"onStart"),this._tTime!==h))return this;if(v>=o&&i>=0)for(y=this._first;y;){if(x=y._next,(y._act||v>=y._start)&&y._ts&&T!==y){if(y.parent!==this)return this.render(i,s,a);if(y.render(y._ts>0?(v-y._start)*y._ts:(y._dirty?y.totalDuration():y._tDur)+(v-y._start)*y._ts,s,a),v!==this._time||!this._ts&&!b){T=0,x&&(h+=this._zTime=-Ki);break}}y=x}else{y=this._last;for(var I=i<0?i:v;y;){if(x=y._prev,(y._act||I<=y._end)&&y._ts&&T!==y){if(y.parent!==this)return this.render(i,s,a);if(y.render(y._ts>0?(I-y._start)*y._ts:(y._dirty?y.totalDuration():y._tDur)+(I-y._start)*y._ts,s,a||Gr&&LL(y)),v!==this._time||!this._ts&&!b){T=0,x&&(h+=this._zTime=I?-Ki:Ki);break}}y=x}}if(T&&!s&&(this.pause(),T.render(v>=o?0:-Ki)._zTime=v>=o?1:-1,this._ts))return this._start=D,DT(this),this.render(i,s,a);this._onUpdate&&!s&&Uo(this,"onUpdate",!0),(h===c&&this._tTime>=this.totalDuration()||!h&&o)&&(D===this._start||Math.abs(R)!==Math.abs(this._ts))&&(this._lock||((i||!u)&&(h===c&&this._ts>0||!h&&this._ts<0)&&Nh(this,1),!s&&!(i<0&&!o)&&(h||o||!c)&&(Uo(this,h===c&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(h<c&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,s){var a=this;if(gf(s)||(s=ul(this,s,i)),!(i instanceof Dx)){if(la(i))return i.forEach(function(o){return a.add(o,s)}),this;if(Cr(i))return this.addLabel(i,s);if(Rs(i))i=Xs.delayedCall(0,i);else return this}return this!==i?Zc(this,i,s):this},t.getChildren=function(i,s,a,o){i===void 0&&(i=!0),s===void 0&&(s=!0),a===void 0&&(a=!0),o===void 0&&(o=-gl);for(var c=[],u=this._first;u;)u._start>=o&&(u instanceof Xs?s&&c.push(u):(a&&c.push(u),i&&c.push.apply(c,u.getChildren(!0,s,a)))),u=u._next;return c},t.getById=function(i){for(var s=this.getChildren(1,1,1),a=s.length;a--;)if(s[a].vars.id===i)return s[a]},t.remove=function(i){return Cr(i)?this.removeLabel(i):Rs(i)?this.killTweensOf(i):(i.parent===this&&RT(this,i),i===this._recent&&(this._recent=this._last),Ep(this))},t.totalTime=function(i,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Ks(Oo.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),r.prototype.totalTime.call(this,i,s),this._forcing=0,this):this._tTime},t.addLabel=function(i,s){return this.labels[i]=ul(this,s),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,s,a){var o=Xs.delayedCall(0,s||Mx,a);return o.data="isPause",this._hasPause=1,Zc(this,o,ul(this,i))},t.removePause=function(i){var s=this._first;for(i=ul(this,i);s;)s._start===i&&s.data==="isPause"&&Nh(s),s=s._next},t.killTweensOf=function(i,s,a){for(var o=this.getTweensOf(i,a),c=o.length;c--;)Sh!==o[c]&&o[c].kill(i,s);return this},t.getTweensOf=function(i,s){for(var a=[],o=vl(i),c=this._first,u=gf(s),h;c;)c instanceof Xs?O$(c._targets,o)&&(u?(!Sh||c._initted&&c._ts)&&c.globalTime(0)<=s&&c.globalTime(c.totalDuration())>s:!s||c.isActive())&&a.push(c):(h=c.getTweensOf(o,s)).length&&a.push.apply(a,h),c=c._next;return a},t.tweenTo=function(i,s){s=s||{};var a=this,o=ul(a,i),c=s,u=c.startAt,h=c.onStart,p=c.onStartParams,v=c.immediateRender,y,x=Xs.to(a,Vo({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:s.duration||Math.abs((o-(u&&"time"in u?u.time:a._time))/a.timeScale())||Ki,onStart:function(){if(a.pause(),!y){var E=s.duration||Math.abs((o-(u&&"time"in u?u.time:a._time))/a.timeScale());x._dur!==E&&_g(x,E,0,1).render(x._time,!0,!0),y=1}h&&h.apply(x,p||[])}},s));return v?x.render(0):x},t.tweenFromTo=function(i,s,a){return this.tweenTo(s,Vo({startAt:{time:ul(this,i)}},a))},t.recent=function(){return this._recent},t.nextLabel=function(i){return i===void 0&&(i=this._time),RB(this,ul(this,i))},t.previousLabel=function(i){return i===void 0&&(i=this._time),RB(this,ul(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+Ki)},t.shiftChildren=function(i,s,a){a===void 0&&(a=0);for(var o=this._first,c=this.labels,u;o;)o._start>=a&&(o._start+=i,o._end+=i),o=o._next;if(s)for(u in c)c[u]>=a&&(c[u]+=i);return Ep(this)},t.invalidate=function(i){var s=this._first;for(this._lock=0;s;)s.invalidate(i),s=s._next;return r.prototype.invalidate.call(this,i)},t.clear=function(i){i===void 0&&(i=!0);for(var s=this._first,a;s;)a=s._next,this.remove(s),s=a;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),Ep(this)},t.totalDuration=function(i){var s=0,a=this,o=a._last,c=gl,u,h,p;if(arguments.length)return a.timeScale((a._repeat<0?a.duration():a.totalDuration())/(a.reversed()?-i:i));if(a._dirty){for(p=a.parent;o;)u=o._prev,o._dirty&&o.totalDuration(),h=o._start,h>c&&a._sort&&o._ts&&!a._lock?(a._lock=1,Zc(a,o,h-o._delay,1)._lock=0):c=h,h<0&&o._ts&&(s-=h,(!p&&!a._dp||p&&p.smoothChildTiming)&&(a._start+=h/a._ts,a._time-=h,a._tTime-=h),a.shiftChildren(-h,!1,-1/0),c=0),o._end>s&&o._ts&&(s=o._end),o=u;_g(a,a===vs&&a._time>s?a._time:s,1,1),a._dirty=0}return a._tDur},e.updateRoot=function(i){if(vs._ts&&(JF(vs,Cb(i,vs)),jF=Oo.frame),Oo.frame>=bB){bB+=Go.autoSleep||120;var s=vs._first;if((!s||!s._ts)&&Go.autoSleep&&Oo._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||Oo.sleep()}}},e})(Dx);Vo(Ua.prototype,{_lock:0,_hasPause:0,_forcing:0});var iQ=function(e,t,n,i,s,a,o){var c=new uo(this._pt,e,t,0,1,bk,null,s),u=0,h=0,p,v,y,x,S,E,b,T;for(c.b=n,c.e=i,n+="",i+="",(b=~i.indexOf("random("))&&(i=Cx(i)),a&&(T=[n,i],a(T,e,t),n=T[0],i=T[1]),v=n.match(sC)||[];p=sC.exec(i);)x=p[0],S=i.substring(u,p.index),y?y=(y+1)%5:S.substr(-5)==="rgba("&&(y=1),x!==v[h++]&&(E=parseFloat(v[h-1])||0,c._pt={_next:c._pt,p:S||h===1?S:",",s:E,c:x.charAt(1)==="="?K0(E,x)-E:parseFloat(x)-E,m:y&&y<4?Math.round:0},u=sC.lastIndex);return c.c=u<i.length?i.substring(u,i.length):"",c.fp=o,(VF.test(i)||b)&&(c.e=0),this._pt=c,c},wL=function(e,t,n,i,s,a,o,c,u,h){Rs(i)&&(i=i(s||0,e,a));var p=e[t],v=n!=="get"?n:Rs(p)?u?e[t.indexOf("set")||!Rs(e["get"+t.substr(3)])?t:"get"+t.substr(3)](u):e[t]():p,y=Rs(p)?u?lQ:Ak:BL,x;if(Cr(i)&&(~i.indexOf("random(")&&(i=Cx(i)),i.charAt(1)==="="&&(x=K0(v,i)+(aa(v)||0),(x||x===0)&&(i=x))),!h||v!==i||CR)return!isNaN(v*i)&&i!==""?(x=new uo(this._pt,e,t,+v||0,i-(v||0),typeof p=="boolean"?uQ:Ek,0,y),u&&(x.fp=u),o&&x.modifier(o,this,e),this._pt=x):(!p&&!(t in e)&&ML(t,i),iQ.call(this,e,t,v,i,y,c||Go.stringFilter,u))},sQ=function(e,t,n,i,s){if(Rs(e)&&(e=$y(e,s,t,n,i)),!fu(e)||e.style&&e.nodeType||la(e)||HF(e))return Cr(e)?$y(e,s,t,n,i):e;var a={},o;for(o in e)a[o]=$y(e[o],s,t,n,i);return a},xk=function(e,t,n,i,s,a){var o,c,u,h;if(Io[e]&&(o=new Io[e]).init(s,o.rawVars?t[e]:sQ(t[e],i,s,a,n),n,i,a)!==!1&&(n._pt=c=new uo(n._pt,s,e,0,1,o.render,o,0,o.priority),n!==U0))for(u=n._ptLookup[n._targets.indexOf(s)],h=o._props.length;h--;)u[o._props[h]]=c;return o},Sh,CR,IL=function r(e,t,n){var i=e.vars,s=i.ease,a=i.startAt,o=i.immediateRender,c=i.lazy,u=i.onUpdate,h=i.runBackwards,p=i.yoyoEase,v=i.keyframes,y=i.autoRevert,x=e._dur,S=e._startAt,E=e._targets,b=e.parent,T=b&&b.data==="nested"?b.vars.targets:E,R=e._overwrite==="auto"&&!AL,D=e.timeline,P,O,N,U,B,I,z,W,Z,te,re,k,j;if(D&&(!v||!s)&&(s="none"),e._ease=bp(s,vg.ease),e._yEase=p?mk(bp(p===!0?s:p,vg.ease)):0,p&&e._yoyo&&!e._repeat&&(p=e._yEase,e._yEase=e._ease,e._ease=p),e._from=!D&&!!i.runBackwards,!D||v&&!i.stagger){if(W=E[0]?Ap(E[0]).harness:0,k=W&&i[W.prop],P=Mb(i,CL),S&&(S._zTime<0&&S.progress(1),t<0&&h&&o&&!y?S.render(-1,!0):S.revert(h&&x?uE:I$),S._lazy=0),a){if(Nh(e._startAt=Xs.set(E,Vo({data:"isStart",overwrite:!1,parent:b,immediateRender:!0,lazy:!S&&lo(c),startAt:null,delay:0,onUpdate:u&&function(){return Uo(e,"onUpdate")},stagger:0},a))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Gr||!o&&!y)&&e._startAt.revert(uE),o&&x&&t<=0&&n<=0){t&&(e._zTime=t);return}}else if(h&&x&&!S){if(t&&(o=!1),N=Vo({overwrite:!1,data:"isFromStart",lazy:o&&!S&&lo(c),immediateRender:o,stagger:0,parent:b},P),k&&(N[W.prop]=k),Nh(e._startAt=Xs.set(E,N)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Gr?e._startAt.revert(uE):e._startAt.render(-1,!0)),e._zTime=t,!o)r(e._startAt,Ki,Ki);else if(!t)return}for(e._pt=e._ptCache=0,c=x&&lo(c)||c&&!x,O=0;O<E.length;O++){if(B=E[O],z=B._gsap||DL(E)[O]._gsap,e._ptLookup[O]=te={},SR[z.id]&&Ch.length&&Tb(),re=T===E?O:T.indexOf(B),W&&(Z=new W).init(B,k||P,e,re,T)!==!1&&(e._pt=U=new uo(e._pt,B,Z.name,0,1,Z.render,Z,0,Z.priority),Z._props.forEach(function(J){te[J]=U}),Z.priority&&(I=1)),!W||k)for(N in P)Io[N]&&(Z=xk(N,P,e,re,B,T))?Z.priority&&(I=1):te[N]=U=wL.call(e,B,N,"get",P[N],re,T,0,i.stringFilter);e._op&&e._op[O]&&e.kill(B,e._op[O]),R&&e._pt&&(Sh=e,vs.killTweensOf(B,te,e.globalTime(t)),j=!e.parent,Sh=0),e._pt&&c&&(SR[z.id]=1)}I&&Tk(e),e._onInit&&e._onInit(e)}e._onUpdate=u,e._initted=(!e._op||e._pt)&&!j,v&&t<=0&&D.render(gl,!0,!0)},rQ=function(e,t,n,i,s,a,o,c){var u=(e._pt&&e._ptCache||(e._ptCache={}))[t],h,p,v,y;if(!u)for(u=e._ptCache[t]=[],v=e._ptLookup,y=e._targets.length;y--;){if(h=v[y][t],h&&h.d&&h.d._pt)for(h=h.d._pt;h&&h.p!==t&&h.fp!==t;)h=h._next;if(!h)return CR=1,e.vars[t]="+=0",IL(e,o),CR=0,c?Tx(t+" not eligible for reset"):1;u.push(h)}for(y=u.length;y--;)p=u[y],h=p._pt||p,h.s=(i||i===0)&&!s?i:h.s+(i||0)+a*h.c,h.c=n-h.s,p.e&&(p.e=Os(n)+aa(p.e)),p.b&&(p.b=h.s+aa(p.b))},aQ=function(e,t){var n=e[0]?Ap(e[0]).harness:0,i=n&&n.aliases,s,a,o,c;if(!i)return t;s=yg({},t);for(a in i)if(a in s)for(c=i[a].split(","),o=c.length;o--;)s[c[o]]=s[a];return s},oQ=function(e,t,n,i){var s=t.ease||i||"power1.inOut",a,o;if(la(t))o=n[e]||(n[e]=[]),t.forEach(function(c,u){return o.push({t:u/(t.length-1)*100,v:c,e:s})});else for(a in t)o=n[a]||(n[a]=[]),a==="ease"||o.push({t:parseFloat(e),v:t[a],e:s})},$y=function(e,t,n,i,s){return Rs(e)?e.call(t,n,i,s):Cr(e)&&~e.indexOf("random(")?Cx(e):e},_k=RL+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",Sk={};co(_k+",id,stagger,delay,duration,paused,scrollTrigger",function(r){return Sk[r]=1});var Xs=(function(r){kF(e,r);function e(n,i,s,a){var o;typeof i=="number"&&(s.duration=i,i=s,s=null),o=r.call(this,a?i:Wy(i))||this;var c=o.vars,u=c.duration,h=c.delay,p=c.immediateRender,v=c.stagger,y=c.overwrite,x=c.keyframes,S=c.defaults,E=c.scrollTrigger,b=c.yoyoEase,T=i.parent||vs,R=(la(n)||HF(n)?gf(n[0]):"length"in i)?[n]:vl(n),D,P,O,N,U,B,I,z;if(o._targets=R.length?DL(R):Tx("GSAP target "+n+" not found. https://gsap.com",!Go.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=y,x||v||BA(u)||BA(h)){if(i=o.vars,D=o.timeline=new Ua({data:"nested",defaults:S||{},targets:T&&T.data==="nested"?T.vars.targets:R}),D.kill(),D.parent=D._dp=ef(o),D._start=0,v||BA(u)||BA(h)){if(N=R.length,I=v&&rk(v),fu(v))for(U in v)~_k.indexOf(U)&&(z||(z={}),z[U]=v[U]);for(P=0;P<N;P++)O=Mb(i,Sk),O.stagger=0,b&&(O.yoyoEase=b),z&&yg(O,z),B=R[P],O.duration=+$y(u,ef(o),P,B,R),O.delay=(+$y(h,ef(o),P,B,R)||0)-o._delay,!v&&N===1&&O.delay&&(o._delay=h=O.delay,o._start+=h,O.delay=0),D.to(B,O,I?I(P,B,R):0),D._ease=di.none;D.duration()?u=h=0:o.timeline=0}else if(x){Wy(Vo(D.vars.defaults,{ease:"none"})),D._ease=bp(x.ease||i.ease||"none");var W=0,Z,te,re;if(la(x))x.forEach(function(k){return D.to(R,k,">")}),D.duration();else{O={};for(U in x)U==="ease"||U==="easeEach"||oQ(U,x[U],O,x.easeEach);for(U in O)for(Z=O[U].sort(function(k,j){return k.t-j.t}),W=0,P=0;P<Z.length;P++)te=Z[P],re={ease:te.e,duration:(te.t-(P?Z[P-1].t:0))/100*u},re[U]=te.v,D.to(R,re,W),W+=re.duration;D.duration()<u&&D.to({},{duration:u-D.duration()})}}u||o.duration(u=D.duration())}else o.timeline=0;return y===!0&&!AL&&(Sh=ef(o),vs.killTweensOf(R),Sh=0),Zc(T,ef(o),s),i.reversed&&o.reverse(),i.paused&&o.paused(!0),(p||!u&&!x&&o._start===Ks(T._time)&&lo(p)&&F$(ef(o))&&T.data!=="nested")&&(o._tTime=-Ki,o.render(Math.max(0,-h)||0)),E&&tk(ef(o),E),o}var t=e.prototype;return t.render=function(i,s,a){var o=this._time,c=this._tDur,u=this._dur,h=i<0,p=i>c-Ki&&!h?c:i<Ki?0:i,v,y,x,S,E,b,T,R,D;if(!u)G$(this,i,s,a);else if(p!==this._tTime||!i||a||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==h||this._lazy){if(v=p,R=this.timeline,this._repeat){if(S=u+this._rDelay,this._repeat<-1&&h)return this.totalTime(S*100+i,s,a);if(v=Ks(p%S),p===c?(x=this._repeat,v=u):(E=Ks(p/S),x=~~E,x&&x===E?(v=u,x--):v>u&&(v=u)),b=this._yoyo&&x&1,b&&(D=this._yEase,v=u-v),E=xg(this._tTime,S),v===o&&!a&&this._initted&&x===E)return this._tTime=p,this;x!==E&&(R&&this._yEase&&gk(R,b),this.vars.repeatRefresh&&!b&&!this._lock&&v!==S&&this._initted&&(this._lock=a=1,this.render(Ks(S*x),!0).invalidate()._lock=0))}if(!this._initted){if(nk(this,h?i:v,a,s,p))return this._tTime=0,this;if(o!==this._time&&!(a&&this.vars.repeatRefresh&&x!==E))return this;if(u!==this._dur)return this.render(i,s,a)}if(this._tTime=p,this._time=v,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=T=(D||this._ease)(v/u),this._from&&(this.ratio=T=1-T),!o&&p&&!s&&!E&&(Uo(this,"onStart"),this._tTime!==p))return this;for(y=this._pt;y;)y.r(T,y.d),y=y._next;R&&R.render(i<0?i:R._dur*R._ease(v/this._dur),s,a)||this._startAt&&(this._zTime=i),this._onUpdate&&!s&&(h&&AR(this,i,s,a),Uo(this,"onUpdate")),this._repeat&&x!==E&&this.vars.onRepeat&&!s&&this.parent&&Uo(this,"onRepeat"),(p===this._tDur||!p)&&this._tTime===p&&(h&&!this._onUpdate&&AR(this,i,!0,!0),(i||!u)&&(p===this._tDur&&this._ts>0||!p&&this._ts<0)&&Nh(this,1),!s&&!(h&&!o)&&(p||o||b)&&(Uo(this,p===c?"onComplete":"onReverseComplete",!0),this._prom&&!(p<c&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(i){return(!i||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(i),r.prototype.invalidate.call(this,i)},t.resetTo=function(i,s,a,o,c){Rx||Oo.wake(),this._ts||this.play();var u=Math.min(this._dur,(this._dp._time-this._start)*this._ts),h;return this._initted||IL(this,u),h=this._ease(u/this._dur),rQ(this,i,s,a,o,h,u,c)?this.resetTo(i,s,a,o,1):(LT(this,0),this.parent||ZF(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(i,s){if(s===void 0&&(s="all"),!i&&(!s||s==="all"))return this._lazy=this._pt=0,this.parent?Ry(this):this.scrollTrigger&&this.scrollTrigger.kill(!!Gr),this;if(this.timeline){var a=this.timeline.totalDuration();return this.timeline.killTweensOf(i,s,Sh&&Sh.vars.overwrite!==!0)._first||Ry(this),this.parent&&a!==this.timeline.totalDuration()&&_g(this,this._dur*this.timeline._tDur/a,0,1),this}var o=this._targets,c=i?vl(i):o,u=this._ptLookup,h=this._pt,p,v,y,x,S,E,b;if((!s||s==="all")&&N$(o,c))return s==="all"&&(this._pt=0),Ry(this);for(p=this._op=this._op||[],s!=="all"&&(Cr(s)&&(S={},co(s,function(T){return S[T]=1}),s=S),s=aQ(o,s)),b=o.length;b--;)if(~c.indexOf(o[b])){v=u[b],s==="all"?(p[b]=s,x=v,y={}):(y=p[b]=p[b]||{},x=s);for(S in x)E=v&&v[S],E&&((!("kill"in E.d)||E.d.kill(S)===!0)&&RT(this,E,"_pt"),delete v[S]),y!=="all"&&(y[S]=1)}return this._initted&&!this._pt&&h&&Ry(this),this},e.to=function(i,s){return new e(i,s,arguments[2])},e.from=function(i,s){return Jy(1,arguments)},e.delayedCall=function(i,s,a,o){return new e(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:s,onReverseComplete:s,onCompleteParams:a,onReverseCompleteParams:a,callbackScope:o})},e.fromTo=function(i,s,a){return Jy(2,arguments)},e.set=function(i,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new e(i,s)},e.killTweensOf=function(i,s,a){return vs.killTweensOf(i,s,a)},e})(Dx);Vo(Xs.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});co("staggerTo,staggerFrom,staggerFromTo",function(r){Xs[r]=function(){var e=new Ua,t=bR.call(arguments,0);return t.splice(r==="staggerFromTo"?5:4,0,0),e[r].apply(e,t)}});var BL=function(e,t,n){return e[t]=n},Ak=function(e,t,n){return e[t](n)},lQ=function(e,t,n,i){return e[t](i.fp,n)},cQ=function(e,t,n){return e.setAttribute(t,n)},OL=function(e,t){return Rs(e[t])?Ak:EL(e[t])&&e.setAttribute?cQ:BL},Ek=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},uQ=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},bk=function(e,t){var n=t._pt,i="";if(!e&&t.b)i=t.b;else if(e===1&&t.e)i=t.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*e):Math.round((n.s+n.c*e)*1e4)/1e4)+i,n=n._next;i+=t.c}t.set(t.t,t.p,i,t)},PL=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},fQ=function(e,t,n,i){for(var s=this._pt,a;s;)a=s._next,s.p===i&&s.modifier(e,t,n),s=a},hQ=function(e){for(var t=this._pt,n,i;t;)i=t._next,t.p===e&&!t.op||t.op===e?RT(this,t,"_pt"):t.dep||(n=1),t=i;return!n},dQ=function(e,t,n,i){i.mSet(e,t,i.m.call(i.tween,n,i.mt),i)},Tk=function(e){for(var t=e._pt,n,i,s,a;t;){for(n=t._next,i=s;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:a)?t._prev._next=t:s=t,(t._next=i)?i._prev=t:a=t,t=n}e._pt=s},uo=(function(){function r(t,n,i,s,a,o,c,u,h){this.t=n,this.s=s,this.c=a,this.p=i,this.r=o||Ek,this.d=c||this,this.set=u||BL,this.pr=h||0,this._next=t,t&&(t._prev=this)}var e=r.prototype;return e.modifier=function(n,i,s){this.mSet=this.mSet||this.set,this.set=dQ,this.m=n,this.mt=s,this.tween=i},r})();co(RL+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(r){return CL[r]=1});zo.TweenMax=zo.TweenLite=Xs;zo.TimelineLite=zo.TimelineMax=Ua;vs=new Ua({sortChildren:!1,defaults:vg,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Go.stringFilter=pk;var Tp=[],hE={},pQ=[],LB=0,mQ=0,cC=function(e){return(hE[e]||pQ).map(function(t){return t()})},RR=function(){var e=Date.now(),t=[];e-LB>2&&(cC("matchMediaInit"),Tp.forEach(function(n){var i=n.queries,s=n.conditions,a,o,c,u;for(o in i)a=Jc.matchMedia(i[o]).matches,a&&(c=1),a!==s[o]&&(s[o]=a,u=1);u&&(n.revert(),c&&t.push(n))}),cC("matchMediaRevert"),t.forEach(function(n){return n.onMatch(n,function(i){return n.add(null,i)})}),LB=e,cC("matchMedia"))},Mk=(function(){function r(t,n){this.selector=n&&TR(n),this.data=[],this._r=[],this.isReverted=!1,this.id=mQ++,t&&this.add(t)}var e=r.prototype;return e.add=function(n,i,s){Rs(n)&&(s=i,i=n,n=Rs);var a=this,o=function(){var u=fs,h=a.selector,p;return u&&u!==a&&u.data.push(a),s&&(a.selector=TR(s)),fs=a,p=i.apply(a,arguments),Rs(p)&&a._r.push(p),fs=u,a.selector=h,a.isReverted=!1,p};return a.last=o,n===Rs?o(a,function(c){return a.add(null,c)}):n?a[n]=o:o},e.ignore=function(n){var i=fs;fs=null,n(this),fs=i},e.getTweens=function(){var n=[];return this.data.forEach(function(i){return i instanceof r?n.push.apply(n,i.getTweens()):i instanceof Xs&&!(i.parent&&i.parent.data==="nested")&&n.push(i)}),n},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(n,i){var s=this;if(n?(function(){for(var o=s.getTweens(),c=s.data.length,u;c--;)u=s.data[c],u.data==="isFlip"&&(u.revert(),u.getChildren(!0,!0,!1).forEach(function(h){return o.splice(o.indexOf(h),1)}));for(o.map(function(h){return{g:h._dur||h._delay||h._sat&&!h._sat.vars.immediateRender?h.globalTime(0):-1/0,t:h}}).sort(function(h,p){return p.g-h.g||-1/0}).forEach(function(h){return h.t.revert(n)}),c=s.data.length;c--;)u=s.data[c],u instanceof Ua?u.data!=="nested"&&(u.scrollTrigger&&u.scrollTrigger.revert(),u.kill()):!(u instanceof Xs)&&u.revert&&u.revert(n);s._r.forEach(function(h){return h(n,s)}),s.isReverted=!0})():this.data.forEach(function(o){return o.kill&&o.kill()}),this.clear(),i)for(var a=Tp.length;a--;)Tp[a].id===this.id&&Tp.splice(a,1)},e.revert=function(n){this.kill(n||{})},r})(),gQ=(function(){function r(t){this.contexts=[],this.scope=t,fs&&fs.data.push(this)}var e=r.prototype;return e.add=function(n,i,s){fu(n)||(n={matches:n});var a=new Mk(0,s||this.scope),o=a.conditions={},c,u,h;fs&&!a.selector&&(a.selector=fs.selector),this.contexts.push(a),i=a.add("onMatch",i),a.queries=n;for(u in n)u==="all"?h=1:(c=Jc.matchMedia(n[u]),c&&(Tp.indexOf(a)<0&&Tp.push(a),(o[u]=c.matches)&&(h=1),c.addListener?c.addListener(RR):c.addEventListener("change",RR)));return h&&i(a,function(p){return a.add(null,p)}),this},e.revert=function(n){this.kill(n||{})},e.kill=function(n){this.contexts.forEach(function(i){return i.kill(n,!0)})},r})(),Rb={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(i){return fk(i)})},timeline:function(e){return new Ua(e)},getTweensOf:function(e,t){return vs.getTweensOf(e,t)},getProperty:function(e,t,n,i){Cr(e)&&(e=vl(e)[0]);var s=Ap(e||{}).get,a=n?QF:$F;return n==="native"&&(n=""),e&&(t?a((Io[t]&&Io[t].get||s)(e,t,n,i)):function(o,c,u){return a((Io[o]&&Io[o].get||s)(e,o,c,u))})},quickSetter:function(e,t,n){if(e=vl(e),e.length>1){var i=e.map(function(h){return ho.quickSetter(h,t,n)}),s=i.length;return function(h){for(var p=s;p--;)i[p](h)}}e=e[0]||{};var a=Io[t],o=Ap(e),c=o.harness&&(o.harness.aliases||{})[t]||t,u=a?function(h){var p=new a;U0._pt=0,p.init(e,n?h+n:h,U0,0,[e]),p.render(1,p),U0._pt&&PL(1,U0)}:o.set(e,c);return a?u:function(h){return u(e,c,n?h+n:h,o,1)}},quickTo:function(e,t,n){var i,s=ho.to(e,Vo((i={},i[t]="+=0.1",i.paused=!0,i.stagger=0,i),n||{})),a=function(c,u,h){return s.resetTo(t,c,u,h)};return a.tween=s,a},isTweening:function(e){return vs.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=bp(e.ease,vg.ease)),TB(vg,e||{})},config:function(e){return TB(Go,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,i=e.plugins,s=e.defaults,a=e.extendTimeline;(i||"").split(",").forEach(function(o){return o&&!Io[o]&&!zo[o]&&Tx(t+" effect requires "+o+" plugin.")}),rC[t]=function(o,c,u){return n(vl(o),Vo(c||{},s),u)},a&&(Ua.prototype[t]=function(o,c,u){return this.add(rC[t](o,fu(c)?c:(u=c)&&{},this),u)})},registerEase:function(e,t){di[e]=bp(t)},parseEase:function(e,t){return arguments.length?bp(e,t):di},getById:function(e){return vs.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var n=new Ua(e),i,s;for(n.smoothChildTiming=lo(e.smoothChildTiming),vs.remove(n),n._dp=0,n._time=n._tTime=vs._time,i=vs._first;i;)s=i._next,(t||!(!i._dur&&i instanceof Xs&&i.vars.onComplete===i._targets[0]))&&Zc(n,i,i._start-i._delay),i=s;return Zc(vs,n,0),n},context:function(e,t){return e?new Mk(e,t):fs},matchMedia:function(e){return new gQ(e)},matchMediaRefresh:function(){return Tp.forEach(function(e){var t=e.conditions,n,i;for(i in t)t[i]&&(t[i]=!1,n=1);n&&e.revert()})||RR()},addEventListener:function(e,t){var n=hE[e]||(hE[e]=[]);~n.indexOf(t)||n.push(t)},removeEventListener:function(e,t){var n=hE[e],i=n&&n.indexOf(t);i>=0&&n.splice(i,1)},utils:{wrap:j$,wrapYoyo:W$,distribute:rk,random:ok,snap:ak,normalize:q$,getUnit:aa,clamp:V$,splitColor:hk,toArray:vl,selector:TR,mapRange:ck,pipe:X$,unitize:K$,interpolate:J$,shuffle:sk},install:KF,effects:rC,ticker:Oo,updateRoot:Ua.updateRoot,plugins:Io,globalTimeline:vs,core:{PropTween:uo,globals:qF,Tween:Xs,Timeline:Ua,Animation:Dx,getCache:Ap,_removeLinkedListItem:RT,reverting:function(){return Gr},context:function(e){return e&&fs&&(fs.data.push(e),e._ctx=fs),fs},suppressOverwrites:function(e){return AL=e}}};co("to,from,fromTo,delayedCall,set,killTweensOf",function(r){return Rb[r]=Xs[r]});Oo.add(Ua.updateRoot);U0=Rb.to({},{duration:0});var vQ=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},yQ=function(e,t){var n=e._targets,i,s,a;for(i in t)for(s=n.length;s--;)a=e._ptLookup[s][i],a&&(a=a.d)&&(a._pt&&(a=vQ(a,i)),a&&a.modifier&&a.modifier(t[i],e,n[s],i))},uC=function(e,t){return{name:e,headless:1,rawVars:1,init:function(i,s,a){a._onInit=function(o){var c,u;if(Cr(s)&&(c={},co(s,function(h){return c[h]=1}),s=c),t){c={};for(u in s)c[u]=t(s[u]);s=c}yQ(o,s)}}}},ho=Rb.registerPlugin({name:"attr",init:function(e,t,n,i,s){var a,o,c;this.tween=n;for(a in t)c=e.getAttribute(a)||"",o=this.add(e,"setAttribute",(c||0)+"",t[a],i,s,0,0,a),o.op=a,o.b=c,this._props.push(a)},render:function(e,t){for(var n=t._pt;n;)Gr?n.set(n.t,n.p,n.b,n):n.r(e,n.d),n=n._next}},{name:"endArray",headless:1,init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n],0,0,0,0,0,1)}},uC("roundProps",MR),uC("modifiers"),uC("snap",ak))||Rb;Xs.version=Ua.version=ho.version="3.13.0";XF=1;bL()&&Sg();di.Power0;di.Power1;di.Power2;di.Power3;di.Power4;di.Linear;di.Quad;di.Cubic;di.Quart;di.Quint;di.Strong;di.Elastic;di.Back;di.SteppedEase;di.Bounce;di.Sine;di.Expo;di.Circ;var wB,Ah,q0,NL,mp,IB,UL,xQ=function(){return typeof window<"u"},vf={},sp=180/Math.PI,j0=Math.PI/180,R0=Math.atan2,BB=1e8,FL=/([A-Z])/g,_Q=/(left|right|width|margin|padding|x)/i,SQ=/[\s,\(]\S/,nu={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},DR=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},AQ=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},EQ=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},bQ=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},Ck=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},Rk=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},TQ=function(e,t,n){return e.style[t]=n},MQ=function(e,t,n){return e.style.setProperty(t,n)},CQ=function(e,t,n){return e._gsap[t]=n},RQ=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},DQ=function(e,t,n,i,s){var a=e._gsap;a.scaleX=a.scaleY=n,a.renderTransform(s,a)},LQ=function(e,t,n,i,s){var a=e._gsap;a[t]=n,a.renderTransform(s,a)},xs="transform",fo=xs+"Origin",wQ=function r(e,t){var n=this,i=this.target,s=i.style,a=i._gsap;if(e in vf&&s){if(this.tfm=this.tfm||{},e!=="transform")e=nu[e]||e,~e.indexOf(",")?e.split(",").forEach(function(o){return n.tfm[o]=nf(i,o)}):this.tfm[e]=a.x?a[e]:nf(i,e),e===fo&&(this.tfm.zOrigin=a.zOrigin);else return nu.transform.split(",").forEach(function(o){return r.call(n,o,t)});if(this.props.indexOf(xs)>=0)return;a.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(fo,t,"")),e=xs}(s||t)&&this.props.push(e,t,s[e])},Dk=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},IQ=function(){var e=this.props,t=this.target,n=t.style,i=t._gsap,s,a;for(s=0;s<e.length;s+=3)e[s+1]?e[s+1]===2?t[e[s]](e[s+2]):t[e[s]]=e[s+2]:e[s+2]?n[e[s]]=e[s+2]:n.removeProperty(e[s].substr(0,2)==="--"?e[s]:e[s].replace(FL,"-$1").toLowerCase());if(this.tfm){for(a in this.tfm)i[a]=this.tfm[a];i.svg&&(i.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),s=UL(),(!s||!s.isStart)&&!n[xs]&&(Dk(n),i.zOrigin&&n[fo]&&(n[fo]+=" "+i.zOrigin+"px",i.zOrigin=0,i.renderTransform()),i.uncache=1)}},Lk=function(e,t){var n={target:e,props:[],revert:IQ,save:wQ};return e._gsap||ho.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(i){return n.save(i)}),n},wk,LR=function(e,t){var n=Ah.createElementNS?Ah.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Ah.createElement(e);return n&&n.style?n:Ah.createElement(e)},yl=function r(e,t,n){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(FL,"-$1").toLowerCase())||i.getPropertyValue(t)||!n&&r(e,Ag(t)||t,1)||""},OB="O,Moz,ms,Ms,Webkit".split(","),Ag=function(e,t,n){var i=t||mp,s=i.style,a=5;if(e in s&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);a--&&!(OB[a]+e in s););return a<0?null:(a===3?"ms":a>=0?OB[a]:"")+e},wR=function(){xQ()&&window.document&&(wB=window,Ah=wB.document,q0=Ah.documentElement,mp=LR("div")||{style:{}},LR("div"),xs=Ag(xs),fo=xs+"Origin",mp.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",wk=!!Ag("perspective"),UL=ho.core.reverting,NL=1)},PB=function(e){var t=e.ownerSVGElement,n=LR("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=e.cloneNode(!0),s;i.style.display="block",n.appendChild(i),q0.appendChild(n);try{s=i.getBBox()}catch{}return n.removeChild(i),q0.removeChild(n),s},NB=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},Ik=function(e){var t,n;try{t=e.getBBox()}catch{t=PB(e),n=1}return t&&(t.width||t.height)||n||(t=PB(e)),t&&!t.width&&!t.x&&!t.y?{x:+NB(e,["x","cx","x1"])||0,y:+NB(e,["y","cy","y1"])||0,width:0,height:0}:t},Bk=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&Ik(e))},Fp=function(e,t){if(t){var n=e.style,i;t in vf&&t!==fo&&(t=xs),n.removeProperty?(i=t.substr(0,2),(i==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),n.removeProperty(i==="--"?t:t.replace(FL,"-$1").toLowerCase())):n.removeAttribute(t)}},Eh=function(e,t,n,i,s,a){var o=new uo(e._pt,t,n,0,1,a?Rk:Ck);return e._pt=o,o.b=i,o.e=s,e._props.push(n),o},UB={deg:1,rad:1,turn:1},BQ={grid:1,flex:1},Uh=function r(e,t,n,i){var s=parseFloat(n)||0,a=(n+"").trim().substr((s+"").length)||"px",o=mp.style,c=_Q.test(t),u=e.tagName.toLowerCase()==="svg",h=(u?"client":"offset")+(c?"Width":"Height"),p=100,v=i==="px",y=i==="%",x,S,E,b;if(i===a||!s||UB[i]||UB[a])return s;if(a!=="px"&&!v&&(s=r(e,t,n,"px")),b=e.getCTM&&Bk(e),(y||a==="%")&&(vf[t]||~t.indexOf("adius")))return x=b?e.getBBox()[c?"width":"height"]:e[h],Os(y?s/x*p:s/100*x);if(o[c?"width":"height"]=p+(v?a:i),S=i!=="rem"&&~t.indexOf("adius")||i==="em"&&e.appendChild&&!u?e:e.parentNode,b&&(S=(e.ownerSVGElement||{}).parentNode),(!S||S===Ah||!S.appendChild)&&(S=Ah.body),E=S._gsap,E&&y&&E.width&&c&&E.time===Oo.time&&!E.uncache)return Os(s/E.width*p);if(y&&(t==="height"||t==="width")){var T=e.style[t];e.style[t]=p+i,x=e[h],T?e.style[t]=T:Fp(e,t)}else(y||a==="%")&&!BQ[yl(S,"display")]&&(o.position=yl(e,"position")),S===e&&(o.position="static"),S.appendChild(mp),x=mp[h],S.removeChild(mp),o.position="absolute";return c&&y&&(E=Ap(S),E.time=Oo.time,E.width=S[h]),Os(v?x*s/p:x&&s?p/x*s:0)},nf=function(e,t,n,i){var s;return NL||wR(),t in nu&&t!=="transform"&&(t=nu[t],~t.indexOf(",")&&(t=t.split(",")[0])),vf[t]&&t!=="transform"?(s=wx(e,i),s=t!=="transformOrigin"?s[t]:s.svg?s.origin:Lb(yl(e,fo))+" "+s.zOrigin+"px"):(s=e.style[t],(!s||s==="auto"||i||~(s+"").indexOf("calc("))&&(s=Db[t]&&Db[t](e,t,n)||yl(e,t)||WF(e,t)||(t==="opacity"?1:0))),n&&!~(s+"").trim().indexOf(" ")?Uh(e,t,s,n)+n:s},OQ=function(e,t,n,i){if(!n||n==="none"){var s=Ag(t,e,1),a=s&&yl(e,s,1);a&&a!==n?(t=s,n=a):t==="borderColor"&&(n=yl(e,"borderTopColor"))}var o=new uo(this._pt,e.style,t,0,1,bk),c=0,u=0,h,p,v,y,x,S,E,b,T,R,D,P;if(o.b=n,o.e=i,n+="",i+="",i.substring(0,6)==="var(--"&&(i=yl(e,i.substring(4,i.indexOf(")")))),i==="auto"&&(S=e.style[t],e.style[t]=i,i=yl(e,t)||i,S?e.style[t]=S:Fp(e,t)),h=[n,i],pk(h),n=h[0],i=h[1],v=n.match(N0)||[],P=i.match(N0)||[],P.length){for(;p=N0.exec(i);)E=p[0],T=i.substring(c,p.index),x?x=(x+1)%5:(T.substr(-5)==="rgba("||T.substr(-5)==="hsla(")&&(x=1),E!==(S=v[u++]||"")&&(y=parseFloat(S)||0,D=S.substr((y+"").length),E.charAt(1)==="="&&(E=K0(y,E)+D),b=parseFloat(E),R=E.substr((b+"").length),c=N0.lastIndex-R.length,R||(R=R||Go.units[t]||D,c===i.length&&(i+=R,o.e+=R)),D!==R&&(y=Uh(e,t,S,R)||0),o._pt={_next:o._pt,p:T||u===1?T:",",s:y,c:b-y,m:x&&x<4||t==="zIndex"?Math.round:0});o.c=c<i.length?i.substring(c,i.length):""}else o.r=t==="display"&&i==="none"?Rk:Ck;return VF.test(i)&&(o.e=0),this._pt=o,o},FB={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},PQ=function(e){var t=e.split(" "),n=t[0],i=t[1]||"50%";return(n==="top"||n==="bottom"||i==="left"||i==="right")&&(e=n,n=i,i=e),t[0]=FB[n]||n,t[1]=FB[i]||i,t.join(" ")},NQ=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n=t.t,i=n.style,s=t.u,a=n._gsap,o,c,u;if(s==="all"||s===!0)i.cssText="",c=1;else for(s=s.split(","),u=s.length;--u>-1;)o=s[u],vf[o]&&(c=1,o=o==="transformOrigin"?fo:xs),Fp(n,o);c&&(Fp(n,xs),a&&(a.svg&&n.removeAttribute("transform"),i.scale=i.rotate=i.translate="none",wx(n,1),a.uncache=1,Dk(i)))}},Db={clearProps:function(e,t,n,i,s){if(s.data!=="isFromStart"){var a=e._pt=new uo(e._pt,t,n,0,0,NQ);return a.u=i,a.pr=-10,a.tween=s,e._props.push(n),1}}},Lx=[1,0,0,1,0,0],Ok={},Pk=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},kB=function(e){var t=yl(e,xs);return Pk(t)?Lx:t.substr(7).match(zF).map(Os)},kL=function(e,t){var n=e._gsap||Ap(e),i=e.style,s=kB(e),a,o,c,u;return n.svg&&e.getAttribute("transform")?(c=e.transform.baseVal.consolidate().matrix,s=[c.a,c.b,c.c,c.d,c.e,c.f],s.join(",")==="1,0,0,1,0,0"?Lx:s):(s===Lx&&!e.offsetParent&&e!==q0&&!n.svg&&(c=i.display,i.display="block",a=e.parentNode,(!a||!e.offsetParent&&!e.getBoundingClientRect().width)&&(u=1,o=e.nextElementSibling,q0.appendChild(e)),s=kB(e),c?i.display=c:Fp(e,"display"),u&&(o?a.insertBefore(e,o):a?a.appendChild(e):q0.removeChild(e))),t&&s.length>6?[s[0],s[1],s[4],s[5],s[12],s[13]]:s)},IR=function(e,t,n,i,s,a){var o=e._gsap,c=s||kL(e,!0),u=o.xOrigin||0,h=o.yOrigin||0,p=o.xOffset||0,v=o.yOffset||0,y=c[0],x=c[1],S=c[2],E=c[3],b=c[4],T=c[5],R=t.split(" "),D=parseFloat(R[0])||0,P=parseFloat(R[1])||0,O,N,U,B;n?c!==Lx&&(N=y*E-x*S)&&(U=D*(E/N)+P*(-S/N)+(S*T-E*b)/N,B=D*(-x/N)+P*(y/N)-(y*T-x*b)/N,D=U,P=B):(O=Ik(e),D=O.x+(~R[0].indexOf("%")?D/100*O.width:D),P=O.y+(~(R[1]||R[0]).indexOf("%")?P/100*O.height:P)),i||i!==!1&&o.smooth?(b=D-u,T=P-h,o.xOffset=p+(b*y+T*S)-b,o.yOffset=v+(b*x+T*E)-T):o.xOffset=o.yOffset=0,o.xOrigin=D,o.yOrigin=P,o.smooth=!!i,o.origin=t,o.originIsAbsolute=!!n,e.style[fo]="0px 0px",a&&(Eh(a,o,"xOrigin",u,D),Eh(a,o,"yOrigin",h,P),Eh(a,o,"xOffset",p,o.xOffset),Eh(a,o,"yOffset",v,o.yOffset)),e.setAttribute("data-svg-origin",D+" "+P)},wx=function(e,t){var n=e._gsap||new yk(e);if("x"in n&&!t&&!n.uncache)return n;var i=e.style,s=n.scaleX<0,a="px",o="deg",c=getComputedStyle(e),u=yl(e,fo)||"0",h,p,v,y,x,S,E,b,T,R,D,P,O,N,U,B,I,z,W,Z,te,re,k,j,J,oe,K,X,ne,xe,_e,Be;return h=p=v=S=E=b=T=R=D=0,y=x=1,n.svg=!!(e.getCTM&&Bk(e)),c.translate&&((c.translate!=="none"||c.scale!=="none"||c.rotate!=="none")&&(i[xs]=(c.translate!=="none"?"translate3d("+(c.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(c.rotate!=="none"?"rotate("+c.rotate+") ":"")+(c.scale!=="none"?"scale("+c.scale.split(" ").join(",")+") ":"")+(c[xs]!=="none"?c[xs]:"")),i.scale=i.rotate=i.translate="none"),N=kL(e,n.svg),n.svg&&(n.uncache?(J=e.getBBox(),u=n.xOrigin-J.x+"px "+(n.yOrigin-J.y)+"px",j=""):j=!t&&e.getAttribute("data-svg-origin"),IR(e,j||u,!!j||n.originIsAbsolute,n.smooth!==!1,N)),P=n.xOrigin||0,O=n.yOrigin||0,N!==Lx&&(z=N[0],W=N[1],Z=N[2],te=N[3],h=re=N[4],p=k=N[5],N.length===6?(y=Math.sqrt(z*z+W*W),x=Math.sqrt(te*te+Z*Z),S=z||W?R0(W,z)*sp:0,T=Z||te?R0(Z,te)*sp+S:0,T&&(x*=Math.abs(Math.cos(T*j0))),n.svg&&(h-=P-(P*z+O*Z),p-=O-(P*W+O*te))):(Be=N[6],xe=N[7],K=N[8],X=N[9],ne=N[10],_e=N[11],h=N[12],p=N[13],v=N[14],U=R0(Be,ne),E=U*sp,U&&(B=Math.cos(-U),I=Math.sin(-U),j=re*B+K*I,J=k*B+X*I,oe=Be*B+ne*I,K=re*-I+K*B,X=k*-I+X*B,ne=Be*-I+ne*B,_e=xe*-I+_e*B,re=j,k=J,Be=oe),U=R0(-Z,ne),b=U*sp,U&&(B=Math.cos(-U),I=Math.sin(-U),j=z*B-K*I,J=W*B-X*I,oe=Z*B-ne*I,_e=te*I+_e*B,z=j,W=J,Z=oe),U=R0(W,z),S=U*sp,U&&(B=Math.cos(U),I=Math.sin(U),j=z*B+W*I,J=re*B+k*I,W=W*B-z*I,k=k*B-re*I,z=j,re=J),E&&Math.abs(E)+Math.abs(S)>359.9&&(E=S=0,b=180-b),y=Os(Math.sqrt(z*z+W*W+Z*Z)),x=Os(Math.sqrt(k*k+Be*Be)),U=R0(re,k),T=Math.abs(U)>2e-4?U*sp:0,D=_e?1/(_e<0?-_e:_e):0),n.svg&&(j=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!Pk(yl(e,xs)),j&&e.setAttribute("transform",j))),Math.abs(T)>90&&Math.abs(T)<270&&(s?(y*=-1,T+=S<=0?180:-180,S+=S<=0?180:-180):(x*=-1,T+=T<=0?180:-180)),t=t||n.uncache,n.x=h-((n.xPercent=h&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-h)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+a,n.y=p-((n.yPercent=p&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-p)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+a,n.z=v+a,n.scaleX=Os(y),n.scaleY=Os(x),n.rotation=Os(S)+o,n.rotationX=Os(E)+o,n.rotationY=Os(b)+o,n.skewX=T+o,n.skewY=R+o,n.transformPerspective=D+a,(n.zOrigin=parseFloat(u.split(" ")[2])||!t&&n.zOrigin||0)&&(i[fo]=Lb(u)),n.xOffset=n.yOffset=0,n.force3D=Go.force3D,n.renderTransform=n.svg?FQ:wk?Nk:UQ,n.uncache=0,n},Lb=function(e){return(e=e.split(" "))[0]+" "+e[1]},fC=function(e,t,n){var i=aa(t);return Os(parseFloat(t)+parseFloat(Uh(e,"x",n+"px",i)))+i},UQ=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Nk(e,t)},Qd="0deg",_y="0px",Zd=") ",Nk=function(e,t){var n=t||this,i=n.xPercent,s=n.yPercent,a=n.x,o=n.y,c=n.z,u=n.rotation,h=n.rotationY,p=n.rotationX,v=n.skewX,y=n.skewY,x=n.scaleX,S=n.scaleY,E=n.transformPerspective,b=n.force3D,T=n.target,R=n.zOrigin,D="",P=b==="auto"&&e&&e!==1||b===!0;if(R&&(p!==Qd||h!==Qd)){var O=parseFloat(h)*j0,N=Math.sin(O),U=Math.cos(O),B;O=parseFloat(p)*j0,B=Math.cos(O),a=fC(T,a,N*B*-R),o=fC(T,o,-Math.sin(O)*-R),c=fC(T,c,U*B*-R+R)}E!==_y&&(D+="perspective("+E+Zd),(i||s)&&(D+="translate("+i+"%, "+s+"%) "),(P||a!==_y||o!==_y||c!==_y)&&(D+=c!==_y||P?"translate3d("+a+", "+o+", "+c+") ":"translate("+a+", "+o+Zd),u!==Qd&&(D+="rotate("+u+Zd),h!==Qd&&(D+="rotateY("+h+Zd),p!==Qd&&(D+="rotateX("+p+Zd),(v!==Qd||y!==Qd)&&(D+="skew("+v+", "+y+Zd),(x!==1||S!==1)&&(D+="scale("+x+", "+S+Zd),T.style[xs]=D||"translate(0, 0)"},FQ=function(e,t){var n=t||this,i=n.xPercent,s=n.yPercent,a=n.x,o=n.y,c=n.rotation,u=n.skewX,h=n.skewY,p=n.scaleX,v=n.scaleY,y=n.target,x=n.xOrigin,S=n.yOrigin,E=n.xOffset,b=n.yOffset,T=n.forceCSS,R=parseFloat(a),D=parseFloat(o),P,O,N,U,B;c=parseFloat(c),u=parseFloat(u),h=parseFloat(h),h&&(h=parseFloat(h),u+=h,c+=h),c||u?(c*=j0,u*=j0,P=Math.cos(c)*p,O=Math.sin(c)*p,N=Math.sin(c-u)*-v,U=Math.cos(c-u)*v,u&&(h*=j0,B=Math.tan(u-h),B=Math.sqrt(1+B*B),N*=B,U*=B,h&&(B=Math.tan(h),B=Math.sqrt(1+B*B),P*=B,O*=B)),P=Os(P),O=Os(O),N=Os(N),U=Os(U)):(P=p,U=v,O=N=0),(R&&!~(a+"").indexOf("px")||D&&!~(o+"").indexOf("px"))&&(R=Uh(y,"x",a,"px"),D=Uh(y,"y",o,"px")),(x||S||E||b)&&(R=Os(R+x-(x*P+S*N)+E),D=Os(D+S-(x*O+S*U)+b)),(i||s)&&(B=y.getBBox(),R=Os(R+i/100*B.width),D=Os(D+s/100*B.height)),B="matrix("+P+","+O+","+N+","+U+","+R+","+D+")",y.setAttribute("transform",B),T&&(y.style[xs]=B)},kQ=function(e,t,n,i,s){var a=360,o=Cr(s),c=parseFloat(s)*(o&&~s.indexOf("rad")?sp:1),u=c-i,h=i+u+"deg",p,v;return o&&(p=s.split("_")[1],p==="short"&&(u%=a,u!==u%(a/2)&&(u+=u<0?a:-a)),p==="cw"&&u<0?u=(u+a*BB)%a-~~(u/a)*a:p==="ccw"&&u>0&&(u=(u-a*BB)%a-~~(u/a)*a)),e._pt=v=new uo(e._pt,t,n,i,u,AQ),v.e=h,v.u="deg",e._props.push(n),v},GB=function(e,t){for(var n in t)e[n]=t[n];return e},GQ=function(e,t,n){var i=GB({},n._gsap),s="perspective,force3D,transformOrigin,svgOrigin",a=n.style,o,c,u,h,p,v,y,x;i.svg?(u=n.getAttribute("transform"),n.setAttribute("transform",""),a[xs]=t,o=wx(n,1),Fp(n,xs),n.setAttribute("transform",u)):(u=getComputedStyle(n)[xs],a[xs]=t,o=wx(n,1),a[xs]=u);for(c in vf)u=i[c],h=o[c],u!==h&&s.indexOf(c)<0&&(y=aa(u),x=aa(h),p=y!==x?Uh(n,c,u,x):parseFloat(u),v=parseFloat(h),e._pt=new uo(e._pt,o,c,p,v-p,DR),e._pt.u=x||0,e._props.push(c));GB(o,i)};co("padding,margin,Width,Radius",function(r,e){var t="Top",n="Right",i="Bottom",s="Left",a=(e<3?[t,n,i,s]:[t+s,t+n,i+n,i+s]).map(function(o){return e<2?r+o:"border"+o+r});Db[e>1?"border"+r:r]=function(o,c,u,h,p){var v,y;if(arguments.length<4)return v=a.map(function(x){return nf(o,x,u)}),y=v.join(" "),y.split(v[0]).length===5?v[0]:y;v=(h+"").split(" "),y={},a.forEach(function(x,S){return y[x]=v[S]=v[S]||v[(S-1)/2|0]}),o.init(c,y,p)}});var Uk={name:"css",register:wR,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,i,s){var a=this._props,o=e.style,c=n.vars.startAt,u,h,p,v,y,x,S,E,b,T,R,D,P,O,N,U;NL||wR(),this.styles=this.styles||Lk(e),U=this.styles.props,this.tween=n;for(S in t)if(S!=="autoRound"&&(h=t[S],!(Io[S]&&xk(S,t,n,i,e,s)))){if(y=typeof h,x=Db[S],y==="function"&&(h=h.call(n,i,e,s),y=typeof h),y==="string"&&~h.indexOf("random(")&&(h=Cx(h)),x)x(this,e,S,h,n)&&(N=1);else if(S.substr(0,2)==="--")u=(getComputedStyle(e).getPropertyValue(S)+"").trim(),h+="",Rh.lastIndex=0,Rh.test(u)||(E=aa(u),b=aa(h)),b?E!==b&&(u=Uh(e,S,u,b)+b):E&&(h+=E),this.add(o,"setProperty",u,h,i,s,0,0,S),a.push(S),U.push(S,0,o[S]);else if(y!=="undefined"){if(c&&S in c?(u=typeof c[S]=="function"?c[S].call(n,i,e,s):c[S],Cr(u)&&~u.indexOf("random(")&&(u=Cx(u)),aa(u+"")||u==="auto"||(u+=Go.units[S]||aa(nf(e,S))||""),(u+"").charAt(1)==="="&&(u=nf(e,S))):u=nf(e,S),v=parseFloat(u),T=y==="string"&&h.charAt(1)==="="&&h.substr(0,2),T&&(h=h.substr(2)),p=parseFloat(h),S in nu&&(S==="autoAlpha"&&(v===1&&nf(e,"visibility")==="hidden"&&p&&(v=0),U.push("visibility",0,o.visibility),Eh(this,o,"visibility",v?"inherit":"hidden",p?"inherit":"hidden",!p)),S!=="scale"&&S!=="transform"&&(S=nu[S],~S.indexOf(",")&&(S=S.split(",")[0]))),R=S in vf,R){if(this.styles.save(S),y==="string"&&h.substring(0,6)==="var(--"&&(h=yl(e,h.substring(4,h.indexOf(")"))),p=parseFloat(h)),D||(P=e._gsap,P.renderTransform&&!t.parseTransform||wx(e,t.parseTransform),O=t.smoothOrigin!==!1&&P.smooth,D=this._pt=new uo(this._pt,o,xs,0,1,P.renderTransform,P,0,-1),D.dep=1),S==="scale")this._pt=new uo(this._pt,P,"scaleY",P.scaleY,(T?K0(P.scaleY,T+p):p)-P.scaleY||0,DR),this._pt.u=0,a.push("scaleY",S),S+="X";else if(S==="transformOrigin"){U.push(fo,0,o[fo]),h=PQ(h),P.svg?IR(e,h,0,O,0,this):(b=parseFloat(h.split(" ")[2])||0,b!==P.zOrigin&&Eh(this,P,"zOrigin",P.zOrigin,b),Eh(this,o,S,Lb(u),Lb(h)));continue}else if(S==="svgOrigin"){IR(e,h,1,O,0,this);continue}else if(S in Ok){kQ(this,P,S,v,T?K0(v,T+h):h);continue}else if(S==="smoothOrigin"){Eh(this,P,"smooth",P.smooth,h);continue}else if(S==="force3D"){P[S]=h;continue}else if(S==="transform"){GQ(this,h,e);continue}}else S in o||(S=Ag(S)||S);if(R||(p||p===0)&&(v||v===0)&&!SQ.test(h)&&S in o)E=(u+"").substr((v+"").length),p||(p=0),b=aa(h)||(S in Go.units?Go.units[S]:E),E!==b&&(v=Uh(e,S,u,b)),this._pt=new uo(this._pt,R?P:o,S,v,(T?K0(v,T+p):p)-v,!R&&(b==="px"||S==="zIndex")&&t.autoRound!==!1?bQ:DR),this._pt.u=b||0,E!==b&&b!=="%"&&(this._pt.b=u,this._pt.r=EQ);else if(S in o)OQ.call(this,e,S,u,T?T+h:h);else if(S in e)this.add(e,S,u||e[S],T?T+h:h,i,s);else if(S!=="parseTransform"){ML(S,h);continue}R||(S in o?U.push(S,0,o[S]):typeof e[S]=="function"?U.push(S,2,e[S]()):U.push(S,1,u||e[S])),a.push(S)}}N&&Tk(this)},render:function(e,t){if(t.tween._time||!UL())for(var n=t._pt;n;)n.r(e,n.d),n=n._next;else t.styles.revert()},get:nf,aliases:nu,getSetter:function(e,t,n){var i=nu[t];return i&&i.indexOf(",")<0&&(t=i),t in vf&&t!==fo&&(e._gsap.x||nf(e,"x"))?n&&IB===n?t==="scale"?RQ:CQ:(IB=n||{})&&(t==="scale"?DQ:LQ):e.style&&!EL(e.style[t])?TQ:~t.indexOf("-")?MQ:OL(e,t)},core:{_removeProperty:Fp,_getMatrix:kL}};ho.utils.checkPrefix=Ag;ho.core.getStyleSaver=Lk;(function(r,e,t,n){var i=co(r+","+e+","+t,function(s){vf[s]=1});co(e,function(s){Go.units[s]="deg",Ok[s]=1}),nu[i[13]]=r+","+e,co(n,function(s){var a=s.split(":");nu[a[1]]=i[a[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");co("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(r){Go.units[r]="px"});ho.registerPlugin(Uk);var uc=ho.registerPlugin(Uk)||ho;uc.core.Tween;function HQ(r){const{color:e}=Tg(),{nodes:t,materials:n,scene:i}=yf("/models/macbook-16-transformed.glb"),s=yT("/screen.png");return s.colorSpace=sr,s.needsUpdate=!0,Fe.useEffect(()=>{i.traverse(a=>{a.isMesh&&(VR.includes(a.name)||(a.material.color=new Ot(e)))})},[e,i]),ye.jsxs("group",{...r,dispose:null,children:[ye.jsx("mesh",{geometry:t.Object_10.geometry,material:n.PaletteMaterial001,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_16.geometry,material:n.zhGRTuGrQoJflBD,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_20.geometry,material:n.PaletteMaterial002,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_22.geometry,material:n.lmWQsEjxpsebDlK,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_30.geometry,material:n.LtEafgAVRolQqRw,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_32.geometry,material:n.iyDJFXmHelnMTbD,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_34.geometry,material:n.eJObPwhgFzvfaoZ,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_38.geometry,material:n.nDsMUuDKliqGFdU,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_42.geometry,material:n.CRQixVLpahJzhJc,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_48.geometry,material:n.YYwBgwvcyZVOOAA,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_54.geometry,material:n.SLGkCohDDelqXBu,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_58.geometry,material:n.WnHKXHhScfUbJQi,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_66.geometry,material:n.fNHiBfcxHUJCahl,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_74.geometry,material:n.LpqXZqhaGCeSzdu,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_82.geometry,material:n.gMtYExgrEUqPfln,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_96.geometry,material:n.PaletteMaterial003,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_107.geometry,material:n.JvMFZolVCdpPqjj,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_123.geometry,rotation:[Math.PI/2,0,0],children:ye.jsx("meshBasicMaterial",{map:s})}),ye.jsx("mesh",{geometry:t.Object_127.geometry,material:n.ZCDwChwkbBfITSW,rotation:[Math.PI/2,0,0]})]})}yf.preload("/models/macbook-16-transformed.glb");function zQ(r){const{color:e}=Tg(),{nodes:t,materials:n,scene:i}=yf("/models/macbook-14-transformed.glb"),s=yT("/screen.png");return s.colorSpace=sr,s.needsUpdate=!0,Fe.useEffect(()=>{i.traverse(a=>{a.isMesh&&(VR.includes(a.name)||(a.material.color=new Ot(e)))})},[e,i]),ye.jsxs("group",{...r,dispose:null,children:[ye.jsx("mesh",{geometry:t.Object_10.geometry,material:n.PaletteMaterial001,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_16.geometry,material:n.zhGRTuGrQoJflBD,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_20.geometry,material:n.PaletteMaterial002,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_22.geometry,material:n.lmWQsEjxpsebDlK,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_30.geometry,material:n.LtEafgAVRolQqRw,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_32.geometry,material:n.iyDJFXmHelnMTbD,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_34.geometry,material:n.eJObPwhgFzvfaoZ,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_38.geometry,material:n.nDsMUuDKliqGFdU,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_42.geometry,material:n.CRQixVLpahJzhJc,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_48.geometry,material:n.YYwBgwvcyZVOOAA,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_54.geometry,material:n.SLGkCohDDelqXBu,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_58.geometry,material:n.WnHKXHhScfUbJQi,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_66.geometry,material:n.fNHiBfcxHUJCahl,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_74.geometry,material:n.LpqXZqhaGCeSzdu,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_82.geometry,material:n.gMtYExgrEUqPfln,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_96.geometry,material:n.PaletteMaterial003,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_107.geometry,material:n.JvMFZolVCdpPqjj,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:t.Object_123.geometry,rotation:[Math.PI/2,0,0],children:ye.jsx("meshBasicMaterial",{map:s})}),ye.jsx("mesh",{geometry:t.Object_127.geometry,material:n.ZCDwChwkbBfITSW,rotation:[Math.PI/2,0,0]})]})}yf.preload("/models/macbook-14-transformed.glb");let HB=typeof document<"u"?Fe.useLayoutEffect:Fe.useEffect,zB=r=>r&&!Array.isArray(r)&&typeof r=="object",OA=[],VQ={},Fk=uc;const qp=(r,e=OA)=>{let t=VQ;zB(r)?(t=r,r=null,e="dependencies"in t?t.dependencies:OA):zB(e)&&(t=e,e="dependencies"in t?t.dependencies:OA),r&&typeof r!="function"&&console.warn("First parameter must be a function or config object");const{scope:n,revertOnUpdate:i}=t,s=Fe.useRef(!1),a=Fe.useRef(Fk.context(()=>{},n)),o=Fe.useRef(u=>a.current.add(null,u)),c=e&&e.length&&!i;return c&&HB(()=>(s.current=!0,()=>a.current.revert()),OA),HB(()=>{if(r&&a.current.add(r,n),!c||!s.current)return()=>a.current.revert()},e),{context:a.current,contextSafe:o.current}};qp.register=r=>{Fk=r};qp.headless=!0;const kk=1,VB=5,PA=(r,e)=>{r&&r.traverse(t=>{t.isMesh&&t.material&&(t.material.transparent=!0,uc.to(t.material,{opacity:e,duration:kk,onComplete:()=>{e===0?t.visible=!1:t.visible=!0}}))})},NA=(r,e)=>{r&&uc.to(r.position,{x:e,duration:kk,ease:"power2.out"})},YQ=({scale:r,isMobile:e})=>{const{color:t}=Tg(),n=.08,i=.05,s=Fe.useRef(),a=Fe.useRef(),o=r===n||r===i;return Fe.useEffect(()=>{const c=u=>{u&&u.traverse(h=>{h.isMesh&&h.material&&h.material.color&&(h.name.includes("Body")||h.name.includes("Case")||h.name.includes("Shell")||h.name.includes("Macbook"))&&(h.material.color.set(t),h.material.needsUpdate=!0)})};s.current&&c(s.current),a.current&&c(a.current)},[t]),qp(()=>{!s.current||!a.current||(o?(NA(s.current,-VB),NA(a.current,0),PA(s.current,0),PA(a.current,1)):(NA(s.current,0),NA(a.current,VB),PA(s.current,1),PA(a.current,0)))},[r,o]),ye.jsxs(ye.Fragment,{children:[ye.jsx(pK,{makeDefault:!0,enableZoom:!1,enablePan:!0,enableRotate:!0,rotateSpeed:1,panSpeed:.8,minDistance:4,maxDistance:8,minPolarAngle:0,maxPolarAngle:Math.PI/2}),ye.jsx("group",{ref:a,children:ye.jsx(HQ,{scale:e?.05:.08,color:t,position:[0,0,0]})}),ye.jsx("group",{ref:s,children:ye.jsx(zQ,{scale:e?.03:.06,color:t,position:[0,0,0]})})]})};var UA={},YB;function XQ(){if(YB)return UA;YB=1,UA.match=s,UA.parse=a;var r=/(?:(only|not)?\s*([^\s\(\)]+)(?:\s*and)?\s*)?(.+)?/i,e=/\(\s*([^\s\:\)]+)\s*(?:\:\s*([^\s\)]+))?\s*\)/,t=/^(?:(min|max)-)?(.+)/,n=/(em|rem|px|cm|mm|in|pt|pc)?$/,i=/(dpi|dpcm|dppx)?$/;function s(h,p){return a(h).some(function(v){var y=v.inverse,x=v.type==="all"||p.type===v.type;if(x&&y||!(x||y))return!1;var S=v.expressions.every(function(E){var b=E.feature,T=E.modifier,R=E.value,D=p[b];if(!D)return!1;switch(b){case"orientation":case"scan":return D.toLowerCase()===R.toLowerCase();case"width":case"height":case"device-width":case"device-height":R=u(R),D=u(D);break;case"resolution":R=c(R),D=c(D);break;case"aspect-ratio":case"device-aspect-ratio":case"device-pixel-ratio":R=o(R),D=o(D);break;case"grid":case"color":case"color-index":case"monochrome":R=parseInt(R,10)||1,D=parseInt(D,10)||0;break}switch(T){case"min":return D>=R;case"max":return D<=R;default:return D===R}});return S&&!y||!S&&y})}function a(h){return h.split(",").map(function(p){p=p.trim();var v=p.match(r),y=v[1],x=v[2],S=v[3]||"",E={};return E.inverse=!!y&&y.toLowerCase()==="not",E.type=x?x.toLowerCase():"all",S=S.match(/\([^\)]+\)/g)||[],E.expressions=S.map(function(b){var T=b.match(e),R=T[1].toLowerCase().match(t);return{modifier:R[1],feature:R[2],value:T[2]}}),E})}function o(h){var p=Number(h),v;return p||(v=h.match(/^(\d+)\s*\/\s*(\d+)$/),p=v[1]/v[2]),p}function c(h){var p=parseFloat(h),v=String(h).match(i)[1];switch(v){case"dpcm":return p/2.54;case"dppx":return p*96;default:return p}}function u(h){var p=parseFloat(h),v=String(h).match(n)[1];switch(v){case"em":return p*16;case"rem":return p*16;case"cm":return p*96/2.54;case"mm":return p*96/2.54/10;case"in":return p*96;case"pt":return p*72;case"pc":return p*72/12;default:return p}}return UA}var hC,XB;function KQ(){if(XB)return hC;XB=1;var r=XQ().match,e=typeof window<"u"?window.matchMedia:null;function t(i,s,a){var o=this,c;e&&!a&&(c=e.call(window,i)),c?(this.matches=c.matches,this.media=c.media,c.addListener(p)):(this.matches=r(i,s),this.media=i),this.addListener=u,this.removeListener=h,this.dispose=v;function u(y){c&&c.addListener(y)}function h(y){c&&c.removeListener(y)}function p(y){o.matches=y.matches,o.media=y.media}function v(){c&&c.removeListener(p)}}function n(i,s,a){return new t(i,s,a)}return hC=n,hC}var qQ=KQ();const jQ=Ox(qQ);var WQ=/[A-Z]/g,JQ=/^ms-/,dC={};function $Q(r){return"-"+r.toLowerCase()}function Gk(r){if(dC.hasOwnProperty(r))return dC[r];var e=r.replace(WQ,$Q);return dC[r]=JQ.test(e)?"-"+e:e}function QQ(r,e){if(r===e)return!0;if(!r||!e)return!1;const t=Object.keys(r),n=Object.keys(e),i=t.length;if(n.length!==i)return!1;for(let s=0;s<i;s++){const a=t[s];if(r[a]!==e[a]||!Object.prototype.hasOwnProperty.call(e,a))return!1}return!0}var pC={exports:{}},mC,KB;function ZQ(){if(KB)return mC;KB=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return mC=r,mC}var gC,qB;function eZ(){if(qB)return gC;qB=1;var r=ZQ();function e(){}function t(){}return t.resetWarningCache=e,gC=function(){function n(a,o,c,u,h,p){if(p!==r){var v=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw v.name="Invariant Violation",v}}n.isRequired=n;function i(){return n}var s={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:i,element:n,elementType:n,instanceOf:i,node:n,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:t,resetWarningCache:e};return s.PropTypes=s,s},gC}var jB;function tZ(){return jB||(jB=1,pC.exports=eZ()()),pC.exports}var nZ=tZ();const Ci=Ox(nZ),wa=Ci.oneOfType([Ci.string,Ci.number]),Hk={all:Ci.bool,grid:Ci.bool,aural:Ci.bool,braille:Ci.bool,handheld:Ci.bool,print:Ci.bool,projection:Ci.bool,screen:Ci.bool,tty:Ci.bool,tv:Ci.bool,embossed:Ci.bool},iZ={orientation:Ci.oneOf(["portrait","landscape"]),scan:Ci.oneOf(["progressive","interlace"]),aspectRatio:Ci.string,deviceAspectRatio:Ci.string,height:wa,deviceHeight:wa,width:wa,deviceWidth:wa,color:Ci.bool,colorIndex:Ci.bool,monochrome:Ci.bool,resolution:wa,type:Object.keys(Hk)},{type:$Z,...sZ}=iZ,rZ={minAspectRatio:Ci.string,maxAspectRatio:Ci.string,minDeviceAspectRatio:Ci.string,maxDeviceAspectRatio:Ci.string,minHeight:wa,maxHeight:wa,minDeviceHeight:wa,maxDeviceHeight:wa,minWidth:wa,maxWidth:wa,minDeviceWidth:wa,maxDeviceWidth:wa,minColor:Ci.number,maxColor:Ci.number,minColorIndex:Ci.number,maxColorIndex:Ci.number,minMonochrome:Ci.number,maxMonochrome:Ci.number,minResolution:wa,maxResolution:wa,...sZ},aZ={...Hk,...rZ};var oZ={all:aZ};const lZ=r=>`not ${r}`,cZ=(r,e)=>{const t=Gk(r);return typeof e=="number"&&(e=`${e}px`),e===!0?t:e===!1?lZ(t):`(${t}: ${e})`},uZ=r=>r.join(" and "),fZ=r=>{const e=[];return Object.keys(oZ.all).forEach(t=>{const n=r[t];n!=null&&e.push(cZ(t,n))}),uZ(e)},hZ=Fe.createContext(void 0),dZ=r=>r.query||fZ(r),WB=r=>r?Object.keys(r).reduce((t,n)=>(t[Gk(n)]=r[n],t),{}):void 0,zk=()=>{const r=Fe.useRef(!1);return Fe.useEffect(()=>{r.current=!0},[]),r.current},pZ=r=>{const e=Fe.useContext(hZ),t=()=>WB(r)||WB(e),[n,i]=Fe.useState(t);return Fe.useEffect(()=>{const s=t();QQ(n,s)||i(s)},[r,e]),n},mZ=r=>{const e=()=>dZ(r),[t,n]=Fe.useState(e);return Fe.useEffect(()=>{const i=e();t!==i&&n(i)},[r]),t},gZ=(r,e)=>{const t=()=>jQ(r,e||{},!!e),[n,i]=Fe.useState(t),s=zk();return Fe.useEffect(()=>{if(s){const a=t();return i(a),()=>{a&&a.dispose()}}},[r,e]),n},vZ=r=>{const[e,t]=Fe.useState(r.matches);return Fe.useEffect(()=>{const n=i=>{t(i.matches)};return r.addListener(n),t(r.matches),()=>{r.removeListener(n)}},[r]),e},t_=(r,e,t)=>{const n=pZ(e),i=mZ(r);if(!i)throw new Error("Invalid or missing MediaQuery!");const s=gZ(i,n),a=vZ(s);return zk(),Fe.useEffect(()=>{},[a]),Fe.useEffect(()=>()=>{s&&s.dispose()},[]),a},yZ=()=>{const{color:r,scale:e,setColor:t,setScale:n}=Tg(),i=t_({query:"(max-width: 1024px)"}),s=[{name:"Silver",value:"#f2f2f2"},{name:"Sierra Orange",value:"#ff6b35"},{name:"Deep Purple",value:"#5d3a7a"},{name:"Pacific Blue",value:"#007aff"},{name:"Space Gray",value:"#2e2c2e"}],a=s.find(c=>c.value===r)?.name||s[0].name,o=e===.06?'14"':'16"';return ye.jsxs("section",{id:"product-viewer",children:[ye.jsx("h2",{children:"Take a closer look."}),ye.jsxs("div",{className:"controls",children:[ye.jsxs("p",{className:"info text-xl font-medium",children:["Macbook Pro ",o," in ",ye.jsx("span",{style:{color:r,fontWeight:"bold"},children:a})]}),ye.jsxs("div",{className:"flex-center gap-5 mt-5",children:[ye.jsx("div",{className:"color-control",children:s.map(c=>ye.jsx("div",{onClick:()=>t(c.value),className:JA("color-option",r===c.value&&"active",c.value==="#f2f2f2"?"border border-gray-300":""),style:{backgroundColor:c.value,boxShadow:r===c.value?`0 0 0 3px ${c.value}, 0 0 0 6px rgba(255,255,255,0.3)`:"none"},title:c.name},c.value))}),ye.jsxs("div",{className:"size-control",children:[ye.jsx("div",{onClick:()=>n(.06),className:JA("size-option",e===.06?"bg-white text-black":"bg-transparent text-white"),children:ye.jsx("p",{children:'14"'})}),ye.jsx("div",{onClick:()=>n(.08),className:JA("size-option",e===.08?"bg-white text-black":"bg-transparent text-white"),children:ye.jsx("p",{children:'16"'})})]})]})]}),ye.jsxs(IN,{id:"canvas",camera:{position:[0,2,5],fov:50,near:.1,far:100},children:[ye.jsx(FF,{}),ye.jsx(YQ,{scale:i?e-.03:e,isMobile:i})]})]})};function xZ(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function _Z(r,e,t){return e&&xZ(r.prototype,e),r}var Ur,dE,Po,bh,Th,W0,Vk,rp,Qy,Yk,cf,tc,Xk,Kk=function(){return Ur||typeof window<"u"&&(Ur=window.gsap)&&Ur.registerPlugin&&Ur},qk=1,F0=[],Jn=[],ru=[],Zy=Date.now,BR=function(e,t){return t},SZ=function(){var e=Qy.core,t=e.bridge||{},n=e._scrollers,i=e._proxies;n.push.apply(n,Jn),i.push.apply(i,ru),Jn=n,ru=i,BR=function(a,o){return t[a](o)}},Dh=function(e,t){return~ru.indexOf(e)&&ru[ru.indexOf(e)+1][t]},ex=function(e){return!!~Yk.indexOf(e)},Da=function(e,t,n,i,s){return e.addEventListener(t,n,{passive:i!==!1,capture:!!s})},Ra=function(e,t,n,i){return e.removeEventListener(t,n,!!i)},FA="scrollLeft",kA="scrollTop",OR=function(){return cf&&cf.isPressed||Jn.cache++},wb=function(e,t){var n=function i(s){if(s||s===0){qk&&(Po.history.scrollRestoration="manual");var a=cf&&cf.isPressed;s=i.v=Math.round(s)||(cf&&cf.iOS?1:0),e(s),i.cacheID=Jn.cache,a&&BR("ss",s)}else(t||Jn.cache!==i.cacheID||BR("ref"))&&(i.cacheID=Jn.cache,i.v=e());return i.v+i.offset};return n.offset=0,e&&n},Fa={s:FA,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:wb(function(r){return arguments.length?Po.scrollTo(r,ir.sc()):Po.pageXOffset||bh[FA]||Th[FA]||W0[FA]||0})},ir={s:kA,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:Fa,sc:wb(function(r){return arguments.length?Po.scrollTo(Fa.sc(),r):Po.pageYOffset||bh[kA]||Th[kA]||W0[kA]||0})},no=function(e,t){return(t&&t._ctx&&t._ctx.selector||Ur.utils.toArray)(e)[0]||(typeof e=="string"&&Ur.config().nullTargetWarn!==!1?console.warn("Element not found:",e):null)},AZ=function(e,t){for(var n=t.length;n--;)if(t[n]===e||t[n].contains(e))return!0;return!1},Fh=function(e,t){var n=t.s,i=t.sc;ex(e)&&(e=bh.scrollingElement||Th);var s=Jn.indexOf(e),a=i===ir.sc?1:2;!~s&&(s=Jn.push(e)-1),Jn[s+a]||Da(e,"scroll",OR);var o=Jn[s+a],c=o||(Jn[s+a]=wb(Dh(e,n),!0)||(ex(e)?i:wb(function(u){return arguments.length?e[n]=u:e[n]})));return c.target=e,o||(c.smooth=Ur.getProperty(e,"scrollBehavior")==="smooth"),c},PR=function(e,t,n){var i=e,s=e,a=Zy(),o=a,c=t||50,u=Math.max(500,c*3),h=function(x,S){var E=Zy();S||E-a>c?(s=i,i=x,o=a,a=E):n?i+=x:i=s+(x-s)/(E-o)*(a-o)},p=function(){s=i=n?0:i,o=a=0},v=function(x){var S=o,E=s,b=Zy();return(x||x===0)&&x!==i&&h(x),a===o||b-o>u?0:(i+(n?E:-E))/((n?b:a)-S)*1e3};return{update:h,reset:p,getVelocity:v}},Sy=function(e,t){return t&&!e._gsapAllow&&e.preventDefault(),e.changedTouches?e.changedTouches[0]:e},JB=function(e){var t=Math.max.apply(Math,e),n=Math.min.apply(Math,e);return Math.abs(t)>=Math.abs(n)?t:n},jk=function(){Qy=Ur.core.globals().ScrollTrigger,Qy&&Qy.core&&SZ()},Wk=function(e){return Ur=e||Kk(),!dE&&Ur&&typeof document<"u"&&document.body&&(Po=window,bh=document,Th=bh.documentElement,W0=bh.body,Yk=[Po,bh,Th,W0],Ur.utils.clamp,Xk=Ur.core.context||function(){},rp="onpointerenter"in W0?"pointer":"mouse",Vk=Us.isTouch=Po.matchMedia&&Po.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in Po||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,tc=Us.eventTypes=("ontouchstart"in Th?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in Th?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout(function(){return qk=0},500),jk(),dE=1),dE};Fa.op=ir;Jn.cache=0;var Us=(function(){function r(t){this.init(t)}var e=r.prototype;return e.init=function(n){dE||Wk(Ur)||console.warn("Please gsap.registerPlugin(Observer)"),Qy||jk();var i=n.tolerance,s=n.dragMinimum,a=n.type,o=n.target,c=n.lineHeight,u=n.debounce,h=n.preventDefault,p=n.onStop,v=n.onStopDelay,y=n.ignore,x=n.wheelSpeed,S=n.event,E=n.onDragStart,b=n.onDragEnd,T=n.onDrag,R=n.onPress,D=n.onRelease,P=n.onRight,O=n.onLeft,N=n.onUp,U=n.onDown,B=n.onChangeX,I=n.onChangeY,z=n.onChange,W=n.onToggleX,Z=n.onToggleY,te=n.onHover,re=n.onHoverEnd,k=n.onMove,j=n.ignoreCheck,J=n.isNormalizer,oe=n.onGestureStart,K=n.onGestureEnd,X=n.onWheel,ne=n.onEnable,xe=n.onDisable,_e=n.onClick,Be=n.scrollSpeed,pe=n.capture,be=n.allowClicks,je=n.lockAxis,gt=n.onLockAxis;this.target=o=no(o)||Th,this.vars=n,y&&(y=Ur.utils.toArray(y)),i=i||1e-9,s=s||0,x=x||1,Be=Be||1,a=a||"wheel,touch,pointer",u=u!==!1,c||(c=parseFloat(Po.getComputedStyle(W0).lineHeight)||22);var St,At,jt,vt,ze,ie,Oe,ue=this,st=0,$e=0,_t=n.passive||!h&&n.passive!==!1,it=Fh(o,Fa),Tt=Fh(o,ir),se=it(),q=Tt(),Ee=~a.indexOf("touch")&&!~a.indexOf("pointer")&&tc[0]==="pointerdown",Ge=ex(o),Ve=o.ownerDocument||bh,Pe=[0,0,0],wt=[0,0,0],bt=0,Ft=function(){return bt=Zy()},Mt=function(Ut,dn){return(ue.event=Ut)&&y&&AZ(Ut.target,y)||dn&&Ee&&Ut.pointerType!=="touch"||j&&j(Ut,dn)},Ze=function(){ue._vx.reset(),ue._vy.reset(),At.pause(),p&&p(ue)},Je=function(){var Ut=ue.deltaX=JB(Pe),dn=ue.deltaY=JB(wt),It=Math.abs(Ut)>=i,pn=Math.abs(dn)>=i;z&&(It||pn)&&z(ue,Ut,dn,Pe,wt),It&&(P&&ue.deltaX>0&&P(ue),O&&ue.deltaX<0&&O(ue),B&&B(ue),W&&ue.deltaX<0!=st<0&&W(ue),st=ue.deltaX,Pe[0]=Pe[1]=Pe[2]=0),pn&&(U&&ue.deltaY>0&&U(ue),N&&ue.deltaY<0&&N(ue),I&&I(ue),Z&&ue.deltaY<0!=$e<0&&Z(ue),$e=ue.deltaY,wt[0]=wt[1]=wt[2]=0),(vt||jt)&&(k&&k(ue),jt&&(E&&jt===1&&E(ue),T&&T(ue),jt=0),vt=!1),ie&&!(ie=!1)&&gt&&gt(ue),ze&&(X(ue),ze=!1),St=0},Nt=function(Ut,dn,It){Pe[It]+=Ut,wt[It]+=dn,ue._vx.update(Ut),ue._vy.update(dn),u?St||(St=requestAnimationFrame(Je)):Je()},he=function(Ut,dn){je&&!Oe&&(ue.axis=Oe=Math.abs(Ut)>Math.abs(dn)?"x":"y",ie=!0),Oe!=="y"&&(Pe[2]+=Ut,ue._vx.update(Ut,!0)),Oe!=="x"&&(wt[2]+=dn,ue._vy.update(dn,!0)),u?St||(St=requestAnimationFrame(Je)):Je()},Ce=function(Ut){if(!Mt(Ut,1)){Ut=Sy(Ut,h);var dn=Ut.clientX,It=Ut.clientY,pn=dn-ue.x,Wt=It-ue.y,$t=ue.isDragging;ue.x=dn,ue.y=It,($t||(pn||Wt)&&(Math.abs(ue.startX-dn)>=s||Math.abs(ue.startY-It)>=s))&&(jt=$t?2:1,$t||(ue.isDragging=!0),he(pn,Wt))}},tt=ue.onPress=function(Dt){Mt(Dt,1)||Dt&&Dt.button||(ue.axis=Oe=null,At.pause(),ue.isPressed=!0,Dt=Sy(Dt),st=$e=0,ue.startX=ue.x=Dt.clientX,ue.startY=ue.y=Dt.clientY,ue._vx.reset(),ue._vy.reset(),Da(J?o:Ve,tc[1],Ce,_t,!0),ue.deltaX=ue.deltaY=0,R&&R(ue))},le=ue.onRelease=function(Dt){if(!Mt(Dt,1)){Ra(J?o:Ve,tc[1],Ce,!0);var Ut=!isNaN(ue.y-ue.startY),dn=ue.isDragging,It=dn&&(Math.abs(ue.x-ue.startX)>3||Math.abs(ue.y-ue.startY)>3),pn=Sy(Dt);!It&&Ut&&(ue._vx.reset(),ue._vy.reset(),h&&be&&Ur.delayedCall(.08,function(){if(Zy()-bt>300&&!Dt.defaultPrevented){if(Dt.target.click)Dt.target.click();else if(Ve.createEvent){var Wt=Ve.createEvent("MouseEvents");Wt.initMouseEvent("click",!0,!0,Po,1,pn.screenX,pn.screenY,pn.clientX,pn.clientY,!1,!1,!1,!1,0,null),Dt.target.dispatchEvent(Wt)}}})),ue.isDragging=ue.isGesturing=ue.isPressed=!1,p&&dn&&!J&&At.restart(!0),jt&&Je(),b&&dn&&b(ue),D&&D(ue,It)}},Re=function(Ut){return Ut.touches&&Ut.touches.length>1&&(ue.isGesturing=!0)&&oe(Ut,ue.isDragging)},ht=function(){return(ue.isGesturing=!1)||K(ue)},yt=function(Ut){if(!Mt(Ut)){var dn=it(),It=Tt();Nt((dn-se)*Be,(It-q)*Be,1),se=dn,q=It,p&&At.restart(!0)}},ut=function(Ut){if(!Mt(Ut)){Ut=Sy(Ut,h),X&&(ze=!0);var dn=(Ut.deltaMode===1?c:Ut.deltaMode===2?Po.innerHeight:1)*x;Nt(Ut.deltaX*dn,Ut.deltaY*dn,0),p&&!J&&At.restart(!0)}},Qe=function(Ut){if(!Mt(Ut)){var dn=Ut.clientX,It=Ut.clientY,pn=dn-ue.x,Wt=It-ue.y;ue.x=dn,ue.y=It,vt=!0,p&&At.restart(!0),(pn||Wt)&&he(pn,Wt)}},Rt=function(Ut){ue.event=Ut,te(ue)},Vt=function(Ut){ue.event=Ut,re(ue)},En=function(Ut){return Mt(Ut)||Sy(Ut,h)&&_e(ue)};At=ue._dc=Ur.delayedCall(v||.25,Ze).pause(),ue.deltaX=ue.deltaY=0,ue._vx=PR(0,50,!0),ue._vy=PR(0,50,!0),ue.scrollX=it,ue.scrollY=Tt,ue.isDragging=ue.isGesturing=ue.isPressed=!1,Xk(this),ue.enable=function(Dt){return ue.isEnabled||(Da(Ge?Ve:o,"scroll",OR),a.indexOf("scroll")>=0&&Da(Ge?Ve:o,"scroll",yt,_t,pe),a.indexOf("wheel")>=0&&Da(o,"wheel",ut,_t,pe),(a.indexOf("touch")>=0&&Vk||a.indexOf("pointer")>=0)&&(Da(o,tc[0],tt,_t,pe),Da(Ve,tc[2],le),Da(Ve,tc[3],le),be&&Da(o,"click",Ft,!0,!0),_e&&Da(o,"click",En),oe&&Da(Ve,"gesturestart",Re),K&&Da(Ve,"gestureend",ht),te&&Da(o,rp+"enter",Rt),re&&Da(o,rp+"leave",Vt),k&&Da(o,rp+"move",Qe)),ue.isEnabled=!0,ue.isDragging=ue.isGesturing=ue.isPressed=vt=jt=!1,ue._vx.reset(),ue._vy.reset(),se=it(),q=Tt(),Dt&&Dt.type&&tt(Dt),ne&&ne(ue)),ue},ue.disable=function(){ue.isEnabled&&(F0.filter(function(Dt){return Dt!==ue&&ex(Dt.target)}).length||Ra(Ge?Ve:o,"scroll",OR),ue.isPressed&&(ue._vx.reset(),ue._vy.reset(),Ra(J?o:Ve,tc[1],Ce,!0)),Ra(Ge?Ve:o,"scroll",yt,pe),Ra(o,"wheel",ut,pe),Ra(o,tc[0],tt,pe),Ra(Ve,tc[2],le),Ra(Ve,tc[3],le),Ra(o,"click",Ft,!0),Ra(o,"click",En),Ra(Ve,"gesturestart",Re),Ra(Ve,"gestureend",ht),Ra(o,rp+"enter",Rt),Ra(o,rp+"leave",Vt),Ra(o,rp+"move",Qe),ue.isEnabled=ue.isPressed=ue.isDragging=!1,xe&&xe(ue))},ue.kill=ue.revert=function(){ue.disable();var Dt=F0.indexOf(ue);Dt>=0&&F0.splice(Dt,1),cf===ue&&(cf=0)},F0.push(ue),J&&ex(o)&&(cf=ue),ue.enable(S)},_Z(r,[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}]),r})();Us.version="3.13.0";Us.create=function(r){return new Us(r)};Us.register=Wk;Us.getAll=function(){return F0.slice()};Us.getById=function(r){return F0.filter(function(e){return e.vars.id===r})[0]};Kk()&&Ur.registerPlugin(Us);var en,I0,Wn,Wi,Bo,wi,GL,Ib,Ix,tx,Ly,GA,ia,wT,NR,Ba,$B,QB,B0,Jk,vC,$k,Ia,UR,Qk,Zk,ph,FR,HL,J0,zL,Bb,kR,yC,HA=1,ra=Date.now,xC=ra(),Sl=0,wy=0,ZB=function(e,t,n){var i=wo(e)&&(e.substr(0,6)==="clamp("||e.indexOf("max")>-1);return n["_"+t+"Clamp"]=i,i?e.substr(6,e.length-7):e},eO=function(e,t){return t&&(!wo(e)||e.substr(0,6)!=="clamp(")?"clamp("+e+")":e},EZ=function r(){return wy&&requestAnimationFrame(r)},tO=function(){return wT=1},nO=function(){return wT=0},$c=function(e){return e},Iy=function(e){return Math.round(e*1e5)/1e5||0},e4=function(){return typeof window<"u"},t4=function(){return en||e4()&&(en=window.gsap)&&en.registerPlugin&&en},kp=function(e){return!!~GL.indexOf(e)},n4=function(e){return(e==="Height"?zL:Wn["inner"+e])||Bo["client"+e]||wi["client"+e]},i4=function(e){return Dh(e,"getBoundingClientRect")||(kp(e)?function(){return yE.width=Wn.innerWidth,yE.height=zL,yE}:function(){return of(e)})},bZ=function(e,t,n){var i=n.d,s=n.d2,a=n.a;return(a=Dh(e,"getBoundingClientRect"))?function(){return a()[i]}:function(){return(t?n4(s):e["client"+s])||0}},TZ=function(e,t){return!t||~ru.indexOf(e)?i4(e):function(){return yE}},iu=function(e,t){var n=t.s,i=t.d2,s=t.d,a=t.a;return Math.max(0,(n="scroll"+i)&&(a=Dh(e,n))?a()-i4(e)()[s]:kp(e)?(Bo[n]||wi[n])-n4(i):e[n]-e["offset"+i])},zA=function(e,t){for(var n=0;n<B0.length;n+=3)(!t||~t.indexOf(B0[n+1]))&&e(B0[n],B0[n+1],B0[n+2])},wo=function(e){return typeof e=="string"},oa=function(e){return typeof e=="function"},By=function(e){return typeof e=="number"},ap=function(e){return typeof e=="object"},Ay=function(e,t,n){return e&&e.progress(t?0:1)&&n&&e.pause()},_C=function(e,t){if(e.enabled){var n=e._ctx?e._ctx.add(function(){return t(e)}):t(e);n&&n.totalTime&&(e.callbackAnimation=n)}},D0=Math.abs,s4="left",r4="top",VL="right",YL="bottom",Mp="width",Cp="height",nx="Right",ix="Left",sx="Top",rx="Bottom",Ys="padding",hl="margin",Eg="Width",XL="Height",er="px",dl=function(e){return Wn.getComputedStyle(e)},MZ=function(e){var t=dl(e).position;e.style.position=t==="absolute"||t==="fixed"?t:"relative"},iO=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},of=function(e,t){var n=t&&dl(e)[NR]!=="matrix(1, 0, 0, 1, 0, 0)"&&en.to(e,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),i=e.getBoundingClientRect();return n&&n.progress(0).kill(),i},Ob=function(e,t){var n=t.d2;return e["offset"+n]||e["client"+n]||0},a4=function(e){var t=[],n=e.labels,i=e.duration(),s;for(s in n)t.push(n[s]/i);return t},CZ=function(e){return function(t){return en.utils.snap(a4(e),t)}},KL=function(e){var t=en.utils.snap(e),n=Array.isArray(e)&&e.slice(0).sort(function(i,s){return i-s});return n?function(i,s,a){a===void 0&&(a=.001);var o;if(!s)return t(i);if(s>0){for(i-=a,o=0;o<n.length;o++)if(n[o]>=i)return n[o];return n[o-1]}else for(o=n.length,i+=a;o--;)if(n[o]<=i)return n[o];return n[0]}:function(i,s,a){a===void 0&&(a=.001);var o=t(i);return!s||Math.abs(o-i)<a||o-i<0==s<0?o:t(s<0?i-e:i+e)}},RZ=function(e){return function(t,n){return KL(a4(e))(t,n.direction)}},VA=function(e,t,n,i){return n.split(",").forEach(function(s){return e(t,s,i)})},Ar=function(e,t,n,i,s){return e.addEventListener(t,n,{passive:!i,capture:!!s})},Sr=function(e,t,n,i){return e.removeEventListener(t,n,!!i)},YA=function(e,t,n){n=n&&n.wheelHandler,n&&(e(t,"wheel",n),e(t,"touchmove",n))},sO={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},XA={toggleActions:"play",anticipatePin:0},Pb={top:0,left:0,center:.5,bottom:1,right:1},pE=function(e,t){if(wo(e)){var n=e.indexOf("="),i=~n?+(e.charAt(n-1)+1)*parseFloat(e.substr(n+1)):0;~n&&(e.indexOf("%")>n&&(i*=t/100),e=e.substr(0,n-1)),e=i+(e in Pb?Pb[e]*t:~e.indexOf("%")?parseFloat(e)*t/100:parseFloat(e)||0)}return e},KA=function(e,t,n,i,s,a,o,c){var u=s.startColor,h=s.endColor,p=s.fontSize,v=s.indent,y=s.fontWeight,x=Wi.createElement("div"),S=kp(n)||Dh(n,"pinType")==="fixed",E=e.indexOf("scroller")!==-1,b=S?wi:n,T=e.indexOf("start")!==-1,R=T?u:h,D="border-color:"+R+";font-size:"+p+";color:"+R+";font-weight:"+y+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return D+="position:"+((E||c)&&S?"fixed;":"absolute;"),(E||c||!S)&&(D+=(i===ir?VL:YL)+":"+(a+parseFloat(v))+"px;"),o&&(D+="box-sizing:border-box;text-align:left;width:"+o.offsetWidth+"px;"),x._isStart=T,x.setAttribute("class","gsap-marker-"+e+(t?" marker-"+t:"")),x.style.cssText=D,x.innerText=t||t===0?e+"-"+t:e,b.children[0]?b.insertBefore(x,b.children[0]):b.appendChild(x),x._offset=x["offset"+i.op.d2],mE(x,0,i,T),x},mE=function(e,t,n,i){var s={display:"block"},a=n[i?"os2":"p2"],o=n[i?"p2":"os2"];e._isFlipped=i,s[n.a+"Percent"]=i?-100:0,s[n.a]=i?"1px":0,s["border"+a+Eg]=1,s["border"+o+Eg]=0,s[n.p]=t+"px",en.set(e,s)},Vn=[],GR={},Bx,rO=function(){return ra()-Sl>34&&(Bx||(Bx=requestAnimationFrame(df)))},L0=function(){(!Ia||!Ia.isPressed||Ia.startX>wi.clientWidth)&&(Jn.cache++,Ia?Bx||(Bx=requestAnimationFrame(df)):df(),Sl||Hp("scrollStart"),Sl=ra())},SC=function(){Zk=Wn.innerWidth,Qk=Wn.innerHeight},Oy=function(e){Jn.cache++,(e===!0||!ia&&!$k&&!Wi.fullscreenElement&&!Wi.webkitFullscreenElement&&(!UR||Zk!==Wn.innerWidth||Math.abs(Wn.innerHeight-Qk)>Wn.innerHeight*.25))&&Ib.restart(!0)},Gp={},DZ=[],o4=function r(){return Sr(ti,"scrollEnd",r)||gp(!0)},Hp=function(e){return Gp[e]&&Gp[e].map(function(t){return t()})||DZ},Lo=[],l4=function(e){for(var t=0;t<Lo.length;t+=5)(!e||Lo[t+4]&&Lo[t+4].query===e)&&(Lo[t].style.cssText=Lo[t+1],Lo[t].getBBox&&Lo[t].setAttribute("transform",Lo[t+2]||""),Lo[t+3].uncache=1)},qL=function(e,t){var n;for(Ba=0;Ba<Vn.length;Ba++)n=Vn[Ba],n&&(!t||n._ctx===t)&&(e?n.kill(1):n.revert(!0,!0));Bb=!0,t&&l4(t),t||Hp("revert")},c4=function(e,t){Jn.cache++,(t||!Oa)&&Jn.forEach(function(n){return oa(n)&&n.cacheID++&&(n.rec=0)}),wo(e)&&(Wn.history.scrollRestoration=HL=e)},Oa,Rp=0,aO,LZ=function(){if(aO!==Rp){var e=aO=Rp;requestAnimationFrame(function(){return e===Rp&&gp(!0)})}},u4=function(){wi.appendChild(J0),zL=!Ia&&J0.offsetHeight||Wn.innerHeight,wi.removeChild(J0)},oO=function(e){return Ix(".gsap-marker-start, .gsap-marker-end, .gsap-marker-scroller-start, .gsap-marker-scroller-end").forEach(function(t){return t.style.display=e?"none":"block"})},gp=function(e,t){if(Bo=Wi.documentElement,wi=Wi.body,GL=[Wn,Wi,Bo,wi],Sl&&!e&&!Bb){Ar(ti,"scrollEnd",o4);return}u4(),Oa=ti.isRefreshing=!0,Jn.forEach(function(i){return oa(i)&&++i.cacheID&&(i.rec=i())});var n=Hp("refreshInit");Jk&&ti.sort(),t||qL(),Jn.forEach(function(i){oa(i)&&(i.smooth&&(i.target.style.scrollBehavior="auto"),i(0))}),Vn.slice(0).forEach(function(i){return i.refresh()}),Bb=!1,Vn.forEach(function(i){if(i._subPinOffset&&i.pin){var s=i.vars.horizontal?"offsetWidth":"offsetHeight",a=i.pin[s];i.revert(!0,1),i.adjustPinSpacing(i.pin[s]-a),i.refresh()}}),kR=1,oO(!0),Vn.forEach(function(i){var s=iu(i.scroller,i._dir),a=i.vars.end==="max"||i._endClamp&&i.end>s,o=i._startClamp&&i.start>=s;(a||o)&&i.setPositions(o?s-1:i.start,a?Math.max(o?s:i.start+1,s):i.end,!0)}),oO(!1),kR=0,n.forEach(function(i){return i&&i.render&&i.render(-1)}),Jn.forEach(function(i){oa(i)&&(i.smooth&&requestAnimationFrame(function(){return i.target.style.scrollBehavior="smooth"}),i.rec&&i(i.rec))}),c4(HL,1),Ib.pause(),Rp++,Oa=2,df(2),Vn.forEach(function(i){return oa(i.vars.onRefresh)&&i.vars.onRefresh(i)}),Oa=ti.isRefreshing=!1,Hp("refresh")},HR=0,gE=1,ax,df=function(e){if(e===2||!Oa&&!Bb){ti.isUpdating=!0,ax&&ax.update(0);var t=Vn.length,n=ra(),i=n-xC>=50,s=t&&Vn[0].scroll();if(gE=HR>s?-1:1,Oa||(HR=s),i&&(Sl&&!wT&&n-Sl>200&&(Sl=0,Hp("scrollEnd")),Ly=xC,xC=n),gE<0){for(Ba=t;Ba-- >0;)Vn[Ba]&&Vn[Ba].update(0,i);gE=1}else for(Ba=0;Ba<t;Ba++)Vn[Ba]&&Vn[Ba].update(0,i);ti.isUpdating=!1}Bx=0},zR=[s4,r4,YL,VL,hl+rx,hl+nx,hl+sx,hl+ix,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],vE=zR.concat([Mp,Cp,"boxSizing","max"+Eg,"max"+XL,"position",hl,Ys,Ys+sx,Ys+nx,Ys+rx,Ys+ix]),wZ=function(e,t,n){$0(n);var i=e._gsap;if(i.spacerIsNative)$0(i.spacerState);else if(e._gsap.swappedIn){var s=t.parentNode;s&&(s.insertBefore(e,t),s.removeChild(t))}e._gsap.swappedIn=!1},AC=function(e,t,n,i){if(!e._gsap.swappedIn){for(var s=zR.length,a=t.style,o=e.style,c;s--;)c=zR[s],a[c]=n[c];a.position=n.position==="absolute"?"absolute":"relative",n.display==="inline"&&(a.display="inline-block"),o[YL]=o[VL]="auto",a.flexBasis=n.flexBasis||"auto",a.overflow="visible",a.boxSizing="border-box",a[Mp]=Ob(e,Fa)+er,a[Cp]=Ob(e,ir)+er,a[Ys]=o[hl]=o[r4]=o[s4]="0",$0(i),o[Mp]=o["max"+Eg]=n[Mp],o[Cp]=o["max"+XL]=n[Cp],o[Ys]=n[Ys],e.parentNode!==t&&(e.parentNode.insertBefore(t,e),t.appendChild(e)),e._gsap.swappedIn=!0}},IZ=/([A-Z])/g,$0=function(e){if(e){var t=e.t.style,n=e.length,i=0,s,a;for((e.t._gsap||en.core.getCache(e.t)).uncache=1;i<n;i+=2)a=e[i+1],s=e[i],a?t[s]=a:t[s]&&t.removeProperty(s.replace(IZ,"-$1").toLowerCase())}},qA=function(e){for(var t=vE.length,n=e.style,i=[],s=0;s<t;s++)i.push(vE[s],n[vE[s]]);return i.t=e,i},BZ=function(e,t,n){for(var i=[],s=e.length,a=n?8:0,o;a<s;a+=2)o=e[a],i.push(o,o in t?t[o]:e[a+1]);return i.t=e.t,i},yE={left:0,top:0},lO=function(e,t,n,i,s,a,o,c,u,h,p,v,y,x){oa(e)&&(e=e(c)),wo(e)&&e.substr(0,3)==="max"&&(e=v+(e.charAt(4)==="="?pE("0"+e.substr(3),n):0));var S=y?y.time():0,E,b,T;if(y&&y.seek(0),isNaN(e)||(e=+e),By(e))y&&(e=en.utils.mapRange(y.scrollTrigger.start,y.scrollTrigger.end,0,v,e)),o&&mE(o,n,i,!0);else{oa(t)&&(t=t(c));var R=(e||"0").split(" "),D,P,O,N;T=no(t,c)||wi,D=of(T)||{},(!D||!D.left&&!D.top)&&dl(T).display==="none"&&(N=T.style.display,T.style.display="block",D=of(T),N?T.style.display=N:T.style.removeProperty("display")),P=pE(R[0],D[i.d]),O=pE(R[1]||"0",n),e=D[i.p]-u[i.p]-h+P+s-O,o&&mE(o,O,i,n-O<20||o._isStart&&O>20),n-=n-O}if(x&&(c[x]=e||-.001,e<0&&(e=0)),a){var U=e+n,B=a._isStart;E="scroll"+i.d2,mE(a,U,i,B&&U>20||!B&&(p?Math.max(wi[E],Bo[E]):a.parentNode[E])<=U+1),p&&(u=of(o),p&&(a.style[i.op.p]=u[i.op.p]-i.op.m-a._offset+er))}return y&&T&&(E=of(T),y.seek(v),b=of(T),y._caScrollDist=E[i.p]-b[i.p],e=e/y._caScrollDist*v),y&&y.seek(S),y?e:Math.round(e)},OZ=/(webkit|moz|length|cssText|inset)/i,cO=function(e,t,n,i){if(e.parentNode!==t){var s=e.style,a,o;if(t===wi){e._stOrig=s.cssText,o=dl(e);for(a in o)!+a&&!OZ.test(a)&&o[a]&&typeof s[a]=="string"&&a!=="0"&&(s[a]=o[a]);s.top=n,s.left=i}else s.cssText=e._stOrig;en.core.getCache(e).uncache=1,t.appendChild(e)}},f4=function(e,t,n){var i=t,s=i;return function(a){var o=Math.round(e());return o!==i&&o!==s&&Math.abs(o-i)>3&&Math.abs(o-s)>3&&(a=o,n&&n()),s=i,i=Math.round(a),i}},jA=function(e,t,n){var i={};i[t.p]="+="+n,en.set(e,i)},uO=function(e,t){var n=Fh(e,t),i="_scroll"+t.p2,s=function a(o,c,u,h,p){var v=a.tween,y=c.onComplete,x={};u=u||n();var S=f4(n,u,function(){v.kill(),a.tween=0});return p=h&&p||0,h=h||o-u,v&&v.kill(),c[i]=o,c.inherit=!1,c.modifiers=x,x[i]=function(){return S(u+h*v.ratio+p*v.ratio*v.ratio)},c.onUpdate=function(){Jn.cache++,a.tween&&df()},c.onComplete=function(){a.tween=0,y&&y.call(v)},v=a.tween=en.to(e,c),v};return e[i]=n,n.wheelHandler=function(){return s.tween&&s.tween.kill()&&(s.tween=0)},Ar(e,"wheel",n.wheelHandler),ti.isTouch&&Ar(e,"touchmove",n.wheelHandler),s},ti=(function(){function r(t,n){I0||r.register(en)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),FR(this),this.init(t,n)}var e=r.prototype;return e.init=function(n,i){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),!wy){this.update=this.refresh=this.kill=$c;return}n=iO(wo(n)||By(n)||n.nodeType?{trigger:n}:n,XA);var s=n,a=s.onUpdate,o=s.toggleClass,c=s.id,u=s.onToggle,h=s.onRefresh,p=s.scrub,v=s.trigger,y=s.pin,x=s.pinSpacing,S=s.invalidateOnRefresh,E=s.anticipatePin,b=s.onScrubComplete,T=s.onSnapComplete,R=s.once,D=s.snap,P=s.pinReparent,O=s.pinSpacer,N=s.containerAnimation,U=s.fastScrollEnd,B=s.preventOverlaps,I=n.horizontal||n.containerAnimation&&n.horizontal!==!1?Fa:ir,z=!p&&p!==0,W=no(n.scroller||Wn),Z=en.core.getCache(W),te=kp(W),re=("pinType"in n?n.pinType:Dh(W,"pinType")||te&&"fixed")==="fixed",k=[n.onEnter,n.onLeave,n.onEnterBack,n.onLeaveBack],j=z&&n.toggleActions.split(" "),J="markers"in n?n.markers:XA.markers,oe=te?0:parseFloat(dl(W)["border"+I.p2+Eg])||0,K=this,X=n.onRefreshInit&&function(){return n.onRefreshInit(K)},ne=bZ(W,te,I),xe=TZ(W,te),_e=0,Be=0,pe=0,be=Fh(W,I),je,gt,St,At,jt,vt,ze,ie,Oe,ue,st,$e,_t,it,Tt,se,q,Ee,Ge,Ve,Pe,wt,bt,Ft,Mt,Ze,Je,Nt,he,Ce,tt,le,Re,ht,yt,ut,Qe,Rt,Vt;if(K._startClamp=K._endClamp=!1,K._dir=I,E*=45,K.scroller=W,K.scroll=N?N.time.bind(N):be,At=be(),K.vars=n,i=i||n.animation,"refreshPriority"in n&&(Jk=1,n.refreshPriority===-9999&&(ax=K)),Z.tweenScroll=Z.tweenScroll||{top:uO(W,ir),left:uO(W,Fa)},K.tweenTo=je=Z.tweenScroll[I.p],K.scrubDuration=function(It){Re=By(It)&&It,Re?le?le.duration(It):le=en.to(i,{ease:"expo",totalProgress:"+=0",inherit:!1,duration:Re,paused:!0,onComplete:function(){return b&&b(K)}}):(le&&le.progress(1).kill(),le=0)},i&&(i.vars.lazy=!1,i._initted&&!K.isReverted||i.vars.immediateRender!==!1&&n.immediateRender!==!1&&i.duration()&&i.render(0,!0,!0),K.animation=i.pause(),i.scrollTrigger=K,K.scrubDuration(p),Ce=0,c||(c=i.vars.id)),D&&((!ap(D)||D.push)&&(D={snapTo:D}),"scrollBehavior"in wi.style&&en.set(te?[wi,Bo]:W,{scrollBehavior:"auto"}),Jn.forEach(function(It){return oa(It)&&It.target===(te?Wi.scrollingElement||Bo:W)&&(It.smooth=!1)}),St=oa(D.snapTo)?D.snapTo:D.snapTo==="labels"?CZ(i):D.snapTo==="labelsDirectional"?RZ(i):D.directional!==!1?function(It,pn){return KL(D.snapTo)(It,ra()-Be<500?0:pn.direction)}:en.utils.snap(D.snapTo),ht=D.duration||{min:.1,max:2},ht=ap(ht)?tx(ht.min,ht.max):tx(ht,ht),yt=en.delayedCall(D.delay||Re/2||.1,function(){var It=be(),pn=ra()-Be<500,Wt=je.tween;if((pn||Math.abs(K.getVelocity())<10)&&!Wt&&!wT&&_e!==It){var $t=(It-vt)/it,ai=i&&!z?i.totalProgress():$t,hn=pn?0:(ai-tt)/(ra()-Ly)*1e3||0,Yt=en.utils.clamp(-$t,1-$t,D0(hn/2)*hn/.185),Xn=$t+(D.inertia===!1?0:Yt),Jt,V,$=D,me=$.onStart,De=$.onInterrupt,Ye=$.onComplete;if(Jt=St(Xn,K),By(Jt)||(Jt=Xn),V=Math.max(0,Math.round(vt+Jt*it)),It<=ze&&It>=vt&&V!==It){if(Wt&&!Wt._initted&&Wt.data<=D0(V-It))return;D.inertia===!1&&(Yt=Jt-$t),je(V,{duration:ht(D0(Math.max(D0(Xn-ai),D0(Jt-ai))*.185/hn/.05||0)),ease:D.ease||"power3",data:D0(V-It),onInterrupt:function(){return yt.restart(!0)&&De&&De(K)},onComplete:function(){K.update(),_e=be(),i&&!z&&(le?le.resetTo("totalProgress",Jt,i._tTime/i._tDur):i.progress(Jt)),Ce=tt=i&&!z?i.totalProgress():K.progress,T&&T(K),Ye&&Ye(K)}},It,Yt*it,V-It-Yt*it),me&&me(K,je.tween)}}else K.isActive&&_e!==It&&yt.restart(!0)}).pause()),c&&(GR[c]=K),v=K.trigger=no(v||y!==!0&&y),Vt=v&&v._gsap&&v._gsap.stRevert,Vt&&(Vt=Vt(K)),y=y===!0?v:no(y),wo(o)&&(o={targets:v,className:o}),y&&(x===!1||x===hl||(x=!x&&y.parentNode&&y.parentNode.style&&dl(y.parentNode).display==="flex"?!1:Ys),K.pin=y,gt=en.core.getCache(y),gt.spacer?Tt=gt.pinState:(O&&(O=no(O),O&&!O.nodeType&&(O=O.current||O.nativeElement),gt.spacerIsNative=!!O,O&&(gt.spacerState=qA(O))),gt.spacer=Ee=O||Wi.createElement("div"),Ee.classList.add("pin-spacer"),c&&Ee.classList.add("pin-spacer-"+c),gt.pinState=Tt=qA(y)),n.force3D!==!1&&en.set(y,{force3D:!0}),K.spacer=Ee=gt.spacer,he=dl(y),Ft=he[x+I.os2],Ve=en.getProperty(y),Pe=en.quickSetter(y,I.a,er),AC(y,Ee,he),q=qA(y)),J){$e=ap(J)?iO(J,sO):sO,ue=KA("scroller-start",c,W,I,$e,0),st=KA("scroller-end",c,W,I,$e,0,ue),Ge=ue["offset"+I.op.d2];var En=no(Dh(W,"content")||W);ie=this.markerStart=KA("start",c,En,I,$e,Ge,0,N),Oe=this.markerEnd=KA("end",c,En,I,$e,Ge,0,N),N&&(Rt=en.quickSetter([ie,Oe],I.a,er)),!re&&!(ru.length&&Dh(W,"fixedMarkers")===!0)&&(MZ(te?wi:W),en.set([ue,st],{force3D:!0}),Ze=en.quickSetter(ue,I.a,er),Nt=en.quickSetter(st,I.a,er))}if(N){var Dt=N.vars.onUpdate,Ut=N.vars.onUpdateParams;N.eventCallback("onUpdate",function(){K.update(0,0,1),Dt&&Dt.apply(N,Ut||[])})}if(K.previous=function(){return Vn[Vn.indexOf(K)-1]},K.next=function(){return Vn[Vn.indexOf(K)+1]},K.revert=function(It,pn){if(!pn)return K.kill(!0);var Wt=It!==!1||!K.enabled,$t=ia;Wt!==K.isReverted&&(Wt&&(ut=Math.max(be(),K.scroll.rec||0),pe=K.progress,Qe=i&&i.progress()),ie&&[ie,Oe,ue,st].forEach(function(ai){return ai.style.display=Wt?"none":"block"}),Wt&&(ia=K,K.update(Wt)),y&&(!P||!K.isActive)&&(Wt?wZ(y,Ee,Tt):AC(y,Ee,dl(y),Mt)),Wt||K.update(Wt),ia=$t,K.isReverted=Wt)},K.refresh=function(It,pn,Wt,$t){if(!((ia||!K.enabled)&&!pn)){if(y&&It&&Sl){Ar(r,"scrollEnd",o4);return}!Oa&&X&&X(K),ia=K,je.tween&&!Wt&&(je.tween.kill(),je.tween=0),le&&le.pause(),S&&i&&(i.revert({kill:!1}).invalidate(),i.getChildren&&i.getChildren(!0,!0,!1).forEach(function(Bt){return Bt.vars.immediateRender&&Bt.render(0,!0,!0)})),K.isReverted||K.revert(!0,!0),K._subPinOffset=!1;var ai=ne(),hn=xe(),Yt=N?N.duration():iu(W,I),Xn=it<=.01||!it,Jt=0,V=$t||0,$=ap(Wt)?Wt.end:n.end,me=n.endTrigger||v,De=ap(Wt)?Wt.start:n.start||(n.start===0||!v?0:y?"0 0":"0 100%"),Ye=K.pinnedContainer=n.pinnedContainer&&no(n.pinnedContainer,K),Xe=v&&Math.max(0,Vn.indexOf(K))||0,dt=Xe,rt,ct,Y,ce,fe,Se,de,Ke,et,pt,xt,Lt,Pt;for(J&&ap(Wt)&&(Lt=en.getProperty(ue,I.p),Pt=en.getProperty(st,I.p));dt-- >0;)Se=Vn[dt],Se.end||Se.refresh(0,1)||(ia=K),de=Se.pin,de&&(de===v||de===y||de===Ye)&&!Se.isReverted&&(pt||(pt=[]),pt.unshift(Se),Se.revert(!0,!0)),Se!==Vn[dt]&&(Xe--,dt--);for(oa(De)&&(De=De(K)),De=ZB(De,"start",K),vt=lO(De,v,ai,I,be(),ie,ue,K,hn,oe,re,Yt,N,K._startClamp&&"_startClamp")||(y?-.001:0),oa($)&&($=$(K)),wo($)&&!$.indexOf("+=")&&(~$.indexOf(" ")?$=(wo(De)?De.split(" ")[0]:"")+$:(Jt=pE($.substr(2),ai),$=wo(De)?De:(N?en.utils.mapRange(0,N.duration(),N.scrollTrigger.start,N.scrollTrigger.end,vt):vt)+Jt,me=v)),$=ZB($,"end",K),ze=Math.max(vt,lO($||(me?"100% 0":Yt),me,ai,I,be()+Jt,Oe,st,K,hn,oe,re,Yt,N,K._endClamp&&"_endClamp"))||-.001,Jt=0,dt=Xe;dt--;)Se=Vn[dt],de=Se.pin,de&&Se.start-Se._pinPush<=vt&&!N&&Se.end>0&&(rt=Se.end-(K._startClamp?Math.max(0,Se.start):Se.start),(de===v&&Se.start-Se._pinPush<vt||de===Ye)&&isNaN(De)&&(Jt+=rt*(1-Se.progress)),de===y&&(V+=rt));if(vt+=Jt,ze+=Jt,K._startClamp&&(K._startClamp+=Jt),K._endClamp&&!Oa&&(K._endClamp=ze||-.001,ze=Math.min(ze,iu(W,I))),it=ze-vt||(vt-=.01)&&.001,Xn&&(pe=en.utils.clamp(0,1,en.utils.normalize(vt,ze,ut))),K._pinPush=V,ie&&Jt&&(rt={},rt[I.a]="+="+Jt,Ye&&(rt[I.p]="-="+be()),en.set([ie,Oe],rt)),y&&!(kR&&K.end>=iu(W,I)))rt=dl(y),ce=I===ir,Y=be(),wt=parseFloat(Ve(I.a))+V,!Yt&&ze>1&&(xt=(te?Wi.scrollingElement||Bo:W).style,xt={style:xt,value:xt["overflow"+I.a.toUpperCase()]},te&&dl(wi)["overflow"+I.a.toUpperCase()]!=="scroll"&&(xt.style["overflow"+I.a.toUpperCase()]="scroll")),AC(y,Ee,rt),q=qA(y),ct=of(y,!0),Ke=re&&Fh(W,ce?Fa:ir)(),x?(Mt=[x+I.os2,it+V+er],Mt.t=Ee,dt=x===Ys?Ob(y,I)+it+V:0,dt&&(Mt.push(I.d,dt+er),Ee.style.flexBasis!=="auto"&&(Ee.style.flexBasis=dt+er)),$0(Mt),Ye&&Vn.forEach(function(Bt){Bt.pin===Ye&&Bt.vars.pinSpacing!==!1&&(Bt._subPinOffset=!0)}),re&&be(ut)):(dt=Ob(y,I),dt&&Ee.style.flexBasis!=="auto"&&(Ee.style.flexBasis=dt+er)),re&&(fe={top:ct.top+(ce?Y-vt:Ke)+er,left:ct.left+(ce?Ke:Y-vt)+er,boxSizing:"border-box",position:"fixed"},fe[Mp]=fe["max"+Eg]=Math.ceil(ct.width)+er,fe[Cp]=fe["max"+XL]=Math.ceil(ct.height)+er,fe[hl]=fe[hl+sx]=fe[hl+nx]=fe[hl+rx]=fe[hl+ix]="0",fe[Ys]=rt[Ys],fe[Ys+sx]=rt[Ys+sx],fe[Ys+nx]=rt[Ys+nx],fe[Ys+rx]=rt[Ys+rx],fe[Ys+ix]=rt[Ys+ix],se=BZ(Tt,fe,P),Oa&&be(0)),i?(et=i._initted,vC(1),i.render(i.duration(),!0,!0),bt=Ve(I.a)-wt+it+V,Je=Math.abs(it-bt)>1,re&&Je&&se.splice(se.length-2,2),i.render(0,!0,!0),et||i.invalidate(!0),i.parent||i.totalTime(i.totalTime()),vC(0)):bt=it,xt&&(xt.value?xt.style["overflow"+I.a.toUpperCase()]=xt.value:xt.style.removeProperty("overflow-"+I.a));else if(v&&be()&&!N)for(ct=v.parentNode;ct&&ct!==wi;)ct._pinOffset&&(vt-=ct._pinOffset,ze-=ct._pinOffset),ct=ct.parentNode;pt&&pt.forEach(function(Bt){return Bt.revert(!1,!0)}),K.start=vt,K.end=ze,At=jt=Oa?ut:be(),!N&&!Oa&&(At<ut&&be(ut),K.scroll.rec=0),K.revert(!1,!0),Be=ra(),yt&&(_e=-1,yt.restart(!0)),ia=0,i&&z&&(i._initted||Qe)&&i.progress()!==Qe&&i.progress(Qe||0,!0).render(i.time(),!0,!0),(Xn||pe!==K.progress||N||S||i&&!i._initted)&&(i&&!z&&(i._initted||pe||i.vars.immediateRender!==!1)&&i.totalProgress(N&&vt<-.001&&!pe?en.utils.normalize(vt,ze,0):pe,!0),K.progress=Xn||(At-vt)/it===pe?0:pe),y&&x&&(Ee._pinOffset=Math.round(K.progress*bt)),le&&le.invalidate(),isNaN(Lt)||(Lt-=en.getProperty(ue,I.p),Pt-=en.getProperty(st,I.p),jA(ue,I,Lt),jA(ie,I,Lt-($t||0)),jA(st,I,Pt),jA(Oe,I,Pt-($t||0))),Xn&&!Oa&&K.update(),h&&!Oa&&!_t&&(_t=!0,h(K),_t=!1)}},K.getVelocity=function(){return(be()-jt)/(ra()-Ly)*1e3||0},K.endAnimation=function(){Ay(K.callbackAnimation),i&&(le?le.progress(1):i.paused()?z||Ay(i,K.direction<0,1):Ay(i,i.reversed()))},K.labelToScroll=function(It){return i&&i.labels&&(vt||K.refresh()||vt)+i.labels[It]/i.duration()*it||0},K.getTrailing=function(It){var pn=Vn.indexOf(K),Wt=K.direction>0?Vn.slice(0,pn).reverse():Vn.slice(pn+1);return(wo(It)?Wt.filter(function($t){return $t.vars.preventOverlaps===It}):Wt).filter(function($t){return K.direction>0?$t.end<=vt:$t.start>=ze})},K.update=function(It,pn,Wt){if(!(N&&!Wt&&!It)){var $t=Oa===!0?ut:K.scroll(),ai=It?0:($t-vt)/it,hn=ai<0?0:ai>1?1:ai||0,Yt=K.progress,Xn,Jt,V,$,me,De,Ye,Xe;if(pn&&(jt=At,At=N?be():$t,D&&(tt=Ce,Ce=i&&!z?i.totalProgress():hn)),E&&y&&!ia&&!HA&&Sl&&(!hn&&vt<$t+($t-jt)/(ra()-Ly)*E?hn=1e-4:hn===1&&ze>$t+($t-jt)/(ra()-Ly)*E&&(hn=.9999)),hn!==Yt&&K.enabled){if(Xn=K.isActive=!!hn&&hn<1,Jt=!!Yt&&Yt<1,De=Xn!==Jt,me=De||!!hn!=!!Yt,K.direction=hn>Yt?1:-1,K.progress=hn,me&&!ia&&(V=hn&&!Yt?0:hn===1?1:Yt===1?2:3,z&&($=!De&&j[V+1]!=="none"&&j[V+1]||j[V],Xe=i&&($==="complete"||$==="reset"||$ in i))),B&&(De||Xe)&&(Xe||p||!i)&&(oa(B)?B(K):K.getTrailing(B).forEach(function(Y){return Y.endAnimation()})),z||(le&&!ia&&!HA?(le._dp._time-le._start!==le._time&&le.render(le._dp._time-le._start),le.resetTo?le.resetTo("totalProgress",hn,i._tTime/i._tDur):(le.vars.totalProgress=hn,le.invalidate().restart())):i&&i.totalProgress(hn,!!(ia&&(Be||It)))),y){if(It&&x&&(Ee.style[x+I.os2]=Ft),!re)Pe(Iy(wt+bt*hn));else if(me){if(Ye=!It&&hn>Yt&&ze+1>$t&&$t+1>=iu(W,I),P)if(!It&&(Xn||Ye)){var dt=of(y,!0),rt=$t-vt;cO(y,wi,dt.top+(I===ir?rt:0)+er,dt.left+(I===ir?0:rt)+er)}else cO(y,Ee);$0(Xn||Ye?se:q),Je&&hn<1&&Xn||Pe(wt+(hn===1&&!Ye?bt:0))}}D&&!je.tween&&!ia&&!HA&&yt.restart(!0),o&&(De||R&&hn&&(hn<1||!yC))&&Ix(o.targets).forEach(function(Y){return Y.classList[Xn||R?"add":"remove"](o.className)}),a&&!z&&!It&&a(K),me&&!ia?(z&&(Xe&&($==="complete"?i.pause().totalProgress(1):$==="reset"?i.restart(!0).pause():$==="restart"?i.restart(!0):i[$]()),a&&a(K)),(De||!yC)&&(u&&De&&_C(K,u),k[V]&&_C(K,k[V]),R&&(hn===1?K.kill(!1,1):k[V]=0),De||(V=hn===1?1:3,k[V]&&_C(K,k[V]))),U&&!Xn&&Math.abs(K.getVelocity())>(By(U)?U:2500)&&(Ay(K.callbackAnimation),le?le.progress(1):Ay(i,$==="reverse"?1:!hn,1))):z&&a&&!ia&&a(K)}if(Nt){var ct=N?$t/N.duration()*(N._caScrollDist||0):$t;Ze(ct+(ue._isFlipped?1:0)),Nt(ct)}Rt&&Rt(-$t/N.duration()*(N._caScrollDist||0))}},K.enable=function(It,pn){K.enabled||(K.enabled=!0,Ar(W,"resize",Oy),te||Ar(W,"scroll",L0),X&&Ar(r,"refreshInit",X),It!==!1&&(K.progress=pe=0,At=jt=_e=be()),pn!==!1&&K.refresh())},K.getTween=function(It){return It&&je?je.tween:le},K.setPositions=function(It,pn,Wt,$t){if(N){var ai=N.scrollTrigger,hn=N.duration(),Yt=ai.end-ai.start;It=ai.start+Yt*It/hn,pn=ai.start+Yt*pn/hn}K.refresh(!1,!1,{start:eO(It,Wt&&!!K._startClamp),end:eO(pn,Wt&&!!K._endClamp)},$t),K.update()},K.adjustPinSpacing=function(It){if(Mt&&It){var pn=Mt.indexOf(I.d)+1;Mt[pn]=parseFloat(Mt[pn])+It+er,Mt[1]=parseFloat(Mt[1])+It+er,$0(Mt)}},K.disable=function(It,pn){if(K.enabled&&(It!==!1&&K.revert(!0,!0),K.enabled=K.isActive=!1,pn||le&&le.pause(),ut=0,gt&&(gt.uncache=1),X&&Sr(r,"refreshInit",X),yt&&(yt.pause(),je.tween&&je.tween.kill()&&(je.tween=0)),!te)){for(var Wt=Vn.length;Wt--;)if(Vn[Wt].scroller===W&&Vn[Wt]!==K)return;Sr(W,"resize",Oy),te||Sr(W,"scroll",L0)}},K.kill=function(It,pn){K.disable(It,pn),le&&!pn&&le.kill(),c&&delete GR[c];var Wt=Vn.indexOf(K);Wt>=0&&Vn.splice(Wt,1),Wt===Ba&&gE>0&&Ba--,Wt=0,Vn.forEach(function($t){return $t.scroller===K.scroller&&(Wt=1)}),Wt||Oa||(K.scroll.rec=0),i&&(i.scrollTrigger=null,It&&i.revert({kill:!1}),pn||i.kill()),ie&&[ie,Oe,ue,st].forEach(function($t){return $t.parentNode&&$t.parentNode.removeChild($t)}),ax===K&&(ax=0),y&&(gt&&(gt.uncache=1),Wt=0,Vn.forEach(function($t){return $t.pin===y&&Wt++}),Wt||(gt.spacer=0)),n.onKill&&n.onKill(K)},Vn.push(K),K.enable(!1,!1),Vt&&Vt(K),i&&i.add&&!it){var dn=K.update;K.update=function(){K.update=dn,Jn.cache++,vt||ze||K.refresh()},en.delayedCall(.01,K.update),it=.01,vt=ze=0}else K.refresh();y&&LZ()},r.register=function(n){return I0||(en=n||t4(),e4()&&window.document&&r.enable(),I0=wy),I0},r.defaults=function(n){if(n)for(var i in n)XA[i]=n[i];return XA},r.disable=function(n,i){wy=0,Vn.forEach(function(a){return a[i?"kill":"disable"](n)}),Sr(Wn,"wheel",L0),Sr(Wi,"scroll",L0),clearInterval(GA),Sr(Wi,"touchcancel",$c),Sr(wi,"touchstart",$c),VA(Sr,Wi,"pointerdown,touchstart,mousedown",tO),VA(Sr,Wi,"pointerup,touchend,mouseup",nO),Ib.kill(),zA(Sr);for(var s=0;s<Jn.length;s+=3)YA(Sr,Jn[s],Jn[s+1]),YA(Sr,Jn[s],Jn[s+2])},r.enable=function(){if(Wn=window,Wi=document,Bo=Wi.documentElement,wi=Wi.body,en&&(Ix=en.utils.toArray,tx=en.utils.clamp,FR=en.core.context||$c,vC=en.core.suppressOverwrites||$c,HL=Wn.history.scrollRestoration||"auto",HR=Wn.pageYOffset||0,en.core.globals("ScrollTrigger",r),wi)){wy=1,J0=document.createElement("div"),J0.style.height="100vh",J0.style.position="absolute",u4(),EZ(),Us.register(en),r.isTouch=Us.isTouch,ph=Us.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),UR=Us.isTouch===1,Ar(Wn,"wheel",L0),GL=[Wn,Wi,Bo,wi],en.matchMedia?(r.matchMedia=function(u){var h=en.matchMedia(),p;for(p in u)h.add(p,u[p]);return h},en.addEventListener("matchMediaInit",function(){return qL()}),en.addEventListener("matchMediaRevert",function(){return l4()}),en.addEventListener("matchMedia",function(){gp(0,1),Hp("matchMedia")}),en.matchMedia().add("(orientation: portrait)",function(){return SC(),SC})):console.warn("Requires GSAP 3.11.0 or later"),SC(),Ar(Wi,"scroll",L0);var n=wi.hasAttribute("style"),i=wi.style,s=i.borderTopStyle,a=en.core.Animation.prototype,o,c;for(a.revert||Object.defineProperty(a,"revert",{value:function(){return this.time(-.01,!0)}}),i.borderTopStyle="solid",o=of(wi),ir.m=Math.round(o.top+ir.sc())||0,Fa.m=Math.round(o.left+Fa.sc())||0,s?i.borderTopStyle=s:i.removeProperty("border-top-style"),n||(wi.setAttribute("style",""),wi.removeAttribute("style")),GA=setInterval(rO,250),en.delayedCall(.5,function(){return HA=0}),Ar(Wi,"touchcancel",$c),Ar(wi,"touchstart",$c),VA(Ar,Wi,"pointerdown,touchstart,mousedown",tO),VA(Ar,Wi,"pointerup,touchend,mouseup",nO),NR=en.utils.checkPrefix("transform"),vE.push(NR),I0=ra(),Ib=en.delayedCall(.2,gp).pause(),B0=[Wi,"visibilitychange",function(){var u=Wn.innerWidth,h=Wn.innerHeight;Wi.hidden?($B=u,QB=h):($B!==u||QB!==h)&&Oy()},Wi,"DOMContentLoaded",gp,Wn,"load",gp,Wn,"resize",Oy],zA(Ar),Vn.forEach(function(u){return u.enable(0,1)}),c=0;c<Jn.length;c+=3)YA(Sr,Jn[c],Jn[c+1]),YA(Sr,Jn[c],Jn[c+2])}},r.config=function(n){"limitCallbacks"in n&&(yC=!!n.limitCallbacks);var i=n.syncInterval;i&&clearInterval(GA)||(GA=i)&&setInterval(rO,i),"ignoreMobileResize"in n&&(UR=r.isTouch===1&&n.ignoreMobileResize),"autoRefreshEvents"in n&&(zA(Sr)||zA(Ar,n.autoRefreshEvents||"none"),$k=(n.autoRefreshEvents+"").indexOf("resize")===-1)},r.scrollerProxy=function(n,i){var s=no(n),a=Jn.indexOf(s),o=kp(s);~a&&Jn.splice(a,o?6:2),i&&(o?ru.unshift(Wn,i,wi,i,Bo,i):ru.unshift(s,i))},r.clearMatchMedia=function(n){Vn.forEach(function(i){return i._ctx&&i._ctx.query===n&&i._ctx.kill(!0,!0)})},r.isInViewport=function(n,i,s){var a=(wo(n)?no(n):n).getBoundingClientRect(),o=a[s?Mp:Cp]*i||0;return s?a.right-o>0&&a.left+o<Wn.innerWidth:a.bottom-o>0&&a.top+o<Wn.innerHeight},r.positionInViewport=function(n,i,s){wo(n)&&(n=no(n));var a=n.getBoundingClientRect(),o=a[s?Mp:Cp],c=i==null?o/2:i in Pb?Pb[i]*o:~i.indexOf("%")?parseFloat(i)*o/100:parseFloat(i)||0;return s?(a.left+c)/Wn.innerWidth:(a.top+c)/Wn.innerHeight},r.killAll=function(n){if(Vn.slice(0).forEach(function(s){return s.vars.id!=="ScrollSmoother"&&s.kill()}),n!==!0){var i=Gp.killAll||[];Gp={},i.forEach(function(s){return s()})}},r})();ti.version="3.13.0";ti.saveStyles=function(r){return r?Ix(r).forEach(function(e){if(e&&e.style){var t=Lo.indexOf(e);t>=0&&Lo.splice(t,5),Lo.push(e,e.style.cssText,e.getBBox&&e.getAttribute("transform"),en.core.getCache(e),FR())}}):Lo};ti.revert=function(r,e){return qL(!r,e)};ti.create=function(r,e){return new ti(r,e)};ti.refresh=function(r){return r?Oy(!0):(I0||ti.register())&&gp(!0)};ti.update=function(r){return++Jn.cache&&df(r===!0?2:0)};ti.clearScrollMemory=c4;ti.maxScroll=function(r,e){return iu(r,e?Fa:ir)};ti.getScrollFunc=function(r,e){return Fh(no(r),e?Fa:ir)};ti.getById=function(r){return GR[r]};ti.getAll=function(){return Vn.filter(function(r){return r.vars.id!=="ScrollSmoother"})};ti.isScrolling=function(){return!!Sl};ti.snapDirectional=KL;ti.addEventListener=function(r,e){var t=Gp[r]||(Gp[r]=[]);~t.indexOf(e)||t.push(e)};ti.removeEventListener=function(r,e){var t=Gp[r],n=t&&t.indexOf(e);n>=0&&t.splice(n,1)};ti.batch=function(r,e){var t=[],n={},i=e.interval||.016,s=e.batchMax||1e9,a=function(u,h){var p=[],v=[],y=en.delayedCall(i,function(){h(p,v),p=[],v=[]}).pause();return function(x){p.length||y.restart(!0),p.push(x.trigger),v.push(x),s<=p.length&&y.progress(1)}},o;for(o in e)n[o]=o.substr(0,2)==="on"&&oa(e[o])&&o!=="onRefreshInit"?a(o,e[o]):e[o];return oa(s)&&(s=s(),Ar(ti,"refresh",function(){return s=e.batchMax()})),Ix(r).forEach(function(c){var u={};for(o in n)u[o]=n[o];u.trigger=c,t.push(ti.create(u))}),t};var fO=function(e,t,n,i){return t>i?e(i):t<0&&e(0),n>i?(i-t)/(n-t):n<0?t/(t-n):1},EC=function r(e,t){t===!0?e.style.removeProperty("touch-action"):e.style.touchAction=t===!0?"auto":t?"pan-"+t+(Us.isTouch?" pinch-zoom":""):"none",e===Bo&&r(wi,t)},WA={auto:1,scroll:1},PZ=function(e){var t=e.event,n=e.target,i=e.axis,s=(t.changedTouches?t.changedTouches[0]:t).target,a=s._gsap||en.core.getCache(s),o=ra(),c;if(!a._isScrollT||o-a._isScrollT>2e3){for(;s&&s!==wi&&(s.scrollHeight<=s.clientHeight&&s.scrollWidth<=s.clientWidth||!(WA[(c=dl(s)).overflowY]||WA[c.overflowX]));)s=s.parentNode;a._isScroll=s&&s!==n&&!kp(s)&&(WA[(c=dl(s)).overflowY]||WA[c.overflowX]),a._isScrollT=o}(a._isScroll||i==="x")&&(t.stopPropagation(),t._gsapAllow=!0)},h4=function(e,t,n,i){return Us.create({target:e,capture:!0,debounce:!1,lockAxis:!0,type:t,onWheel:i=i&&PZ,onPress:i,onDrag:i,onScroll:i,onEnable:function(){return n&&Ar(Wi,Us.eventTypes[0],dO,!1,!0)},onDisable:function(){return Sr(Wi,Us.eventTypes[0],dO,!0)}})},NZ=/(input|label|select|textarea)/i,hO,dO=function(e){var t=NZ.test(e.target.tagName);(t||hO)&&(e._gsapAllow=!0,hO=t)},UZ=function(e){ap(e)||(e={}),e.preventDefault=e.isNormalizer=e.allowClicks=!0,e.type||(e.type="wheel,touch"),e.debounce=!!e.debounce,e.id=e.id||"normalizer";var t=e,n=t.normalizeScrollX,i=t.momentum,s=t.allowNestedScroll,a=t.onRelease,o,c,u=no(e.target)||Bo,h=en.core.globals().ScrollSmoother,p=h&&h.get(),v=ph&&(e.content&&no(e.content)||p&&e.content!==!1&&!p.smooth()&&p.content()),y=Fh(u,ir),x=Fh(u,Fa),S=1,E=(Us.isTouch&&Wn.visualViewport?Wn.visualViewport.scale*Wn.visualViewport.width:Wn.outerWidth)/Wn.innerWidth,b=0,T=oa(i)?function(){return i(o)}:function(){return i||2.8},R,D,P=h4(u,e.type,!0,s),O=function(){return D=!1},N=$c,U=$c,B=function(){c=iu(u,ir),U=tx(ph?1:0,c),n&&(N=tx(0,iu(u,Fa))),R=Rp},I=function(){v._gsap.y=Iy(parseFloat(v._gsap.y)+y.offset)+"px",v.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(v._gsap.y)+", 0, 1)",y.offset=y.cacheID=0},z=function(){if(D){requestAnimationFrame(O);var J=Iy(o.deltaY/2),oe=U(y.v-J);if(v&&oe!==y.v+y.offset){y.offset=oe-y.v;var K=Iy((parseFloat(v&&v._gsap.y)||0)-y.offset);v.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+K+", 0, 1)",v._gsap.y=K+"px",y.cacheID=Jn.cache,df()}return!0}y.offset&&I(),D=!0},W,Z,te,re,k=function(){B(),W.isActive()&&W.vars.scrollY>c&&(y()>c?W.progress(1)&&y(c):W.resetTo("scrollY",c))};return v&&en.set(v,{y:"+=0"}),e.ignoreCheck=function(j){return ph&&j.type==="touchmove"&&z()||S>1.05&&j.type!=="touchstart"||o.isGesturing||j.touches&&j.touches.length>1},e.onPress=function(){D=!1;var j=S;S=Iy((Wn.visualViewport&&Wn.visualViewport.scale||1)/E),W.pause(),j!==S&&EC(u,S>1.01?!0:n?!1:"x"),Z=x(),te=y(),B(),R=Rp},e.onRelease=e.onGestureStart=function(j,J){if(y.offset&&I(),!J)re.restart(!0);else{Jn.cache++;var oe=T(),K,X;n&&(K=x(),X=K+oe*.05*-j.velocityX/.227,oe*=fO(x,K,X,iu(u,Fa)),W.vars.scrollX=N(X)),K=y(),X=K+oe*.05*-j.velocityY/.227,oe*=fO(y,K,X,iu(u,ir)),W.vars.scrollY=U(X),W.invalidate().duration(oe).play(.01),(ph&&W.vars.scrollY>=c||K>=c-1)&&en.to({},{onUpdate:k,duration:oe})}a&&a(j)},e.onWheel=function(){W._ts&&W.pause(),ra()-b>1e3&&(R=0,b=ra())},e.onChange=function(j,J,oe,K,X){if(Rp!==R&&B(),J&&n&&x(N(K[2]===J?Z+(j.startX-j.x):x()+J-K[1])),oe){y.offset&&I();var ne=X[2]===oe,xe=ne?te+j.startY-j.y:y()+oe-X[1],_e=U(xe);ne&&xe!==_e&&(te+=_e-xe),y(_e)}(oe||J)&&df()},e.onEnable=function(){EC(u,n?!1:"x"),ti.addEventListener("refresh",k),Ar(Wn,"resize",k),y.smooth&&(y.target.style.scrollBehavior="auto",y.smooth=x.smooth=!1),P.enable()},e.onDisable=function(){EC(u,!0),Sr(Wn,"resize",k),ti.removeEventListener("refresh",k),P.kill()},e.lockAxis=e.lockAxis!==!1,o=new Us(e),o.iOS=ph,ph&&!y()&&y(1),ph&&en.ticker.add($c),re=o._dc,W=en.to(o,{ease:"power4",paused:!0,inherit:!1,scrollX:n?"+=0.1":"+=0",scrollY:"+=0.1",modifiers:{scrollY:f4(y,y(),function(){return W.pause()})},onUpdate:df,onComplete:re.vars.onComplete}),o};ti.sort=function(r){if(oa(r))return Vn.sort(r);var e=Wn.pageYOffset||0;return ti.getAll().forEach(function(t){return t._sortY=t.trigger?e+t.trigger.getBoundingClientRect().top:t.start+Wn.innerHeight}),Vn.sort(r||function(t,n){return(t.vars.refreshPriority||0)*-1e6+(t.vars.containerAnimation?1e6:t._sortY)-((n.vars.containerAnimation?1e6:n._sortY)+(n.vars.refreshPriority||0)*-1e6)})};ti.observe=function(r){return new Us(r)};ti.normalizeScroll=function(r){if(typeof r>"u")return Ia;if(r===!0&&Ia)return Ia.enable();if(r===!1){Ia&&Ia.kill(),Ia=r;return}var e=r instanceof Us?r:UZ(r);return Ia&&Ia.target===e.target&&Ia.kill(),kp(e.target)&&(Ia=e),e};ti.core={_getVelocityProp:PR,_inputObserver:h4,_scrollers:Jn,_proxies:ru,bridge:{ss:function(){Sl||Hp("scrollStart"),Sl=ra()},ref:function(){return ia}}};t4()&&en.registerPlugin(ti);const FZ=()=>{const r=t_({query:"(max-width: 1024px)"});return qp(()=>{r||uc.timeline({scrollTrigger:{trigger:"#showcase",start:"top top",end:"bottom top",scrub:!0,pin:!0}}).to(".mask img",{transform:"scale(1.1)"}).to(".content",{opacity:1,y:0,ease:"power1.in"})},[r]),ye.jsxs("section",{id:"showcase",children:[ye.jsxs("div",{className:"media",children:[ye.jsx("video",{src:"/videos/game.mp4",loop:!0,muted:!0,autoPlay:!0,playsInline:!0}),ye.jsx("div",{className:"mask",children:ye.jsx("img",{src:"/mask-logo.svg"})})]}),ye.jsx("div",{className:"content",children:ye.jsxs("div",{className:"wrapper",children:[ye.jsxs("div",{className:"lg:max-w-md",children:[ye.jsx("h2",{children:"Rocket Chip"}),ye.jsxs("div",{className:"space-y-5 mt-7 pe-10",children:[ye.jsxs("p",{children:["Introducing "," ",ye.jsx("span",{className:"text-white",children:"M4, the next generation of Apple silicon"}),". M4 powers"]}),ye.jsx("p",{children:"It drives Apple Intelligence on iPad Pro, so you can write, create, and accomplish more with ease. All in a design thats unbelievably thin, light, and powerful."}),ye.jsx("p",{children:"A brand-new display engine delivers breathtaking precision, color accuracy, and brightness. And a next-gen GPU with hardware-accelerated ray tracing brings console-level graphics to your fingertips."}),ye.jsx("p",{className:"text-primary",children:"Learn more about Apple Intelligence"})]})]}),ye.jsxs("div",{className:"max-w-3xs space-y-14",children:[ye.jsxs("div",{className:"space-y-2",children:[ye.jsx("p",{children:"Up to"}),ye.jsx("h3",{children:"4x faster"}),ye.jsx("p",{children:"pro rendering performance than M2"})]}),ye.jsxs("div",{className:"space-y-2",children:[ye.jsx("p",{children:"Up to"}),ye.jsx("h3",{children:"1.5x faster"}),ye.jsx("p",{children:"CPU performance than M2"})]})]})]})})]})},kZ=()=>{const r=t_({query:"(max-width: 1024px)"}),e=Fe.useRef(null);return qp(()=>{const t=e.current;if(!t||(uc.fromTo(".content p",{opacity:0,y:10},{opacity:1,y:0,ease:"power1.out",scrollTrigger:{trigger:".content p",start:"top bottom",end:"top center",scrub:!0,invalidateOnRefresh:!0}}),r))return;const n=uc.timeline({defaults:{duration:2,ease:"power1.inOut",overwrite:"auto"},scrollTrigger:{trigger:t,start:"top bottom",end:"bottom top",scrub:1,invalidateOnRefresh:!0}});pG.forEach(i=>{if(i.id==="p5")return;const s=`.${i.id}`,a={};typeof i.left=="number"&&(a.left=`${i.left}%`),typeof i.right=="number"&&(a.right=`${i.right}%`),typeof i.bottom=="number"&&(a.bottom=`${i.bottom}%`),i.transform&&(a.transform=i.transform),n.to(s,a,0)})},{scope:e,dependencies:[r]}),ye.jsxs("section",{id:"performance",ref:e,children:[ye.jsx("h2",{children:"Next-level graphics performance. Game on."}),ye.jsx("div",{className:"wrapper",children:dG.map((t,n)=>ye.jsx("img",{src:t.src,className:t.id,alt:t.alt||`Performance Image #${n+1}`},n))}),ye.jsx("div",{className:"content",children:ye.jsxs("p",{children:["Run graphics-intensive workflows with a responsiveness that keeps up with your imagination. The M4 family of chips features a GPU with a second-generation hardware-accelerated ray tracing engine that renders images faster, so"," ",ye.jsx("span",{className:"text-white",children:"gaming feels more immersive and realistic than ever."})," ","And Dynamic Caching optimizes fast on-chip memory to dramatically increase average GPU utilization  driving a huge performance boost for the most demanding pro apps and games."]})})]})},GZ=()=>ye.jsxs("footer",{children:[ye.jsxs("div",{className:"info",children:[ye.jsx("p",{children:"More ways to shop: Find an Apple Store or other retailer near you. Or call 000800 040 1966."}),ye.jsx("img",{src:"/logo.svg",alt:"Apple logo"})]}),ye.jsx("hr",{}),ye.jsxs("div",{className:"links",children:[ye.jsx("p",{children:"Copyright  2024 Apple Inc. All rights reserved."}),ye.jsx("ul",{children:gG.map(({label:r,link:e})=>ye.jsx("li",{children:ye.jsx("a",{href:e,children:r})},r))})]})]});function HZ(r){const{color:e,texture:t}=Tg(),{nodes:n,materials:i,scene:s}=yf("/models/macbook-transformed.glb"),a=l$(t);return Fe.useEffect(()=>{s.traverse(o=>{o.isMesh&&(VR.includes(o.name)||(o.material.color=new Ot(e)))})},[e,s]),ye.jsxs("group",{...r,dispose:null,children:[ye.jsx("mesh",{geometry:n.Object_10.geometry,material:i.PaletteMaterial001,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_16.geometry,material:i.zhGRTuGrQoJflBD,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_20.geometry,material:i.PaletteMaterial002,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_22.geometry,material:i.lmWQsEjxpsebDlK,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_30.geometry,material:i.LtEafgAVRolQqRw,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_32.geometry,material:i.iyDJFXmHelnMTbD,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_34.geometry,material:i.eJObPwhgFzvfaoZ,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_38.geometry,material:i.nDsMUuDKliqGFdU,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_42.geometry,material:i.CRQixVLpahJzhJc,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_48.geometry,material:i.YYwBgwvcyZVOOAA,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_54.geometry,material:i.SLGkCohDDelqXBu,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_58.geometry,material:i.WnHKXHhScfUbJQi,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_66.geometry,material:i.fNHiBfcxHUJCahl,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_74.geometry,material:i.LpqXZqhaGCeSzdu,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_82.geometry,material:i.gMtYExgrEUqPfln,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_96.geometry,material:i.PaletteMaterial003,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_107.geometry,material:i.JvMFZolVCdpPqjj,rotation:[Math.PI/2,0,0]}),ye.jsx("mesh",{geometry:n.Object_123.geometry,rotation:[Math.PI/2,0,0],children:ye.jsx("meshBasicMaterial",{map:a})}),ye.jsx("mesh",{geometry:n.Object_127.geometry,material:i.ZCDwChwkbBfITSW,rotation:[Math.PI/2,0,0]})]})}yf.preload("/models/macbook-transformed.glb");const zZ=()=>{const r=Fe.useRef(null),e=t_({query:"(max-width: 1024px)"}),{setTexture:t}=Tg();return Fe.useEffect(()=>{Jw.forEach(n=>{const i=document.createElement("video");Object.assign(i,{src:n.videoPath,muted:!0,playsInline:!0,preload:"auto",crossOrigin:"anonymous"}),i.load()})},[]),qp(()=>{const n=uc.timeline({scrollTrigger:{trigger:"#features",start:"top top",end:"bottom top",scrub:1,pin:!0}}),i=uc.timeline({scrollTrigger:{trigger:"#features",start:"top center",end:"bottom top",scrub:1}});r.current&&n.to(r.current.rotation,{y:Math.PI*2,ease:"power1.inOut",duration:5}),Jw.forEach((s,a)=>{const o=s.delay||a*1.5;i.call(()=>{s.videoPath&&t(s.videoPath)},[],o).to(`.box${a+1}`,{opacity:1,y:0,duration:1},o+.5)})},[]),ye.jsx("group",{ref:r,children:ye.jsx(Fe.Suspense,{fallback:ye.jsx(rX,{center:!0,children:ye.jsx("div",{className:"text-white text-xl",children:"Loading Macbook..."})}),children:ye.jsx(HZ,{scale:e?.05:.08,position:[0,-1,0]})})})},VZ=()=>ye.jsxs("section",{id:"features",className:"relative h-screen",children:[ye.jsx("h2",{className:"text-center text-4xl md:text-5xl text-white mb-10 pt-10",children:"See it all in a new light."}),ye.jsxs(IN,{id:"f-canvas",camera:{position:[0,0,5],fov:50},className:"absolute top-0 left-0 w-full h-3/4",children:[ye.jsx(FF,{}),ye.jsx("ambientLight",{intensity:.5}),ye.jsx(zZ,{})]}),ye.jsx("div",{className:"absolute inset-0 pointer-events-none mt-40",children:mG.map((r,e)=>ye.jsxs("div",{className:JA("box absolute bg-black/70 backdrop-blur-lg p-6 rounded-2xl border border-white/10 max-w-xs transition-all duration-500",`box${e+1}`,r.styles),children:[r.icon&&ye.jsx("img",{src:r.icon,alt:r.highlight,className:"w-12 h-12 mb-4"}),ye.jsxs("p",{className:"text-gray-200 text-sm leading-relaxed",children:[ye.jsx("span",{className:"text-white font-semibold text-lg block mb-1",children:r.highlight}),r.text]})]},r.id))})]}),YZ=()=>{const r=t_({query:"(max-width: 1024px)"});return qp(()=>{uc.to([".left-column",".right-column"],{scrollTrigger:{trigger:"#highlights",start:r?"bottom bottom":"top center"},y:0,opacity:1,stagger:.5,duration:1,ease:"power1.inOut"})}),ye.jsxs("section",{id:"highlights",children:[ye.jsx("h2",{children:"Theres never been a better time to upgrade."}),ye.jsx("h3",{children:"Heres what you get with the new MacBook Pro."}),ye.jsxs("div",{className:"masonry",children:[ye.jsxs("div",{className:"left-column",children:[ye.jsxs("div",{children:[ye.jsx("img",{src:"/laptop.png",alt:"Laptop"}),ye.jsx("p",{children:"Fly through demanding tasks up to 9.8x faster."})]}),ye.jsxs("div",{children:[ye.jsx("img",{src:"/sun.png",alt:"Sun"}),ye.jsxs("p",{children:["A stunning ",ye.jsx("br",{}),"Liquid Retina XDR ",ye.jsx("br",{}),"display."]})]})]}),ye.jsxs("div",{className:"right-column",children:[ye.jsxs("div",{className:"apple-gradient",children:[ye.jsx("img",{src:"/ai.png",alt:"AI"}),ye.jsxs("p",{children:["Built for ",ye.jsx("br",{}),ye.jsx("span",{children:"Apple Intelligence."})]})]}),ye.jsxs("div",{children:[ye.jsx("img",{src:"/battery.png",alt:"Battery"}),ye.jsxs("p",{children:["Up to",ye.jsxs("span",{className:"green-gradient",children:[" ","14 more hours"," "]}),"battery life.",ye.jsxs("span",{className:"text-dark-100",children:[" ","(Up to 24 hours total.)"]})]})]})]})]})]})};uc.registerPlugin(ti);const XZ=()=>ye.jsxs("main",{children:[ye.jsx(vG,{}),ye.jsx(yG,{}),ye.jsx(yZ,{}),ye.jsx(FZ,{}),ye.jsx(kZ,{}),ye.jsx(VZ,{}),ye.jsx(YZ,{}),ye.jsx(GZ,{})]});pO.createRoot(document.getElementById("root")).render(ye.jsx(Fe.StrictMode,{children:ye.jsx(XZ,{})}));
